(()=>{var Cx=Object.create;var Mc=Object.defineProperty;var Sx=Object.getOwnPropertyDescriptor;var Ix=Object.getOwnPropertyNames;var Rx=Object.getPrototypeOf,Px=Object.prototype.hasOwnProperty;var kr=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),ya=(i,t)=>{for(var e in t)Mc(i,e,{get:t[e],enumerable:!0})},Mx=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ix(t))!Px.call(i,s)&&s!==e&&Mc(i,s,{get:()=>t[s],enumerable:!(r=Sx(t,s))||r.enumerable});return i};var lo=(i,t,e)=>(e=i!=null?Cx(Rx(i)):{},Mx(t||!i||!i.__esModule?Mc(e,"default",{value:i,enumerable:!0}):e,i));var Nc=kr((eT,Dc)=>{"use strict";var Dx=Object.prototype.hasOwnProperty,ve="~";function Ta(){}Object.create&&(Ta.prototype=Object.create(null),new Ta().__proto__||(ve=!1));function Nx(i,t,e){this.fn=i,this.context=t,this.once=e||!1}function yp(i,t,e,r,s){if(typeof e!="function")throw new TypeError("The listener must be a function");var o=new Nx(e,r||i,s),n=ve?ve+t:t;return i._events[n]?i._events[n].fn?i._events[n]=[i._events[n],o]:i._events[n].push(o):(i._events[n]=o,i._eventsCount++),i}function sl(i,t){--i._eventsCount===0?i._events=new Ta:delete i._events[t]}function de(){this._events=new Ta,this._eventsCount=0}de.prototype.eventNames=function(){var t=[],e,r;if(this._eventsCount===0)return t;for(r in e=this._events)Dx.call(e,r)&&t.push(ve?r.slice(1):r);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};de.prototype.listeners=function(t){var e=ve?ve+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,o=r.length,n=new Array(o);s<o;s++)n[s]=r[s].fn;return n};de.prototype.listenerCount=function(t){var e=ve?ve+t:t,r=this._events[e];return r?r.fn?1:r.length:0};de.prototype.emit=function(t,e,r,s,o,n){var a=ve?ve+t:t;if(!this._events[a])return!1;var h=this._events[a],l=arguments.length,u,c;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,r),!0;case 4:return h.fn.call(h.context,e,r,s),!0;case 5:return h.fn.call(h.context,e,r,s,o),!0;case 6:return h.fn.call(h.context,e,r,s,o,n),!0}for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];h.fn.apply(h.context,u)}else{var d=h.length,f;for(c=0;c<d;c++)switch(h[c].once&&this.removeListener(t,h[c].fn,void 0,!0),l){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,e);break;case 3:h[c].fn.call(h[c].context,e,r);break;case 4:h[c].fn.call(h[c].context,e,r,s);break;default:if(!u)for(f=1,u=new Array(l-1);f<l;f++)u[f-1]=arguments[f];h[c].fn.apply(h[c].context,u)}}return!0};de.prototype.on=function(t,e,r){return yp(this,t,e,r,!1)};de.prototype.once=function(t,e,r){return yp(this,t,e,r,!0)};de.prototype.removeListener=function(t,e,r,s){var o=ve?ve+t:t;if(!this._events[o])return this;if(!e)return sl(this,o),this;var n=this._events[o];if(n.fn)n.fn===e&&(!s||n.once)&&(!r||n.context===r)&&sl(this,o);else{for(var a=0,h=[],l=n.length;a<l;a++)(n[a].fn!==e||s&&!n[a].once||r&&n[a].context!==r)&&h.push(n[a]);h.length?this._events[o]=h.length===1?h[0]:h:sl(this,o)}return this};de.prototype.removeAllListeners=function(t){var e;return t?(e=ve?ve+t:t,this._events[e]&&sl(this,e)):(this._events=new Ta,this._eventsCount=0),this};de.prototype.off=de.prototype.removeListener;de.prototype.addListener=de.prototype.on;de.prefixed=ve;de.EventEmitter=de;typeof Dc<"u"&&(Dc.exports=de)});var Gc=kr((iT,kc)=>{"use strict";kc.exports=al;kc.exports.default=al;function al(i,t,e){e=e||2;var r=t&&t.length,s=r?t[0]*e:i.length,o=bp(i,0,s,e,!0),n=[];if(!o||o.next===o.prev)return n;var a,h,l,u,c,d,f;if(r&&(o=Gx(i,t,o,e)),i.length>80*e){a=l=i[0],h=u=i[1];for(var p=e;p<s;p+=e)c=i[p],d=i[p+1],c<a&&(a=c),d<h&&(h=d),c>l&&(l=c),d>u&&(u=d);f=Math.max(l-a,u-h),f=f!==0?32767/f:0}return Ea(o,n,e,a,h,f,0),n}function bp(i,t,e,r,s){var o,n;if(s===Uc(i,t,e,r)>0)for(o=t;o<e;o+=r)n=vp(o,i[o],i[o+1],n);else for(o=e-r;o>=t;o-=r)n=vp(o,i[o],i[o+1],n);return n&&hl(n,n.next)&&(wa(n),n=n.next),n}function gs(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(hl(e,e.next)||Bt(e.prev,e,e.next)===0)){if(wa(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function Ea(i,t,e,r,s,o,n){if(i){!n&&o&&$x(i,r,s,o);for(var a=i,h,l;i.prev!==i.next;){if(h=i.prev,l=i.next,o?Ox(i,r,s,o):Lx(i)){t.push(h.i/e|0),t.push(i.i/e|0),t.push(l.i/e|0),wa(i),i=l.next,a=l.next;continue}if(i=l,i===a){n?n===1?(i=Ux(gs(i),t,e),Ea(i,t,e,r,s,o,2)):n===2&&kx(i,t,e,r,s,o):Ea(gs(i),t,e,r,s,o,1);break}}}}function Lx(i){var t=i.prev,e=i,r=i.next;if(Bt(t,e,r)>=0)return!1;for(var s=t.x,o=e.x,n=r.x,a=t.y,h=e.y,l=r.y,u=s<o?s<n?s:n:o<n?o:n,c=a<h?a<l?a:l:h<l?h:l,d=s>o?s>n?s:n:o>n?o:n,f=a>h?a>l?a:l:h>l?h:l,p=r.next;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&co(s,a,o,h,n,l,p.x,p.y)&&Bt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Ox(i,t,e,r){var s=i.prev,o=i,n=i.next;if(Bt(s,o,n)>=0)return!1;for(var a=s.x,h=o.x,l=n.x,u=s.y,c=o.y,d=n.y,f=a<h?a<l?a:l:h<l?h:l,p=u<c?u<d?u:d:c<d?c:d,m=a>h?a>l?a:l:h>l?h:l,g=u>c?u>d?u:d:c>d?c:d,_=Lc(f,p,t,e,r),v=Lc(m,g,t,e,r),x=i.prevZ,y=i.nextZ;x&&x.z>=_&&y&&y.z<=v;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==n&&co(a,u,h,c,l,d,x.x,x.y)&&Bt(x.prev,x,x.next)>=0||(x=x.prevZ,y.x>=f&&y.x<=m&&y.y>=p&&y.y<=g&&y!==s&&y!==n&&co(a,u,h,c,l,d,y.x,y.y)&&Bt(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;x&&x.z>=_;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==n&&co(a,u,h,c,l,d,x.x,x.y)&&Bt(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;y&&y.z<=v;){if(y.x>=f&&y.x<=m&&y.y>=p&&y.y<=g&&y!==s&&y!==n&&co(a,u,h,c,l,d,y.x,y.y)&&Bt(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function Ux(i,t,e){var r=i;do{var s=r.prev,o=r.next.next;!hl(s,o)&&Tp(s,r,r.next,o)&&Aa(s,o)&&Aa(o,s)&&(t.push(s.i/e|0),t.push(r.i/e|0),t.push(o.i/e|0),wa(r),wa(r.next),r=i=o),r=r.next}while(r!==i);return gs(r)}function kx(i,t,e,r,s,o){var n=i;do{for(var a=n.next.next;a!==n.prev;){if(n.i!==a.i&&Yx(n,a)){var h=Ep(n,a);n=gs(n,n.next),h=gs(h,h.next),Ea(n,t,e,r,s,o,0),Ea(h,t,e,r,s,o,0);return}a=a.next}n=n.next}while(n!==i)}function Gx(i,t,e,r){var s=[],o,n,a,h,l;for(o=0,n=t.length;o<n;o++)a=t[o]*r,h=o<n-1?t[o+1]*r:i.length,l=bp(i,a,h,r,!1),l===l.next&&(l.steiner=!0),s.push(zx(l));for(s.sort(Hx),o=0;o<s.length;o++)e=Vx(s[o],e);return e}function Hx(i,t){return i.x-t.x}function Vx(i,t){var e=Xx(i,t);if(!e)return t;var r=Ep(e,i);return gs(r,r.next),gs(e,e.next)}function Xx(i,t){var e=t,r=i.x,s=i.y,o=-1/0,n;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>o&&(o=a,n=e.x<e.next.x?e:e.next,a===r))return n}e=e.next}while(e!==t);if(!n)return null;var h=n,l=n.x,u=n.y,c=1/0,d;e=n;do r>=e.x&&e.x>=l&&r!==e.x&&co(s<u?r:o,s,l,u,s<u?o:r,s,e.x,e.y)&&(d=Math.abs(s-e.y)/(r-e.x),Aa(e,i)&&(d<c||d===c&&(e.x>n.x||e.x===n.x&&Wx(n,e)))&&(n=e,c=d)),e=e.next;while(e!==h);return n}function Wx(i,t){return Bt(i.prev,i,t.prev)<0&&Bt(t.next,i,i.next)<0}function $x(i,t,e,r){var s=i;do s.z===0&&(s.z=Lc(s.x,s.y,t,e,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,jx(s)}function jx(i){var t,e,r,s,o,n,a,h,l=1;do{for(e=i,i=null,o=null,n=0;e;){for(n++,r=e,a=0,t=0;t<l&&(a++,r=r.nextZ,!!r);t++);for(h=l;a>0||h>0&&r;)a!==0&&(h===0||!r||e.z<=r.z)?(s=e,e=e.nextZ,a--):(s=r,r=r.nextZ,h--),o?o.nextZ=s:i=s,s.prevZ=o,o=s;e=r}o.nextZ=null,l*=2}while(n>1);return i}function Lc(i,t,e,r,s){return i=(i-e)*s|0,t=(t-r)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function zx(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function co(i,t,e,r,s,o,n,a){return(s-n)*(t-a)>=(i-n)*(o-a)&&(i-n)*(r-a)>=(e-n)*(t-a)&&(e-n)*(o-a)>=(s-n)*(r-a)}function Yx(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!qx(i,t)&&(Aa(i,t)&&Aa(t,i)&&Kx(i,t)&&(Bt(i.prev,i,t.prev)||Bt(i,t.prev,t))||hl(i,t)&&Bt(i.prev,i,i.next)>0&&Bt(t.prev,t,t.next)>0)}function Bt(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function hl(i,t){return i.x===t.x&&i.y===t.y}function Tp(i,t,e,r){var s=nl(Bt(i,t,e)),o=nl(Bt(i,t,r)),n=nl(Bt(e,r,i)),a=nl(Bt(e,r,t));return!!(s!==o&&n!==a||s===0&&ol(i,e,t)||o===0&&ol(i,r,t)||n===0&&ol(e,i,r)||a===0&&ol(e,t,r))}function ol(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function nl(i){return i>0?1:i<0?-1:0}function qx(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&Tp(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Aa(i,t){return Bt(i.prev,i,i.next)<0?Bt(i,t,i.next)>=0&&Bt(i,i.prev,t)>=0:Bt(i,t,i.prev)<0||Bt(i,i.next,t)<0}function Kx(i,t){var e=i,r=!1,s=(i.x+t.x)/2,o=(i.y+t.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&s<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function Ep(i,t){var e=new Oc(i.i,i.x,i.y),r=new Oc(t.i,t.x,t.y),s=i.next,o=t.prev;return i.next=t,t.prev=i,e.next=s,s.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function vp(i,t,e,r){var s=new Oc(i,t,e);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function wa(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Oc(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}al.deviation=function(i,t,e,r){var s=t&&t.length,o=s?t[0]*e:i.length,n=Math.abs(Uc(i,0,o,e));if(s)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,u=a<h-1?t[a+1]*e:i.length;n-=Math.abs(Uc(i,l,u,e))}var c=0;for(a=0;a<r.length;a+=3){var d=r[a]*e,f=r[a+1]*e,p=r[a+2]*e;c+=Math.abs((i[d]-i[p])*(i[f+1]-i[d+1])-(i[d]-i[f])*(i[p+1]-i[d+1]))}return n===0&&c===0?0:Math.abs((c-n)/n)};function Uc(i,t,e,r){for(var s=0,o=t,n=e-r;o<e;o+=r)s+=(i[n]-i[o])*(i[o+1]+i[n+1]),n=o;return s}al.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,s=0;s<i.length;s++){for(var o=0;o<i[s].length;o++)for(var n=0;n<t;n++)e.vertices.push(i[s][o][n]);s>0&&(r+=i[s-1].length,e.holes.push(r))}return e}});var Ap=kr((fo,po)=>{/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i){var t=typeof fo=="object"&&fo&&!fo.nodeType&&fo,e=typeof po=="object"&&po&&!po.nodeType&&po,r=typeof global=="object"&&global;(r.global===r||r.window===r||r.self===r)&&(i=r);var s,o=2147483647,n=36,a=1,h=26,l=38,u=700,c=72,d=128,f="-",p=/^xn--/,m=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=n-a,x=Math.floor,y=String.fromCharCode,P;function H(L){throw RangeError(_[L])}function E(L,z){for(var W=L.length,xt=[];W--;)xt[W]=z(L[W]);return xt}function w(L,z){var W=L.split("@"),xt="";W.length>1&&(xt=W[0]+"@",L=W[1]),L=L.replace(g,".");var Ct=L.split("."),Gt=E(Ct,z).join(".");return xt+Gt}function N(L){for(var z=[],W=0,xt=L.length,Ct,Gt;W<xt;)Ct=L.charCodeAt(W++),Ct>=55296&&Ct<=56319&&W<xt?(Gt=L.charCodeAt(W++),(Gt&64512)==56320?z.push(((Ct&1023)<<10)+(Gt&1023)+65536):(z.push(Ct),W--)):z.push(Ct);return z}function Q(L){return E(L,function(z){var W="";return z>65535&&(z-=65536,W+=y(z>>>10&1023|55296),z=56320|z&1023),W+=y(z),W}).join("")}function O(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:n}function X(L,z){return L+22+75*(L<26)-((z!=0)<<5)}function C(L,z,W){var xt=0;for(L=W?x(L/u):L>>1,L+=x(L/z);L>v*h>>1;xt+=n)L=x(L/v);return x(xt+(v+1)*L/(L+l))}function M(L){var z=[],W=L.length,xt,Ct=0,Gt=d,Pt=c,le,Me,me,Be,$t,Ht,jt,ue,ge;for(le=L.lastIndexOf(f),le<0&&(le=0),Me=0;Me<le;++Me)L.charCodeAt(Me)>=128&&H("not-basic"),z.push(L.charCodeAt(Me));for(me=le>0?le+1:0;me<W;){for(Be=Ct,$t=1,Ht=n;me>=W&&H("invalid-input"),jt=O(L.charCodeAt(me++)),(jt>=n||jt>x((o-Ct)/$t))&&H("overflow"),Ct+=jt*$t,ue=Ht<=Pt?a:Ht>=Pt+h?h:Ht-Pt,!(jt<ue);Ht+=n)ge=n-ue,$t>x(o/ge)&&H("overflow"),$t*=ge;xt=z.length+1,Pt=C(Ct-Be,xt,Be==0),x(Ct/xt)>o-Gt&&H("overflow"),Gt+=x(Ct/xt),Ct%=xt,z.splice(Ct++,0,Gt)}return Q(z)}function at(L){var z,W,xt,Ct,Gt,Pt,le,Me,me,Be,$t,Ht=[],jt,ue,ge,xa;for(L=N(L),jt=L.length,z=d,W=0,Gt=c,Pt=0;Pt<jt;++Pt)$t=L[Pt],$t<128&&Ht.push(y($t));for(xt=Ct=Ht.length,Ct&&Ht.push(f);xt<jt;){for(le=o,Pt=0;Pt<jt;++Pt)$t=L[Pt],$t>=z&&$t<le&&(le=$t);for(ue=xt+1,le-z>x((o-W)/ue)&&H("overflow"),W+=(le-z)*ue,z=le,Pt=0;Pt<jt;++Pt)if($t=L[Pt],$t<z&&++W>o&&H("overflow"),$t==z){for(Me=W,me=n;Be=me<=Gt?a:me>=Gt+h?h:me-Gt,!(Me<Be);me+=n)xa=Me-Be,ge=n-Be,Ht.push(y(X(Be+xa%ge,0))),Me=x(xa/ge);Ht.push(y(X(Me,0))),Gt=C(W,ue,xt==Ct),W=0,++xt}++W,++z}return Ht.join("")}function ut(L){return w(L,function(z){return p.test(z)?M(z.slice(4).toLowerCase()):z})}function $(L){return w(L,function(z){return m.test(z)?"xn--"+at(z):z})}if(s={version:"1.3.2",ucs2:{decode:N,encode:Q},decode:M,encode:at,toASCII:$,toUnicode:ut},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return s});else if(t&&e)if(po.exports==t)e.exports=s;else for(P in s)s.hasOwnProperty(P)&&(t[P]=s[P]);else i.punycode=s})(fo)});var Cp=kr((rT,wp)=>{"use strict";wp.exports={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}}});var Ip=kr((sT,Sp)=>{"use strict";function Zx(i,t){return Object.prototype.hasOwnProperty.call(i,t)}Sp.exports=function(i,t,e,r){t=t||"&",e=e||"=";var s={};if(typeof i!="string"||i.length===0)return s;var o=/\+/g;i=i.split(t);var n=1e3;r&&typeof r.maxKeys=="number"&&(n=r.maxKeys);var a=i.length;n>0&&a>n&&(a=n);for(var h=0;h<a;++h){var l=i[h].replace(o,"%20"),u=l.indexOf(e),c,d,f,p;u>=0?(c=l.substr(0,u),d=l.substr(u+1)):(c=l,d=""),f=decodeURIComponent(c),p=decodeURIComponent(d),Zx(s,f)?Array.isArray(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s}});var Pp=kr((oT,Rp)=>{"use strict";var Ca=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}};Rp.exports=function(i,t,e,r){return t=t||"&",e=e||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(s){var o=encodeURIComponent(Ca(s))+e;return Array.isArray(i[s])?i[s].map(function(n){return o+encodeURIComponent(Ca(n))}).join(t):o+encodeURIComponent(Ca(i[s]))}).join(t):r?encodeURIComponent(Ca(r))+e+encodeURIComponent(Ca(i)):""}});var Mp=kr(Sa=>{"use strict";Sa.decode=Sa.parse=Ip();Sa.encode=Sa.stringify=Pp()});var Wc=kr(go=>{"use strict";var Qx=Ap(),Gi=Cp();go.parse=Ia;go.resolve=h0;go.resolveObject=l0;go.format=a0;go.Url=ei;function ei(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Jx=/^([a-z0-9.+-]+:)/i,t0=/:[0-9]*$/,e0=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,i0=["<",">",'"',"`"," ","\r",`
`,"	"],r0=["{","}","|","\\","^","`"].concat(i0),Hc=["'"].concat(r0),Bp=["%","/","?",";","#"].concat(Hc),Fp=["/","?","#"],s0=255,Dp=/^[+a-z0-9A-Z_-]{0,63}$/,o0=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,n0={javascript:!0,"javascript:":!0},Vc={javascript:!0,"javascript:":!0},mo={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Xc=Mp();function Ia(i,t,e){if(i&&Gi.isObject(i)&&i instanceof ei)return i;var r=new ei;return r.parse(i,t,e),r}ei.prototype.parse=function(i,t,e){if(!Gi.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),s=r!==-1&&r<i.indexOf("#")?"?":"#",o=i.split(s),n=/\\/g;o[0]=o[0].replace(n,"/"),i=o.join(s);var a=i;if(a=a.trim(),!e&&i.split("#").length===1){var h=e0.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=Xc.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=Jx.exec(a);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var c=a.substr(0,2)==="//";c&&!(l&&Vc[l])&&(a=a.substr(2),this.slashes=!0)}if(!Vc[l]&&(c||l&&!mo[l])){for(var d=-1,f=0;f<Fp.length;f++){var p=a.indexOf(Fp[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,g;d===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",d),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<Bp.length;f++){var p=a.indexOf(Bp[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var _=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!_)for(var v=this.hostname.split(/\./),f=0,x=v.length;f<x;f++){var y=v[f];if(y&&!y.match(Dp)){for(var P="",H=0,E=y.length;H<E;H++)y.charCodeAt(H)>127?P+="x":P+=y[H];if(!P.match(Dp)){var w=v.slice(0,f),N=v.slice(f+1),Q=y.match(o0);Q&&(w.push(Q[1]),N.unshift(Q[2])),N.length&&(a="/"+N.join(".")+a),this.hostname=w.join(".");break}}}this.hostname.length>s0?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=Qx.toASCII(this.hostname));var O=this.port?":"+this.port:"",X=this.hostname||"";this.host=X+O,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!n0[u])for(var f=0,x=Hc.length;f<x;f++){var C=Hc[f];if(a.indexOf(C)!==-1){var M=encodeURIComponent(C);M===C&&(M=escape(C)),a=a.split(C).join(M)}}var at=a.indexOf("#");at!==-1&&(this.hash=a.substr(at),a=a.slice(0,at));var ut=a.indexOf("?");if(ut!==-1?(this.search=a.substr(ut),this.query=a.substr(ut+1),t&&(this.query=Xc.parse(this.query)),a=a.slice(0,ut)):t&&(this.search="",this.query={}),a&&(this.pathname=a),mo[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var O=this.pathname||"",$=this.search||"";this.path=O+$}return this.href=this.format(),this};function a0(i){return Gi.isString(i)&&(i=Ia(i)),i instanceof ei?i.format():ei.prototype.format.call(i)}ei.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",s=!1,o="";this.host?s=i+this.host:this.hostname&&(s=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&Gi.isObject(this.query)&&Object.keys(this.query).length&&(o=Xc.stringify(this.query));var n=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||mo[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),n&&n.charAt(0)!=="?"&&(n="?"+n),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),n=n.replace("#","%23"),t+s+e+n+r};function h0(i,t){return Ia(i,!1,!0).resolve(t)}ei.prototype.resolve=function(i){return this.resolveObject(Ia(i,!1,!0)).format()};function l0(i,t){return i?Ia(i,!1,!0).resolveObject(t):t}ei.prototype.resolveObject=function(i){if(Gi.isString(i)){var t=new ei;t.parse(i,!1,!0),i=t}for(var e=new ei,r=Object.keys(this),s=0;s<r.length;s++){var o=r[s];e[o]=this[o]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var n=Object.keys(i),a=0;a<n.length;a++){var h=n[a];h!=="protocol"&&(e[h]=i[h])}return mo[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!mo[i.protocol]){for(var l=Object.keys(i),u=0;u<l.length;u++){var c=l[u];e[c]=i[c]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!Vc[i.protocol]){for(var x=(i.pathname||"").split("/");x.length&&!(i.host=x.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),x[0]!==""&&x.unshift(""),x.length<2&&x.unshift(""),e.pathname=x.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var d=e.pathname||"",f=e.search||"";e.path=d+f}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",m=i.host||i.pathname&&i.pathname.charAt(0)==="/",g=m||p||e.host&&i.pathname,_=g,v=e.pathname&&e.pathname.split("/")||[],x=i.pathname&&i.pathname.split("/")||[],y=e.protocol&&!mo[e.protocol];if(y&&(e.hostname="",e.port=null,e.host&&(v[0]===""?v[0]=e.host:v.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(x[0]===""?x[0]=i.host:x.unshift(i.host)),i.host=null),g=g&&(x[0]===""||v[0]==="")),m)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,v=x;else if(x.length)v||(v=[]),v.pop(),v=v.concat(x),e.search=i.search,e.query=i.query;else if(!Gi.isNullOrUndefined(i.search)){if(y){e.hostname=e.host=v.shift();var P=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;P&&(e.auth=P.shift(),e.host=e.hostname=P.shift())}return e.search=i.search,e.query=i.query,(!Gi.isNull(e.pathname)||!Gi.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!v.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var H=v.slice(-1)[0],E=(e.host||i.host||v.length>1)&&(H==="."||H==="..")||H==="",w=0,N=v.length;N>=0;N--)H=v[N],H==="."?v.splice(N,1):H===".."?(v.splice(N,1),w++):w&&(v.splice(N,1),w--);if(!g&&!_)for(;w--;w)v.unshift("..");g&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),E&&v.join("/").substr(-1)!=="/"&&v.push("");var Q=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(y){e.hostname=e.host=Q?"":v.length?v.shift():"";var P=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;P&&(e.auth=P.shift(),e.host=e.hostname=P.shift())}return g=g||e.host&&v.length,g&&!Q&&v.unshift(""),v.length?e.pathname=v.join("/"):(e.pathname=null,e.path=null),(!Gi.isNull(e.pathname)||!Gi.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};ei.prototype.parseHost=function(){var i=this.host,t=t0.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)}});var rf={};ya(rf,{ALPHA_MODES:()=>St,AbstractMultiResource:()=>_r,AccessibilityManager:()=>jo,AlphaFilter:()=>ko,AnimatedSprite:()=>Ws,Application:()=>Fd,ArrayResource:()=>Lo,Assets:()=>Yo,AssetsClass:()=>Ja,Attribute:()=>lr,BLEND_MODES:()=>Y,BUFFER_BITS:()=>va,BUFFER_TYPE:()=>ye,BackgroundSystem:()=>Xi,BaseImageResource:()=>Qt,BasePrepare:()=>Xs,BaseRenderTexture:()=>$r,BaseTexture:()=>j,BatchDrawCall:()=>hr,BatchGeometry:()=>Wr,BatchRenderer:()=>Vi,BatchShaderGenerator:()=>To,BatchSystem:()=>Ts,BatchTextureArray:()=>mr,BitmapFont:()=>li,BitmapFontData:()=>Pi,BitmapText:()=>Zg,BlobResource:()=>ks,BlurFilter:()=>Go,BlurFilterPass:()=>xr,Bounds:()=>Ci,BrowserAdapter:()=>il,Buffer:()=>ft,BufferResource:()=>ri,BufferSystem:()=>Do,CLEAR_MODES:()=>De,COLOR_MASK_BITS:()=>ap,Cache:()=>ai,CanvasResource:()=>Oo,Circle:()=>cr,Color:()=>tt,ColorMatrixFilter:()=>Kr,CompressedTextureResource:()=>Le,Container:()=>Dt,ContextSystem:()=>Wi,CountLimiter:()=>an,CubeResource:()=>Hl,DEG_TO_RAD:()=>xl,DRAW_MODES:()=>_e,DisplacementFilter:()=>Ho,DisplayObject:()=>lt,ENV:()=>Fe,Ellipse:()=>dr,EventBoundary:()=>Wo,EventSystem:()=>$o,ExtensionType:()=>b,Extract:()=>Hd,FORMATS:()=>I,FORMATS_TO_COMPONENTS:()=>gu,FXAAFilter:()=>Vo,FederatedDisplayObject:()=>Md,FederatedEvent:()=>oi,FederatedMouseEvent:()=>Si,FederatedPointerEvent:()=>oe,FederatedWheelEvent:()=>ni,FillStyle:()=>Zi,Filter:()=>bt,FilterState:()=>Ao,FilterSystem:()=>As,Framebuffer:()=>gr,FramebufferSystem:()=>ws,GC_MODES:()=>ba,GLFramebuffer:()=>wo,GLProgram:()=>Ro,GLTexture:()=>qr,GRAPHICS_CURVES:()=>Tg,GenerateTextureSystem:()=>Ms,Geometry:()=>ie,GeometrySystem:()=>Cs,Graphics:()=>oh,GraphicsData:()=>Er,GraphicsGeometry:()=>Au,HTMLText:()=>Qg,HTMLTextStyle:()=>dn,IGLUniformData:()=>Ml,INSTALLED:()=>yo,INTERNAL_FORMATS:()=>pe,INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:()=>yr,ImageBitmapResource:()=>wi,ImageResource:()=>jr,LINE_CAP:()=>Ye,LINE_JOIN:()=>ne,LineStyle:()=>ts,LoaderParserPriority:()=>It,MASK_TYPES:()=>Mt,MIPMAP_MODES:()=>qt,MSAA_QUALITY:()=>_t,MaskData:()=>So,MaskSystem:()=>Ss,Matrix:()=>rt,Mesh:()=>Ri,MeshBatchUvs:()=>en,MeshGeometry:()=>hi,MeshMaterial:()=>qe,MultisampleSystem:()=>Fo,NineSlicePlane:()=>Su,NoiseFilter:()=>Xo,ObjectRenderer:()=>si,ObjectRendererSystem:()=>No,ObservablePoint:()=>fe,PI_2:()=>ur,PRECISION:()=>ce,ParticleContainer:()=>Pu,ParticleRenderer:()=>nn,PlaneGeometry:()=>rn,PluginSystem:()=>Rs,Point:()=>Z,Polygon:()=>$e,Prepare:()=>hn,Program:()=>re,ProjectionSystem:()=>Ps,Quad:()=>Eo,QuadUv:()=>Yr,RAD_TO_DEG:()=>_l,RENDERER_TYPE:()=>el,Rectangle:()=>V,RenderTexture:()=>Te,RenderTexturePool:()=>Es,RenderTextureSystem:()=>Fs,Renderer:()=>Ya,ResizePlugin:()=>zo,Resource:()=>Ne,RopeGeometry:()=>sn,RoundedRectangle:()=>fr,Runner:()=>Ft,SAMPLER_TYPES:()=>U,SCALE_MODES:()=>Xe,SHAPES:()=>vt,SVGResource:()=>Us,ScissorSystem:()=>Pl,Shader:()=>Xt,ShaderSystem:()=>Ds,SimpleMesh:()=>Iu,SimplePlane:()=>on,SimpleRope:()=>Ru,Sprite:()=>se,SpriteMaskFilter:()=>Co,Spritesheet:()=>ch,StartupSystem:()=>ji,State:()=>Ut,StateSystem:()=>Nl,StencilSystem:()=>Is,SystemManager:()=>Ns,TARGETS:()=>ki,TEXT_GRADIENT:()=>Ar,TYPES:()=>G,TYPES_TO_BYTES_PER_COMPONENT:()=>eh,TYPES_TO_BYTES_PER_PIXEL:()=>_u,TemporaryDisplayObject:()=>Ka,Text:()=>hh,TextFormat:()=>Ji,TextMetrics:()=>Ke,TextStyle:()=>we,Texture:()=>B,TextureGCSystem:()=>Ai,TextureMatrix:()=>$i,TextureSystem:()=>Ls,TextureUvs:()=>zr,Ticker:()=>At,TickerPlugin:()=>Mo,TilingSprite:()=>ln,TilingSpriteRenderer:()=>un,TimeLimiter:()=>Bu,Transform:()=>pr,TransformFeedback:()=>Xl,TransformFeedbackSystem:()=>Os,UPDATE_PRIORITY:()=>Ee,UniformGroup:()=>Vt,VERSION:()=>z0,VideoResource:()=>Uo,ViewSystem:()=>zi,ViewableBuffer:()=>ar,WRAP_MODES:()=>xe,XMLFormat:()=>wr,XMLStringFormat:()=>Cr,accessibleTarget:()=>$l,autoDetectFormat:()=>Du,autoDetectRenderer:()=>Ol,autoDetectResource:()=>_s,cacheTextureArray:()=>ru,checkDataUrl:()=>Ae,checkExtension:()=>zt,checkMaxIfStatementsInShader:()=>Oa,convertToList:()=>Jt,copySearchParams:()=>Zr,createStringVariations:()=>Qa,createTexture:()=>ze,createUBOElements:()=>xd,curves:()=>Oe,defaultFilterVertex:()=>Bo,defaultVertex:()=>Ul,detectAvif:()=>ou,detectCompressedTextures:()=>du,detectDefaults:()=>au,detectMp4:()=>lu,detectOgv:()=>uu,detectWebm:()=>hu,detectWebp:()=>nu,extensions:()=>A,filters:()=>Wl,generateProgram:()=>Bl,generateUniformBufferSync:()=>Fl,getFontFamilyName:()=>Zl,getTestContext:()=>ka,getUBOData:()=>yd,graphicsUtils:()=>Jy,groupD8:()=>Et,isMobile:()=>We,isSingleItem:()=>qi,loadBitmapFont:()=>tf,loadDDS:()=>xu,loadImageBitmap:()=>Jl,loadJson:()=>ql,loadKTX:()=>yu,loadSVG:()=>tu,loadTextures:()=>Ki,loadTxt:()=>Kl,loadVideo:()=>eu,loadWebFont:()=>Ql,parseDDS:()=>th,parseKTX:()=>ih,resolveCompressedTextureUrl:()=>vu,resolveTextureUrl:()=>cu,settings:()=>T,spritesheetAsset:()=>qd,uniformParsers:()=>Ti,unsafeEvalSupported:()=>Xa,utils:()=>S});var Fe=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(Fe||{}),el=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(el||{}),va=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(va||{}),Y=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(Y||{}),_e=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(_e||{}),I=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(I||{}),ki=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(ki||{}),G=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(G||{}),U=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(U||{}),Xe=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Xe||{}),xe=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(xe||{}),qt=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(qt||{}),St=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(St||{}),De=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(De||{}),ba=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(ba||{}),ce=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(ce||{}),Mt=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(Mt||{}),ap=(i=>(i[i.RED=1]="RED",i[i.GREEN=2]="GREEN",i[i.BLUE=4]="BLUE",i[i.ALPHA=8]="ALPHA",i))(ap||{}),_t=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(_t||{}),ye=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(ye||{});var il={createCanvas:(i,t)=>{let e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")};var T={ADAPTER:il,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Bc=/iPhone/i,hp=/iPod/i,lp=/iPad/i,up=/\biOS-universal(?:.+)Mac\b/i,Fc=/\bAndroid(?:.+)Mobile\b/i,cp=/Android/i,uo=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,rl=/Silk/i,or=/Windows Phone/i,dp=/\bWindows(?:.+)ARM\b/i,fp=/BlackBerry/i,pp=/BB10/i,mp=/Opera Mini/i,gp=/\b(CriOS|Chrome)(?:.+)Mobile/i,_p=/Mobile(?:.+)Firefox\b/i,xp=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function Bx(i){return function(t){return t.test(i)}}function Gr(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var s=Bx(e),o={apple:{phone:s(Bc)&&!s(or),ipod:s(hp),tablet:!s(Bc)&&(s(lp)||xp(t))&&!s(or),universal:s(up),device:(s(Bc)||s(hp)||s(lp)||s(up)||xp(t))&&!s(or)},amazon:{phone:s(uo),tablet:!s(uo)&&s(rl),device:s(uo)||s(rl)},android:{phone:!s(or)&&s(uo)||!s(or)&&s(Fc),tablet:!s(or)&&!s(uo)&&!s(Fc)&&(s(rl)||s(cp)),device:!s(or)&&(s(uo)||s(rl)||s(Fc)||s(cp))||s(/\bokhttp\b/i)},windows:{phone:s(or),tablet:s(dp),device:s(or)||s(dp)},other:{blackberry:s(fp),blackberry10:s(pp),opera:s(mp),firefox:s(_p),chrome:s(gp),device:s(fp)||s(pp)||s(mp)||s(_p)||s(gp)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}var Fx=Gr.default??Gr,We=Fx(globalThis.navigator);var S={};ya(S,{BaseTextureCache:()=>be,BoundingBox:()=>Da,CanvasRenderTarget:()=>pl,DATA_URI:()=>dl,EventEmitter:()=>Xr.default,ProgramCache:()=>Na,TextureCache:()=>Zt,clearTextureCache:()=>um,correctBlendMode:()=>im,createIndicesForQuads:()=>nm,decomposeDataUri:()=>pm,deprecation:()=>J,destroyTextureCache:()=>lm,detectVideoAlphaMode:()=>Op,determineCrossOrigin:()=>gl,earcut:()=>mm.default,getBufferType:()=>Hr,getCanvasBoundingBox:()=>ml,getResolutionOfUrl:()=>La,hex2rgb:()=>Qp,hex2string:()=>Jp,interleaveTypedArrays:()=>am,isMobile:()=>We,isPow2:()=>Ba,isWebGLSupported:()=>ll,log2:()=>Fa,nextPow2:()=>Vr,path:()=>$c,premultiplyBlendMode:()=>Ma,premultiplyRgba:()=>rm,premultiplyTint:()=>sm,premultiplyTintToRgba:()=>om,removeItems:()=>fl,rgb2hex:()=>em,sayHello:()=>kp,sign:()=>hm,skipHello:()=>Up,string2hex:()=>tm,trimCanvas:()=>fm,uid:()=>Hi,url:()=>Lp});T.RETINA_PREFIX=/@([0-9\.]+)x/;T.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Xr=lo(Nc(),1),mm=lo(Gc(),1);var _o=lo(Wc(),1);var Np={};function J(i,t,e=3){if(Np[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),Np[t]=!0}var Lp={get parse(){return J("7.3.0","utils.url.parse is deprecated, use native URL API instead."),_o.parse},get format(){return J("7.3.0","utils.url.format is deprecated, use native URL API instead."),_o.format},get resolve(){return J("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),_o.resolve}};function vi(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function Ra(i){return i.split("?")[0].split("#")[0]}function u0(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function c0(i,t,e){return i.replace(new RegExp(u0(t),"g"),e)}function d0(i,t){let e="",r=0,s=-1,o=0,n=-1;for(let a=0;a<=i.length;++a){if(a<i.length)n=i.charCodeAt(a);else{if(n===47)break;n=47}if(n===47){if(!(s===a-1||o===1))if(s!==a-1&&o===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){let h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",r=0):(e=e.slice(0,h),r=e.length-1-e.lastIndexOf("/")),s=a,o=0;continue}}else if(e.length===2||e.length===1){e="",r=0,s=a,o=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(s+1,a)}`:e=i.slice(s+1,a),r=a-s-1;s=a,o=0}else n===46&&o!==-1?++o:o=-1}return e}var $c={toPosix(i){return c0(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){vi(i),i=this.toPosix(i);let t=/^file:\/\/\//.exec(i);if(t)return t[0];let e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(vi(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;let r=Ra(this.toPosix(t??T.ADAPTER.getBaseUrl())),s=Ra(this.toPosix(e??this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?$c.join(s,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(vi(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="",e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));let r=i.endsWith("/");return i=d0(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return vi(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){let r=i[e];if(vi(r),r.length>0)if(t===void 0)t=r;else{let s=i[e-1]??"";this.extname(s)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(vi(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0),e=t===47,r=-1,s=!0,o=this.getProtocol(i),n=i;i=i.slice(o.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!s){r=a;break}}else s=!1;return r===-1?e?"/":this.isUrl(n)?o+i:o:e&&r===1?"//":o+i.slice(0,r)},rootname(i){vi(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){let e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){vi(i),t&&vi(t),i=Ra(this.toPosix(i));let e=0,r=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let n=t.length-1,a=-1;for(o=i.length-1;o>=0;--o){let h=i.charCodeAt(o);if(h===47){if(!s){e=o+1;break}}else a===-1&&(s=!1,a=o+1),n>=0&&(h===t.charCodeAt(n)?--n===-1&&(r=o):(n=-1,r=a))}return e===r?r=a:r===-1&&(r=i.length),i.slice(e,r)}for(o=i.length-1;o>=0;--o)if(i.charCodeAt(o)===47){if(!s){e=o+1;break}}else r===-1&&(s=!1,r=o+1);return r===-1?"":i.slice(e,r)},extname(i){vi(i),i=Ra(this.toPosix(i));let t=-1,e=0,r=-1,s=!0,o=0;for(let n=i.length-1;n>=0;--n){let a=i.charCodeAt(n);if(a===47){if(!s){e=n+1;break}continue}r===-1&&(s=!1,r=n+1),a===46?t===-1?t=n:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||r===-1||o===0||o===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){vi(i);let t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=Ra(this.toPosix(i));let e=i.charCodeAt(0),r=this.isAbsolute(i),s,o="";t.root=this.rootname(i),r||this.hasProtocol(i)?s=1:s=0;let n=-1,a=0,h=-1,l=!0,u=i.length-1,c=0;for(;u>=s;--u){if(e=i.charCodeAt(u),e===47){if(!l){a=u+1;break}continue}h===-1&&(l=!1,h=u+1),e===46?n===-1?n=u:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||h===-1||c===0||c===1&&n===h-1&&n===a+1?h!==-1&&(a===0&&r?t.base=t.name=i.slice(1,h):t.base=t.name=i.slice(a,h)):(a===0&&r?(t.name=i.slice(1,n),t.base=i.slice(1,h)):(t.name=i.slice(a,n),t.base=i.slice(a,h)),t.ext=i.slice(n,h)),t.dir=this.dirname(i),o&&(t.dir=o+t.dir),t},sep:"/",delimiter:":"};var jc;async function Op(){return jc??(jc=(async()=>{let i=document.createElement("canvas").getContext("webgl");if(!i)return St.UNPACK;let t=await new Promise(o=>{let n=document.createElement("video");n.onloadeddata=()=>o(n),n.onerror=()=>o(null),n.autoplay=!1,n.crossOrigin="anonymous",n.preload="auto",n.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",n.load()});if(!t)return St.UNPACK;let e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);let r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t);let s=new Uint8Array(4);return i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,s),i.deleteFramebuffer(r),i.deleteTexture(e),i.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?St.PMA:St.UNPACK})()),jc}function Up(){J("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function kp(){J("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}var zc;function ll(){return typeof zc>"u"&&(zc=function(){let i={stencil:!0,failIfMajorPerformanceCaveat:T.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!T.ADAPTER.getWebGLRenderingContext())return!1;let t=T.ADAPTER.createCanvas(),e=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),r=!!e?.getContextAttributes()?.stencil;if(e){let s=e.getExtension("WEBGL_lose_context");s&&s.loseContext()}return e=null,r}catch{return!1}}()),zc}var f0={grad:.9,turn:360,rad:360/(2*Math.PI)},nr=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},Kt=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},ii=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},zp=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},Gp=function(i){return{r:ii(i.r,0,255),g:ii(i.g,0,255),b:ii(i.b,0,255),a:ii(i.a)}},Yc=function(i){return{r:Kt(i.r),g:Kt(i.g),b:Kt(i.b),a:Kt(i.a,3)}},p0=/^#([0-9a-f]{3,8})$/i,ul=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},Yp=function(i){var t=i.r,e=i.g,r=i.b,s=i.a,o=Math.max(t,e,r),n=o-Math.min(t,e,r),a=n?o===t?(e-r)/n:o===e?2+(r-t)/n:4+(t-e)/n:0;return{h:60*(a<0?a+6:a),s:o?n/o*100:0,v:o/255*100,a:s}},qp=function(i){var t=i.h,e=i.s,r=i.v,s=i.a;t=t/360*6,e/=100,r/=100;var o=Math.floor(t),n=r*(1-e),a=r*(1-(t-o)*e),h=r*(1-(1-t+o)*e),l=o%6;return{r:255*[r,a,n,n,h,r][l],g:255*[h,r,r,a,n,n][l],b:255*[n,n,h,r,r,a][l],a:s}},Hp=function(i){return{h:zp(i.h),s:ii(i.s,0,100),l:ii(i.l,0,100),a:ii(i.a)}},Vp=function(i){return{h:Kt(i.h),s:Kt(i.s),l:Kt(i.l),a:Kt(i.a,3)}},Xp=function(i){return qp((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},Pa=function(i){return{h:(t=Yp(i)).h,s:(s=(200-(e=t.s))*(r=t.v)/100)>0&&s<200?e*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,r,s},m0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,g0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,x0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Zc={string:[[function(i){var t=p0.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?Kt(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?Kt(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=_0.exec(i)||x0.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:Gp({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=m0.exec(i)||g0.exec(i);if(!t)return null;var e,r,s=Hp({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(f0[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Xp(s)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,s=i.a,o=s===void 0?1:s;return nr(t)&&nr(e)&&nr(r)?Gp({r:Number(t),g:Number(e),b:Number(r),a:Number(o)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,s=i.a,o=s===void 0?1:s;if(!nr(t)||!nr(e)||!nr(r))return null;var n=Hp({h:Number(t),s:Number(e),l:Number(r),a:Number(o)});return Xp(n)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,s=i.a,o=s===void 0?1:s;if(!nr(t)||!nr(e)||!nr(r))return null;var n=function(a){return{h:zp(a.h),s:ii(a.s,0,100),v:ii(a.v,0,100),a:ii(a.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(o)});return qp(n)},"hsv"]]},Wp=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},y0=function(i){return typeof i=="string"?Wp(i.trim(),Zc.string):typeof i=="object"&&i!==null?Wp(i,Zc.object):[null,void 0]};var qc=function(i,t){var e=Pa(i);return{h:e.h,s:ii(e.s+100*t,0,100),l:e.l,a:e.a}},Kc=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},$p=function(i,t){var e=Pa(i);return{h:e.h,s:e.s,l:ii(e.l+100*t,0,100),a:e.a}},Qc=function(){function i(t){this.parsed=y0(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return Kt(Kc(this.rgba),2)},i.prototype.isDark=function(){return Kc(this.rgba)<.5},i.prototype.isLight=function(){return Kc(this.rgba)>=.5},i.prototype.toHex=function(){return t=Yc(this.rgba),e=t.r,r=t.g,s=t.b,n=(o=t.a)<1?ul(Kt(255*o)):"","#"+ul(e)+ul(r)+ul(s)+n;var t,e,r,s,o,n},i.prototype.toRgb=function(){return Yc(this.rgba)},i.prototype.toRgbString=function(){return t=Yc(this.rgba),e=t.r,r=t.g,s=t.b,(o=t.a)<1?"rgba("+e+", "+r+", "+s+", "+o+")":"rgb("+e+", "+r+", "+s+")";var t,e,r,s,o},i.prototype.toHsl=function(){return Vp(Pa(this.rgba))},i.prototype.toHslString=function(){return t=Vp(Pa(this.rgba)),e=t.h,r=t.s,s=t.l,(o=t.a)<1?"hsla("+e+", "+r+"%, "+s+"%, "+o+")":"hsl("+e+", "+r+"%, "+s+"%)";var t,e,r,s,o},i.prototype.toHsv=function(){return t=Yp(this.rgba),{h:Kt(t.h),s:Kt(t.s),v:Kt(t.v),a:Kt(t.a,3)};var t},i.prototype.invert=function(){return bi({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),bi(qc(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),bi(qc(this.rgba,-t))},i.prototype.grayscale=function(){return bi(qc(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),bi($p(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),bi($p(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?bi({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Kt(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=Pa(this.rgba);return typeof t=="number"?bi({h:t,s:e.s,l:e.l,a:e.a}):Kt(e.h)},i.prototype.isEqual=function(t){return this.toHex()===bi(t).toHex()},i}(),bi=function(i){return i instanceof Qc?i:new Qc(i)},jp=[],Kp=function(i){i.forEach(function(t){jp.indexOf(t)<0&&(t(Qc,Zc),jp.push(t))})};function Zp(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in e)r[e[s]]=s;var o={};i.prototype.toName=function(n){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=r[this.toHex()];if(l)return l;if(n?.closest){var u=this.toRgb(),c=1/0,d="black";if(!o.length)for(var f in e)o[f]=new i(e[f]).toRgb();for(var p in e){var m=(a=u,h=o[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<c&&(c=m,d=p)}return d}},t.string.push([function(n){var a=n.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new i(h).toRgb():null},"name"])}Kp([Zp]);var xo=class cl{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof cl)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){let r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,o)=>s===e[o]);if(t!==null&&e!==null){let s=Object.keys(t),o=Object.keys(e);return s.length!==o.length?!1:s.every(n=>t[n]===e[n])}return t===e}toRgba(){let[t,e,r,s]=this._components;return{r:t,g:e,b:r,a:s}}toRgb(){let[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){let[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){let[e,r,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];let[e,r,s]=this._components;return t[0]=e,t[1]=r,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,r,s,o]=cl.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=s,this._components[3]*=o,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,s=this._int>>8&255,o=this._int&255;return e&&(r=r*t+.5|0,s=s*t+.5|0,o=o*t+.5|0),(t*255<<24)+(r<<16)+(s<<8)+o}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){let[e,r,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];let[e,r,s,o]=this._components;return t[0]=e,t[1]=r,t[2]=s,t[3]=o,t}normalize(t){let e,r,s,o;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let n=t;e=(n>>16&255)/255,r=(n>>8&255)/255,s=(n&255)/255,o=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,s,o=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,s,o=255]=t,e/=255,r/=255,s/=255,o/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let a=cl.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}let n=bi(t);n.isValid()&&({r:e,g:r,b:s,a:o}=n.rgba,e/=255,r/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=s,this._components[3]=o,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((s,o)=>{t[o]=Math.min(Math.max(s,e),r)}),t)}};xo.shared=new xo,xo.temp=new xo,xo.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var tt=xo;function Qp(i,t=[]){return J("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),tt.shared.setValue(i).toRgbArray(t)}function Jp(i){return J("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),tt.shared.setValue(i).toHex()}function tm(i){return J("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),tt.shared.setValue(i).toNumber()}function em(i){return J("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),tt.shared.setValue(i).toNumber()}function v0(){let i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[Y.NORMAL_NPM]=Y.NORMAL,i[Y.ADD_NPM]=Y.ADD,i[Y.SCREEN_NPM]=Y.SCREEN,t[Y.NORMAL]=Y.NORMAL_NPM,t[Y.ADD]=Y.ADD_NPM,t[Y.SCREEN]=Y.SCREEN_NPM;let e=[];return e.push(t),e.push(i),e}var Ma=v0();function im(i,t){return Ma[t?1:0][i]}function rm(i,t,e,r=!0){return J("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),tt.shared.setValue(i).premultiply(t,r).toArray(e??new Float32Array(4))}function sm(i,t){return J("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),tt.shared.setValue(i).toPremultiplied(t)}function om(i,t,e,r=!0){return J("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),tt.shared.setValue(i).premultiply(t,r).toArray(e??new Float32Array(4))}var dl=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function nm(i,t=null){let e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,s=0;r<e;r+=6,s+=4)t[r+0]=s+0,t[r+1]=s+1,t[r+2]=s+2,t[r+3]=s+0,t[r+4]=s+2,t[r+5]=s+3;return t}function Hr(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}var b0={Float32Array,Uint32Array,Int32Array,Uint8Array};function am(i,t){let e=0,r=0,s={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;let o=new ArrayBuffer(e*4),n=null,a=0;for(let h=0;h<i.length;h++){let l=t[h],u=i[h],c=Hr(u);s[c]||(s[c]=new b0[c](o)),n=s[c];for(let d=0;d<u.length;d++){let f=(d/l|0)*r+a,p=d%l;n[f+p]=u[d]}a+=l}return new Float32Array(o)}function Vr(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Ba(i){return!(i&i-1)&&!!i}function Fa(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function fl(i,t,e){let r=i.length,s;if(t>=r||e===0)return;e=t+e>r?r-t:e;let o=r-e;for(s=t;s<o;++s)i[s]=i[s+e];i.length=o}function hm(i){return i===0?0:i<0?-1:1}var T0=0;function Hi(){return++T0}var Jc=class{constructor(i,t,e,r){this.left=i,this.top=t,this.right=e,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Jc.EMPTY=new Jc(0,0,0,0);var Da=Jc;var Na={},Zt=Object.create(null),be=Object.create(null);function lm(){let i;for(i in Zt)Zt[i].destroy();for(i in be)be[i].destroy()}function um(){let i;for(i in Zt)delete Zt[i];for(i in be)delete be[i]}var pl=class{constructor(t,e,r){this._canvas=T.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||T.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function cm(i,t,e){for(let r=0,s=4*e*t;r<t;++r,s+=4)if(i[s+3]!==0)return!1;return!0}function dm(i,t,e,r,s){let o=4*t;for(let n=r,a=r*o+4*e;n<=s;++n,a+=o)if(i[a+3]!==0)return!1;return!0}function ml(i){let{width:t,height:e}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");let s=r.getImageData(0,0,t,e).data,o=0,n=0,a=t-1,h=e-1;for(;n<e&&cm(s,t,n);)++n;if(n===e)return Da.EMPTY;for(;cm(s,t,h);)--h;for(;dm(s,t,o,n,h);)++o;for(;dm(s,t,a,n,h);)--a;return++a,++h,new Da(o,n,a,h)}function fm(i){let t=ml(i),{width:e,height:r}=t,s=null;if(!t.isEmpty()){let o=i.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");s=o.getImageData(t.left,t.top,e,r)}return{width:e,height:r,data:s}}function pm(i){let t=dl.exec(i);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function gl(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;let e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function La(i,t=1){let e=T.RETINA_PREFIX?.exec(i);return e?parseFloat(e[1]):t}var b=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(b||{}),td=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},gm=(i,t)=>td(i).priority??t,A={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(td).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(td).forEach(t=>{t.type.forEach(e=>{let r=this._addHandlers,s=this._queue;r[e]?r[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(i,t,e){let r=this._addHandlers,s=this._removeHandlers;if(r[i]||s[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,s[i]=e;let o=this._queue;return o[i]&&(o[i].forEach(n=>t(n)),delete o[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((s,o)=>gm(o,e)-gm(s,e)))},r=>{let s=t.indexOf(r.ref);s!==-1&&t.splice(s,1)})}};var ar=class{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}};var E0=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function A0(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function Oa(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let e=t.createShader(t.FRAGMENT_SHADER);for(;;){let r=E0.replace(/%forloop%/gi,A0(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}var ed=0,id=1,rd=2,sd=3,od=4,nd=5,Ut=class{constructor(){this.data=0,this.blendMode=Y.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<ed)}set blend(t){!!(this.data&1<<ed)!==t&&(this.data^=1<<ed)}get offsets(){return!!(this.data&1<<id)}set offsets(t){!!(this.data&1<<id)!==t&&(this.data^=1<<id)}get culling(){return!!(this.data&1<<rd)}set culling(t){!!(this.data&1<<rd)!==t&&(this.data^=1<<rd)}get depthTest(){return!!(this.data&1<<sd)}set depthTest(t){!!(this.data&1<<sd)!==t&&(this.data^=1<<sd)}get depthMask(){return!!(this.data&1<<nd)}set depthMask(t){!!(this.data&1<<nd)!==t&&(this.data^=1<<nd)}get clockwiseFrontFace(){return!!(this.data&1<<od)}set clockwiseFrontFace(t){!!(this.data&1<<od)!==t&&(this.data^=1<<od)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==Y.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){let t=new Ut;return t.depthTest=!1,t.blend=!0,t}};Ut.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};var yo=[];function _s(i,t){if(!i)return null;let e="";if(typeof i=="string"){let r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=yo.length-1;r>=0;--r){let s=yo[r];if(s.test&&s.test(i,e))return new s(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}var Ft=class{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,s,o,n,a,h){if(arguments.length>8)throw new Error("max arguments reached");let{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](t,e,r,s,o,n,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){let e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(Ft.prototype,{dispatch:{value:Ft.prototype.emit},run:{value:Ft.prototype.emit}});var Ne=class{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Ft("setRealSize"),this.onUpdate=new Ft("update"),this.onError=new Ft("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}};var ri=class extends Ne{constructor(t,e){let{width:r,height:s}=e||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){let s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===St.UNPACK);let o=e.realWidth,n=e.realHeight;return r.width===o&&r.height===n?s.texSubImage2D(e.target,0,0,0,o,n,e.format,r.type,this.data):(r.width=o,r.height=n,s.texImage2D(e.target,0,r.internalFormat,o,n,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}};var w0={scaleMode:Xe.NEAREST,alphaMode:St.NPM},ad=class vo extends Xr.default{constructor(t=null,e=null){super(),e=Object.assign({},vo.defaultOptions,e);let{alphaMode:r,mipmap:s,anisotropicLevel:o,scaleMode:n,width:a,height:h,wrapMode:l,format:u,type:c,target:d,resolution:f,resourceOptions:p}=e;t&&!(t instanceof Ne)&&(t=_s(t,p),t.internal=!0),this.resolution=f||T.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=o,this._wrapMode=l,this._scaleMode=n,this.format=u,this.type=c,this.target=d,this.alphaMode=r,this.uid=Hi(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Ba(this.realWidth)&&Ba(this.realHeight)}setResolution(t){let e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete be[this.cacheId],delete Zt[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),vo.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=T.STRICT_TEXTURE_CACHE){let s=typeof t=="string",o=null;if(s)o=t;else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${Hi()}`}o=t._pixiId}let n=be[o];if(s&&r&&!n)throw new Error(`The cacheId "${o}" does not exist in BaseTextureCache.`);return n||(n=new vo(t,e),n.cacheId=o,vo.addToCache(n,o)),n}static fromBuffer(t,e,r,s){t=t||new Float32Array(e*r*4);let o=new ri(t,{width:e,height:r,...s?.resourceOptions}),n,a;return t instanceof Float32Array?(n=I.RGBA,a=G.FLOAT):t instanceof Int32Array?(n=I.RGBA_INTEGER,a=G.INT):t instanceof Uint32Array?(n=I.RGBA_INTEGER,a=G.UNSIGNED_INT):t instanceof Int16Array?(n=I.RGBA_INTEGER,a=G.SHORT):t instanceof Uint16Array?(n=I.RGBA_INTEGER,a=G.UNSIGNED_SHORT):t instanceof Int8Array?(n=I.RGBA,a=G.BYTE):(n=I.RGBA,a=G.UNSIGNED_BYTE),o.internal=!0,new vo(o,Object.assign({},w0,{type:a,format:n},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),be[e]&&be[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),be[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=be[t];if(e){let r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete be[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete be[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};ad.defaultOptions={mipmap:qt.POW2,anisotropicLevel:0,scaleMode:Xe.LINEAR,wrapMode:xe.CLAMP,alphaMode:St.UNPACK,target:ki.TEXTURE_2D,format:I.RGBA,type:G.UNSIGNED_BYTE},ad._globalBatch=0;var j=ad;var hr=class{constructor(){this.texArray=null,this.blend=0,this.type=_e.TRIANGLES,this.start=0,this.size=0,this.data=null}};var C0=0,ft=class{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=C0++,this.disposeRunner=new Ft("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?ye.ELEMENT_ARRAY_BUFFER:ye.ARRAY_BUFFER}get index(){return this.type===ye.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new ft(t)}};var lr=class{constructor(t,e=0,r=!1,s=G.FLOAT,o,n,a,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=s,this.stride=o,this.start=n,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,s,o){return new lr(t,e,r,s,o)}};var S0={Float32Array,Uint32Array,Int32Array,Uint8Array};function _m(i,t){let e=0,r=0,s={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;let o=new ArrayBuffer(e*4),n=null,a=0;for(let h=0;h<i.length;h++){let l=t[h],u=i[h],c=Hr(u);s[c]||(s[c]=new S0[c](o)),n=s[c];for(let d=0;d<u.length;d++){let f=(d/l|0)*r+a,p=d%l;n[f+p]=u[d]}a+=l}return new Float32Array(o)}var xm={5126:4,5123:2,5121:1},I0=0,R0={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},ie=class{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=I0++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Ft("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,s=!1,o,n,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ft||(e instanceof Array&&(e=new Float32Array(e)),e=new ft(e));let l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,r,s,o);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new lr(u,r,s,o,n,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof ft||(t instanceof Array&&(t=new Uint16Array(t)),t=new ft(t)),t.type=ye.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let t=[],e=[],r=new ft,s;for(s in this.attributes){let o=this.attributes[s],n=this.buffers[o.buffer];t.push(n.data),e.push(o.size*xm[o.type]/4),o.buffer=0}for(r.data=_m(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let t in this.attributes){let e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let t=new ie;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new ft(this.buffers[e].data.slice(0));for(let e in this.attributes){let r=this.attributes[e];t.attributes[e]=new lr(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=ye.ELEMENT_ARRAY_BUFFER),t}static merge(t){let e=new ie,r=[],s=[],o=[],n;for(let a=0;a<t.length;a++){n=t[a];for(let h=0;h<n.buffers.length;h++)s[h]=s[h]||0,s[h]+=n.buffers[h].data.length,o[h]=0}for(let a=0;a<n.buffers.length;a++)r[a]=new R0[Hr(n.buffers[a].data)](s[a]),e.buffers[a]=new ft(r[a]);for(let a=0;a<t.length;a++){n=t[a];for(let h=0;h<n.buffers.length;h++)r[h].set(n.buffers[h].data,o[h]),o[h]+=n.buffers[h].data.length}if(e.attributes=n.attributes,n.indexBuffer){e.indexBuffer=e.buffers[n.buffers.indexOf(n.indexBuffer)],e.indexBuffer.type=ye.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let c=0;c<n.buffers.length;c++)if(n.buffers[c]!==n.indexBuffer){u=c;break}for(let c in n.attributes){let d=n.attributes[c];(d.buffer|0)===u&&(h+=d.size*xm[d.type]/4)}for(let c=0;c<t.length;c++){let d=t[c].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[c].buffers[u].data.length/h,l+=d.length}}return e}};var Wr=class extends ie{constructor(t=!1){super(),this._buffer=new ft(null,t,!1),this._indexBuffer=new ft(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,G.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,G.FLOAT).addAttribute("aColor",this._buffer,4,!0,G.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,G.FLOAT).addIndex(this._indexBuffer)}};var ur=Math.PI*2,_l=180/Math.PI,xl=Math.PI/180,vt=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(vt||{});var Z=class{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Z(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}};Z.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};var yl=[new Z,new Z,new Z,new Z],V=class{constructor(t=0,e=0,r=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(s),this.type=vt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new V(0,0,0,0)}clone(){return new V(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){let w=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=w)return!1;let N=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>N}let r=this.left,s=this.right,o=this.top,n=this.bottom;if(s<=r||n<=o)return!1;let a=yl[0].set(t.left,t.top),h=yl[1].set(t.left,t.bottom),l=yl[2].set(t.right,t.top),u=yl[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;let c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=r||Math.min(a.x,h.x,l.x,u.x)>=s||Math.max(a.y,h.y,l.y,u.y)<=o||Math.min(a.y,h.y,l.y,u.y)>=n))return!1;let d=c*(h.y-a.y),f=c*(a.x-h.x),p=d*r+f*o,m=d*s+f*o,g=d*r+f*n,_=d*s+f*n;if(Math.max(p,m,g,_)<=d*a.x+f*a.y||Math.min(p,m,g,_)>=d*u.x+f*u.y)return!1;let v=c*(a.y-l.y),x=c*(l.x-a.x),y=v*r+x*o,P=v*s+x*o,H=v*r+x*n,E=v*s+x*n;return!(Math.max(y,P,H,E)<=v*a.x+x*a.y||Math.min(y,P,H,E)>=v*u.x+x*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){let e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=s,this.height=Math.max(o-s,0),this}ceil(t=1,e=.001){let r=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=s-this.y,this}enlarge(t){let e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=s,this.height=o-s,this}};V.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var cr=class{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=vt.CIRC}clone(){return new cr(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;let r=this.radius*this.radius,s=this.x-t,o=this.y-e;return s*=s,o*=o,s+o<=r}getBounds(){return new V(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}};cr.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};var dr=class{constructor(t=0,e=0,r=0,s=0){this.x=t,this.y=e,this.width=r,this.height=s,this.type=vt.ELIP}clone(){return new dr(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,s=(e-this.y)/this.height;return r*=r,s*=s,r+s<=1}getBounds(){return new V(this.x-this.width,this.y-this.height,this.width,this.height)}};dr.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var $e=class{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){let r=[];for(let s=0,o=e.length;s<o;s++)r.push(e[s].x,e[s].y);e=r}this.points=e,this.type=vt.POLY,this.closeStroke=!0}clone(){let t=this.points.slice(),e=new $e(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1,s=this.points.length/2;for(let o=0,n=s-1;o<s;n=o++){let a=this.points[o*2],h=this.points[o*2+1],l=this.points[n*2],u=this.points[n*2+1];h>e!=u>e&&t<(l-a)*((e-h)/(u-h))+a&&(r=!r)}return r}};$e.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((i,t)=>`${i}, ${t}`,"")}]`};var fr=class{constructor(t=0,e=0,r=0,s=0,o=20){this.x=t,this.y=e,this.width=r,this.height=s,this.radius=o,this.type=vt.RREC}clone(){return new fr(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){let r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let s=t-(this.x+r),o=e-(this.y+r),n=r*r;if(s*s+o*o<=n||(s=t-(this.x+this.width-r),s*s+o*o<=n)||(o=e-(this.y+this.height-r),s*s+o*o<=n)||(s=t-(this.x+r),s*s+o*o<=n))return!0}return!1}};fr.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};var rt=class{constructor(t=1,e=0,r=0,s=1,o=0,n=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=s,this.tx=o,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,s,o,n){return this.a=t,this.b=e,this.c=r,this.d=s,this.tx=o,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));let r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Z;let r=t.x,s=t.y;return e.x=this.a*r+this.c*s+this.tx,e.y=this.b*r+this.d*s+this.ty,e}applyInverse(t,e){e=e||new Z;let r=1/(this.a*this.d+this.c*-this.b),s=t.x,o=t.y;return e.x=this.d*r*s+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*o+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){let e=Math.cos(t),r=Math.sin(t),s=this.a,o=this.c,n=this.tx;return this.a=s*e-this.b*r,this.b=s*r+this.b*e,this.c=o*e-this.d*r,this.d=o*r+this.d*e,this.tx=n*e-this.ty*r,this.ty=n*r+this.ty*e,this}append(t){let e=this.a,r=this.b,s=this.c,o=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*r+t.b*o,this.c=t.c*e+t.d*s,this.d=t.c*r+t.d*o,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*r+t.ty*o+this.ty,this}setTransform(t,e,r,s,o,n,a,h,l){return this.a=Math.cos(a+l)*o,this.b=Math.sin(a+l)*o,this.c=-Math.sin(a-h)*n,this.d=Math.cos(a-h)*n,this.tx=t-(r*this.a+s*this.c),this.ty=e-(r*this.b+s*this.d),this}prepend(t){let e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){let r=this.a,s=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){let e=this.a,r=this.b,s=this.c,o=this.d,n=t.pivot,a=-Math.atan2(-s,o),h=Math.atan2(r,e),l=Math.abs(a+h);return l<1e-5||Math.abs(ur-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(s*s+o*o),t.position.x=this.tx+(n.x*e+n.y*s),t.position.y=this.ty+(n.x*r+n.y*o),t}invert(){let t=this.a,e=this.b,r=this.c,s=this.d,o=this.tx,n=t*s-e*r;return this.a=s/n,this.b=-e/n,this.c=-r/n,this.d=t/n,this.tx=(r*this.ty-s*o)/n,this.ty=-(t*this.ty-e*o)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let t=new rt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new rt}static get TEMP_MATRIX(){return new rt}};rt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};var xs=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ys=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vs=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],bs=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],hd=[],ym=[],vl=Math.sign;function P0(){for(let i=0;i<16;i++){let t=[];hd.push(t);for(let e=0;e<16;e++){let r=vl(xs[i]*xs[e]+vs[i]*ys[e]),s=vl(ys[i]*xs[e]+bs[i]*ys[e]),o=vl(xs[i]*vs[e]+vs[i]*bs[e]),n=vl(ys[i]*vs[e]+bs[i]*bs[e]);for(let a=0;a<16;a++)if(xs[a]===r&&ys[a]===s&&vs[a]===o&&bs[a]===n){t.push(a);break}}}for(let i=0;i<16;i++){let t=new rt;t.set(xs[i],ys[i],vs[i],bs[i],0,0),ym.push(t)}}P0();var Et={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>xs[i],uY:i=>ys[i],vX:i=>vs[i],vY:i=>bs[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>hd[i][t],sub:(i,t)=>hd[i][Et.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?Et.S:Et.N:Math.abs(t)*2<=Math.abs(i)?i>0?Et.E:Et.W:t>0?i>0?Et.SE:Et.SW:i>0?Et.NE:Et.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{let s=ym[Et.inv(t)];s.tx=e,s.ty=r,i.append(s)}};var fe=class{constructor(t,e,r=0,s=0){this._x=r,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new fe(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}};fe.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};var ld=class{constructor(){this.worldTransform=new rt,this.localTransform=new rt,this.position=new fe(this.onChange,this,0,0),this.scale=new fe(this.onChange,this,1,1),this.pivot=new fe(this.onChange,this,0,0),this.skew=new fe(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){let i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){let t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){let e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};ld.IDENTITY=new ld;var pr=ld;pr.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var vm=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var bm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function bl(i,t,e){let r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function ud(i){let t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Ua(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return ud(2*t);case"bvec3":return ud(3*t);case"bvec4":return ud(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Ti=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}];var M0={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},B0={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function cd(i,t){let e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let r in i.uniforms){let s=t[r];if(!s){i.uniforms[r]?.group===!0&&(i.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}let o=i.uniforms[r],n=!1;for(let a=0;a<Ti.length;a++)if(Ti[a].test(s,o)){e.push(Ti[a].code(r,o)),n=!0;break}if(!n){let a=(s.size===1&&!s.isArray?M0:B0)[s.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${a};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}var Tm={},Tl=Tm;function ka(){if(Tl===Tm||Tl?.isContextLost()){let i=T.ADAPTER.createCanvas(),t;T.PREFER_ENV>=Fe.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Tl=t}return Tl}var El;function dd(){if(!El){El=ce.MEDIUM;let i=ka();if(i&&i.getShaderPrecisionFormat){let t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(El=t.precision?ce.HIGH:ce.MEDIUM)}}return El}function Em(i,t){let e=i.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=i.getShaderInfoLog(t),s=r.split(`
`),o={},n=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!o[l]?(o[l]=!0,!0):!1),a=[""];n.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let h=e.join(`
`);a[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function fd(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||Em(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||Em(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}var F0={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ga(i){return F0[i]}var Al=null,Am={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Ha(i,t){if(!Al){let e=Object.keys(Am);Al={};for(let r=0;r<e.length;++r){let s=e[r];Al[i[s]]=Am[s]}}return Al[t]}function wl(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===ce.HIGH&&e!==ce.HIGH&&(r=ce.MEDIUM),`precision ${r} float;
${i}`}else if(e!==ce.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}var Va;function Xa(){if(typeof Va=="boolean")return Va;try{Va=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Va=!1}return Va}var D0=0,Cl={},pd=class bo{constructor(t,e,r="pixi-shader",s={}){this.extra={},this.id=D0++,this.vertexSrc=t||bo.defaultVertexSrc,this.fragmentSrc=e||bo.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Cl[r]?(Cl[r]++,r+=`-${Cl[r]}`):Cl[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=wl(this.vertexSrc,bo.defaultVertexPrecision,ce.HIGH),this.fragmentSrc=wl(this.fragmentSrc,bo.defaultFragmentPrecision,dd())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return bm}static get defaultFragmentSrc(){return vm}static from(t,e,r){let s=t+e,o=Na[s];return o||(Na[s]=o=new bo(t,e,r)),o}};pd.defaultVertexPrecision=ce.HIGH,pd.defaultFragmentPrecision=We.apple.device?ce.HIGH:ce.MEDIUM;var re=pd;var N0=0,Vt=class{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=N0++,this.static=!!e,this.ubo=!!r,t instanceof ft?(this.buffer=t,this.buffer.type=ye.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ft(new Float32Array(1)),this.buffer.type=ye.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new Vt(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new Vt(t,e,r)}static uboFrom(t,e){return new Vt(t,e??!0,!0)}};var Xt=class{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Vt?this.uniformGroup=e:this.uniformGroup=new Vt(e):this.uniformGroup=new Vt({}),this.disposeRunner=new Ft("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(let r in e.uniforms){let s=e.uniforms[r];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){let s=re.from(t,e);return new Xt(s,r)}};var To=class{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){let r=new Int32Array(t);for(let o=0;o<t;o++)r[o]=o;this.defaultGroupCache[t]=Vt.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new re(this.vertexSrc,s)}let e={tint:new Float32Array([1,1,1,1]),translationMatrix:new rt,default:this.defaultGroupCache[t]};return new Xt(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}};var mr=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}};function wm(){return!We.apple.device}function Cm(i){let t=!0,e=T.ADAPTER.getNavigator();if(We.tablet||We.phone){if(We.apple.device){let r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(We.android.device){let r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}var si=class{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}};var Sm=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var Im=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var Wa=class Ei extends si{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Wr,this.vertexSize=6,this.state=Ut.for2d(),this.size=Ei.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Cm(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??wm(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return J("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Im}static get defaultFragmentTemplate(){return Sm}setShaderGenerator({vertex:t=Ei.defaultVertexSrc,fragment:e=Ei.defaultFragmentTemplate}={}){this.shaderGenerator=new To(t,e)}contextChange(){let t=this.renderer.gl;T.PREFER_ENV===Fe.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Ei.defaultMaxTextures),this.maxTextures=Oa(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:e}=Ei,r=this.size/4,s=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new hr);for(;e.length<s;)e.push(new mr);for(let o=0;o<this.maxTextures;o++)this._tempBoundTextures[o]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:e}=this,r=Ei._textureArrayPool,s=this.renderer.batch,o=this._tempBoundTextures,n=this.renderer.textureGC.count,a=++j._globalBatch,h=0,l=r[0],u=0;s.copyBoundTextures(o,e);for(let c=0;c<this._bufferSize;++c){let d=t[c];t[c]=null,d._batchEnabled!==a&&(l.count>=e&&(s.boundArray(l,o,a,e),this.buildDrawCalls(l,u,c),u=c,l=r[++h],++a),d._batchEnabled=a,d.touched=n,l.elements[l.count++]=d)}l.count>0&&(s.boundArray(l,o,a,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let c=0;c<o.length;c++)o[c]=null;j._globalBatch=a}buildDrawCalls(t,e,r){let{_bufferedElements:s,_attributeBuffer:o,_indexBuffer:n,vertexSize:a}=this,h=Ei._drawCallPool,l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let f=e;f<r;++f){let p=s[f],m=p._texture.baseTexture,g=Ma[m.alphaMode?1:0][p.blendMode];s[f]=null,e<f&&d.blend!==g&&(d.size=c-d.start,e=f,d=h[++l],d.texArray=t,d.start=c),this.packInterleavedGeometry(p,o,n,u,c),u+=p.vertexData.length/2*a,c+=p.indices.length,d.blend=g}e<r&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){let e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;Ei.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:e,state:r}=this.renderer,s=Ei._drawCallPool,o=null;for(let n=0;n<t;n++){let{texArray:a,type:h,size:l,start:u,blend:c}=s[n];o!==a&&(o=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,r.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Ei.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){let e=Vr(Math.ceil(t/8)),r=Fa(e),s=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let o=this._aBuffers[s];return o||(this._aBuffers[s]=o=new ar(s*this.vertexSize*4)),o}getIndexBuffer(t){let e=Vr(Math.ceil(t/12)),r=Fa(e),s=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let o=this._iBuffers[r];return o||(this._iBuffers[r]=o=new Uint16Array(s)),o}packInterleavedGeometry(t,e,r,s,o){let{uint32View:n,float32View:a}=e,h=s/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=tt.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let m=0;m<c.length;m+=2)a[s++]=c[m],a[s++]=c[m+1],a[s++]=l[m],a[s++]=l[m+1],n[s++]=p,a[s++]=d;for(let m=0;m<u.length;m++)r[o++]=h+u[m]}};Wa.defaultBatchSize=4096,Wa.extension={name:"batch",type:b.RendererPlugin},Wa._drawCallPool=[],Wa._textureArrayPool=[];var Vi=Wa;A.add(Vi);var Rm=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var Pm=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var md=class $a extends Xt{constructor(t,e,r){let s=re.from(t||$a.defaultVertexSrc,e||$a.defaultFragmentSrc);super(s,r),this.padding=0,this.resolution=$a.defaultResolution,this.multisample=$a.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Ut}apply(t,e,r,s,o){t.applyFilter(this,e,r,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Pm}static get defaultFragmentSrc(){return Rm}};md.defaultResolution=1,md.defaultMultisample=_t.NONE;var bt=md;var Xi=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new tt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;let{backgroundColor:e,background:r,backgroundAlpha:s}=t,o=r??e;o!==void 0&&(this.color=o),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}};Xi.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Xi.extension={type:[b.RendererSystem,b.CanvasRendererSystem],name:"background"};A.add(Xi);var Ts=class{constructor(t){this.renderer=t,this.emptyRenderer=new si(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){let{boundTextures:r}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=r[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,r,s){let{elements:o,ids:n,count:a}=t,h=0;for(let l=0;l<a;l++){let u=o[l],c=u._batchLocation;if(c>=0&&c<s&&e[c]===u){n[l]=c;continue}for(;h<s;){let d=e[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}n[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}};Ts.extension={type:b.RendererSystem,name:"batch"};A.add(Ts);var Mm=0,Wi=class{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Mm++}init(t){if(t.context)this.initFromContext(t.context);else{let e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Mm++,this.renderer.runners.contextChange.emit(t);let e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){let e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(T.PREFER_ENV>=Fe.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){let{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){let e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};Wi.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Wi.extension={type:b.RendererSystem,name:"context"};A.add(Wi);var gr=class{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Ft("disposeFramebuffer"),this.multisample=_t.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new j(null,{scaleMode:Xe.NEAREST,resolution:1,mipmap:qt.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new j(null,{scaleMode:Xe.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:qt.OFF,format:I.DEPTH_COMPONENT,type:G.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){let s=this.colorTextures[r],o=s.resolution;s.setSize(t/o,e/o)}if(this.depthTexture){let r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var $r=class extends j{constructor(t={}){if(typeof t=="number"){let e=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3];t={width:e,height:r,scaleMode:s,resolution:o}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=_t.NONE),super(null,t),this.mipmap=qt.OFF,this.valid=!0,this._clear=new tt([0,0,0,0]),this.framebuffer=new gr(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var Qt=class extends Ne{constructor(t){let e=t,r=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;super(r,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=gl(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,s){let o=t.gl,n=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===St.UNPACK),!this.noSubImage&&e.target===o.TEXTURE_2D&&r.width===n&&r.height===a?o.texSubImage2D(o.TEXTURE_2D,0,0,0,e.format,r.type,s):(r.width=n,r.height=a,o.texImage2D(e.target,0,r.internalFormat,e.format,r.type,s)),!0}update(){if(this.destroyed)return;let t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}};var jr=class extends Qt{constructor(t,e){if(e=e||{},typeof t=="string"){let r=new Image;Qt.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??T.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{let s=this.source;this.url=s.src;let o=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?o():(s.onload=o,s.onerror=n=>{r(n),this.onError.emit(n)})}),this._load)}process(){let t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===St.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let s=!0,o=e._glTextures;for(let n in o){let a=o[n];if(a!==r&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}};var zr=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){let s=e.width,o=e.height;if(r){let n=t.width/2/s,a=t.height/2/o,h=t.x/s+n,l=t.y/o+a;r=Et.add(r,Et.NW),this.x0=h+n*Et.uX(r),this.y0=l+a*Et.uY(r),r=Et.add(r,2),this.x1=h+n*Et.uX(r),this.y1=l+a*Et.uY(r),r=Et.add(r,2),this.x2=h+n*Et.uX(r),this.y2=l+a*Et.uY(r),r=Et.add(r,2),this.x3=h+n*Et.uX(r),this.y3=l+a*Et.uY(r)}else this.x0=t.x/s,this.y0=t.y/o,this.x1=(t.x+t.width)/s,this.y1=t.y/o,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/o,this.x3=t.x/s,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}};zr.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};var Bm=new zr;function Sl(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}var B=class extends Xr.default{constructor(t,e,r,s,o,n,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new V(0,0,1,1)),t instanceof B&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=Bm,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new Z(n.x,n.y):new Z(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){let{resource:e}=this.baseTexture;e?.url&&Zt[e.url]&&B.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,B.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){let t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new B(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===Bm&&(this._uvs=new zr),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=T.STRICT_TEXTURE_CACHE){let s=typeof t=="string",o=null;if(s)o=t;else if(t instanceof j){if(!t.cacheId){let a=e?.pixiIdPrefix||"pixiid";t.cacheId=`${a}-${Hi()}`,j.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${Hi()}`}o=t._pixiId}let n=Zt[o];if(s&&r&&!n)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!n&&!(t instanceof j)?(e.resolution||(e.resolution=La(t)),n=new B(new j(t,e)),n.baseTexture.cacheId=o,j.addToCache(n.baseTexture,o),B.addToCache(n,o)):!n&&t instanceof j&&(n=new B(t),B.addToCache(n,o)),n}static fromURL(t,e){let r=Object.assign({autoLoad:!1},e?.resourceOptions),s=B.from(t,Object.assign({resourceOptions:r},e),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,r,s){return new B(j.fromBuffer(t,e,r,s))}static fromLoader(t,e,r,s){let o=new j(t,Object.assign({scaleMode:j.defaultOptions.scaleMode,resolution:La(e)},s)),{resource:n}=o;n instanceof jr&&(n.url=e);let a=new B(o);return r||(r=e),j.addToCache(a.baseTexture,r),B.addToCache(a,r),r!==e&&(j.addToCache(a.baseTexture,e),B.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Zt[e]&&Zt[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Zt[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=Zt[t];if(e){let r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Zt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Zt[t.textureCacheIds[e]]===t&&delete Zt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;let{x:e,y:r,width:s,height:o}=t,n=e+s>this.baseTexture.width,a=r+o>this.baseTexture.height;if(n||a){let h=n&&a?"and":"or",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,u=`Y: ${r} + ${o} = ${r+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return B._EMPTY||(B._EMPTY=new B(new j),Sl(B._EMPTY),Sl(B._EMPTY.baseTexture)),B._EMPTY}static get WHITE(){if(!B._WHITE){let t=T.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),B._WHITE=new B(j.from(t)),Sl(B._WHITE),Sl(B._WHITE.baseTexture)}return B._WHITE}};var Te=class extends B{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){let s=this.baseTexture.resolution,o=Math.round(t*s)/s,n=Math.round(e*s)/s;this.valid=o>0&&n>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=n,r&&this.baseTexture.resize(o,n),this.updateUvs()}setResolution(t){let{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Te(new $r(t))}};var Es=class{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=_t.NONE){let s=new $r(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Te(s)}getOptimalTexture(t,e,r=1,s=_t.NONE){let o;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Vr(t),e=Vr(e),o=((t&65535)<<16|e&65535)>>>0,s>1&&(o+=s*4294967296)):o=s>1?-s:-1,this.texturePool[o]||(this.texturePool[o]=[]);let n=this.texturePool[o].pop();return n||(n=this.createTexture(t,e,s)),n.filterPoolKey=o,n.setResolution(r),n}getFilterTexture(t,e,r){let s=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||_t.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){let e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(let e in this.texturePool){let r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(let e in this.texturePool){if(!(Number(e)<0))continue;let r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}};Es.SCREEN_KEY=-1;var Eo=class extends ie{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var Yr=class extends ie{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ft(this.vertices),this.uvBuffer=new ft(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+e.width/t.width,this.uvs[3]=s,this.uvs[4]=r+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=r,this.uvs[7]=s+e.height/t.height,r=e.x,s=e.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+e.width,this.vertices[3]=s,this.vertices[4]=r+e.width,this.vertices[5]=s+e.height,this.vertices[6]=r,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var Ao=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=_t.NONE,this.sourceFrame=new V,this.destinationFrame=new V,this.bindingSourceFrame=new V,this.bindingDestinationFrame=new V,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var Il=[new Z,new Z,new Z,new Z],gd=new rt,As=class{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Es,this.statePool=[],this.quad=new Eo,this.quadUv=new Yr,this.tempRect=new V,this.activeState={},this.globalUniforms=new Vt({outputFrame:new V,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){let r=this.renderer,s=this.defaultFilterStack,o=this.statePool.pop()||new Ao,n=r.renderTexture,a,h;if(n.current){let g=n.current;a=g.resolution,h=g.multisample}else a=r.resolution,h=r.multisample;let l=e[0].resolution||a,u=e[0].multisample??h,c=e[0].padding,d=e[0].autoFit,f=e[0].legacy??!0;for(let g=1;g<e.length;g++){let _=e[g];l=Math.min(l,_.resolution||a),u=Math.min(u,_.multisample??h),c=this.useMaxPadding?Math.max(c,_.padding):c+_.padding,d=d&&_.autoFit,f=f||(_.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=n.current),s.push(o),o.resolution=l,o.multisample=u,o.legacy=f,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(c);let p=this.tempRect.copyFrom(n.sourceFrame);r.projection.transform&&this.transformAABB(gd.copyFrom(r.projection.transform).invert(),p),d?(o.sourceFrame.fit(p),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(p)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,n.current?n.current.resolution:r.resolution,n.sourceFrame,n.destinationFrame,r.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,l,u),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;let m=this.tempRect;m.x=0,m.y=0,m.width=o.sourceFrame.width,m.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(n.sourceFrame),o.bindingDestinationFrame.copyFrom(n.destinationFrame),o.transform=r.projection.transform,r.projection.transform=null,n.bind(o.renderTexture,o.sourceFrame,m),r.framebuffer.clear(0,0,0,0)}pop(){let t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;let s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;let o=s.inputSize,n=s.inputPixel,a=s.inputClamp;if(o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],n[0]=Math.round(o[0]*e.resolution),n[1]=Math.round(o[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],a[0]=.5*n[2],a[1]=.5*n[3],a[2]=e.sourceFrame.width*o[2]-.5*n[2],a[3]=e.sourceFrame.height*o[3]-.5*n[3],e.legacy){let l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,De.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<r.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[c].apply(this,l,u,De.CLEAR,e);let d=l;l=u,u=d}r[c].apply(this,l,h.renderTexture,De.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=De.CLEAR){let{renderTexture:r,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){let n=this.tempRect;n.x=0,n.y=0,n.width=t.filterFrame.width,n.height=t.filterFrame.height,r.bind(t,t.filterFrame,n)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let o=s.stateId&1||this.forceClear;(e===De.CLEAR||e===De.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,s){let o=this.renderer;o.state.set(t.state),this.bindAndClear(r,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(_e.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(_e.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){let{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:o}=e._texture,n=t.set(s.width,0,0,s.height,r.x,r.y),a=e.worldTransform.copyTo(rt.TEMP_MATRIX);return a.invert(),n.prepend(a),n.scale(1/o.width,1/o.height),n.translate(e.anchor.x,e.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,s=_t.NONE){return this.texturePool.getOptimalTexture(t,e,r,s)}getFilterTexture(t,e,r){if(typeof t=="number"){let o=t;t=e,e=o}t=t||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||_t.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){let r=Il[0],s=Il[1],o=Il[2],n=Il[3];r.set(e.left,e.top),s.set(e.left,e.bottom),o.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(r,r),t.apply(s,s),t.apply(o,o),t.apply(n,n);let a=Math.min(r.x,s.x,o.x,n.x),h=Math.min(r.y,s.y,o.y,n.y),l=Math.max(r.x,s.x,o.x,n.x),u=Math.max(r.y,s.y,o.y,n.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,r,s,o){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(o){let{a:n,b:a,c:h,d:l}=o;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(n)>1e-4||Math.abs(l)>1e-4))return}o=o?gd.copyFrom(o):gd.identity(),o.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(o,t),t.ceil(e),this.transformAABB(o.invert(),t)}}};As.extension={type:b.RendererSystem,name:"filter"};A.add(As);var wo=class{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=_t.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var L0=new V,ws=class{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new gr(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new V,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;T.PREFER_ENV===Fe.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){let{gl:s}=this;if(t){let o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=r),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let n=0;n<t.colorTextures.length;n++){let a=t.colorTextures[n];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){let n=e.width>>r,a=e.height>>r,h=n/e.width;this.setViewport(e.x*h,e.y*h,n,a)}else{let n=t.width>>r,a=t.height>>r;this.setViewport(0,0,n,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,s){let o=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),s=Math.round(s),(o.width!==r||o.height!==s||o.x!==t||o.y!==e)&&(o.x=t,o.y=e,o.width=r,o.height=s,this.gl.viewport(t,e,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,s,o=va.COLOR|va.DEPTH){let{gl:n}=this;n.clearColor(t,e,r,s),n.clear(o)}initFramebuffer(t){let{gl:e}=this,r=new wo(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){let{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let n;this.renderer.context.webGLVersion===1?n=e.DEPTH_STENCIL:t.depth&&t.stencil?n=e.DEPTH24_STENCIL8:t.depth?n=e.DEPTH_COMPONENT24:n=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,n,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,n,t.width,t.height)}let s=t.colorTextures,o=s.length;e.drawBuffers||(o=Math.min(o,1));for(let n=0;n<o;n++){let a=s[n],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),n===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){let{gl:r}=this,s=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures,n=o.length;r.drawBuffers||(n=Math.min(n,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let h=0;h<n;h++){let l=o[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(r.COLOR_ATTACHMENT0+h))}if(a.length>1&&r.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){let h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):t.depth&&t.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):t.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,l,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,l,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,s.stencil)}else s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){let{msaaSamples:e}=this,r=_t.NONE;if(t<=1||e===null)return r;for(let s=0;s<e.length;s++)if(e[s]<=t){r=e[s];break}return r===1&&(r=_t.NONE),r}blit(t,e,r){let{current:s,renderer:o,gl:n,CONTEXT_UID:a}=this;if(o.context.webGLVersion!==2||!s)return;let h=s.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;let u=s.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new gr(s.width,s.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=L0,e.width=s.width,e.height=s.height),r||(r=e);let l=e.width===r.width&&e.height===r.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,h.framebuffer),n.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,n.COLOR_BUFFER_BIT,l?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){let r=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];let o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){let e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){let t=this.current;if(!t)return;let e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;let r=t.width,s=t.height,o=this.gl,n=e.stencil=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,n);let a,h;this.renderer.context.webGLVersion===1?(a=o.DEPTH_STENCIL_ATTACHMENT,h=o.DEPTH_STENCIL):t.depth?(a=o.DEPTH_STENCIL_ATTACHMENT,h=o.DEPTH24_STENCIL8):(a=o.STENCIL_ATTACHMENT,h=o.STENCIL_INDEX8),e.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,e.multisample,h,r,s):o.renderbufferStorage(o.RENDERBUFFER,h,r,s),o.framebufferRenderbuffer(o.FRAMEBUFFER,a,o.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new V}destroy(){this.renderer=null}};ws.extension={type:b.RendererSystem,name:"framebuffer"};A.add(ws);var _d={5126:4,5123:2,5121:1},Cs=class{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;T.PREFER_ENV===Fe.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=s=>r.bindVertexArrayOES(s),t.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){let r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(s,o)=>r.vertexAttribDivisorANGLE(s,o),t.drawElementsInstanced=(s,o,n,a,h)=>r.drawElementsInstancedANGLE(s,o,n,a,h),t.drawArraysInstanced=(s,o,n,a)=>r.drawArraysInstancedANGLE(s,o,n,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;let{gl:r}=this,s=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},o=!0);let n=s[e.program.id]||this.initGeometryVao(t,e,o);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?r.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){let s=t.buffers[r];e.update(s)}}checkCompatibility(t,e){let r=t.attributes,s=e.attributeData;for(let o in s)if(!r[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,e){let r=t.attributes,s=e.attributeData,o=["g",t.id];for(let n in r)s[n]&&o.push(n,s[n].location);return o.join("-")}initGeometryVao(t,e,r=!0){let s=this.gl,o=this.CONTEXT_UID,n=this.renderer.buffer,a=e.program;a.glPrograms[o]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);let h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID],u=l[h];if(u)return l[a.id]=u,u;let c=t.buffers,d=t.attributes,f={},p={};for(let m in c)f[m]=0,p[m]=0;for(let m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*_d[d[m].type];for(let m in d){let g=d[m],_=g.size;g.stride===void 0&&(f[g.buffer]===_*_d[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=_*_d[g.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let m=0;m<c.length;m++){let g=c[m];n.bind(g),r&&g._glBuffers[o].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,s.bindVertexArray(null),n.unbind(ye.ARRAY_BUFFER),u}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];let r=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=t.buffers,n=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!r){if(n)for(let a=0;a<o.length;a++){let h=o[a]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(o[a],e))}if(!e){for(let a in r)if(a[0]==="g"){let h=r[a];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){let e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){let r=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,n=t.buffers,a=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let h=null;for(let l in a){let u=a[l],c=n[u.buffer],d=c._glBuffers[s];if(e.attributeData[l]){h!==d&&(o.bind(c),h=d);let f=e.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,s){let{gl:o}=this,n=this._activeGeometry;if(n.indexBuffer){let a=n.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?n.instanced?o.drawElementsInstanced(t,e||n.indexBuffer.data.length,h,(r||0)*a,s||1):o.drawElements(t,e||n.indexBuffer.data.length,h,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else n.instanced?o.drawArraysInstanced(t,r,e||n.getSize(),s||1):o.drawArrays(t,r,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};Cs.extension={type:b.RendererSystem,name:"geometry"};A.add(Cs);var Fm=new rt,$i=class{constructor(t,e){this._texture=t,this.mapCoord=new rt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);let r=this.mapCoord;for(let s=0;s<t.length;s+=2){let o=t[s],n=t[s+1];e[s]=o*r.a+n*r.c+r.tx,e[s+1]=o*r.b+n*r.d+r.ty}return e}update(t){let e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;let r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);let s=e.orig,o=e.trim;o&&(Fm.set(s.width/o.width,0,0,s.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(Fm));let n=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/n.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/n.width,a[1]=(e._frame.y+h+l)/n.height,a[2]=(e._frame.x+e._frame.width-h+l)/n.width,a[3]=(e._frame.y+e._frame.height-h+l)/n.height,this.uClampOffset[0]=l/n.realWidth,this.uClampOffset[1]=l/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&e.rotate===0,!0}};var Dm=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var Nm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var Co=class extends bt{constructor(t,e,r){let s=null;typeof t!="string"&&e===void 0&&r===void 0&&(s=t,t=void 0,e=void 0,r=void 0),super(t||Nm,e||Dm,r),this.maskSprite=s,this.maskMatrix=new rt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,s){let o=this._maskSprite,n=o._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new $i(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,r,s))}};var So=class{constructor(t=null){this.type=Mt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=bt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Mt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var Ss=class{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){let o=this.maskDataPool.pop()||new So;o.pooled=!0,o.maskObject=e,r=o}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==Mt.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Mt.SCISSOR:this.renderer.scissor.push(r);break;case Mt.STENCIL:this.renderer.stencil.push(r);break;case Mt.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Mt.COLOR:this.pushColorMask(r);break;default:break}r.type===Mt.SPRITE&&this.maskStack.push(r)}pop(t){let e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Mt.SCISSOR:this.renderer.scissor.pop(e);break;case Mt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Mt.SPRITE:this.popSpriteMask(e);break;case Mt.COLOR:this.popColorMask(e);break;default:break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){let r=this.maskStack[this.maskStack.length-1];r.type===Mt.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){let e=t.maskObject;e?e.isSprite?t.type=Mt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Mt.SCISSOR:t.type=Mt.STENCIL:t.type=Mt.COLOR}pushSpriteMask(t){let{maskObject:e}=t,r=t._target,s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Co])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;let o=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,s),r.filterArea=o,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){let e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){let e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}};Ss.extension={type:b.RendererSystem,name:"mask"};A.add(Ss);var Io=class{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){let{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;let s=this.getStackLength();s!==r&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var Lm=new rt,Om=[],Um=class Rl extends Io{constructor(t){super(t),this.glConst=T.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;let e=t._scissorRect,{maskObject:r}=t,{renderer:s}=this,o=s.renderTexture,n=r.getBounds(!0,Om.pop()??new V);this.roundFrameToPixels(n,o.current?o.current.resolution:s.resolution,o.sourceFrame,o.destinationFrame,s.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;let{a:e,b:r,c:s,d:o}=t;return(Math.abs(r)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(o)>1e-4)}testScissor(t){let{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Rl.isMatrixRotated(e.worldTransform)||Rl.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,s,o){Rl.isMatrixRotated(o)||(o=o?Lm.copyFrom(o):Lm.identity(),o.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.renderer.filter.transformAABB(o,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);let{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){let{gl:e}=this.renderer;t&&Om.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){let t=this.maskStack[this.maskStack.length-1]._scissorRect,e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Um.extension={type:b.RendererSystem,name:"scissor"};var Pl=Um;A.add(Pl);var Is=class extends Io{constructor(t){super(t),this.glConst=T.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){let e=t.maskObject,{gl:r}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;let o=t._colorMask;o!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,o!==0&&(t._colorMask=o,r.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){let e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{let r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(r._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}};Is.extension={type:b.RendererSystem,name:"stencil"};A.add(Is);var Rs=class{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){let t=this.rendererPlugins;for(let e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(let t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}};Rs.extension={type:[b.RendererSystem,b.CanvasRendererSystem],name:"_plugin"};A.add(Rs);var Ps=class{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new rt,this.transform=null}update(t,e,r,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);let o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,e,r,s){let o=this.projectionMatrix,n=s?-1:1;o.identity(),o.a=1/e.width*2,o.d=n*(1/e.height*2),o.tx=-1-e.x*o.a,o.ty=-n-e.y*o.d}setTransform(t){}destroy(){this.renderer=null}};Ps.extension={type:b.RendererSystem,name:"projection"};A.add(Ps);var O0=new pr,km=new V,Ms=class{constructor(t){this.renderer=t,this._tempMatrix=new rt}generateTexture(t,e){let{region:r,...s}=e||{},o=r?.copyTo(km)||t.getLocalBounds(km,!0),n=s.resolution||this.renderer.resolution;o.width=Math.max(o.width,1/n),o.height=Math.max(o.height,1/n),s.width=o.width,s.height=o.height,s.resolution=n,s.multisample??(s.multisample=this.renderer.multisample);let a=Te.create(s);this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;let h=t.transform;return t.transform=O0,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}};Ms.extension={type:[b.RendererSystem,b.CanvasRendererSystem],name:"textureGenerator"};A.add(Ms);var Bs=new V,ja=new V,Fs=class{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new V,this.destinationFrame=new V,this.viewportFrame=new V}contextChange(){let t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){let s=this.renderer;this.current=t;let o,n,a;t?(o=t.baseTexture,a=o.resolution,e||(Bs.width=t.frame.width,Bs.height=t.frame.height,e=Bs),r||(ja.x=t.frame.x,ja.y=t.frame.y,ja.width=e.width,ja.height=e.height,r=ja),n=o.framebuffer):(a=s.resolution,e||(Bs.width=s._view.screen.width,Bs.height=s._view.screen.height,e=Bs),r||(r=Bs,r.width=e.width,r.height=e.height));let h=this.viewportFrame;h.x=r.x*a,h.y=r.y*a,h.width=r.width*a,h.height=r.height*a,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(n,h),this.renderer.projection.update(r,e,a,!n),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){let r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=tt.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);let o=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,a=o.width!==n.width||o.height!==n.height;if(a){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};Fs.extension={type:b.RendererSystem,name:"renderTexture"};A.add(Fs);var Ml=class{},Ro=class{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function Gm(i,t){let e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let o=t.getActiveAttrib(i,s);if(o.name.startsWith("gl_"))continue;let n=Ha(t,o.type),a={type:n,name:o.name,size:Ga(n),location:t.getAttribLocation(i,o.name)};e[o.name]=a}return e}function Hm(i,t){let e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){let o=t.getActiveUniform(i,s),n=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),h=Ha(t,o.type);e[n]={name:n,index:s,type:h,size:o.size,isArray:a,value:Ua(h,o.size)}}return e}function Bl(i,t){let e=bl(i,i.VERTEX_SHADER,t.vertexSrc),r=bl(i,i.FRAGMENT_SHADER,t.fragmentSrc),s=i.createProgram();i.attachShader(s,e),i.attachShader(s,r);let o=t.extra?.transformFeedbackVaryings;if(o&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(s,o.names,o.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||fd(i,s,e,r),t.attributeData=Gm(s,i),t.uniformData=Hm(s,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){let a=Object.keys(t.attributeData);a.sort((h,l)=>h>l?1:-1);for(let h=0;h<a.length;h++)t.attributeData[a[h]].location=h,i.bindAttribLocation(s,h,a[h]);i.linkProgram(s)}i.deleteShader(e),i.deleteShader(r);let n={};for(let a in t.uniformData){let h=t.uniformData[a];n[a]={location:i.getUniformLocation(s,a),value:Ua(h.type,h.size)}}return new Ro(s,n)}function U0(i,t,e,r,s){e.buffer.update(s)}var k0={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Vm={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function xd(i){let t=i.map(o=>({data:o,offset:0,dataLen:0,dirty:0})),e=0,r=0,s=0;for(let o=0;o<t.length;o++){let n=t[o];if(e=Vm[n.data.type],n.data.size>1&&(e=Math.max(e,16)*n.data.size),n.dataLen=e,r%e!==0&&r<16){let a=r%e%16;r+=a,s+=a}r+e>16?(s=Math.ceil(s/16)*16,n.offset=s,s+=e,r=e):(n.offset=s,r+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function yd(i,t){let e=[];for(let r in i)t[r]&&e.push(t[r]);return e.sort((r,s)=>r.index-s.index),e}function Fl(i,t){if(!i.autoManage)return{size:0,syncFunc:U0};let e=yd(i.uniforms,t),{uboElements:r,size:s}=xd(e),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let n=0;n<r.length;n++){let a=r[n],h=i.uniforms[a.data.name],l=a.data.name,u=!1;for(let c=0;c<Ti.length;c++){let d=Ti[c];if(d.codeUbo&&d.test(a.data,h)){o.push(`offset = ${a.offset/4};`,Ti[c].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){let c=Ga(a.data.type),d=Math.max(Vm[a.data.type]/16,1),f=c/d,p=(4-f%4)%4;o.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{let c=k0[a.data.type];o.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${c};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}var G0=0,Dl={textureCount:0,uboCount:0},Ds=class{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=G0++}systemCheck(){if(!Xa())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;let r=t.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),e||(Dl.textureCount=0,Dl.uboCount=0,this.syncUniformGroup(t.uniformGroup,Dl)),s}setUniforms(t){let e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){let r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){let e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=cd(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){let r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;let s=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),s(r.uniformData,t.uniforms,this.renderer,Dl,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){let{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);let o=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;let n=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[n];if(a||(a=this._uboCache[n]=Fl(t,this.shader.program.uniformData)),t.autoManage){let h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){let s=t.uniforms,o=[`${r}-`];for(let n in s)o.push(n),e[n]&&o.push(e[n].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){let e=this.gl,r=t.program,s=Bl(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};Ds.extension={type:b.RendererSystem,name:"shader"};A.add(Ds);var ji=class{constructor(t){this.renderer=t}run(t){let{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}};ji.defaultOptions={hello:!1},ji.extension={type:[b.RendererSystem,b.CanvasRendererSystem],name:"startup"};A.add(ji);function Xm(i,t=[]){return t[Y.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.ADD]=[i.ONE,i.ONE],t[Y.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.NONE]=[0,0],t[Y.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[Y.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Y.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[Y.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[Y.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[Y.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[Y.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[Y.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[Y.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[Y.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[Y.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}var H0=0,V0=1,X0=2,W0=3,$0=4,j0=5,Wm=class vd{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Y.NONE,this._blendEq=!1,this.map=[],this.map[H0]=this.setBlend,this.map[V0]=this.setOffset,this.map[X0]=this.setCullFace,this.map[W0]=this.setDepthTest,this.map[$0]=this.setFrontFace,this.map[j0]=this.setDepthMask,this.checks=[],this.defaultState=new Ut,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=Xm(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(vd.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(vd.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;let e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){let r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Wm.extension={type:b.RendererSystem,name:"state"};var Nl=Wm;A.add(Nl);var Ns=class extends Xr.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);let e=(t.priority??[]).filter(s=>t.systems[s]),r=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(let s of r)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Ft(e)})}addSystem(t,e){let r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(let s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(t,e){let r=Object.keys(this._systemsHash);t.items.forEach(s=>{let o=r.find(n=>this._systemsHash[n]===s);s[t.name](e[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}};var za=class Ll{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Ll.defaultMaxIdle,this.checkCountMax=Ll.defaultCheckCountMax,this.mode=Ll.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==ba.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let t=this.renderer.texture,e=t.managedTextures,r=!1;for(let s=0;s<e.length;s++){let o=e[s];o.resource&&this.count-o.touched>this.maxIdle&&(t.destroyTexture(o,!0),e[s]=null,r=!0)}if(r){let s=0;for(let o=0;o<e.length;o++)e[o]!==null&&(e[s++]=e[o]);e.length=s}}unload(t){let e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};za.defaultMode=ba.AUTO,za.defaultMaxIdle=60*60,za.defaultCheckCountMax=60*10,za.extension={type:b.RendererSystem,name:"textureGC"};var Ai=za;A.add(Ai);var qr=class{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=G.UNSIGNED_BYTE,this.internalFormat=I.RGBA,this.samplerType=0}};function $m(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:U.FLOAT,[i.RGBA]:U.FLOAT,[i.ALPHA]:U.FLOAT,[i.LUMINANCE]:U.FLOAT,[i.LUMINANCE_ALPHA]:U.FLOAT,[i.R8]:U.FLOAT,[i.R8_SNORM]:U.FLOAT,[i.RG8]:U.FLOAT,[i.RG8_SNORM]:U.FLOAT,[i.RGB8]:U.FLOAT,[i.RGB8_SNORM]:U.FLOAT,[i.RGB565]:U.FLOAT,[i.RGBA4]:U.FLOAT,[i.RGB5_A1]:U.FLOAT,[i.RGBA8]:U.FLOAT,[i.RGBA8_SNORM]:U.FLOAT,[i.RGB10_A2]:U.FLOAT,[i.RGB10_A2UI]:U.FLOAT,[i.SRGB8]:U.FLOAT,[i.SRGB8_ALPHA8]:U.FLOAT,[i.R16F]:U.FLOAT,[i.RG16F]:U.FLOAT,[i.RGB16F]:U.FLOAT,[i.RGBA16F]:U.FLOAT,[i.R32F]:U.FLOAT,[i.RG32F]:U.FLOAT,[i.RGB32F]:U.FLOAT,[i.RGBA32F]:U.FLOAT,[i.R11F_G11F_B10F]:U.FLOAT,[i.RGB9_E5]:U.FLOAT,[i.R8I]:U.INT,[i.R8UI]:U.UINT,[i.R16I]:U.INT,[i.R16UI]:U.UINT,[i.R32I]:U.INT,[i.R32UI]:U.UINT,[i.RG8I]:U.INT,[i.RG8UI]:U.UINT,[i.RG16I]:U.INT,[i.RG16UI]:U.UINT,[i.RG32I]:U.INT,[i.RG32UI]:U.UINT,[i.RGB8I]:U.INT,[i.RGB8UI]:U.UINT,[i.RGB16I]:U.INT,[i.RGB16UI]:U.UINT,[i.RGB32I]:U.INT,[i.RGB32UI]:U.UINT,[i.RGBA8I]:U.INT,[i.RGBA8UI]:U.UINT,[i.RGBA16I]:U.INT,[i.RGBA16UI]:U.UINT,[i.RGBA32I]:U.INT,[i.RGBA32UI]:U.UINT,[i.DEPTH_COMPONENT16]:U.FLOAT,[i.DEPTH_COMPONENT24]:U.FLOAT,[i.DEPTH_COMPONENT32F]:U.FLOAT,[i.DEPTH_STENCIL]:U.FLOAT,[i.DEPTH24_STENCIL8]:U.FLOAT,[i.DEPTH32F_STENCIL8]:U.FLOAT}:t={[i.RGB]:U.FLOAT,[i.RGBA]:U.FLOAT,[i.ALPHA]:U.FLOAT,[i.LUMINANCE]:U.FLOAT,[i.LUMINANCE_ALPHA]:U.FLOAT,[i.DEPTH_STENCIL]:U.FLOAT},t}function jm(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[G.UNSIGNED_BYTE]:{[I.RGBA]:i.RGBA8,[I.RGB]:i.RGB8,[I.RG]:i.RG8,[I.RED]:i.R8,[I.RGBA_INTEGER]:i.RGBA8UI,[I.RGB_INTEGER]:i.RGB8UI,[I.RG_INTEGER]:i.RG8UI,[I.RED_INTEGER]:i.R8UI,[I.ALPHA]:i.ALPHA,[I.LUMINANCE]:i.LUMINANCE,[I.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[G.BYTE]:{[I.RGBA]:i.RGBA8_SNORM,[I.RGB]:i.RGB8_SNORM,[I.RG]:i.RG8_SNORM,[I.RED]:i.R8_SNORM,[I.RGBA_INTEGER]:i.RGBA8I,[I.RGB_INTEGER]:i.RGB8I,[I.RG_INTEGER]:i.RG8I,[I.RED_INTEGER]:i.R8I},[G.UNSIGNED_SHORT]:{[I.RGBA_INTEGER]:i.RGBA16UI,[I.RGB_INTEGER]:i.RGB16UI,[I.RG_INTEGER]:i.RG16UI,[I.RED_INTEGER]:i.R16UI,[I.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[G.SHORT]:{[I.RGBA_INTEGER]:i.RGBA16I,[I.RGB_INTEGER]:i.RGB16I,[I.RG_INTEGER]:i.RG16I,[I.RED_INTEGER]:i.R16I},[G.UNSIGNED_INT]:{[I.RGBA_INTEGER]:i.RGBA32UI,[I.RGB_INTEGER]:i.RGB32UI,[I.RG_INTEGER]:i.RG32UI,[I.RED_INTEGER]:i.R32UI,[I.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[G.INT]:{[I.RGBA_INTEGER]:i.RGBA32I,[I.RGB_INTEGER]:i.RGB32I,[I.RG_INTEGER]:i.RG32I,[I.RED_INTEGER]:i.R32I},[G.FLOAT]:{[I.RGBA]:i.RGBA32F,[I.RGB]:i.RGB32F,[I.RG]:i.RG32F,[I.RED]:i.R32F,[I.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[G.HALF_FLOAT]:{[I.RGBA]:i.RGBA16F,[I.RGB]:i.RGB16F,[I.RG]:i.RG16F,[I.RED]:i.R16F},[G.UNSIGNED_SHORT_5_6_5]:{[I.RGB]:i.RGB565},[G.UNSIGNED_SHORT_4_4_4_4]:{[I.RGBA]:i.RGBA4},[G.UNSIGNED_SHORT_5_5_5_1]:{[I.RGBA]:i.RGB5_A1},[G.UNSIGNED_INT_2_10_10_10_REV]:{[I.RGBA]:i.RGB10_A2,[I.RGBA_INTEGER]:i.RGB10_A2UI},[G.UNSIGNED_INT_10F_11F_11F_REV]:{[I.RGB]:i.R11F_G11F_B10F},[G.UNSIGNED_INT_5_9_9_9_REV]:{[I.RGB]:i.RGB9_E5},[G.UNSIGNED_INT_24_8]:{[I.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[G.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[I.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[G.UNSIGNED_BYTE]:{[I.RGBA]:i.RGBA,[I.RGB]:i.RGB,[I.ALPHA]:i.ALPHA,[I.LUMINANCE]:i.LUMINANCE,[I.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[G.UNSIGNED_SHORT_5_6_5]:{[I.RGB]:i.RGB},[G.UNSIGNED_SHORT_4_4_4_4]:{[I.RGBA]:i.RGBA},[G.UNSIGNED_SHORT_5_5_5_1]:{[I.RGBA]:i.RGBA}},t}var Ls=class{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new j,this.hasIntegerTextures=!1}contextChange(){let t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=jm(t),this.samplerTypes=$m(t);let e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};let r=new qr(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new qr(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){let{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;let s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){let{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[s]=null)}ensureSamplerType(t){let{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let o=t-1;o>=0;--o){let n=e[o];n&&n._glTextures[s].samplerType!==U.FLOAT&&this.renderer.texture.unbind(n)}}initTexture(t){let e=new qr(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??U.FLOAT,this.webGLVersion===2&&t.type===G.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){let e=t._glTextures[this.CONTEXT_UID];if(!e)return;let r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==U.FLOAT&&(this.hasIntegerTextures=!0);else{let s=t.realWidth,o=t.realHeight,n=r.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,n.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){let{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){let s=this.managedTextures.indexOf(t);s!==-1&&fl(this.managedTextures,s,1)}}updateTextureStyle(t){let e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===qt.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=xe.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){let r=this.gl;if(e.mipmap&&t.mipmap!==qt.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Xe.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===Xe.LINEAR){let o=Math.min(t.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Xe.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===Xe.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}};Ls.extension={type:b.RendererSystem,name:"texture"};A.add(Ls);var Os=class{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:r}=this,s=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){let{gl:r,renderer:s}=this;e&&s.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){let{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){let{gl:e,renderer:r,CONTEXT_UID:s}=this,o=e.createTransformFeedback();t._glTransformFeedbacks[s]=o,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,o);for(let n=0;n<t.buffers.length;n++){let a=t.buffers[n];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,n,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,e){let r=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);let o=this.renderer.buffer;if(o)for(let n=0;n<t.buffers.length;n++){let a=t.buffers[n];if(!a)continue;let h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&o.dispose(a,e))}r&&(e||s.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};Os.extension={type:b.RendererSystem,name:"transformFeedback"};A.add(Os);var zi=class{constructor(t){this.renderer=t}init(t){this.screen=new V(0,0,t.width,t.height),this.element=t.view||T.ADAPTER.createCanvas(),this.resolution=t.resolution||T.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);let r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}};zi.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},zi.extension={type:[b.RendererSystem,b.CanvasRendererSystem],name:"_view"};A.add(zi);T.PREFER_ENV=Fe.WEBGL2;T.STRICT_TEXTURE_CACHE=!1;T.RENDER_OPTIONS={...Wi.defaultOptions,...Xi.defaultOptions,...zi.defaultOptions,...ji.defaultOptions};Object.defineProperties(T,{WRAP_MODE:{get(){return j.defaultOptions.wrapMode},set(i){J("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),j.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return j.defaultOptions.scaleMode},set(i){J("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),j.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return j.defaultOptions.mipmap},set(i){J("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),j.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return j.defaultOptions.anisotropicLevel},set(i){J("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),j.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return J("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),bt.defaultResolution},set(i){bt.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return J("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),bt.defaultMultisample},set(i){bt.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return Vi.defaultMaxTextures},set(i){J("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Vi.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return Vi.defaultBatchSize},set(i){J("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Vi.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return Vi.canUploadSameBuffer},set(i){J("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Vi.canUploadSameBuffer=i}},GC_MODE:{get(){return Ai.defaultMode},set(i){J("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ai.defaultMode=i}},GC_MAX_IDLE:{get(){return Ai.defaultMaxIdle},set(i){J("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ai.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return Ai.defaultCheckCountMax},set(i){J("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ai.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return re.defaultVertexPrecision},set(i){J("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),re.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return re.defaultFragmentPrecision},set(i){J("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),re.defaultFragmentPrecision=i}}});var Ee=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(Ee||{});var Po=class{constructor(t,e=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));let e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let e=this.next;return this.next=t?null:e,this.previous=null,e}};var zm=class je{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Po(null,null,1/0),this.deltaMS=1/je.targetFPMS,this.elapsedMS=1/je.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=Ee.NORMAL){return this._addListener(new Po(t,e,r))}addOnce(t,e,r=Ee.NORMAL){return this._addListener(new Po(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let o=t-this._lastFrame|0;if(o<this._minElapsedMS)return;this._lastFrame=t-o%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*je.targetFPMS;let r=this._head,s=r.next;for(;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,je.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!je._shared){let t=je._shared=new je;t.autoStart=!0,t._protected=!0}return je._shared}static get system(){if(!je._system){let t=je._system=new je;t.autoStart=!0,t._protected=!0}return je._system}};zm.targetFPMS=.06;var At=zm;Object.defineProperties(T,{TARGET_FPMS:{get(){return At.targetFPMS},set(i){J("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),At.targetFPMS=i}}});var Mo=class{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Ee.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?At.shared:new At,t.autoStart&&this.start()}static destroy(){if(this._ticker){let t=this._ticker;this.ticker=null,t.destroy()}}};Mo.extension=b.Application;A.add(Mo);var Ym=[];A.handleByList(b.Renderer,Ym);function Ol(i){for(let t of Ym)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var qm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`;var Km=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var Ul=qm,Bo=Km;var Fo=class{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){let r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{let r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=_t.HIGH?this.multisample=_t.HIGH:e>=_t.MEDIUM?this.multisample=_t.MEDIUM:e>=_t.LOW?this.multisample=_t.LOW:this.multisample=_t.NONE}destroy(){}};Fo.extension={type:b.RendererSystem,name:"_multisample"};A.add(Fo);var kl=class{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var Do=class{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){let{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){let{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){let o=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,o.buffer)}}bindBufferRange(t,e,r){let{gl:s,CONTEXT_UID:o}=this;r=r||0;let n=t._glBuffers[o]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,n.buffer,r*256,256)}update(t){let{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{let o=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,o)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];let r=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),r&&(e||s.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){let e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){let{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new kl(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}};Do.extension={type:b.RendererSystem,name:"buffer"};A.add(Do);var No=class{constructor(t){this.renderer=t}render(t,e){let r=this.renderer,s,o,n,a;if(e&&(s=e.renderTexture,o=e.clear,n=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=n,!r.context.isLost){if(s||(this.lastObjectRendered=t),!a){let h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(o??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),s&&(e.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};No.extension={type:b.RendererSystem,name:"objectRenderer"};A.add(No);var Gl=class bd extends Ns{constructor(t){super(),this.type=el.WEBGL,t=Object.assign({},T.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Vt({projectionMatrix:new rt},!0);let e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:bd.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(J("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=bd.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:ll()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return J("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return J("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return J("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return J("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){J("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return J("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){J("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return J("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Gl.extension={type:b.Renderer,priority:1},Gl.__plugins={},Gl.__systems={};var Ya=Gl;A.handleByMap(b.RendererPlugin,Ya.__plugins);A.handleByMap(b.RendererSystem,Ya.__systems);A.add(Ya);var _r=class extends Ne{constructor(t,e){let{width:r,height:s}=e||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){let n=new j;this.items.push(n),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Ne?this.addResourceAt(t[r],r):this.addResourceAt(_s(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;let t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{let{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}};var Lo=class extends _r{constructor(t,e){let{width:r,height:s}=e||{},o,n;Array.isArray(t)?(o=t,n=t.length):n=t,super(n,{width:r,height:s}),o&&this.initFromArray(o,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=ki.TEXTURE_2D_ARRAY}upload(t,e,r){let{length:s,itemDirtyIds:o,items:n}=this,{gl:a}=t;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,e.format,r.type,null);for(let h=0;h<s;h++){let l=n[h];o[h]<l.dirtyId&&(o[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}};var Oo=class extends Qt{constructor(t){super(t)}static test(t){let{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}};var Zm=class qa extends _r{constructor(t,e){let{width:r,height:s,autoLoad:o,linkBaseTexture:n}=e||{};if(t&&t.length!==qa.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:s});for(let a=0;a<qa.SIDES;a++)this.items[a].target=ki.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=n!==!1,t&&this.initFromArray(t,e),o!==!1&&this.load()}bind(t){super.bind(t),t.target=ki.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=ki.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){let s=this.itemDirtyIds;for(let o=0;o<qa.SIDES;o++){let n=this.items[o];(s[o]<n.dirtyId||r.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,r),s[o]=n.dirtyId):s[o]<-1&&(t.gl.texImage2D(n.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),s[o]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===qa.SIDES}};Zm.SIDES=6;var Hl=Zm;var wi=class extends Qt{constructor(t,e){e=e||{};let r,s,o;typeof t=="string"?(r=wi.EMPTY,s=t,o=!0):(r=t,s=null,o=!1),super(r),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??o,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{let r=await T.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=await r.blob();if(this.destroyed)return;let o=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===St.UNPACK?"premultiply":"none"});if(this.destroyed){o.close();return}this.source=o,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return wi._EMPTY=wi._EMPTY??T.ADAPTER.createCanvas(0,0),wi._EMPTY}};var Td=class Vl extends Qt{constructor(t,e){e=e||{},super(T.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Vl.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let t=new Image;Qt.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;let e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,o=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/r*e,o=this._overrideHeight||this._overrideWidth/e*r),s=Math.round(s),o=Math.round(o);let n=this.source;n.width=s,n.height=o,n._pixiId=`canvas_${Hi()}`,n.getContext("2d").drawImage(t,0,0,e,r,0,0,s,o),this._resolve(),this._resolve=null}}static getSize(t){let e=Vl.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Vl.SVG_XML.test(t)}};Td.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Td.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var Us=Td;var Ed=class Ad extends Qt{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){let r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);let s=t[0].src||t[0];Qt.crossOrigin(r,s,e.crossorigin);for(let o=0;o<t.length;++o){let n=document.createElement("source"),{src:a,mime:h}=t[o];if(a=a||t[o],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){let l=a.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||Ad.MIME_TYPES[u]||`video/${u}`}n.src=a,h&&(n.type=h),r.appendChild(n)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){let e=At.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;let t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){let t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){let t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);let e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();let t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(At.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(At.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(At.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Ad.TYPES.includes(e)}};Ed.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Ed.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};var Uo=Ed;yo.push(wi,jr,Oo,Uo,Us,ri,Hl,Lo);var Xl=class{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new Ft("disposeTransformFeedback")}bindBuffer(t,e){this.buffers[t]=e}destroy(){this.disposeRunner.emit(this,!1)}};var z0="7.3.2";var Ci=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?V.EMPTY:(t=t||new V(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){let{a:r,b:s,c:o,d:n,tx:a,ty:h}=t,l=r*e.x+o*e.y+a,u=s*e.x+n*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,s=this.maxX,o=this.maxY,n=t[0],a=t[1];e=n<e?n:e,r=a<r?a:r,s=n>s?n:s,o=a>o?a:o,n=t[2],a=t[3],e=n<e?n:e,r=a<r?a:r,s=n>s?n:s,o=a>o?a:o,n=t[4],a=t[5],e=n<e?n:e,r=a<r?a:r,s=n>s?n:s,o=a>o?a:o,n=t[6],a=t[7],e=n<e?n:e,r=a<r?a:r,s=n>s?n:s,o=a>o?a:o,this.minX=e,this.minY=r,this.maxX=s,this.maxY=o}addFrame(t,e,r,s,o){this.addFrameMatrix(t.worldTransform,e,r,s,o)}addFrameMatrix(t,e,r,s,o){let n=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty,d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=n*e+h*r+u,_=a*e+l*r+c;d=g<d?g:d,f=_<f?_:f,p=g>p?g:p,m=_>m?_:m,g=n*s+h*r+u,_=a*s+l*r+c,d=g<d?g:d,f=_<f?_:f,p=g>p?g:p,m=_>m?_:m,g=n*e+h*o+u,_=a*e+l*o+c,d=g<d?g:d,f=_<f?_:f,p=g>p?g:p,m=_>m?_:m,g=n*s+h*o+u,_=a*s+l*o+c,d=g<d?g:d,f=_<f?_:f,p=g>p?g:p,m=_>m?_:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,r){let s=this.minX,o=this.minY,n=this.maxX,a=this.maxY;for(let h=e;h<r;h+=2){let l=t[h],u=t[h+1];s=l<s?l:s,o=u<o?u:o,n=l>n?l:n,a=u>a?u:a}this.minX=s,this.minY=o,this.maxX=n,this.maxY=a}addVertices(t,e,r,s){this.addVerticesMatrix(t.worldTransform,e,r,s)}addVerticesMatrix(t,e,r,s,o=0,n=o){let a=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty,f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let _=r;_<s;_+=2){let v=e[_],x=e[_+1],y=a*v+l*x+c,P=u*x+h*v+d;f=Math.min(f,y-o),m=Math.max(m,y+o),p=Math.min(p,P-n),g=Math.max(g,P+n)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){let e=this.minX,r=this.minY,s=this.maxX,o=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,e){let r=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,o=t.maxX<e.maxX?t.maxX:e.maxX,n=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=o&&s<=n){let a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<h?s:h,this.maxX=o>l?o:l,this.maxY=n>u?n:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){let r=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,o=t.maxX<e.x+e.width?t.maxX:e.x+e.width,n=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=o&&s<=n){let a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<h?s:h,this.maxX=o>l?o:l,this.maxY=n>u?n:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,s,o,n){t-=o,e-=n,r+=o,s+=n,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}};var lt=class extends S.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new pr,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ci,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){let e=Object.keys(t);for(let r=0;r<e.length;++r){let s=e[r];Object.defineProperty(lt.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new V),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new V),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ci);let e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=r?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;let s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;let n=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-o,n}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,s){return e&&(t=e.toGlobal(t,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,s=1,o=0,n=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=s||1,this.rotation=o,this.skew.x=n,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Ka),this.tempDisplayObjectParent}enableTempParent(){let t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*_l}set angle(t){this.transform.rotation=t*xl}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}},Ka=class extends lt{constructor(){super(...arguments),this.sortDirty=null}};lt.prototype.displayObjectUpdateTransform=lt.prototype.updateTransform;var Y0=new rt;function q0(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}var Qm=class wd extends lt{constructor(){super(),this.children=[],this.sortableChildren=wd.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{let e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;let r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t,this.onChildrenChange(r<s?r:s)}getChildIndex(t){let e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);let r=this.getChildIndex(t);S.removeItems(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{let e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,S.removeItems(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){let e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,S.removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){let r=t,s=e,o=s-r,n;if(o>0&&o<=s){n=this.children.splice(r,o);for(let a=0;a<n.length;++a)n[a].parent=null,n[a].transform&&(n[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<n.length;++a)n[a].emit("removed",this),this.emit("childRemoved",n[a],this,a);return n}else if(o===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){let s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(q0),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){let r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){let e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){let r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){let r=super.getLocalBounds(t);if(!e)for(let s=0,o=this.children.length;s<o;++s){let n=this.children[s];n.visible&&n.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){let e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,s;this.cullArea?(r=this.cullArea,s=this.worldTransform):this._render!==wd.prototype._render&&(r=this.getBounds(!0));let o=t.projection.transform;if(o&&(s?(s=Y0.copyFrom(s),s.prepend(o)):s=o),r&&e.intersects(r,s))this._render(t);else if(this.cullArea)return;for(let n=0,a=this.children.length;n<a;++n){let h=this.children[n],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){let e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let o=0;o<e.length;o++)e[o].enabled&&this._enabledFilters.push(e[o])}let s=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Mt.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let o=0,n=this.children.length;o<n;++o)this.children[o].render(t)}s&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;let e=typeof t=="boolean"?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<r.length;++s)r[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){let e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){let e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};Qm.defaultSortableChildren=!1;var Dt=Qm;Dt.prototype.containerUpdateTransform=Dt.prototype.updateTransform;Object.defineProperties(T,{SORTABLE_CHILDREN:{get(){return Dt.defaultSortableChildren},set(i){S.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Dt.defaultSortableChildren=i}}});var Za=new Z,K0=new Uint16Array([0,1,2,0,2,3]),se=class extends Dt{constructor(t){super(),this._anchor=new fe(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new tt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Y.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||B.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=K0,this.pluginName="batch",this.isSprite=!0,this._roundPixels=T.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=S.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=S.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;let e=this.transform.worldTransform,r=e.a,s=e.b,o=e.c,n=e.d,a=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,d=this._anchor,f=0,p=0,m=0,g=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,g=u.y-d._y*c.height,m=g+u.height):(p=-d._x*c.width,f=p+c.width,g=-d._y*c.height,m=g+c.height),l[0]=r*p+o*g+a,l[1]=n*g+s*p+h,l[2]=r*f+o*g+a,l[3]=n*g+s*f+h,l[4]=r*f+o*m+a,l[5]=n*m+s*f+h,l[6]=r*p+o*m+a,l[7]=n*m+s*p+h,this._roundPixels){let _=T.RESOLUTION;for(let v=0;v<l.length;++v)l[v]=Math.round(l[v]*_)/_}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let t=this._texture,e=this.vertexTrimmedData,r=t.orig,s=this._anchor,o=this.transform.worldTransform,n=o.a,a=o.b,h=o.c,l=o.d,u=o.tx,c=o.ty,d=-s._x*r.width,f=d+r.width,p=-s._y*r.height,m=p+r.height;if(e[0]=n*d+h*p+u,e[1]=l*p+a*d+c,e[2]=n*f+h*p+u,e[3]=l*p+a*f+c,e[4]=n*f+h*m+u,e[5]=l*m+a*f+c,e[6]=n*d+h*m+u,e[7]=l*m+a*d+c,this._roundPixels){let g=T.RESOLUTION;for(let _=0;_<e.length;++_)e[_]=Math.round(e[_]*g)/g}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){let t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Ci),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new V),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Za);let e=this._texture.orig.width,r=this._texture.orig.height,s=-e*this.anchor.x,o=0;return Za.x>=s&&Za.x<s+e&&(o=-r*this.anchor.y,Za.y>=o&&Za.y<o+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){let e=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){let r=t instanceof B?t:B.from(t,e);return new se(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){let e=S.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){let e=S.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||B.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}};var Jm=new rt;lt.prototype._cacheAsBitmap=!1;lt.prototype._cacheData=null;lt.prototype._cacheAsBitmapResolution=null;lt.prototype._cacheAsBitmapMultisample=null;var Cd=class{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}};Object.defineProperties(lt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new Cd),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});lt.prototype._renderCached=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(i),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(i))};lt.prototype._initCachedDisplayObject=function(i){if(this._cacheData?.sprite)return;let t=this.alpha;this.alpha=1,i.batch.flush();let e=this.getLocalBounds(new V,!0);if(this.filters?.length){let d=this.filters[0].padding;e.pad(d)}let r=this.cacheAsBitmapResolution||i.resolution;e.ceil(r),e.width=Math.max(e.width,1/r),e.height=Math.max(e.height,1/r);let s=i.renderTexture.current,o=i.renderTexture.sourceFrame.clone(),n=i.renderTexture.destinationFrame.clone(),a=i.projection.transform,h=Te.create({width:e.width,height:e.height,resolution:r,multisample:this.cacheAsBitmapMultisample??i.multisample}),l=`cacheAsBitmap_${S.uid()}`;this._cacheData.textureCacheId=l,j.addToCache(h.baseTexture,l),B.addToCache(h,l);let u=this.transform.localTransform.copyTo(Jm).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,i.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),i.framebuffer.blit(),i.projection.transform=a,i.renderTexture.bind(s,o,n),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;let c=new se(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)};lt.prototype._renderCachedCanvas=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(i),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(i))};lt.prototype._initCachedDisplayObjectCanvas=function(i){if(this._cacheData?.sprite)return;let t=this.getLocalBounds(new V,!0),e=this.alpha;this.alpha=1;let r=i.canvasContext.activeContext,s=i._projTransform,o=this.cacheAsBitmapResolution||i.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);let n=Te.create({width:t.width,height:t.height,resolution:o}),a=`cacheAsBitmap_${S.uid()}`;this._cacheData.textureCacheId=a,j.addToCache(n.baseTexture,a),B.addToCache(n,a);let h=Jm;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,i.render(this,{renderTexture:n,clear:!0,transform:h,skipUpdateTransform:!1}),i.canvasContext.activeContext=r,i._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;let l=new se(n);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(t.x/t.width),l.anchor.y=-(t.y/t.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=i._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};lt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};lt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};lt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,j.removeFromCache(this._cacheData.textureCacheId),B.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};lt.prototype._cacheAsBitmapDestroy=function(i){this.cacheAsBitmap=!1,this.destroy(i)};lt.prototype.name=null;Dt.prototype.getChildByName=function(i,t){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===i)return this.children[e];if(t)for(let e=0,r=this.children.length;e<r;e++){let s=this.children[e];if(!s.getChildByName)continue;let o=s.getChildByName(i,!0);if(o)return o}return null};lt.prototype.getGlobalPosition=function(i=new Z,t=!1){return this.parent?this.parent.toGlobal(this.position,i,t):(i.x=this.position.x,i.y=this.position.y),i};var tg=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;var ko=class extends bt{constructor(t=1){super(Ul,tg,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}};var Z0={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Q0=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function eg(i){let t=Z0[i],e=t.length,r=Q0,s="",o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",n;for(let a=0;a<i;a++){let h=o.replace("%index%",a.toString());n=a,a>=e&&(n=i-a-1),h=h.replace("%value%",t[n].toString()),s+=h,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}var J0=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function ig(i,t){let e=Math.ceil(i/2),r=J0,s="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let n=0;n<i;n++){let a=o.replace("%index%",n.toString());a=a.replace("%sampleIndex%",`${n-(e-1)}.0`),s+=a,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}var xr=class extends bt{constructor(t,e=8,r=4,s=bt.defaultResolution,o=5){let n=ig(o,t),a=eg(o);super(n,a),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,s){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,r,s);else{let o=t.getFilterTexture(),n=t.renderer,a=e,h=o;this.state.blend=!1,t.applyFilter(this,a,h,De.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,De.BLIT),this.uniforms.uSampler=h;let u=h;h=a,a=u,n.shader.bind(this),n.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,r,s),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}};var Go=class extends bt{constructor(t=8,e=4,r=bt.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new xr(!0,t,e,r,s),this.blurYFilter=new xr(!1,t,e,r,s),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,s){let o=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(o&&n){let a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,De.CLEAR),this.blurYFilter.apply(t,a,r,s),t.returnFilterTexture(a)}else n?this.blurYFilter.apply(t,e,r,s):this.blurXFilter.apply(t,e,r,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}};var rg=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;var Kr=class extends bt{constructor(){let t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Bo,rg,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){let e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){let r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){let[r,s,o]=tt.shared.setValue(t).toArray(),n=[r,0,0,0,0,0,s,0,0,0,0,0,o,0,0,0,0,0,1,0];this._loadMatrix(n,e)}greyscale(t,e){let r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){let e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;let r=Math.cos(t),s=Math.sin(t),o=Math.sqrt,n=1/3,a=o(n),h=r+(1-r)*n,l=n*(1-r)-a*s,u=n*(1-r)+a*s,c=n*(1-r)+a*s,d=r+n*(1-r),f=n*(1-r)-a*s,p=n*(1-r)-a*s,m=n*(1-r)+a*s,g=r+n*(1-r),_=[h,l,u,0,0,c,d,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(_,e)}contrast(t,e){let r=(t||0)+1,s=-.5*(r-1),o=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(o,e)}saturate(t=0,e){let r=t*2/3+1,s=(r-1)*-.5,o=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(o,e)}desaturate(){this.saturate(-1)}negative(t){let e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){let e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){let e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){let e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){let e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){let e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){let e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){let e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,s,o){t=t||.2,e=e||.15,r=r||16770432,s=s||3375104;let n=tt.shared,[a,h,l]=n.setValue(r).toArray(),[u,c,d]=n.setValue(s).toArray(),f=[.3,.59,.11,0,0,a,h,l,t,0,u,c,d,e,0,a-u,h-c,l-d,0,0];this._loadMatrix(f,o)}night(t,e){t=t||.1;let r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){let r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){let e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){let t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}};Kr.prototype.grayscale=Kr.prototype.greyscale;var sg=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`;var og=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;var Ho=class extends bt{constructor(t,e){let r=new rt;t.renderable=!1,super(og,sg,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,e==null&&(e=20),this.scale=new Z(e,e)}apply(t,e,r,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;let o=this.maskSprite.worldTransform,n=Math.sqrt(o.a*o.a+o.b*o.b),a=Math.sqrt(o.c*o.c+o.d*o.d);n!==0&&a!==0&&(this.uniforms.rotation[0]=o.a/n,this.uniforms.rotation[1]=o.b/n,this.uniforms.rotation[2]=o.c/a,this.uniforms.rotation[3]=o.d/a),t.applyFilter(this,e,r,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}};var ng=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;var ag=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;var Vo=class extends bt{constructor(){super(ag,ng)}};var hg=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;var Xo=class extends bt{constructor(t=.5,e=Math.random()){super(Bo,hg,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}};var Wl={AlphaFilter:ko,BlurFilter:Go,BlurFilterPass:xr,ColorMatrixFilter:Kr,DisplacementFilter:Ho,FXAAFilter:Vo,NoiseFilter:Xo};Object.entries(Wl).forEach(([i,t])=>{Object.defineProperty(Wl,i,{get(){return S.deprecation("7.1.0",`filters.${i} has moved to ${i}`),t}})});var Sd=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(At.system.add(this.tickerUpdate,this,Ee.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(At.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}},Yi=new Sd;var oi=class{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=oi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Z,this.page=new Z,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,s,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}};var Si=class extends oi{constructor(){super(...arguments),this.client=new Z,this.movement=new Z,this.offset=new Z,this.global=new Z,this.screen=new Z}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,s,o,n,a,h,l,u,c,d,f,p,m){throw new Error("Method not implemented.")}};var oe=class extends Si{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}};var ni=class extends Si{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};ni.DOM_DELTA_PIXEL=0,ni.DOM_DELTA_LINE=1,ni.DOM_DELTA_PAGE=2;var ty=2048,ey=new Z,Id=new Z,Wo=class{constructor(t){this.dispatch=new S.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,s)=>r.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;let e=this.mappingTable[t.type];if(e)for(let r=0,s=e.length;r<s;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Yi.pauseUpdate=!0;let r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[r](this.rootTarget,this.rootTarget.eventMode,ey.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;let r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,o=r.length-1;s<o;s++)if(t.currentTarget=r[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=r.length-2;s>=0;s--)if(t.currentTarget=r[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(r.length===0)return;t.eventPhase=t.BUBBLING_PHASE;let s=Array.isArray(e)?e:[e];for(let o=r.length-1;o>=0;o--)s.forEach(n=>{t.currentTarget=r[o],this.notifyTarget(t,n)})}propagationPath(t){let e=[t];for(let r=0;r<ty&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,s,o,n=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Yi.pauseUpdate=!1),t.interactiveChildren&&t.children){let u=t.children;for(let c=u.length-1;c>=0;c--){let d=u[c],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,r,s,o,n||o(t,r));if(f){if(f.length>0&&!f[f.length-1].parent)continue;let p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}let h=this._isInteractive(e),l=t.isInteractive();return h&&l&&this._allInteractiveElements.push(t),n||this._hitElements.length>0?null:a?this._hitElements:h&&!o(t,r)&&s(t,r)?l?[t]:[]:null}hitTestRecursive(t,e,r,s,o){if(this._interactivePrune(t)||o(t,r))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Yi.pauseUpdate=!1),t.interactiveChildren&&t.children){let h=t.children;for(let l=h.length-1;l>=0;l--){let u=h[l],c=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,r,s,o);if(c){if(c.length>0&&!c[c.length-1].parent)continue;let d=t.isInteractive();return(c.length>0||d)&&c.push(t),c}}}let n=this._isInteractive(e),a=t.isInteractive();return n&&s(t,r)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Id),!t.hitArea.contains(Id.x,Id.y)))return!0;if(t._mask){let r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!r.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;let r=`on${e}`;t.currentTarget[r]?.(t);let s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){let s=e.button===2;this.dispatchEvent(e,s?"rightdown":"mousedown")}let r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;let r=e.pointerType==="mouse"||e.pointerType==="pen",s=this.trackingData(t.pointerId),o=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&o!==e.target){let h=t.type==="mousemove"?"mouseout":"pointerout",l=this.createPointerEvent(t,h,o);if(this.dispatchEvent(l,"pointerout"),r&&this.dispatchEvent(l,"mouseout"),!e.composedPath().includes(o)){let u=this.createPointerEvent(t,"pointerleave",o);for(u.eventPhase=u.AT_TARGET;u.target&&!e.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),r&&this.notifyTarget(u,"mouseleave"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}if(o!==e.target){let h=t.type==="mousemove"?"mouseover":"pointerover",l=this.clonePointerEvent(e,h);this.dispatchEvent(l,"pointerover"),r&&this.dispatchEvent(l,"mouseover");let u=o?.parent;for(;u&&u!==this.rootTarget.parent&&u!==e.target;)u=u.parent;if(!u||u===this.rootTarget.parent){let c=this.clonePointerEvent(e,"pointerenter");for(c.eventPhase=c.AT_TARGET;c.target&&c.target!==o&&c.target!==this.rootTarget.parent;)c.currentTarget=c.target,this.notifyTarget(c),r&&this.notifyTarget(c,"mouseenter"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(l)}let n=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?n.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&n.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?n.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&n.push("globaltouchmove")),r&&(this.moveOnAll?n.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&n.push("globalmousemove"),this.cursor=e.target?.cursor),n.length>0&&this.all(e,n),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),s=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=r.target?.cursor);let o=this.clonePointerEvent(r,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId);if(e.overTargets){let r=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(e.overTargets),o=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(o),r&&this.dispatchEvent(o,"mouseout");let n=this.createPointerEvent(t,"pointerleave",s);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;e.overTargets=null,this.freeEvent(o),this.freeEvent(n)}this.cursor=null}mapPointerUp(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}let s=this.trackingData(t.pointerId),o=this.findMountedTarget(s.pressTargetsByButton[t.button]),n=o;if(o&&!r.composedPath().includes(o)){let a=o;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let h=r.button===2;this.notifyTarget(r,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[t.button],n=a}if(n){let a=this.clonePointerEvent(r,"click");a.target=n,a.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});let h=s.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){let l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(r){let o=r;for(;o;)s.currentTarget=o,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof ni)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}let e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){let s=this.allocateEvent(oe);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=r??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof e=="string"&&(s.type=e),s}createWheelEvent(t){let e=this.allocateEvent(ni);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){let r=this.allocateEvent(oe);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof oe&&e instanceof oe&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Si&&e instanceof Si&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);let e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){let r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let s=0,o=r.length;s<o&&!t.propagationImmediatelyStopped;s++)r[s].once&&t.currentTarget.removeListener(e,r[s].fn,void 0,!0),r[s].fn.call(r[s].context,t)}};var iy=1,ry={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Rd=class Pd{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Wo(null),Yi.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new oe(null),this.rootWheelEvent=new ni(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Pd.defaultEventFeatures},{set:(e,r,s)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[r]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){let{view:e,resolution:r}=this.renderer;this.setTargetElement(e),this.resolution=r,Pd._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;let r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,s=e.length;r<s;r++){let o=e[r],n=this.bootstrapEvent(this.rootPointerEvent,o);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Yi.pointerMoved();let e=this.normalizeToPointerData(t);for(let r=0,s=e.length;r<s;r++){let o=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);let r=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let o=0,n=s.length;o<n;o++){let a=this.bootstrapEvent(this.rootPointerEvent,s[o]);a.type+=r,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this.normalizeToPointerData(t);for(let r=0,s=e.length;r<s;r++){let o=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;let e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Yi.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Yi.addTickerListener();let t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Yi.removeTickerListener();let t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){let s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},o=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*o,t.y=(r-s.top)*(this.domElement.height/s.height)*o}normalizeToPointerData(t){let e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,s=t.changedTouches.length;r<s;r++){let o=t.changedTouches[r];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,e.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){let r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=iy),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){let e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=ry[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Rd.extension={name:"events",type:[b.RendererSystem,b.CanvasRendererSystem]},Rd.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};var $o=Rd;A.add($o);function lg(i){return i==="dynamic"||i==="static"}var Md={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??lg($o.defaultEventMode)},set interactive(i){S.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??$o.defaultEventMode},set eventMode(i){this._internalInteractive=lg(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){let r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,s)},removeEventListener(i,t,e){let r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,s)},dispatchEvent(i){if(!(i instanceof oi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};lt.mixin(Md);var $l={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};lt.mixin($l);var sy=9,jl=100,oy=0,ny=0,ug=2,cg=1,ay=-1e3,hy=-1e3,ly=2,jo=class{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(S.isMobile.tablet||S.isMobile.phone)&&this.createTouchHook();let e=document.createElement("div");e.style.width=`${jl}px`,e.style.height=`${jl}px`,e.style.position="absolute",e.style.top=`${oy}px`,e.style.left=`${ny}px`,e.style.zIndex=ug.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){let t=document.createElement("button");t.style.width=`${cg}px`,t.style.height=`${cg}px`,t.style.position="absolute",t.style.top=`${ay}px`,t.style.left=`${hy}px`,t.style.zIndex=ly.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);let e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){let t=performance.now();if(S.isMobile.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);let{x:e,y:r,width:s,height:o}=this.renderer.view.getBoundingClientRect(),{width:n,height:a,resolution:h}=this.renderer,l=s/n*h,u=o/a*h,c=this.div;c.style.left=`${e}px`,c.style.top=`${r}px`,c.style.width=`${n}px`,c.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){let f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,S.removeItems(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{c=f._accessibleDiv;let p=f.hitArea,m=f.worldTransform;f.hitArea?(c.style.left=`${(m.tx+p.x*m.a)*l}px`,c.style.top=`${(m.ty+p.y*m.d)*u}px`,c.style.width=`${p.width*m.a*l}px`,c.style.height=`${p.height*m.d*u}px`):(p=f.getBounds(),this.capHitArea(p),c.style.left=`${p.x*l}px`,c.style.top=`${p.y*u}px`,c.style.width=`${p.width*l}px`,c.style.height=`${p.height*u}px`,c.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(c.title=f.accessibleTitle),c.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&c.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==c.title||f.tabIndex!==c.tabIndex)&&(c.title=f.accessibleTitle,c.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);let{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${jl}px`,e.style.height=`${jl}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=ug.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){let{displayObject:r}=t.target,s=this.renderer.events.rootBoundary,o=Object.assign(new oi(s),{target:r});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(n=>s.dispatchEvent(o,n))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===sy&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}};jo.extension={name:"accessibility",type:[b.RendererPlugin,b.CanvasRendererPlugin]};A.add(jo);var dg=class Bd{constructor(t){this.stage=new Dt,t=Object.assign({forceCanvas:!1},t),this.renderer=Ol(t),Bd._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){let r=Bd._plugins.slice(0);r.reverse(),r.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};dg._plugins=[];var Fd=dg;A.handleByList(b.Application,Fd._plugins);var zo=class{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{let{clientWidth:s,clientHeight:o}=this._resizeTo;e=s,r=o}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};zo.extension=b.Application;A.add(zo);var fg={loader:b.LoadParser,resolver:b.ResolveParser,cache:b.CacheParser,detection:b.DetectionParser};A.handle(b.Asset,i=>{let t=i.ref;Object.entries(fg).filter(([e])=>!!t[e]).forEach(([e,r])=>A.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{let t=i.ref;Object.keys(fg).filter(e=>!!t[e]).forEach(e=>A.remove(t[e]))});var zl=class{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}};function Ae(i,t){if(Array.isArray(t)){for(let e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function zt(i,t){let e=i.split("?")[0],r=S.path.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}var Jt=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(r=>typeof r=="string"||e?t(r):r):i);var Zr=(i,t)=>{let e=t.split("?")[1];return e&&(i+=`?${e}`),i};function pg(i,t,e,r,s){let o=t[e];for(let n=0;n<o.length;n++){let a=o[n];e<t.length-1?pg(i.replace(r[e],a),t,e+1,r,s):s.push(i.replace(r[e],a))}}function Qa(i){let t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){let s=[];e.forEach(o=>{let n=o.substring(1,o.length-1).split(",");s.push(n)}),pg(i,s,0,e,r)}else r.push(i);return r}var qi=i=>!Array.isArray(i);var Dd=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){let e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){let r=Jt(t),s;for(let a=0;a<this.parsers.length;a++){let h=this.parsers[a];if(h.test(e)){s=h.getCacheableAssets(r,e);break}}s||(s={},r.forEach(a=>{s[a]=e}));let o=Object.keys(s),n={cacheKeys:o,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,n)}),o.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),e instanceof B){let a=e;r.forEach(h=>{a.baseTexture!==B.EMPTY.baseTexture&&j.addToCache(a.baseTexture,h),B.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}let e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}},ai=new Dd;var Yl=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){let r={promise:null,parser:null};return r.promise=(async()=>{let s=null,o=null;if(e.loadParser&&(o=this._parserHash[e.loadParser],o||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!o){for(let n=0;n<this.parsers.length;n++){let a=this.parsers[n];if(a.load&&a.test?.(t,e,this)){o=a;break}}if(!o)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await o.load(t,e,this),r.parser=o;for(let n=0;n<this.parsers.length;n++){let a=this.parsers[n];a.parse&&a.parse&&await a.testParse?.(s,e,this)&&(s=await a.parse(s,e,this)||s,r.parser=a)}return s})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0,s={},o=qi(t),n=Jt(t,l=>({alias:[l],src:l})),a=n.length,h=n.map(async l=>{let u=S.path.toAbsolute(l.src);if(!s[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),s[l.src]=await this.promiseCache[u].promise,e&&e(++r/a)}catch(c){throw delete this.promiseCache[u],delete s[l.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(h),o?s[n[0].src]:s}async unload(t){let e=Jt(t,r=>({alias:[r],src:r})).map(async r=>{let s=S.path.toAbsolute(r.src),o=this.promiseCache[s];if(o){let n=await o.promise;delete this.promiseCache[s],o.parser?.unload?.(n,r,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}};var It=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(It||{});var uy=".json",cy="application/json",ql={extension:{type:b.LoadParser,priority:It.Low},name:"loadJson",test(i){return Ae(i,cy)||zt(i,uy)},async load(i){return await(await T.ADAPTER.fetch(i)).json()}};A.add(ql);var dy=".txt",fy="text/plain",Kl={name:"loadTxt",extension:{type:b.LoadParser,priority:It.Low},test(i){return Ae(i,fy)||zt(i,dy)},async load(i){return await(await T.ADAPTER.fetch(i)).text()}};A.add(Kl);var py=["normal","bold","100","200","300","400","500","600","700","800","900"],my=[".ttf",".otf",".woff",".woff2"],gy=["font/ttf","font/otf","font/woff","font/woff2"],_y=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Zl(i){let t=S.path.extname(i),e=S.path.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)),r=e.length>0;for(let o of e)if(!o.match(_y)){r=!1;break}let s=e.join(" ");return r||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}var xy=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function yy(i){return xy.test(i)?i:encodeURI(i)}var Ql={extension:{type:b.LoadParser,priority:It.Low},name:"loadWebFont",test(i){return Ae(i,gy)||zt(i,my)},async load(i,t){let e=T.ADAPTER.getFontFaceSet();if(e){let r=[],s=t.data?.family??Zl(i),o=t.data?.weights?.filter(a=>py.includes(a))??["normal"],n=t.data??{};for(let a=0;a<o.length;a++){let h=o[a],l=new FontFace(s,`url(${yy(i)})`,{...n,weight:h});await l.load(),e.add(l),r.push(l)}return r.length===1?r[0]:r}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>T.ADAPTER.getFontFaceSet().delete(t))}};A.add(Ql);var mg=0,Nd,vy="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",by={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${vy}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Ty={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},Ld,Od=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{let e=URL.createObjectURL(new Blob([by.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",s=>{r.terminate(),URL.revokeObjectURL(e),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Nd===void 0&&(Nd=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Nd&&(Ld||(Ld=URL.createObjectURL(new Blob([Ty.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Ld),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();let r=new Promise((s,o)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:o})});return this.next(),r}next(){if(!this.queue.length)return;let t=this.getWorker();if(!t)return;let e=this.queue.pop(),r=e.id;this.resolveHash[mg]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:mg++,id:r})}},Ud=new Od;function ze(i,t,e){i.resource.internal=!0;let r=new B(i),s=()=>{delete t.promiseCache[e],ai.has(e)&&ai.remove(e)};return r.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),r.once("destroyed",()=>{i.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),r}var Ey=[".jpeg",".jpg",".png",".webp",".avif"],Ay=["image/jpeg","image/png","image/webp","image/avif"];async function Jl(i){let t=await T.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);let e=await t.blob();return await createImageBitmap(e)}var Ki={name:"loadTextures",extension:{type:b.LoadParser,priority:It.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return Ae(i,Ay)||zt(i,Ey)},async load(i,t,e){let r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap,s;r?this.config.preferWorkers&&await Ud.isImageBitmapSupported()?s=await Ud.loadImageBitmap(i):s=await Jl(i):s=await new Promise((a,h)=>{let l=new Image;l.crossOrigin=this.config.crossOrigin,l.src=i,l.complete?a(l):(l.onload=()=>a(l),l.onerror=u=>h(u))});let o={...t.data};o.resolution??(o.resolution=S.getResolutionOfUrl(i)),r&&o.resourceOptions?.ownsImageBitmap===void 0&&(o.resourceOptions={...o.resourceOptions},o.resourceOptions.ownsImageBitmap=!0);let n=new j(s,o);return n.resource.src=i,ze(n,e,i)},unload(i){i.destroy(!0)}};A.add(Ki);var wy=".svg",Cy="image/svg+xml",tu={extension:{type:b.LoadParser,priority:It.High},name:"loadSVG",test(i){return Ae(i,Cy)||zt(i,wy)},async testParse(i){return Us.test(i)},async parse(i,t,e){let r=new Us(i,t?.data?.resourceOptions);await r.load();let s=new j(r,{resolution:S.getResolutionOfUrl(i),...t?.data});return s.resource.src=t.src,ze(s,e,t.src)},async load(i,t){return(await T.ADAPTER.fetch(i)).text()},unload:Ki.unload};A.add(tu);var Sy=[".mp4",".m4v",".webm",".ogv"],Iy=["video/mp4","video/webm","video/ogg"],eu={name:"loadVideo",extension:{type:b.LoadParser,priority:It.High},config:{defaultAutoPlay:!0},test(i){return Ae(i,Iy)||zt(i,Sy)},async load(i,t,e){let r,s=await(await T.ADAPTER.fetch(i)).blob(),o=URL.createObjectURL(s);try{let n={autoPlay:this.config.defaultAutoPlay,...t?.data?.resourceOptions},a=new Uo(o,n);await a.load();let h=new j(a,{alphaMode:await S.detectVideoAlphaMode(),resolution:S.getResolutionOfUrl(i),...t?.data});h.resource.src=i,r=ze(h,e,i),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(n){throw URL.revokeObjectURL(o),n}return r},unload(i){i.destroy(!0)}};A.add(eu);var iu=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{let e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}getAlias(t){let{alias:e,name:r,src:s,srcs:o}=t;return Jt(e||r||s||o,n=>typeof n=="string"?n:Array.isArray(n)?n.map(a=>a?.src??a?.srcs??a):n?.src||n?.srcs?n.src??n.srcs:n,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){let r=[];Array.isArray(e)?e.forEach(s=>{let o=s.src??s.srcs,n=s.alias??s.name,a;if(typeof n=="string"){let h=this._createBundleAssetId(t,n);r.push(h),a=[n,h]}else{let h=n.map(l=>this._createBundleAssetId(t,l));r.push(...h),a=[...n,...h]}this.add({...s,alias:a,src:o})}):Object.keys(e).forEach(s=>{let o=[s,this._createBundleAssetId(t,s)];if(typeof e[s]=="string")this.add({alias:o,src:e[s]});else if(Array.isArray(e[s]))this.add({alias:o,src:e[s]});else{let n=e[s],a=n.src??n.srcs;this.add({...n,alias:o,src:Array.isArray(a)?a:[a]})}r.push(...o)}),this._bundles[t]=r}add(t,e,r,s,o){let n=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(S.deprecation("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),n.push({alias:t,src:e,data:r,format:s,loadParser:o})):Array.isArray(t)?n.push(...t):n.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},Jt(n).forEach(h=>{let{src:l,srcs:u}=h,{data:c,format:d,loadParser:f}=h,p=Jt(l||u).map(_=>typeof _=="string"?Qa(_):Array.isArray(_)?_:[_]),m=this.getAlias(h);Array.isArray(m)?m.forEach(a):a(m);let g=[];p.forEach(_=>{_.forEach(v=>{let x={};if(typeof v!="object"){x.src=v;for(let y=0;y<this._parsers.length;y++){let P=this._parsers[y];if(P.test(v)){x=P.parse(v);break}}}else c=v.data??c,d=v.format??d,f=v.loadParser??f,x={...x,...v};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${x.src}`);x=this.buildResolvedAsset(x,{aliases:m,data:c,format:d,loadParser:f}),g.push(x)})}),m.forEach(_=>{this._assetMap[_]=g})})}resolveBundle(t){let e=qi(t);t=Jt(t);let r={};return t.forEach(s=>{let o=this._bundles[s];if(o){let n=this.resolve(o),a={};for(let h in n){let l=n[h];a[this._extractAssetIdFromBundle(s,h)]=l}r[s]=a}}),e?r[t[0]]:r}resolveUrl(t){let e=this.resolve(t);if(typeof t!="string"){let r={};for(let s in e)r[s]=e[s].src;return r}return e.src}resolve(t){let e=qi(t);t=Jt(t);let r={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let o=this._assetMap[s],n=o[0],a=this._getPreferredOrder(o);a?.priority.forEach(h=>{a.params[h].forEach(l=>{let u=o.filter(c=>c[h]?c[h]===l:!1);u.length&&(o=u)})}),this._resolverHash[s]=o[0]??n}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});r[s]=this._resolverHash[s]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){let r=t[0],s=this._preferredOrder.find(o=>o.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;let e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){let{aliases:r,data:s,loadParser:o,format:n}=e;return(this._basePath||this._rootPath)&&(t.src=S.path.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...s||{},...t.data},t.loadParser=o??t.loadParser,t.format=n??S.path.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}};var Ja=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new iu,this.loader=new Yl,this.cache=ai,this._backgroundLoader=new zl(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let o=t.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}let e=t.texturePreference?.resolution??1,r=typeof e=="number"?[e]:e,s=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,s,o){this.resolver.add(t,e,r,s,o)}async load(t,e){this._initialized||await this.init();let r=qi(t),s=Jt(t).map(a=>{if(typeof a!="string"){let h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),o=this.resolver.resolve(s),n=await this._mapLoadToResolve(o,e);return r?n[s[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);let s=this.resolver.resolveBundle(t),o={},n=Object.keys(s),a=0,h=0,l=()=>{e?.(++a/h)},u=n.map(c=>{let d=s[c];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{o[c]=f})});return await Promise.all(u),r?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ai.get(t);let e={};for(let r=0;r<t.length;r++)e[r]=ai.get(t[r]);return e}async _mapLoadToResolve(t,e){let r=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;let o=await this.loader.load(r,e);this._backgroundLoader.active=!0;let n={};return r.forEach((a,h)=>{let l=o[a.src],u=[a.src];a.alias&&u.push(...a.alias),n[s[h]]=l,ai.set(u,l)}),n}async unload(t){this._initialized||await this.init();let e=Jt(t).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Jt(t);let e=this.resolver.resolveBundle(t),r=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(r)}async _unloadFromResolved(t){let e=Object.values(t);e.forEach(r=>{ai.remove(r.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(let r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter((r,s)=>e.indexOf(r)===s),e}get detections(){return this._detections}get preferWorkers(){return Ki.config.preferWorkers}set preferWorkers(t){S.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}},Yo=new Ja;A.handleByList(b.LoadParser,Yo.loader.parsers).handleByList(b.ResolveParser,Yo.resolver.parsers).handleByList(b.CacheParser,Yo.cache.parsers).handleByList(b.DetectionParser,Yo.detections);var ru={extension:b.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof B),getCacheableAssets:(i,t)=>{let e={};return i.forEach(r=>{t.forEach((s,o)=>{e[r+(o===0?"":o+1)]=s})}),e}};A.add(ru);async function su(i){if("Image"in globalThis)return new Promise(t=>{let e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}var ou={extension:{type:b.DetectionParser,priority:1},test:async()=>su("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};A.add(ou);var nu={extension:{type:b.DetectionParser,priority:0},test:async()=>su("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};A.add(nu);var gg=["png","jpg","jpeg"],au={extension:{type:b.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...gg],remove:async i=>i.filter(t=>!gg.includes(t))};A.add(au);var Ry="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function qo(i){return Ry?!1:document.createElement("video").canPlayType(i)!==""}var hu={extension:{type:b.DetectionParser,priority:0},test:async()=>qo("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")};A.add(hu);var lu={extension:{type:b.DetectionParser,priority:0},test:async()=>qo("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")};A.add(lu);var uu={extension:{type:b.DetectionParser,priority:0},test:async()=>qo("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")};A.add(uu);var cu={extension:b.ResolveParser,test:Ki.test,parse:i=>({resolution:parseFloat(T.RETINA_PREFIX.exec(i)?.[1]??"1"),format:S.path.extname(i).slice(1),src:i})};A.add(cu);var pe=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(pe||{}),yr={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};var vr,Ko;function _g(){Ko={s3tc:vr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:vr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:vr.getExtension("WEBGL_compressed_texture_etc"),etc1:vr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:vr.getExtension("WEBGL_compressed_texture_pvrtc")||vr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:vr.getExtension("WEBGL_compressed_texture_atc"),astc:vr.getExtension("WEBGL_compressed_texture_astc")}}var du={extension:{type:b.DetectionParser,priority:2},test:async()=>{let i=T.ADAPTER.createCanvas().getContext("webgl");return i?(vr=i,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{Ko||_g();let t=[];for(let e in Ko)Ko[e]&&t.push(e);return[...t,...i]},remove:async i=>(Ko||_g(),i.filter(t=>!(t in Ko)))};A.add(du);var ks=class extends ri{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,s;typeof t=="string"?(r=t,s=new Uint8Array):(r=null,s=t),super(s,e),this.origin=r,this.buffer=s?new ar(s):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new ar(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}};var Le=class extends ks{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Le._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Le._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){let s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let o=0,n=this.levels;o<n;o++){let{levelID:a,levelWidth:h,levelHeight:l,levelBuffer:u}=this._levelBuffers[o];s.compressedTexImage2D(s.TEXTURE_2D,a,this.format,h,l,0,u)}return!0}onBlobLoaded(){this._levelBuffers=Le._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,s,o,n,a){let h=new Array(r),l=t.byteOffset,u=n,c=a,d=u+s-1&~(s-1),f=c+o-1&~(o-1),p=d*f*yr[e];for(let m=0;m<r;m++)h[m]={levelID:m,levelWidth:r>1?u:d,levelHeight:r>1?c:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,u=u>>1||1,c=c>>1||1,d=u+s-1&~(s-1),f=c+o-1&~(o-1),p=d*f*yr[e];return h}};var kd=4,fu=124,Py=32,xg=20,My=542327876,pu={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},By={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},mu={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},Fy=1,Dy=2,Ny=4,Ly=64,Oy=512,Uy=131072,ky=827611204,Gy=861165636,Hy=894720068,Vy=808540228,Xy=4,Wy={[ky]:pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Gy]:pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Hy]:pe.COMPRESSED_RGBA_S3TC_DXT5_EXT},$y={70:pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:pe.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:pe.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:pe.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:pe.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:pe.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function th(i){let t=new Uint32Array(i);if(t[0]!==My)throw new Error("Invalid DDS file magic word");let e=new Uint32Array(i,0,fu/Uint32Array.BYTES_PER_ELEMENT),r=e[pu.HEIGHT],s=e[pu.WIDTH],o=e[pu.MIPMAP_COUNT],n=new Uint32Array(i,pu.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Py/Uint32Array.BYTES_PER_ELEMENT),a=n[Fy];if(a&Ny){let h=n[By.FOURCC];if(h!==Vy){let v=Wy[h],x=kd+fu,y=new Uint8Array(i,x);return[new Le(y,{format:v,width:s,height:r,levels:o})]}let l=kd+fu,u=new Uint32Array(t.buffer,l,xg/Uint32Array.BYTES_PER_ELEMENT),c=u[mu.DXGI_FORMAT],d=u[mu.RESOURCE_DIMENSION],f=u[mu.MISC_FLAG],p=u[mu.ARRAY_SIZE],m=$y[c];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(f===Xy)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");let g=new Array,_=kd+fu+xg;if(p===1)g.push(new Uint8Array(i,_));else{let v=yr[m],x=0,y=s,P=r;for(let E=0;E<o;E++){let w=Math.max(1,y+3&-4),N=Math.max(1,P+3&-4),Q=w*N*v;x+=Q,y=y>>>1,P=P>>>1}let H=_;for(let E=0;E<p;E++)g.push(new Uint8Array(i,H,x)),H+=x}return g.map(v=>new Le(v,{format:m,width:s,height:r,levels:o}))}throw a&Ly?new Error("DDSParser does not support uncompressed texture data."):a&Oy?new Error("DDSParser does not supported YUV uncompressed texture data."):a&Uy?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&Dy?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var yg=[171,75,84,88,32,49,49,187,13,10,26,10],jy=67305985,Ii={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Gd=64,eh={[G.UNSIGNED_BYTE]:1,[G.UNSIGNED_SHORT]:2,[G.INT]:4,[G.UNSIGNED_INT]:4,[G.FLOAT]:4,[G.HALF_FLOAT]:8},gu={[I.RGBA]:4,[I.RGB]:3,[I.RG]:2,[I.RED]:1,[I.LUMINANCE]:1,[I.LUMINANCE_ALPHA]:2,[I.ALPHA]:1},_u={[G.UNSIGNED_SHORT_4_4_4_4]:2,[G.UNSIGNED_SHORT_5_5_5_1]:2,[G.UNSIGNED_SHORT_5_6_5]:2};function ih(i,t,e=!1){let r=new DataView(t);if(!zy(i,r))return null;let s=r.getUint32(Ii.ENDIANNESS,!0)===jy,o=r.getUint32(Ii.GL_TYPE,s),n=r.getUint32(Ii.GL_FORMAT,s),a=r.getUint32(Ii.GL_INTERNAL_FORMAT,s),h=r.getUint32(Ii.PIXEL_WIDTH,s),l=r.getUint32(Ii.PIXEL_HEIGHT,s)||1,u=r.getUint32(Ii.PIXEL_DEPTH,s)||1,c=r.getUint32(Ii.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=r.getUint32(Ii.NUMBER_OF_FACES,s),f=r.getUint32(Ii.NUMBER_OF_MIPMAP_LEVELS,s),p=r.getUint32(Ii.BYTES_OF_KEY_VALUE_DATA,s);if(l===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");let m=4,g=4,_=h+3&-4,v=l+3&-4,x=new Array(c),y=h*l;o===0&&(y=_*v);let P;if(o!==0?eh[o]?P=eh[o]*gu[n]:P=_u[o]:P=yr[a],P===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");let H=e?qy(r,p,s):null,E=y*P,w=h,N=l,Q=_,O=v,X=Gd+p;for(let C=0;C<f;C++){let M=r.getUint32(X,s),at=X+4;for(let ut=0;ut<c;ut++){let $=x[ut];$||($=x[ut]=new Array(f)),$[C]={levelID:C,levelWidth:f>1||o!==0?w:Q,levelHeight:f>1||o!==0?N:O,levelBuffer:new Uint8Array(t,at,E)},at+=E}X+=M+4,X=X%4!==0?X+4-X%4:X,w=w>>1||1,N=N>>1||1,Q=w+m-1&~(m-1),O=N+g-1&~(g-1),E=Q*O*P}return o!==0?{uncompressed:x.map(C=>{let M=C[0].levelBuffer,at=!1;return o===G.FLOAT?M=new Float32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4):o===G.UNSIGNED_INT?(at=!0,M=new Uint32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4)):o===G.INT&&(at=!0,M=new Int32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4)),{resource:new ri(M,{width:C[0].levelWidth,height:C[0].levelHeight}),type:o,format:at?Yy(n):n}}),kvData:H}:{compressed:x.map(C=>new Le(null,{format:a,width:h,height:l,levels:f,levelBuffers:C})),kvData:H}}function zy(i,t){for(let e=0;e<yg.length;e++)if(t.getUint8(e)!==yg[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function Yy(i){switch(i){case I.RGBA:return I.RGBA_INTEGER;case I.RGB:return I.RGB_INTEGER;case I.RG:return I.RG_INTEGER;case I.RED:return I.RED_INTEGER;default:return i}}function qy(i,t,e){let r=new Map,s=0;for(;s<t;){let o=i.getUint32(Gd+s,e),n=Gd+s+4,a=3-(o+3)%4;if(o===0||o>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<o&&i.getUint8(n+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}let l=new TextDecoder().decode(new Uint8Array(i.buffer,n,h)),u=new DataView(i.buffer,n+h+1,o-h-1);r.set(l,u),s+=4+o+a}return r}var xu={extension:{type:b.LoadParser,priority:It.High},name:"loadDDS",test(i){return zt(i,".dds")},async load(i,t,e){let r=await(await T.ADAPTER.fetch(i)).arrayBuffer(),s=th(r).map(o=>{let n=new j(o,{mipmap:qt.OFF,alphaMode:St.NO_PREMULTIPLIED_ALPHA,resolution:S.getResolutionOfUrl(i),...t.data});return ze(n,e,i)});return s.length===1?s[0]:s},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};A.add(xu);var yu={extension:{type:b.LoadParser,priority:It.High},name:"loadKTX",test(i){return zt(i,".ktx")},async load(i,t,e){let r=await(await T.ADAPTER.fetch(i)).arrayBuffer(),{compressed:s,uncompressed:o,kvData:n}=ih(i,r),a=s??o,h={mipmap:qt.OFF,alphaMode:St.NO_PREMULTIPLIED_ALPHA,resolution:S.getResolutionOfUrl(i),...t.data},l=a.map(u=>{a===o&&Object.assign(h,{type:u.type,format:u.format});let c=u.resource??u,d=new j(c,h);return d.ktxKeyValueData=n,ze(d,e,i)});return l.length===1?l[0]:l},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};A.add(yu);var vu={extension:b.ResolveParser,test:i=>{let t=S.path.extname(i).slice(1);return["basis","ktx","dds"].includes(t)},parse:i=>{let t=S.path.extname(i).slice(1);if(t==="ktx"){let e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some(r=>i.endsWith(r)))return{resolution:parseFloat(T.RETINA_PREFIX.exec(i)?.[1]??"1"),format:e.find(r=>i.endsWith(r)),src:i}}return{resolution:parseFloat(T.RETINA_PREFIX.exec(i)?.[1]??"1"),format:t,src:i}}};A.add(vu);var bu=new V,Ky=4,vg=class rh{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){let t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,r,s){let o=new Image;return o.src=await this.base64(t,e,r,s),o}async base64(t,e,r,s){let o=this.canvas(t,s);if(o.toBlob!==void 0)return new Promise((n,a)=>{o.toBlob(h=>{if(!h){a(new Error("ICanvas.toBlob failed!"));return}let l=new FileReader;l.onload=()=>n(l.result),l.onerror=a,l.readAsDataURL(h)},e,r)});if(o.toDataURL!==void 0)return o.toDataURL(e,r);if(o.convertToBlob!==void 0){let n=await o.convertToBlob({type:e,quality:r});return new Promise((a,h)=>{let l=new FileReader;l.onload=()=>a(l.result),l.onerror=h,l.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){let{pixels:r,width:s,height:o,flipY:n,premultipliedAlpha:a}=this._rawPixels(t,e);n&&rh._flipY(r,s,o),a&&rh._unpremultiplyAlpha(r);let h=new S.CanvasRenderTarget(s,o,1),l=new ImageData(new Uint8ClampedArray(r.buffer),s,o);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){let{pixels:r,width:s,height:o,flipY:n,premultipliedAlpha:a}=this._rawPixels(t,e);return n&&rh._flipY(r,s,o),a&&rh._unpremultiplyAlpha(r),r}_rawPixels(t,e){let r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let s,o=!1,n=!1,a,h=!1;t&&(t instanceof Te?a=t:(a=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),h=!0,e&&(bu.width=e.width,bu.height=e.height,e=bu)));let l=r.gl;if(a){if(s=a.baseTexture.resolution,e=e??a.frame,o=!1,n=a.baseTexture.alphaMode>0&&a.baseTexture.format===I.RGBA,!h){r.renderTexture.bind(a);let f=a.framebuffer.glFramebuffers[r.CONTEXT_UID];f.blitFramebuffer&&r.framebuffer.bind(f.blitFramebuffer)}}else s=r.resolution,e||(e=bu,e.width=r.width/s,e.height=r.height/s),o=!0,n=this._rendererPremultipliedAlpha,r.renderTexture.bind();let u=Math.max(Math.round(e.width*s),1),c=Math.max(Math.round(e.height*s),1),d=new Uint8Array(Ky*u*c);return l.readPixels(Math.round(e.x*s),Math.round(e.y*s),u,c,l.RGBA,l.UNSIGNED_BYTE,d),h&&a?.destroy(!0),{pixels:d,width:u,height:c,flipY:o,premultipliedAlpha:n}}destroy(){this.renderer=null}static _flipY(t,e,r){let s=e<<2,o=r>>1,n=new Uint8Array(s);for(let a=0;a<o;a++){let h=a*s,l=(r-a-1)*s;n.set(t.subarray(h,h+s)),t.copyWithin(h,l,l+s),t.set(n,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));let e=t.length;for(let r=0;r<e;r+=4){let s=t[r+3];if(s!==0){let o=255.001/s;t[r]=t[r]*o+.5,t[r+1]=t[r+1]*o+.5,t[r+2]=t[r+2]*o+.5}}}};vg.extension={name:"extract",type:b.RendererSystem};var Hd=vg;A.add(Hd);var Qr={build(i){let t=i.points,e,r,s,o,n,a;if(i.type===vt.CIRC){let p=i.shape;e=p.x,r=p.y,n=a=p.radius,s=o=0}else if(i.type===vt.ELIP){let p=i.shape;e=p.x,r=p.y,n=p.width,a=p.height,s=o=0}else{let p=i.shape,m=p.width/2,g=p.height/2;e=p.x+m,r=p.y+g,n=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),s=m-n,o=g-a}if(!(n>=0&&a>=0&&s>=0&&o>=0)){t.length=0;return}let h=Math.ceil(2.3*Math.sqrt(n+a)),l=h*8+(s?4:0)+(o?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=r+o,t[2]=t[4]=e-s,t[5]=t[7]=r-o;return}let u=0,c=h*4+(s?2:0)+2,d=c,f=l;{let p=s+n,m=o,g=e+p,_=e-p,v=r+m;if(t[u++]=g,t[u++]=v,t[--c]=v,t[--c]=_,o){let x=r-m;t[d++]=_,t[d++]=x,t[--f]=x,t[--f]=g}}for(let p=1;p<h;p++){let m=Math.PI/2*(p/h),g=s+Math.cos(m)*n,_=o+Math.sin(m)*a,v=e+g,x=e-g,y=r+_,P=r-_;t[u++]=v,t[u++]=y,t[--c]=y,t[--c]=x,t[d++]=x,t[d++]=P,t[--f]=P,t[--f]=v}{let p=s,m=o+a,g=e+p,_=e-p,v=r+m,x=r-m;t[u++]=g,t[u++]=v,t[--f]=x,t[--f]=g,s&&(t[u++]=_,t[u++]=v,t[--f]=x,t[--f]=_)}},triangulate(i,t){let e=i.points,r=t.points,s=t.indices;if(e.length===0)return;let o=r.length/2,n=o,a,h;if(i.type!==vt.RREC){let u=i.shape;a=u.x,h=u.y}else{let u=i.shape;a=u.x+u.width/2,h=u.y+u.height/2}let l=i.matrix;r.push(i.matrix?l.a*a+l.c*h+l.tx:a,i.matrix?l.b*a+l.d*h+l.ty:h),o++,r.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)r.push(e[u],e[u+1]),s.push(o++,n,o);s.push(n+1,n,o)}};function bg(i,t=!1){let e=i.length;if(e<6)return;let r=0;for(let s=0,o=i[e-2],n=i[e-1];s<e;s+=2){let a=i[s],h=i[s+1];r+=(a-o)*(h+n),o=a,n=h}if(!t&&r>0||t&&r<=0){let s=e/2;for(let o=s+s%2;o<e;o+=2){let n=e-o-2,a=e-o-1,h=o,l=o+1;[i[n],i[h]]=[i[h],i[n]],[i[a],i[l]]=[i[l],i[a]]}}}var Zo={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points,r=i.holes,s=t.points,o=t.indices;if(e.length>=6){bg(e,!1);let n=[];for(let l=0;l<r.length;l++){let u=r[l];bg(u.points,!0),n.push(e.length/2),e=e.concat(u.points)}let a=S.earcut(e,n,2);if(!a)return;let h=s.length/2;for(let l=0;l<a.length;l+=3)o.push(a[l]+h),o.push(a[l+1]+h),o.push(a[l+2]+h);for(let l=0;l<e.length;l++)s.push(e[l])}}};var Tu={build(i){let t=i.shape,e=t.x,r=t.y,s=t.width,o=t.height,n=i.points;n.length=0,s>=0&&o>=0&&n.push(e,r,e+s,r,e+s,r+o,e,r+o)},triangulate(i,t){let e=i.points,r=t.points;if(e.length===0)return;let s=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}};var Eu={build(i){Qr.build(i)},triangulate(i,t){Qr.triangulate(i,t)}};var ne=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(ne||{}),Ye=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(Ye||{}),Oe={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}},Tg=Oe;var Jr=class{static curveTo(t,e,r,s,o,n){let a=n[n.length-2],h=n[n.length-1]-e,l=a-t,u=s-e,c=r-t,d=Math.abs(h*c-l*u);if(d<1e-8||o===0)return(n[n.length-2]!==t||n[n.length-1]!==e)&&n.push(t,e),null;let f=h*h+l*l,p=u*u+c*c,m=h*u+l*c,g=o*Math.sqrt(f)/d,_=o*Math.sqrt(p)/d,v=g*m/f,x=_*m/p,y=g*c+_*l,P=g*u+_*h,H=l*(_+v),E=h*(_+v),w=c*(g+x),N=u*(g+x),Q=Math.atan2(E-P,H-y),O=Math.atan2(N-P,w-y);return{cx:y+t,cy:P+e,radius:o,startAngle:Q,endAngle:O,anticlockwise:l*u>c*h}}static arc(t,e,r,s,o,n,a,h,l){let u=a-n,c=Oe._segmentsCount(Math.abs(u)*o,Math.ceil(Math.abs(u)/ur)*40),d=u/(c*2),f=d*2,p=Math.cos(d),m=Math.sin(d),g=c-1,_=g%1/g;for(let v=0;v<=g;++v){let x=v+_*v,y=d+n+f*x,P=Math.cos(y),H=-Math.sin(y);l.push((p*P+m*H)*o+r,(p*-H+m*P)*o+s)}}};var Gs=class{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}};var br=class{static curveLength(t,e,r,s,o,n,a,h){let l=0,u=0,c=0,d=0,f=0,p=0,m=0,g=0,_=0,v=0,x=0,y=t,P=e;for(let H=1;H<=10;++H)u=H/10,c=u*u,d=c*u,f=1-u,p=f*f,m=p*f,g=m*t+3*p*u*r+3*f*c*o+d*a,_=m*e+3*p*u*s+3*f*c*n+d*h,v=y-g,x=P-_,y=g,P=_,l+=Math.sqrt(v*v+x*x);return l}static curveTo(t,e,r,s,o,n,a){let h=a[a.length-2],l=a[a.length-1];a.length-=2;let u=Oe._segmentsCount(br.curveLength(h,l,t,e,r,s,o,n)),c=0,d=0,f=0,p=0,m=0;a.push(h,l);for(let g=1,_=0;g<=u;++g)_=g/u,c=1-_,d=c*c,f=d*c,p=_*_,m=p*_,a.push(f*h+3*d*_*t+3*c*p*r+m*o,f*l+3*d*_*e+3*c*p*s+m*n)}};function Eg(i,t,e,r,s,o,n,a){let h=i-e*s,l=t-r*s,u=i+e*o,c=t+r*o,d,f;n?(d=r,f=-e):(d=-r,f=e);let p=h+d,m=l+f,g=u+d,_=c+f;return a.push(p,m,g,_),2}function Hs(i,t,e,r,s,o,n,a){let h=e-i,l=r-t,u=Math.atan2(h,l),c=Math.atan2(s-i,o-t);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);let d=u,f=c-u,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,_=f/g;if(d+=_,a){n.push(i,t,e,r);for(let v=1,x=d;v<g;v++,x+=_)n.push(i,t,i+Math.sin(x)*m,t+Math.cos(x)*m);n.push(i,t,s,o)}else{n.push(e,r,i,t);for(let v=1,x=d;v<g;v++,x+=_)n.push(i+Math.sin(x)*m,t+Math.cos(x)*m,i,t);n.push(s,o,i,t)}return g*2}function Zy(i,t){let e=i.shape,r=i.points||e.points.slice(),s=t.closePointEps;if(r.length===0)return;let o=i.lineStyle,n=new Z(r[0],r[1]),a=new Z(r[r.length-2],r[r.length-1]),h=e.type!==vt.POLY||e.closeStroke,l=Math.abs(n.x-a.x)<s&&Math.abs(n.y-a.y)<s;if(h){r=r.slice(),l&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));let $=(n.x+a.x)*.5,L=(a.y+n.y)*.5;r.unshift($,L),r.push($,L)}let u=t.points,c=r.length/2,d=r.length,f=u.length/2,p=o.width/2,m=p*p,g=o.miterLimit*o.miterLimit,_=r[0],v=r[1],x=r[2],y=r[3],P=0,H=0,E=-(v-y),w=_-x,N=0,Q=0,O=Math.sqrt(E*E+w*w);E/=O,w/=O,E*=p,w*=p;let X=o.alignment,C=(1-X)*2,M=X*2;h||(o.cap===Ye.ROUND?d+=Hs(_-E*(C-M)*.5,v-w*(C-M)*.5,_-E*C,v-w*C,_+E*M,v+w*M,u,!0)+2:o.cap===Ye.SQUARE&&(d+=Eg(_,v,E,w,C,M,!0,u))),u.push(_-E*C,v-w*C,_+E*M,v+w*M);for(let $=1;$<c-1;++$){_=r[($-1)*2],v=r[($-1)*2+1],x=r[$*2],y=r[$*2+1],P=r[($+1)*2],H=r[($+1)*2+1],E=-(v-y),w=_-x,O=Math.sqrt(E*E+w*w),E/=O,w/=O,E*=p,w*=p,N=-(y-H),Q=x-P,O=Math.sqrt(N*N+Q*Q),N/=O,Q/=O,N*=p,Q*=p;let L=x-_,z=v-y,W=x-P,xt=H-y,Ct=L*W+z*xt,Gt=z*W-xt*L,Pt=Gt<0;if(Math.abs(Gt)<.001*Math.abs(Ct)){u.push(x-E*C,y-w*C,x+E*M,y+w*M),Ct>=0&&(o.join===ne.ROUND?d+=Hs(x,y,x-E*C,y-w*C,x-N*C,y-Q*C,u,!1)+4:d+=2,u.push(x-N*M,y-Q*M,x+N*C,y+Q*C));continue}let le=(-E+_)*(-w+y)-(-E+x)*(-w+v),Me=(-N+P)*(-Q+y)-(-N+x)*(-Q+H),me=(L*Me-W*le)/Gt,Be=(xt*le-z*Me)/Gt,$t=(me-x)*(me-x)+(Be-y)*(Be-y),Ht=x+(me-x)*C,jt=y+(Be-y)*C,ue=x-(me-x)*M,ge=y-(Be-y)*M,xa=Math.min(L*L+z*z,W*W+xt*xt),np=Pt?C:M,Ax=xa+np*np*m,wx=$t<=Ax,tl=o.join;if(tl===ne.MITER&&$t/m>g&&(tl=ne.BEVEL),wx)switch(tl){case ne.MITER:{u.push(Ht,jt,ue,ge);break}case ne.BEVEL:{Pt?u.push(Ht,jt,x+E*M,y+w*M,Ht,jt,x+N*M,y+Q*M):u.push(x-E*C,y-w*C,ue,ge,x-N*C,y-Q*C,ue,ge),d+=2;break}case ne.ROUND:{Pt?(u.push(Ht,jt,x+E*M,y+w*M),d+=Hs(x,y,x+E*M,y+w*M,x+N*M,y+Q*M,u,!0)+4,u.push(Ht,jt,x+N*M,y+Q*M)):(u.push(x-E*C,y-w*C,ue,ge),d+=Hs(x,y,x-E*C,y-w*C,x-N*C,y-Q*C,u,!1)+4,u.push(x-N*C,y-Q*C,ue,ge));break}}else{switch(u.push(x-E*C,y-w*C,x+E*M,y+w*M),tl){case ne.MITER:{Pt?u.push(ue,ge,ue,ge):u.push(Ht,jt,Ht,jt),d+=2;break}case ne.ROUND:{Pt?d+=Hs(x,y,x+E*M,y+w*M,x+N*M,y+Q*M,u,!0)+2:d+=Hs(x,y,x-E*C,y-w*C,x-N*C,y-Q*C,u,!1)+2;break}}u.push(x-N*C,y-Q*C,x+N*M,y+Q*M),d+=2}}_=r[(c-2)*2],v=r[(c-2)*2+1],x=r[(c-1)*2],y=r[(c-1)*2+1],E=-(v-y),w=_-x,O=Math.sqrt(E*E+w*w),E/=O,w/=O,E*=p,w*=p,u.push(x-E*C,y-w*C,x+E*M,y+w*M),h||(o.cap===Ye.ROUND?d+=Hs(x-E*(C-M)*.5,y-w*(C-M)*.5,x-E*C,y-w*C,x+E*M,y+w*M,u,!1)+2:o.cap===Ye.SQUARE&&(d+=Eg(x,y,E,w,C,M,!1,u)));let at=t.indices,ut=Oe.epsilon*Oe.epsilon;for(let $=f;$<d+f-2;++$)_=u[$*2],v=u[$*2+1],x=u[($+1)*2],y=u[($+1)*2+1],P=u[($+2)*2],H=u[($+2)*2+1],!(Math.abs(_*(y-H)+x*(H-v)+P*(v-y))<ut)&&at.push($,$+1,$+2)}function Qy(i,t){let e=0,r=i.shape,s=i.points||r.points,o=r.type!==vt.POLY||r.closeStroke;if(s.length===0)return;let n=t.points,a=t.indices,h=s.length/2,l=n.length/2,u=l;for(n.push(s[0],s[1]),e=1;e<h;e++)n.push(s[e*2],s[e*2+1]),a.push(u,u+1),u++;o&&a.push(u,l)}function Qo(i,t){i.lineStyle.native?Qy(i,t):Zy(i,t)}var Tr=class{static curveLength(t,e,r,s,o,n){let a=t-2*r+o,h=e-2*s+n,l=2*r-2*t,u=2*s-2*e,c=4*(a*a+h*h),d=4*(a*l+h*u),f=l*l+u*u,p=2*Math.sqrt(c+d+f),m=Math.sqrt(c),g=2*c*m,_=2*Math.sqrt(f),v=d/m;return(g*p+m*d*(p-_)+(4*f*c-d*d)*Math.log((2*m+v+p)/(v+_)))/(4*g)}static curveTo(t,e,r,s,o){let n=o[o.length-2],a=o[o.length-1],h=Oe._segmentsCount(Tr.curveLength(n,a,t,e,r,s)),l=0,u=0;for(let c=1;c<=h;++c){let d=c/h;l=n+(t-n)*d,u=a+(e-a)*d,o.push(l+(t+(r-t)*d-l)*d,u+(e+(s-e)*d-u)*d)}}};var Jo={[vt.POLY]:Zo,[vt.CIRC]:Qr,[vt.ELIP]:Qr,[vt.RECT]:Tu,[vt.RREC]:Eu},sh=[],Vs=[];var Er=class{constructor(t,e=null,r=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new Er(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}};var tn=new Z,Ag=class wg extends Wr{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ci,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Vs.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e.reset(),sh.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,s=null){let o=new Er(t,e,r,s);return this.graphicsData.push(o),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;let r=new Er(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=s.lineStyle,s.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){let e=this.graphicsData;for(let r=0;r<e.length;++r){let s=e[r];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,tn):tn.copyFrom(t),s.shape.contains(tn.x,tn.y))){let o=!1;if(s.holes){for(let n=0;n<s.holes.length;n++)if(s.holes[n].shape.contains(tn.x,tn.y)){o=!0;break}}if(!o)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;let t=this.uvs,e=this.graphicsData,r=null,s=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],s=r.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;let l=e[h],u=l.fillStyle,c=l.lineStyle;Jo[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){let f=d===0?u:c;if(!f.visible)continue;let p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=xe.REPEAT,d===0?this.processFill(l):this.processLine(l);let _=this.points.length/2-g;_!==0&&(r&&!this._compareStyles(s,f)&&(r.end(m,g),r=null),r||(r=sh.pop()||new Gs,r.begin(f,m,g),this.batches.push(r),s=f),this.addUvs(this.points,t,f.texture,g,_,f.matrix))}}let o=this.indices.length,n=this.points.length/2;if(r&&r.end(o,n),this.batches.length===0){this.batchable=!0;return}let a=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){let r=this.graphicsData[t],s=r.fillStyle,o=r.lineStyle;if(s&&!s.texture.baseTexture.valid||o&&!o.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);let t=this.batches;for(let e=0,r=t.length;e<r;e++){let s=t[e];for(let o=0;o<s.size;o++){let n=s.start+o;this.indicesUint16[n]=this.indicesUint16[n]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;let t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<wg.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++j._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Vs.push(this.drawCalls[c]);this.drawCalls.length=0;let e=this.colors,r=this.textureIds,s=Vs.pop();s||(s=new hr,s.texArray=new mr),s.texArray.count=0,s.start=0,s.size=0,s.type=_e.TRIANGLES;let o=0,n=null,a=0,h=!1,l=_e.TRIANGLES,u=0;this.drawCalls.push(s);for(let c=0;c<this.batches.length;c++){let d=this.batches[c],f=8,p=d.style,m=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,l=h?_e.LINES:_e.TRIANGLES,n=null,o=f,t++),n!==m&&(n=m,m._batchEnabled!==t&&(o===f&&(t++,o=0,s.size>0&&(s=Vs.pop(),s||(s=new hr,s.texArray=new mr),this.drawCalls.push(s)),s.start=u,s.size=0,s.texArray.count=0,s.type=l),m.touched=1,m._batchEnabled=t,m._batchLocation=o,m.wrapMode=xe.REPEAT,s.texArray.elements[s.texArray.count++]=m,o++)),s.size+=d.size,u+=d.size,a=m._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(r,a,d.attribSize,d.attribStart)}j._globalBatch=t,this.packAttributes()}packAttributes(){let t=this.points,e=this.uvs,r=this.colors,s=this.textureIds,o=new ArrayBuffer(t.length*3*4),n=new Float32Array(o),a=new Uint32Array(o),h=0;for(let l=0;l<t.length/2;l++)n[h++]=t[l*2],n[h++]=t[l*2+1],n[h++]=e[l*2],n[h++]=e[l*2+1],a[h++]=r[l],n[h++]=s[l];this._buffer.update(o),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Zo.triangulate(t,this):Jo[t.type].triangulate(t,this)}processLine(t){Qo(t,this);for(let e=0;e<t.holes.length;e++)Qo(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){let r=t[e];Jo[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){let t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){let s=t[r*2],o=t[r*2+1];t[r*2]=e.a*s+e.c*o+e.tx,t[r*2+1]=e.b*s+e.d*o+e.ty}}addColors(t,e,r,s,o=0){let n=tt.shared.setValue(e).toLittleEndianNumber(),a=tt.shared.setValue(n).toPremultiplied(r);t.length=Math.max(t.length,o+s);for(let h=0;h<s;h++)t[o+h]=a}addTextureIds(t,e,r,s=0){t.length=Math.max(t.length,s+r);for(let o=0;o<r;o++)t[s+o]=e}addUvs(t,e,r,s,o,n=null){let a=0,h=e.length,l=r.frame;for(;a<o;){let c=t[(s+a)*2],d=t[(s+a)*2+1];if(n){let f=n.a*c+n.c*d+n.tx;d=n.b*c+n.d*d+n.ty,c=f}a++,e.push(c/l.width,d/l.height)}let u=r.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,r,h,o)}adjustUvs(t,e,r,s){let o=e.baseTexture,n=1e-6,a=r+s*2,h=e.frame,l=h.width/o.width,u=h.height/o.height,c=h.x/h.width,d=h.y/h.height,f=Math.floor(t[r]+n),p=Math.floor(t[r+1]+n);for(let m=r+2;m<a;m+=2)f=Math.min(f,Math.floor(t[m]+n)),p=Math.min(p,Math.floor(t[m+1]+n));c-=f,d-=p;for(let m=r;m<a;m+=2)t[m]=(t[m]+c)*l,t[m+1]=(t[m+1]+d)*u}};Ag.BATCHABLE_SIZE=100;var Au=Ag;var Zi=class{constructor(){this.color=16777215,this.alpha=1,this.texture=B.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){let t=new Zi;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=B.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}};var ts=class extends Zi{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ye.BUTT,this.join=ne.MITER,this.miterLimit=10}clone(){let t=new ts;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Ye.BUTT,this.join=ne.MITER,this.miterLimit=10}};var Vd={},Xd=class wu extends Dt{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Zi,this._lineStyle=new ts,this._matrix=null,this._holeMode=!1,this.state=Ut.for2d(),this._geometry=t||new Au,this._geometry.refCount++,this._transformID=-1,this._tintColor=new tt(16777215),this.blendMode=Y.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new wu(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,s=.5,o=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:r,alignment:s,native:o}),this.lineTextureStyle(t)}lineTextureStyle(t){let e={width:0,texture:B.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Ye.BUTT,join:ne.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){let t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new $e,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new $e,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);let r=this.currentPath.points,s=r[r.length-2],o=r[r.length-1];return(s!==t||o!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,s){this._initCurve();let o=this.currentPath.points;return o.length===0&&this.moveTo(0,0),Tr.curveTo(t,e,r,s,o),this}bezierCurveTo(t,e,r,s,o,n){return this._initCurve(),br.curveTo(t,e,r,s,o,n,this.currentPath.points),this}arcTo(t,e,r,s,o){this._initCurve(t,e);let n=this.currentPath.points,a=Jr.curveTo(t,e,r,s,o,n);if(a){let{cx:h,cy:l,radius:u,startAngle:c,endAngle:d,anticlockwise:f}=a;this.arc(h,l,u,c,d,f)}return this}arc(t,e,r,s,o,n=!1){if(s===o)return this;if(!n&&o<=s?o+=ur:n&&s<=o&&(s+=ur),o-s===0)return this;let a=t+Math.cos(s)*r,h=e+Math.sin(s)*r,l=this._geometry.closePointEps,u=this.currentPath?this.currentPath.points:null;if(u){let c=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-h);c<l&&d<l||u.push(a,h)}else this.moveTo(a,h),u=this.currentPath.points;return Jr.arc(a,h,t,e,r,s,o,n,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:B.WHITE,color:t,alpha:e})}normalizeColor(t){let e=tt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){let e={texture:B.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,s){return this.drawShape(new V(t,e,r,s))}drawRoundedRect(t,e,r,s,o){return this.drawShape(new fr(t,e,r,s,o))}drawCircle(t,e,r){return this.drawShape(new cr(t,e,r))}drawEllipse(t,e,r,s){return this.drawShape(new dr(t,e,r,s))}drawPolygon(...t){let e,r=!0,s=t[0];s.points?(r=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;let o=new $e(e);return o.closeStroke=r,this.drawShape(o),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){let t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===vt.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();let e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){let t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let s=0;s<r;s++){let o=t.batches[s],n=o.style.color,a=new Float32Array(this.vertexData.buffer,o.attribStart*4*2,o.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,o.attribStart*4*2,o.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,o.start*2,o.size),u={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:tt.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:o.style.texture,alpha:o.style.alpha,worldAlpha:1};this.batches[s]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){let s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){let e=this._resolveDirectShader(t),r=this._geometry,s=this.worldAlpha,o=e.uniforms,n=r.drawCalls;o.translationMatrix=this.transform.worldTransform,tt.shared.setValue(this._tintColor).premultiply(s).toArray(o.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let a=0,h=n.length;a<h;a++)this._renderDrawCallDirect(t,r.drawCalls[a])}_renderDrawCallDirect(t,e){let{texArray:r,type:s,size:o,start:n}=e,a=r.count;for(let h=0;h<a;h++)t.texture.bind(r.elements[h],h);t.geometry.draw(s,o,n)}_resolveDirectShader(t){let e=this.shader,r=this.pluginName;if(!e){if(!Vd[r]){let{maxTextures:s}=t.plugins[r],o=new Int32Array(s);for(let h=0;h<s;h++)o[h]=h;let n={tint:new Float32Array([1,1,1,1]),translationMatrix:new rt,default:Vt.from({uSamplers:o},!0)},a=t.plugins[r]._shader.program;Vd[r]=new Xt(a,n)}e=Vd[r]}return e}_calculateBounds(){this.finishPoly();let t=this._geometry;if(!t.graphicsData.length)return;let{minX:e,minY:r,maxX:s,maxY:o}=t.bounds;this._bounds.addFrame(this.transform,e,r,s,o)}containsPoint(t){return this.worldTransform.applyInverse(t,wu._TEMP_POINT),this._geometry.containsPoint(wu._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e._tintRGB=tt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){let t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;let e=this.transform.worldTransform,r=e.a,s=e.b,o=e.c,n=e.d,a=e.tx,h=e.ty,l=this._geometry.points,u=this.vertexData,c=0;for(let d=0;d<l.length;d+=2){let f=l[d],p=l[d+1];u[c++]=r*f+o*p+a,u[c++]=n*p+s*f+h}}closePath(){let t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Xd.curves=Oe,Xd._TEMP_POINT=new Z;var oh=Xd;var Jy={buildPoly:Zo,buildCircle:Qr,buildRectangle:Tu,buildRoundedRectangle:Eu,buildLine:Qo,ArcUtils:Jr,BezierUtils:br,QuadraticUtils:Tr,BatchPart:Gs,FILL_COMMANDS:Jo,BATCH_POOL:sh,DRAW_CALL_POOL:Vs};var en=class{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;let e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}};var Wd=new Z,Cg=new $e,Sg=class Ig extends Dt{constructor(t,e,r,s=_e.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||Ut.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=T.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){let e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===_e.TRIANGLES&&e.length<Ig.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){let e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){let e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;let s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){let t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));let s=this.transform.worldTransform,o=s.a,n=s.b,a=s.c,h=s.d,l=s.tx,u=s.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){let f=e[d*2],p=e[d*2+1];c[d*2]=o*f+a*p+l,c[d*2+1]=n*f+h*p+u}if(this._roundPixels){let d=T.RESOLUTION;for(let f=0;f<c.length;++f)c[f]=Math.round(c[f]*d)/d}this.vertexDirty=r}calculateUvs(){let t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new en(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Wd);let e=this.geometry.getBuffer("aVertexPosition").data,r=Cg.points,s=this.geometry.getIndex().data,o=s.length,n=this.drawMode===4?3:1;for(let a=0;a+2<o;a+=n){let h=s[a]*2,l=s[a+1]*2,u=s[a+2]*2;if(r[0]=e[h],r[1]=e[h+1],r[2]=e[l],r[3]=e[l+1],r[4]=e[u],r[5]=e[u+1],Cg.contains(Wd.x,Wd.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Sg.BATCHABLE_SIZE=100;var Ri=Sg;var hi=class extends ie{constructor(t,e,r){super();let s=new ft(t),o=new ft(e,!0),n=new ft(r,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,G.FLOAT).addAttribute("aTextureCoord",o,2,!1,G.FLOAT).addIndex(n),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}};var Rg=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`;var Pg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;var qe=class extends Xt{constructor(t,e){let r={uSampler:t,alpha:1,uTextureMatrix:rt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||re.from(Pg,Rg),r),this._colorDirty=!1,this.uvMatrix=new $i(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new tt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;let t=this.texture.baseTexture.alphaMode;tt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}};var rn=class extends hi{constructor(t=100,e=100,r=10,s=10){super(),this.segWidth=r,this.segHeight=s,this.width=t,this.height=e,this.build()}build(){let t=this.segWidth*this.segHeight,e=[],r=[],s=[],o=this.segWidth-1,n=this.segHeight-1,a=this.width/o,h=this.height/n;for(let u=0;u<t;u++){let c=u%this.segWidth,d=u/this.segWidth|0;e.push(c*a,d*h),r.push(c/o,d/n)}let l=o*n;for(let u=0;u<l;u++){let c=u%o,d=u/o|0,f=d*this.segWidth+c,p=d*this.segWidth+c+1,m=(d+1)*this.segWidth+c,g=(d+1)*this.segWidth+c+1;s.push(f,p,m,p,g,m)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};var sn=class extends hi{constructor(t=200,e,r=0){super(new Float32Array(e.length*4),new Float32Array(e.length*4),new Uint16Array((e.length-1)*6)),this.points=e,this._width=t,this.textureScale=r,this.build()}get width(){return this._width}build(){let t=this.points;if(!t)return;let e=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),s=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),r.data=new Float32Array(t.length*4),s.data=new Uint16Array((t.length-1)*6));let o=r.data,n=s.data;o[0]=0,o[1]=0,o[2]=0,o[3]=1;let a=0,h=t[0],l=this._width*this.textureScale,u=t.length;for(let d=0;d<u;d++){let f=d*4;if(this.textureScale>0){let p=h.x-t[d].x,m=h.y-t[d].y,g=Math.sqrt(p*p+m*m);h=t[d],a+=g/l}else a=d/(u-1);o[f]=a,o[f+1]=0,o[f+2]=a,o[f+3]=1}let c=0;for(let d=0;d<u-1;d++){let f=d*2;n[c++]=f,n[c++]=f+1,n[c++]=f+2,n[c++]=f+2,n[c++]=f+1,n[c++]=f+3}r.update(),s.update(),this.updateVertices()}updateVertices(){let t=this.points;if(t.length<1)return;let e=t[0],r,s=0,o=0,n=this.buffers[0].data,a=t.length,h=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<a;l++){let u=t[l],c=l*4;l<t.length-1?r=t[l+1]:r=u,o=-(r.x-e.x),s=r.y-e.y;let d=(1-l/(a-1))*10;d>1&&(d=1);let f=Math.sqrt(s*s+o*o);f<1e-6?(s=0,o=0):(s/=f,o/=f,s*=h,o*=h),n[c]=u.x+s,n[c+1]=u.y+o,n[c+2]=u.x-s,n[c+3]=u.y-o,e=u}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}};var on=class extends Ri{constructor(t,e,r){let s=new rn(t.width,t.height,e,r),o=new qe(B.WHITE);super(s,o),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;let t=this.geometry,{width:e,height:r}=this.shader.texture;this.autoResize&&(t.width!==e||t.height!==r)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}};var Cu=10,Su=class extends on{constructor(t,e,r,s,o){super(B.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=e??t.defaultBorders?.left??Cu,this._rightWidth=s??t.defaultBorders?.right??Cu,this._topHeight=r??t.defaultBorders?.top??Cu,this._bottomHeight=o??t.defaultBorders?.bottom??Cu,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){let t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){let t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){let t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,s=this._height>r?1:this._height/r;return Math.min(e,s)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){let t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;let r=1/this._origWidth,s=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=s*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-s*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}};var Iu=class extends Ri{constructor(t=B.EMPTY,e,r,s,o){let n=new hi(e,r,s);n.getBuffer("aVertexPosition").static=!1;let a=new qe(t);super(n,a,null,o),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}};var Ru=class extends Ri{constructor(t,e,r=0){let s=new sn(t.height,e,r),o=new qe(t);r>0&&(t.baseTexture.wrapMode=xe.REPEAT),super(s,o),this.autoUpdate=!0}_render(t){let e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}};var Pu=class extends Dt{constructor(t=1500,e,r=16384,s=!1){super();let o=16384;r>o&&(r=o),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=Y.NORMAL,this.autoResize=s,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tintColor=new tt(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){let e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}};var nh=class{constructor(t,e,r){this.geometry=new ie,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let o=t[s];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||G.FLOAT,offset:o.offset},e[s]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){let t=this.geometry,e=0;this.indexBuffer=new ft(S.createIndicesForQuads(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let n=0;n<this.dynamicProperties.length;++n){let a=this.dynamicProperties[n];a.offset=e,e+=a.size,this.dynamicStride+=a.size}let r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new ft(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let n=0;n<this.staticProperties.length;++n){let a=this.staticProperties[n];a.offset=s,s+=a.size,this.staticStride+=a.size}let o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new ft(this.staticData,!0,!1);for(let n=0;n<this.dynamicProperties.length;++n){let a=this.dynamicProperties[n];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===G.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let n=0;n<this.staticProperties.length;++n){let a=this.staticProperties[n];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===G.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,r){for(let s=0;s<this.dynamicProperties.length;s++){let o=this.dynamicProperties[s];o.uploadFunction(t,e,r,o.type===G.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let s=0;s<this.staticProperties.length;s++){let o=this.staticProperties[s];o.uploadFunction(t,e,r,o.type===G.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}};var Mg=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`;var Bg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;var nn=class extends si{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new rt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:G.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Xt.from(Bg,Mg,{}),this.state=Ut.for2d()}render(t){let e=t.children,r=t._maxSize,s=t._batchSize,o=this.renderer,n=e.length;if(n===0)return;n>r&&!t.autoResize&&(n=r);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));let h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=S.correctBlendMode(t.blendMode,l),o.state.set(this.state);let u=o.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=tt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<n;f+=s,p+=1){let m=n-f;m>s&&(m=s),p>=a.length&&a.push(this._generateOneMoreBuffer(t));let g=a[p];g.uploadDynamic(e,f,m);let _=t._bufferUpdateIDs[p]||0;d=d||g._updateID<_,d&&(g._updateID=t._updateID,g.uploadStatic(e,f,m)),o.geometry.bind(g.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){let e=[],r=t._maxSize,s=t._batchSize,o=t._properties;for(let n=0;n<r;n+=s)e.push(new nh(this.properties,o,s));return e}_generateOneMoreBuffer(t){let e=t._batchSize,r=t._properties;return new nh(this.properties,r,e)}uploadVertices(t,e,r,s,o,n){let a=0,h=0,l=0,u=0;for(let c=0;c<r;++c){let d=t[e+c],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,_=f.orig;g?(h=g.x-d.anchor.x*_.width,a=h+g.width,u=g.y-d.anchor.y*_.height,l=u+g.height):(a=_.width*(1-d.anchor.x),h=_.width*-d.anchor.x,l=_.height*(1-d.anchor.y),u=_.height*-d.anchor.y),s[n]=h*p,s[n+1]=u*m,s[n+o]=a*p,s[n+o+1]=u*m,s[n+o*2]=a*p,s[n+o*2+1]=l*m,s[n+o*3]=h*p,s[n+o*3+1]=l*m,n+=o*4}}uploadPosition(t,e,r,s,o,n){for(let a=0;a<r;a++){let h=t[e+a].position;s[n]=h.x,s[n+1]=h.y,s[n+o]=h.x,s[n+o+1]=h.y,s[n+o*2]=h.x,s[n+o*2+1]=h.y,s[n+o*3]=h.x,s[n+o*3+1]=h.y,n+=o*4}}uploadRotation(t,e,r,s,o,n){for(let a=0;a<r;a++){let h=t[e+a].rotation;s[n]=h,s[n+o]=h,s[n+o*2]=h,s[n+o*3]=h,n+=o*4}}uploadUvs(t,e,r,s,o,n){for(let a=0;a<r;++a){let h=t[e+a]._texture._uvs;h?(s[n]=h.x0,s[n+1]=h.y0,s[n+o]=h.x1,s[n+o+1]=h.y1,s[n+o*2]=h.x2,s[n+o*2+1]=h.y2,s[n+o*3]=h.x3,s[n+o*3+1]=h.y3,n+=o*4):(s[n]=0,s[n+1]=0,s[n+o]=0,s[n+o+1]=0,s[n+o*2]=0,s[n+o*2+1]=0,s[n+o*3]=0,s[n+o*3+1]=0,n+=o*4)}}uploadTint(t,e,r,s,o,n){for(let a=0;a<r;++a){let h=t[e+a],l=tt.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);s[n]=l,s[n+o]=l,s[n+o*2]=l,s[n+o*3]=l,n+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}};nn.extension={name:"particle",type:b.RendererPlugin};A.add(nn);var Ar=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Ar||{});var Mu={willReadFrequently:!0},Qi=class q{static get experimentalLetterSpacingSupported(){let t=q._experimentalLetterSpacingSupported;if(t!==void 0){let e=T.ADAPTER.getCanvasRenderingContext2D().prototype;t=q._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,s,o,n,a,h,l){this.text=t,this.style=e,this.width=r,this.height=s,this.lines=o,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,r,s=q._canvas){r=r??e.wordWrap;let o=e.toFontString(),n=q.measureFont(o);n.fontSize===0&&(n.fontSize=e.fontSize,n.ascent=e.fontSize);let a=s.getContext("2d",Mu);a.font=o;let h=(r?q.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length),u=0;for(let p=0;p<h.length;p++){let m=q._measureText(h[p],e.letterSpacing,a);l[p]=m,u=Math.max(u,m)}let c=u+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);let d=e.lineHeight||n.fontSize+e.strokeThickness,f=Math.max(d,n.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new q(t,e,c,f,h,l,d+e.leading,u,n)}static _measureText(t,e,r){let s=!1;q.experimentalLetterSpacingSupported&&(q.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,s=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let o=r.measureText(t).width;return o>0&&(s?o-=e:o+=(q.graphemeSegmenter(t).length-1)*e),o}static wordWrap(t,e,r=q._canvas){let s=r.getContext("2d",Mu),o=0,n="",a="",h=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,c=q.collapseSpaces(u),d=q.collapseNewlines(u),f=!c,p=e.wordWrapWidth+l,m=q.tokenize(t);for(let g=0;g<m.length;g++){let _=m[g];if(q.isNewline(_)){if(!d){a+=q.addLine(n),f=!c,n="",o=0;continue}_=" "}if(c){let x=q.isBreakingSpace(_),y=q.isBreakingSpace(n[n.length-1]);if(x&&y)continue}let v=q.getFromCache(_,l,h,s);if(v>p)if(n!==""&&(a+=q.addLine(n),n="",o=0),q.canBreakWords(_,e.breakWords)){let x=q.wordWrapSplit(_);for(let y=0;y<x.length;y++){let P=x[y],H=P,E=1;for(;x[y+E];){let N=x[y+E];if(!q.canBreakChars(H,N,_,y,e.breakWords))P+=N;else break;H=N,E++}y+=E-1;let w=q.getFromCache(P,l,h,s);w+o>p&&(a+=q.addLine(n),f=!1,n="",o=0),n+=P,o+=w}}else{n.length>0&&(a+=q.addLine(n),n="",o=0);let x=g===m.length-1;a+=q.addLine(_,!x),f=!1,n="",o=0}else v+o>p&&(f=!1,a+=q.addLine(n),n="",o=0),(n.length>0||!q.isBreakingSpace(_)||f)&&(n+=_,o+=v)}return a+=q.addLine(n,!1),a}static addLine(t,e=!0){return t=q.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,r,s){let o=r[t];return typeof o!="number"&&(o=q._measureText(t,e,s)+e,r[t]=o),o}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){let r=t[e];if(!q.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:q._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:q._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){let e=[],r="";if(typeof t!="string")return e;for(let s=0;s<t.length;s++){let o=t[s],n=t[s+1];if(q.isBreakingSpace(o,n)||q.isNewline(o)){r!==""&&(e.push(r),r=""),e.push(o);continue}r+=o}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,s,o){return!0}static wordWrapSplit(t){return q.graphemeSegmenter(t)}static measureFont(t){if(q._fonts[t])return q._fonts[t];let e={ascent:0,descent:0,fontSize:0},r=q._canvas,s=q._context;s.font=t;let o=q.METRICS_STRING+q.BASELINE_SYMBOL,n=Math.ceil(s.measureText(o).width),a=Math.ceil(s.measureText(q.BASELINE_SYMBOL).width),h=Math.ceil(q.HEIGHT_MULTIPLIER*a);if(a=a*q.BASELINE_MULTIPLIER|0,n===0||h===0)return q._fonts[t]=e,e;r.width=n,r.height=h,s.fillStyle="#f00",s.fillRect(0,0,n,h),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(o,0,a);let l=s.getImageData(0,0,n,h).data,u=l.length,c=n*4,d=0,f=0,p=!1;for(d=0;d<a;++d){for(let m=0;m<c;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f+=c;else break}for(e.ascent=a-d,f=u-c,p=!1,d=h;d>a;--d){for(let m=0;m<c;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f-=c;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,q._fonts[t]=e,e}static clearMetrics(t=""){t?delete q._fonts[t]:q._fonts={}}static get _canvas(){if(!q.__canvas){let t;try{let e=new OffscreenCanvas(0,0);if(e.getContext("2d",Mu)?.measureText)return q.__canvas=e,e;t=T.ADAPTER.createCanvas()}catch{t=T.ADAPTER.createCanvas()}t.width=t.height=10,q.__canvas=t}return q.__canvas}static get _context(){return q.__context||(q.__context=q._canvas.getContext("2d",Mu)),q.__context}};Qi.METRICS_STRING="|\xC9q\xC5",Qi.BASELINE_SYMBOL="M",Qi.BASELINE_MULTIPLIER=1.4,Qi.HEIGHT_MULTIPLIER=2,Qi.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){let i=new Intl.Segmenter;return t=>[...i.segment(t)].map(e=>e.segment)}return i=>[...i]})(),Qi.experimentalLetterSpacing=!1,Qi._fonts={},Qi._newlines=[10,13],Qi._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Ke=Qi;var tv=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Fg=class ah{constructor(t){this.styleID=0,this.reset(),jd(this,t,t)}clone(){let t={};return jd(t,this,ah.defaultStyle),new ah(t)}reset(){jd(this,ah.defaultStyle,ah.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){let e=$d(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){let e=$d(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){ev(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){let e=$d(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){let t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let s=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!tv.includes(s)&&(s=`"${s}"`),e[r]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Fg.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ar.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var we=Fg;function $d(i){let t=tt.shared,e=r=>{let s=t.setValue(r);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(i)?i.map(e):e(i)}function ev(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function jd(i,t,e){for(let r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}var iv={texture:!0,children:!1,baseTexture:!0},Dg=class zd extends se{constructor(t,e,r){let s=!1;r||(r=T.ADAPTER.createCanvas(),s=!0),r.width=3,r.height=3;let o=B.from(r);o.orig=new V,o.trim=new V,super(o),this._ownCanvas=s,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=zd.defaultResolution??T.RESOLUTION,this._autoResolution=zd.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ke.experimentalLetterSpacing}static set experimentalLetterSpacing(t){S.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ke.experimentalLetterSpacing=t}updateText(t){let e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();let r=this.context,s=Ke.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=s.width,n=s.height,a=s.lines,h=s.lineHeight,l=s.lineWidths,u=s.maxLineWidth,c=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;let d,f,p=e.dropShadow?2:1;for(let m=0;m<p;++m){let g=e.dropShadow&&m===0,_=g?Math.ceil(Math.max(1,n)+e.padding*2):0,v=_*this._resolution;if(g){r.fillStyle="black",r.strokeStyle="black";let y=e.dropShadowColor,P=e.dropShadowBlur*this._resolution,H=e.dropShadowDistance*this._resolution;r.shadowColor=tt.shared.setValue(y).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=P,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*H,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*H+v}else r.fillStyle=this._generateFillStyle(e,a,s),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let x=(h-c.fontSize)/2;h-c.fontSize<0&&(x=0);for(let y=0;y<a.length;y++)d=e.strokeThickness/2,f=e.strokeThickness/2+y*h+c.ascent+x,e.align==="right"?d+=u-l[y]:e.align==="center"&&(d+=(u-l[y])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[y],d+e.padding,f+e.padding-_,!0),e.fill&&this.drawLetterSpacing(a[y],d+e.padding,f+e.padding-_)}this.updateTexture()}drawLetterSpacing(t,e,r,s=!1){let o=this._style.letterSpacing,n=!1;if(Ke.experimentalLetterSpacingSupported&&(Ke.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,n=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||n){s?this.context.strokeText(t,e,r):this.context.fillText(t,e,r);return}let a=e,h=Ke.graphemeSegmenter(t),l=this.context.measureText(t).width,u=0;for(let c=0;c<h.length;++c){let d=h[c];s?this.context.strokeText(d,a,r):this.context.fillText(d,a,r);let f="";for(let p=c+1;p<h.length;++p)f+=h[p];u=this.context.measureText(f).width,a+=l-u+o,l=u}}updateTexture(){let t=this.canvas;if(this._style.trim){let n=S.trimCanvas(t);n.data&&(t.width=n.width,t.height=n.height,this.context.putImageData(n.data,0,0))}let e=this._texture,r=this._style,s=r.trim?0:r.padding,o=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){let s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let o,n=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-n-a*2,l=this.canvas.height/this._resolution-n-a*2,u=s.slice(),c=t.fillGradientStops.slice();if(!c.length){let d=u.length+1;for(let f=1;f<d;++f)c.push(f/d)}if(u.unshift(s[0]),c.unshift(0),u.push(s[s.length-1]),c.push(1),t.fillGradientType===Ar.LINEAR_VERTICAL){o=this.context.createLinearGradient(h/2,a,h/2,l+a);let d=r.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){let p=r.lineHeight*(f-1)+d,m=r.lineHeight*f,g=m;f>0&&p>m&&(g=(m+p)/2);let _=m+d,v=r.lineHeight*(f+1),x=_;f+1<e.length&&v<_&&(x=(_+v)/2);let y=(x-g)/l;for(let P=0;P<u.length;P++){let H=0;typeof c[P]=="number"?H=c[P]:H=P/u.length;let E=Math.min(1,Math.max(0,g/l+H*y));E=Number(E.toFixed(5)),o.addColorStop(E,u[P])}}}else{o=this.context.createLinearGradient(a,l/2,h+a,l/2);let d=u.length+1,f=1;for(let p=0;p<u.length;p++){let m;typeof c[p]=="number"?m=c[p]:m=f/d,o.addColorStop(m,u[p]),f++}}return o}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},iv,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);let e=S.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);let e=S.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof we?this._style=t:this._style=new we(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Dg.defaultAutoResolution=!0;var hh=Dg;var an=class{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}};function rv(i,t){let e=!1;if(i?._textures?.length){for(let r=0;r<i._textures.length;r++)if(i._textures[r]instanceof B){let s=i._textures[r].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function sv(i,t){if(i.baseTexture instanceof j){let e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function ov(i,t){if(i._texture&&i._texture instanceof B){let e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function nv(i,t){return t instanceof hh?(t.updateText(!0),!0):!1}function av(i,t){if(t instanceof we){let e=t.toFontString();return Ke.measureFont(e),!0}return!1}function hv(i,t){if(i instanceof hh){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);let e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function lv(i,t){return i instanceof we?(t.includes(i)||t.push(i),!0):!1}var Ng=class Lg{constructor(t){this.limiter=new an(Lg.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(hv),this.registerFindHook(lv),this.registerFindHook(rv),this.registerFindHook(sv),this.registerFindHook(ov),this.registerUploadHook(nv),this.registerUploadHook(av)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,At.system.addOnce(this.tick,this,Ee.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){let t=this.queue[0],e=!1;if(t&&!t._destroyed){for(let r=0,s=this.uploadHooks.length;r<s;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)At.system.addOnce(this.tick,this,Ee.UTILITY);else{this.ticking=!1;let t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Dt)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&At.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Ng.uploadsPerFrame=4;var Xs=Ng;Object.defineProperties(T,{UPLOADS_PER_FRAME:{get(){return Xs.uploadsPerFrame},set(i){S.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Xs.uploadsPerFrame=i}}});function Og(i,t){return t instanceof j?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function uv(i,t){if(!(t instanceof oh))return!1;let{geometry:e}=t;t.finishPoly(),e.updateBatches();let{batches:r}=e;for(let s=0;s<r.length;s++){let{texture:o}=r[s].style;o&&Og(i,o.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function cv(i,t){return i instanceof oh?(t.push(i),!0):!1}var hn=class extends Xs{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(cv),this.registerUploadHook(Og),this.registerUploadHook(uv)}};hn.extension={name:"prepare",type:b.RendererSystem};A.add(hn);var Bu=class{constructor(t){this.maxMilliseconds=t,this.frameStart=0}beginFrame(){this.frameStart=Date.now()}allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds}};var Ws=class extends se{constructor(t,e=!0){super(t[0]instanceof B?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(At.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(At.shared.add(this.update,this,Ee.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;let e=this.animationSpeed*t,r=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=e/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];let o=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())}updateTexture(){let t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){let e=[];for(let r=0;r<t.length;++r)e.push(B.from(t[r]));return new Ws(e)}static fromImages(t){let e=[];for(let r=0;r<t.length;++r)e.push(B.from(t[r]));return new Ws(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof B)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);let e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(At.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(At.shared.add(this.update,this),this._isConnectedToTicker=!0))}};var lh=new Z,ln=class extends se{constructor(t,e=100,r=100){super(t),this.tileTransform=new pr,this._width=e,this._height=r,this.uvMatrix=this.texture.uvMatrix||new $i(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){let e=this._texture;!e||!e.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){let t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),s=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,s)}getLocalBounds(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new V),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,lh);let e=this._width,r=this._height,s=-e*this.anchor._x;if(lh.x>=s&&lh.x<s+e){let o=-r*this.anchor._y;if(lh.y>=o&&lh.y<o+r)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){let r=t instanceof B?t:B.from(t,e);return new ln(r,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}};var Ug=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;var kg=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var Gg=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`;var Yd=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var Hg=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;var Fu=new rt,un=class extends si{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Yr,this.state=Ut.for2d()}contextChange(){let t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Xt.from(Yd,Hg,e),this.shader=t.context.webGLVersion>1?Xt.from(kg,Ug,e):Xt.from(Yd,Gg,e)}render(t){let e=this.renderer,r=this.quad,s=r.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);let o=t.uvRespectAnchor?t.anchor.x:0,n=t.uvRespectAnchor?t.anchor.y:0;s=r.uvs,s[0]=s[6]=-o,s[1]=s[3]=-n,s[2]=s[4]=1-o,s[5]=s[7]=1-n,r.invalidate();let a=t._texture,h=a.baseTexture,l=h.alphaMode>0,u=t.tileTransform.localTransform,c=t.uvMatrix,d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==xe.CLAMP:h.wrapMode===xe.CLAMP&&(h.wrapMode=xe.REPEAT));let f=d?this.simpleShader:this.shader,p=a.width,m=a.height,g=t._width,_=t._height;Fu.set(u.a*p/g,u.b*p/_,u.c*m/g,u.d*m/_,u.tx/g,u.ty/_),Fu.invert(),d?Fu.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=Fu.toArray(!0),f.uniforms.uColor=tt.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(r),this.state.blendMode=S.correctBlendMode(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}};un.extension={name:"tilingSprite",type:b.RendererPlugin};A.add(un);var Vg=class uh{constructor(t,e,r=null){this.linkedSheets=[],this._texture=t instanceof B?t:null,this.baseTexture=t instanceof j?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;let s=this.baseTexture.resource;this.resolution=this._updateResolution(r||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){let{scale:e}=this.data.meta,r=S.getResolutionOfUrl(t,null);return r===null&&(r=parseFloat(e??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=uh.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t,r=uh.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){let s=this._frameKeys[e],o=this._frames[s],n=o.frame;if(n){let a=null,h=null,l=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,u=new V(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);o.rotated?a=new V(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):a=new V(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(h=new V(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[s]=new B(this.baseTexture,a,u,h,o.rotated?2:0,o.anchor,o.borders),B.addToCache(this.textures[s],s.toString())}e++}}_processAnimations(){let t=this.data.animations||{};for(let e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){let s=t[e][r];this.animations[e].push(this.textures[s])}}}_parseComplete(){let t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*uh.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*uh.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(let e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Vg.BATCH_SIZE=1e3;var ch=Vg;var dv=["jpg","png","jpeg","avif","webp"];function Xg(i,t,e){let r={};if(i.forEach(s=>{r[s]=t}),Object.keys(t.textures).forEach(s=>{r[s]=t.textures[s]}),!e){let s=S.path.dirname(i[0]);t.linkedSheets.forEach((o,n)=>{let a=Xg([`${s}/${t.data.meta.related_multi_packs[n]}`],o,!0);Object.assign(r,a)})}return r}var qd={extension:b.Asset,cache:{test:i=>i instanceof ch,getCacheableAssets:(i,t)=>Xg(i,t,!1)},resolver:{test:i=>{let t=i.split("?")[0].split("."),e=t.pop(),r=t.pop();return e==="json"&&dv.includes(r)},parse:i=>{let t=i.split(".");return{resolution:parseFloat(T.RETINA_PREFIX.exec(i)?.[1]??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:b.LoadParser,priority:It.Normal},async testParse(i,t){return S.path.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){let r=S.path.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let s=r+i.meta.image;s=Zr(s,t.src);let o=(await e.load([s]))[s],n=new ch(o.baseTexture,i,t.src);await n.parse();let a=i?.meta?.related_multi_packs;if(Array.isArray(a)){let h=[];for(let u of a){if(typeof u!="string")continue;let c=r+u;t.data?.ignoreMultiPack||(c=Zr(c,t.src),h.push(e.load({src:c,data:{ignoreMultiPack:!0}})))}let l=await Promise.all(h);n.linkedSheets=l,l.forEach(u=>{u.linkedSheets=[n].concat(n.linkedSheets.filter(c=>c!==u))})}return n},unload(i){i.destroy(!0)}}};A.add(qd);var Pi=class{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}};var Ji=class{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){let e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let o in e){let n=e[o].match(/^[a-z]+/gm)[0],a=e[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(let l in a){let u=a[l].split("="),c=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[c]=p}r[n].push(h)}let s=new Pi;return r.info.forEach(o=>s.info.push({face:o.face,size:parseInt(o.size,10)})),r.common.forEach(o=>s.common.push({lineHeight:parseInt(o.lineHeight,10)})),r.page.forEach(o=>s.page.push({id:parseInt(o.id,10),file:o.file})),r.char.forEach(o=>s.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),r.kerning.forEach(o=>s.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),r.distanceField.forEach(o=>s.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),s}};var wr=class{static test(t){let e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){let e=new Pi,r=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),n=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<r.length;l++)e.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(let l=0;l<s.length;l++)e.common.push({lineHeight:parseInt(s[l].getAttribute("lineHeight"),10)});for(let l=0;l<o.length;l++)e.page.push({id:parseInt(o[l].getAttribute("id"),10)||0,file:o[l].getAttribute("file")});for(let l=0;l<n.length;l++){let u=n[l];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return e}};var Cr=class{static test(t){return typeof t=="string"&&t.includes("<font>")?wr.test(T.ADAPTER.parseXML(t)):!1}static parse(t){return wr.parse(T.ADAPTER.parseXML(t))}};var Kd=[Ji,wr,Cr];function Du(i){for(let t=0;t<Kd.length;t++)if(Kd[t].test(i))return Kd[t];return null}function Zd(i,t,e,r,s,o){let n=e.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let a,h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=i.width/r-h-l*2,c=i.height/r-h-l*2,d=n.slice(),f=e.fillGradientStops.slice();if(!f.length){let p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(n[0]),f.unshift(0),d.push(n[n.length-1]),f.push(1),e.fillGradientType===Ar.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,l,u/2,c+l);let p=0,m=(o.fontProperties.fontSize+e.strokeThickness)/c;for(let g=0;g<s.length;g++){let _=o.lineHeight*g;for(let v=0;v<d.length;v++){let x=0;typeof f[v]=="number"?x=f[v]:x=v/d.length;let y=_/c+x*m,P=Math.max(p,y);P=Math.min(P,1),a.addColorStop(P,d[v]),p=P}}}else{a=t.createLinearGradient(l,c/2,u+l,c/2);let p=d.length+1,m=1;for(let g=0;g<d.length;g++){let _;typeof f[g]=="number"?_=f[g]:_=m/p,a.addColorStop(_,d[g]),m++}}return a}function Qd(i,t,e,r,s,o,n){let a=e.text,h=e.fontProperties;t.translate(r,s),t.scale(o,o);let l=n.strokeThickness/2,u=-(n.strokeThickness/2);if(t.font=n.toFontString(),t.lineWidth=n.strokeThickness,t.textBaseline=n.textBaseline,t.lineJoin=n.lineJoin,t.miterLimit=n.miterLimit,t.fillStyle=Zd(i,t,n,o,[a],e),t.strokeStyle=n.stroke,n.dropShadow){let c=n.dropShadowColor,d=n.dropShadowBlur*o,f=n.dropShadowDistance*o;t.shadowColor=tt.shared.setValue(c).setAlpha(n.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(n.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(n.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;n.stroke&&n.strokeThickness&&t.strokeText(a,l,u+e.lineHeight-h.descent),n.fill&&t.fillText(a,l,u+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function $s(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function dh(i){return Array.from?Array.from(i):i.split("")}function Jd(i){typeof i=="string"&&(i=[i]);let t=[];for(let e=0,r=i.length;e<r;e++){let s=i[e];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);let o=s[0].charCodeAt(0),n=s[1].charCodeAt(0);if(n<o)throw new Error("[BitmapFont]: Invalid character range.");for(let a=o,h=n;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...dh(s))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}var es=class tr{constructor(t,e,r){let[s]=t.info,[o]=t.common,[n]=t.page,[a]=t.distanceField,h=S.getResolutionOfUrl(n.file),l={};this._ownsTextures=r,this.font=s.face,this.size=s.size,this.lineHeight=o.lineHeight/h,this.chars={},this.pageTextures=l;for(let u=0;u<t.page.length;u++){let{id:c,file:d}=t.page[u];l[c]=e instanceof Array?e[u]:e[d],a?.fieldType&&a.fieldType!=="none"&&(l[c].baseTexture.alphaMode=St.NO_PREMULTIPLIED_ALPHA,l[c].baseTexture.mipmap=qt.OFF)}for(let u=0;u<t.char.length;u++){let{id:c,page:d}=t.char[u],{x:f,y:p,width:m,height:g,xoffset:_,yoffset:v,xadvance:x}=t.char[u];f/=h,p/=h,m/=h,g/=h,_/=h,v/=h,x/=h;let y=new V(f+l[d].frame.x/h,p+l[d].frame.y/h,m,g);this.chars[c]={xOffset:_,yOffset:v,xAdvance:x,kerning:{},texture:new B(l[d].baseTexture,y),page:d}}for(let u=0;u<t.kerning.length;u++){let{first:c,second:d,amount:f}=t.kerning[u];c/=h,d/=h,f/=h,this.chars[d]&&(this.chars[d].kerning[c]=f)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??"none"}destroy(){for(let t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(let t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,r){let s;if(t instanceof Pi)s=t;else{let n=Du(t);if(!n)throw new Error("Unrecognized data format for font.");s=n.parse(t)}e instanceof B&&(e=[e]);let o=new tr(s,e,r);return tr.available[o.font]=o,o}static uninstall(t){let e=tr.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete tr.available[t]}static from(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");let{chars:s,padding:o,resolution:n,textureWidth:a,textureHeight:h,...l}=Object.assign({},tr.defaultOptions,r),u=Jd(s),c=e instanceof we?e:new we(e),d=a,f=new Pi;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};let p=0,m=0,g,_,v,x=0,y=[],P=[];for(let E=0;E<u.length;E++){g||(g=T.ADAPTER.createCanvas(),g.width=a,g.height=h,_=g.getContext("2d"),v=new j(g,{resolution:n,...l}),y.push(v),P.push(new B(v)),f.page.push({id:P.length-1,file:""}));let w=u[E],N=Ke.measureText(w,c,!1,g),Q=N.width,O=Math.ceil(N.height),X=Math.ceil((c.fontStyle==="italic"?2:1)*Q);if(m>=h-O*n){if(m===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${w}')`);--E,g=null,_=null,v=null,m=0,p=0,x=0;continue}if(x=Math.max(O+N.fontProperties.descent,x),X*n+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${w}')`);--E,m+=x*n,m=Math.ceil(m),p=0,x=0;continue}Qd(g,_,N,p,m,n,c);let C=$s(N.text);f.char.push({id:C,page:P.length-1,x:p/n,y:m/n,width:X,height:O,xoffset:0,yoffset:0,xadvance:Q-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(X+2*o)*n,p=Math.ceil(p)}if(!r?.skipKerning)for(let E=0,w=u.length;E<w;E++){let N=u[E];for(let Q=0;Q<w;Q++){let O=u[Q],X=_.measureText(N).width,C=_.measureText(O).width,M=_.measureText(N+O).width-(X+C);M&&f.kerning.push({first:$s(N),second:$s(O),amount:M})}}let H=new tr(f,P,!0);return tr.available[t]!==void 0&&tr.uninstall(t),tr.available[t]=H,H}};es.ALPHA=[["a","z"],["A","Z"]," "],es.NUMERIC=[["0","9"]],es.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],es.ASCII=[[" ","~"]],es.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:es.ALPHANUMERIC},es.available={};var li=es;var Wg=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`;var $g=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;var jg=[],zg=[],Yg=[],qg=class Kg extends Dt{constructor(t,e={}){super();let{align:r,tint:s,maxWidth:o,letterSpacing:n,fontName:a,fontSize:h}=Object.assign({},Kg.styleDefaults,e);if(!li.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new tt(s),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=o,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new fe(()=>{this.dirty=!0},this,0,0),this._roundPixels=T.ROUND_PIXELS,this.dirty=!0,this._resolution=T.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){let t=li.available[this._fontName],e=this.fontSize,r=e/t.size,s=new Z,o=[],n=[],a=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=dh(h),u=this._maxWidth*t.size/e,c=t.distanceFieldType==="none"?jg:zg,d=null,f=0,p=0,m=0,g=-1,_=0,v=0,x=0,y=0;for(let O=0;O<l.length;O++){let X=l[O],C=$s(X);if(/(?:\s)/.test(X)&&(g=O,_=f,y++),X==="\r"||X===`
`){n.push(f),a.push(-1),p=Math.max(p,f),++m,++v,s.x=0,s.y+=t.lineHeight,d=null,y=0;continue}let M=t.chars[C];if(!M)continue;d&&M.kerning[d]&&(s.x+=M.kerning[d]);let at=Yg.pop()||{texture:B.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Z};at.texture=M.texture,at.line=m,at.charCode=C,at.position.x=Math.round(s.x+M.xOffset+this._letterSpacing/2),at.position.y=Math.round(s.y+M.yOffset),at.prevSpaces=y,o.push(at),f=at.position.x+Math.max(M.xAdvance-M.xOffset,M.texture.orig.width),s.x+=M.xAdvance+this._letterSpacing,x=Math.max(x,M.yOffset+M.texture.height),d=C,g!==-1&&u>0&&s.x>u&&(++v,S.removeItems(o,1+g-v,1+O-g),O=g,g=-1,n.push(_),a.push(o.length>0?o[o.length-1].prevSpaces:0),p=Math.max(p,_),m++,s.x=0,s.y+=t.lineHeight,d=null,y=0)}let P=l[l.length-1];P!=="\r"&&P!==`
`&&(/(?:\s)/.test(P)&&(f=_),n.push(f),p=Math.max(p,f),a.push(-1));let H=[];for(let O=0;O<=m;O++){let X=0;this._align==="right"?X=p-n[O]:this._align==="center"?X=(p-n[O])/2:this._align==="justify"&&(X=a[O]<0?0:(p-n[O])/a[O]),H.push(X)}let E=o.length,w={},N=[],Q=this._activePagesMeshData;c.push(...Q);for(let O=0;O<E;O++){let X=o[O].texture,C=X.baseTexture.uid;if(!w[C]){let M=c.pop();if(!M){let ut=new hi,$,L;t.distanceFieldType==="none"?($=new qe(B.EMPTY),L=Y.NORMAL):($=new qe(B.EMPTY,{program:re.from($g,Wg),uniforms:{uFWidth:0}}),L=Y.NORMAL_NPM);let z=new Ri(ut,$);z.blendMode=L,M={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:z,vertices:null,uvs:null,indices:null}}M.index=0,M.indexCount=0,M.vertexCount=0,M.uvsCount=0,M.total=0;let{_textureCache:at}=this;at[C]=at[C]||new B(X.baseTexture),M.mesh.texture=at[C],M.mesh.tint=this._tintColor.value,N.push(M),w[C]=M}w[C].total++}for(let O=0;O<Q.length;O++)N.includes(Q[O])||this.removeChild(Q[O].mesh);for(let O=0;O<N.length;O++)N[O].mesh.parent!==this&&this.addChild(N[O].mesh);this._activePagesMeshData=N;for(let O in w){let X=w[O],C=X.total;if(!(X.indices?.length>6*C)||X.vertices.length<Ri.BATCHABLE_SIZE*2)X.vertices=new Float32Array(4*2*C),X.uvs=new Float32Array(4*2*C),X.indices=new Uint16Array(6*C);else{let M=X.total,at=X.vertices;for(let ut=M*4*2;ut<at.length;ut++)at[ut]=0}X.mesh.size=6*C}for(let O=0;O<E;O++){let X=o[O],C=X.position.x+H[X.line]*(this._align==="justify"?X.prevSpaces:1);this._roundPixels&&(C=Math.round(C));let M=C*r,at=X.position.y*r,ut=X.texture,$=w[ut.baseTexture.uid],L=ut.frame,z=ut._uvs,W=$.index++;$.indices[W*6+0]=0+W*4,$.indices[W*6+1]=1+W*4,$.indices[W*6+2]=2+W*4,$.indices[W*6+3]=0+W*4,$.indices[W*6+4]=2+W*4,$.indices[W*6+5]=3+W*4,$.vertices[W*8+0]=M,$.vertices[W*8+1]=at,$.vertices[W*8+2]=M+L.width*r,$.vertices[W*8+3]=at,$.vertices[W*8+4]=M+L.width*r,$.vertices[W*8+5]=at+L.height*r,$.vertices[W*8+6]=M,$.vertices[W*8+7]=at+L.height*r,$.uvs[W*8+0]=z.x0,$.uvs[W*8+1]=z.y0,$.uvs[W*8+2]=z.x1,$.uvs[W*8+3]=z.y1,$.uvs[W*8+4]=z.x2,$.uvs[W*8+5]=z.y2,$.uvs[W*8+6]=z.x3,$.uvs[W*8+7]=z.y3}this._textWidth=p*r,this._textHeight=(s.y+t.lineHeight)*r;for(let O in w){let X=w[O];if(this.anchor.x!==0||this.anchor.y!==0){let ut=0,$=this._textWidth*this.anchor.x,L=this._textHeight*this.anchor.y;for(let z=0;z<X.total;z++)X.vertices[ut++]-=$,X.vertices[ut++]-=L,X.vertices[ut++]-=$,X.vertices[ut++]-=L,X.vertices[ut++]-=$,X.vertices[ut++]-=L,X.vertices[ut++]-=$,X.vertices[ut++]-=L}this._maxLineHeight=x*r;let C=X.mesh.geometry.getBuffer("aVertexPosition"),M=X.mesh.geometry.getBuffer("aTextureCoord"),at=X.mesh.geometry.getIndex();C.data=X.vertices,M.data=X.uvs,at.data=X.indices,C.update(),M.update(),at.update()}for(let O=0;O<o.length;O++)Yg.push(o[O]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);let{distanceFieldRange:e,distanceFieldType:r,size:s}=li.available[this._fontName];if(r!=="none"){let{a:o,b:n,c:a,d:h}=this.worldTransform,l=Math.sqrt(o*o+n*n),u=Math.sqrt(a*a+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=this.fontSize/s,f=t._view.resolution;for(let p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*e*d*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){let t=li.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!li.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??li.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){let{_textureCache:e}=this,r=li.available[this._fontName].distanceFieldType==="none"?jg:zg;r.push(...this._activePagesMeshData);for(let s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],r.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=B.EMPTY});for(let s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};qg.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var Zg=qg;var fv=[".xml",".fnt"],tf={extension:{type:b.LoadParser,priority:It.Normal},name:"loadBitmapFont",test(i){return fv.includes(S.path.extname(i).toLowerCase())},async testParse(i){return Ji.test(i)||Cr.test(i)},async parse(i,t,e){let r=Ji.test(i)?Ji.parse(i):Cr.parse(i),{src:s}=t,{page:o}=r,n=[];for(let l=0;l<o.length;++l){let u=o[l].file,c=S.path.join(S.path.dirname(s),u);c=Zr(c,s),n.push(c)}let a=await e.load(n),h=n.map(l=>a[l]);return li.install(r,h,!0)},async load(i,t){return(await T.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};A.add(tf);var ef=class cn extends we{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new cn(Object.keys(cn.defaultOptions).reduce((e,r)=>({...e,[r]:t[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete cn.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){let{availableFonts:r}=cn;if(r[t]){let s=r[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return T.ADAPTER.fetch(t).then(s=>s.blob()).then(async s=>new Promise((o,n)=>{let a=URL.createObjectURL(s),h=new FileReader;h.onload=()=>o([a,h.result]),h.onerror=n,h.readAsDataURL(s)})).then(async([s,o])=>{let n=Object.assign({family:S.path.basename(t,S.path.extname(t)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:o,refs:1,originalUrl:t,fontFace:null},e);r[t]=n,this._fonts.push(n),this.styleID++;let a=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style,display:n.display});n.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){let e=t.filter(r=>!this._overrides.includes(r));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){let e=t.filter(r=>this._overrides.includes(r));e.length>0&&(this._overrides=this._overrides.filter(r=>!e.includes(r)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=S.rgb2hex(t)),typeof t=="number"?S.hex2string(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor),e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));let o=`${r}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${o} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${o} ${t}`}reset(){Object.assign(this,cn.defaultOptions)}onBeforeDraw(){let{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){let{userAgent:t}=T.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};ef.availableFonts={},ef.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};var dn=ef;var fh=class fn extends se{constructor(t="",e={}){super(B.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;let r=new Image,s=B.from(r,{scaleMode:T.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new V,s.trim=new V,this.texture=s;let o="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",a=document.createElementNS(o,"svg"),h=document.createElementNS(o,"foreignObject"),l=document.createElementNS(n,"div"),u=document.createElementNS(n,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=fn.defaultMaxWidth,this.maxHeight=fn.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=r,this._loadImage=new Image,this._autoResolution=fn.defaultAutoResolution,this._resolution=fn.defaultResolution??T.RESOLUTION,this.text=t,this.style=e}measureText(t){let{text:e,style:r,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(s)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);let o=this._domElement.getBoundingClientRect();this._svgRoot.remove();let{width:n,height:a}=o;(n>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");let h=Math.min(this.maxWidth,Math.ceil(n)),l=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",h.toString()),this._svgRoot.setAttribute("height",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(s)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:h+r.padding*2,height:l+r.padding*2}}async updateText(t=!0){let{style:e,_image:r,_loadImage:s}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;let{width:o,height:n}=this.measureText();r.width=s.width=Math.ceil(Math.max(1,o)),r.height=s.height=Math.ceil(Math.max(1,n)),this._updateID++;let a=this._updateID;await new Promise(h=>{s.onload=async()=>{if(a<this._updateID){h();return}await e.onBeforeDraw(),r.src=s.src,s.onload=null,s.src="",this.updateTexture(),h()};let l=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){let{style:t,texture:e,_image:r,resolution:s}=this,{padding:o}=t,{baseTexture:n}=e;e.trim.width=e._frame.width=r.width/s,e.trim.height=e._frame.height=r.height/s,e.trim.x=-o,e.trim.y=-o,e.orig.width=e._frame.width-o*2,e.orig.height=e._frame.height-o*2,this._onTextureUpdate(),n.setRealSize(r.width,r.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},fn.defaultDestroyOptions,t),super.destroy(t);let e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);let e=S.sign(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);let e=S.sign(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof dn?(this.ownsStyle=!1,this._style=t):t instanceof we?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=dn.from(t)):(this.ownsStyle=!0,this._style=new dn(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};fh.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},fh.defaultMaxWidth=2024,fh.defaultMaxHeight=2024,fh.defaultAutoResolution=!0;var Qg=fh;var Hf={};ya(Hf,{Emitter:()=>pt,LinkedListContainer:()=>Of,Particle:()=>$n,ParticleUtils:()=>sb,PropertyList:()=>fs,PropertyNode:()=>Ie,behaviors:()=>mb,upgradeConfig:()=>gb});var Ze=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(Ze||{}),sf=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(sf||{}),Nu=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Nu||{}),K=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(K||{}),pn=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(pn||{}),k=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(k||{}),Sr=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(Sr||{}),ht=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(ht||{}),Lu=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Lu||{}),ui=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(ui||{}),ph=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(ph||{}),Mi=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(Mi||{}),Ue=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(Ue||{}),is=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(is||{}),Ou=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(Ou||{}),Ce=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Ce||{}),Lt=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(Lt||{});var yt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(yt||{}),ke=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(ke||{});var of={createCanvas:(i,t)=>{let e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")};var F={ADAPTER:of,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var pv=Gr.default??Gr,ci=pv(globalThis.navigator);var st={};ya(st,{BaseTextureCache:()=>Se,BoundingBox:()=>_n,CanvasRenderTarget:()=>Xu,DATA_URI:()=>Hu,EventEmitter:()=>os.default,ProgramCache:()=>vh,TextureCache:()=>ee,clearTextureCache:()=>S_,correctBlendMode:()=>x_,createIndicesForQuads:()=>T_,decomposeDataUri:()=>M_,deprecation:()=>et,destroyTextureCache:()=>C_,determineCrossOrigin:()=>ju,earcut:()=>B_.default,getBufferType:()=>rs,getCanvasBoundingBox:()=>Wu,getResolutionOfUrl:()=>bh,hex2rgb:()=>p_,hex2string:()=>m_,interleaveTypedArrays:()=>E_,isMobile:()=>ci,isPow2:()=>xh,isWebGLSupported:()=>ku,log2:()=>yh,nextPow2:()=>ss,path:()=>nf,premultiplyBlendMode:()=>_h,premultiplyRgba:()=>y_,premultiplyTint:()=>v_,premultiplyTintToRgba:()=>b_,removeItems:()=>Vu,rgb2hex:()=>__,sayHello:()=>e_,sign:()=>A_,skipHello:()=>t_,string2hex:()=>g_,trimCanvas:()=>P_,uid:()=>er,url:()=>Uu});F.RETINA_PREFIX=/@([0-9\.]+)x/;F.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var os=lo(Nc(),1),B_=lo(Gc(),1);var mn=lo(Wc(),1),Uu={parse:mn.parse,format:mn.format,resolve:mn.resolve};function Bi(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function mh(i){return i.split("?")[0].split("#")[0]}function mv(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function gv(i,t,e){return i.replace(new RegExp(mv(t),"g"),e)}function _v(i,t){let e="",r=0,s=-1,o=0,n=-1;for(let a=0;a<=i.length;++a){if(a<i.length)n=i.charCodeAt(a);else{if(n===47)break;n=47}if(n===47){if(!(s===a-1||o===1))if(s!==a-1&&o===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){let h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",r=0):(e=e.slice(0,h),r=e.length-1-e.lastIndexOf("/")),s=a,o=0;continue}}else if(e.length===2||e.length===1){e="",r=0,s=a,o=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(s+1,a)}`:e=i.slice(s+1,a),r=a-s-1;s=a,o=0}else n===46&&o!==-1?++o:o=-1}return e}var nf={toPosix(i){return gv(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},hasProtocol(i){return/^[^/:]+:\//.test(this.toPosix(i))},getProtocol(i){Bi(i),i=this.toPosix(i);let t="",e=/^file:\/\/\//.exec(i),r=/^[^/:]+:\/\//.exec(i),s=/^[^/:]+:\//.exec(i);if(e||r||s){let o=e?.[0]||r?.[0]||s?.[0];t=o,i=i.slice(o.length)}return t},toAbsolute(i,t,e){if(this.isDataUrl(i))return i;let r=mh(this.toPosix(t??F.ADAPTER.getBaseUrl())),s=mh(this.toPosix(e??this.rootname(r)));return Bi(i),i=this.toPosix(i),i.startsWith("/")?nf.join(s,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(i=this.toPosix(i),Bi(i),i.length===0)return".";let t="",e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));let r=i.endsWith("/");return i=_v(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return Bi(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){let r=i[e];if(Bi(r),r.length>0)if(t===void 0)t=r;else{let s=i[e-1]??"";this.extname(s)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(Bi(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0),e=t===47,r=-1,s=!0,o=this.getProtocol(i),n=i;i=i.slice(o.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!s){r=a;break}}else s=!1;return r===-1?e?"/":this.isUrl(n)?o+i:o:e&&r===1?"//":o+i.slice(0,r)},rootname(i){Bi(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){let e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){Bi(i),t&&Bi(t),i=mh(this.toPosix(i));let e=0,r=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let n=t.length-1,a=-1;for(o=i.length-1;o>=0;--o){let h=i.charCodeAt(o);if(h===47){if(!s){e=o+1;break}}else a===-1&&(s=!1,a=o+1),n>=0&&(h===t.charCodeAt(n)?--n===-1&&(r=o):(n=-1,r=a))}return e===r?r=a:r===-1&&(r=i.length),i.slice(e,r)}for(o=i.length-1;o>=0;--o)if(i.charCodeAt(o)===47){if(!s){e=o+1;break}}else r===-1&&(s=!1,r=o+1);return r===-1?"":i.slice(e,r)},extname(i){Bi(i),i=mh(this.toPosix(i));let t=-1,e=0,r=-1,s=!0,o=0;for(let n=i.length-1;n>=0;--n){let a=i.charCodeAt(n);if(a===47){if(!s){e=n+1;break}continue}r===-1&&(s=!1,r=n+1),a===46?t===-1?t=n:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||r===-1||o===0||o===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){Bi(i);let t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=mh(this.toPosix(i));let e=i.charCodeAt(0),r=this.isAbsolute(i),s,o="";t.root=this.rootname(i),r||this.hasProtocol(i)?s=1:s=0;let n=-1,a=0,h=-1,l=!0,u=i.length-1,c=0;for(;u>=s;--u){if(e=i.charCodeAt(u),e===47){if(!l){a=u+1;break}continue}h===-1&&(l=!1,h=u+1),e===46?n===-1?n=u:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||h===-1||c===0||c===1&&n===h-1&&n===a+1?h!==-1&&(a===0&&r?t.base=t.name=i.slice(1,h):t.base=t.name=i.slice(a,h)):(a===0&&r?(t.name=i.slice(1,n),t.base=i.slice(1,h)):(t.name=i.slice(a,n),t.base=i.slice(a,h)),t.ext=i.slice(n,h)),t.dir=this.dirname(i),o&&(t.dir=o+t.dir),t},sep:"/",delimiter:":"};var Jg={};function et(i,t,e=3){if(Jg[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),Jg[t]=!0}function t_(){et("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function e_(){et("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}var af;function ku(){return typeof af>"u"&&(af=function(){let t={stencil:!0,failIfMajorPerformanceCaveat:F.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!F.ADAPTER.getWebGLRenderingContext())return!1;let e=F.ADAPTER.createCanvas(),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),s=!!r?.getContextAttributes()?.stencil;if(r){let o=r.getExtension("WEBGL_lose_context");o&&o.loseContext()}return r=null,s}catch{return!1}}()),af}var xv={grad:.9,turn:360,rad:360/(2*Math.PI)},Ir=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},te=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},di=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},l_=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},i_=function(i){return{r:di(i.r,0,255),g:di(i.g,0,255),b:di(i.b,0,255),a:di(i.a)}},hf=function(i){return{r:te(i.r),g:te(i.g),b:te(i.b),a:te(i.a,3)}},yv=/^#([0-9a-f]{3,8})$/i,Gu=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},u_=function(i){var t=i.r,e=i.g,r=i.b,s=i.a,o=Math.max(t,e,r),n=o-Math.min(t,e,r),a=n?o===t?(e-r)/n:o===e?2+(r-t)/n:4+(t-e)/n:0;return{h:60*(a<0?a+6:a),s:o?n/o*100:0,v:o/255*100,a:s}},c_=function(i){var t=i.h,e=i.s,r=i.v,s=i.a;t=t/360*6,e/=100,r/=100;var o=Math.floor(t),n=r*(1-e),a=r*(1-(t-o)*e),h=r*(1-(1-t+o)*e),l=o%6;return{r:255*[r,a,n,n,h,r][l],g:255*[h,r,r,a,n,n][l],b:255*[n,n,h,r,r,a][l],a:s}},r_=function(i){return{h:l_(i.h),s:di(i.s,0,100),l:di(i.l,0,100),a:di(i.a)}},s_=function(i){return{h:te(i.h),s:te(i.s),l:te(i.l),a:te(i.a,3)}},o_=function(i){return c_((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},gh=function(i){return{h:(t=u_(i)).h,s:(s=(200-(e=t.s))*(r=t.v)/100)>0&&s<200?e*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,r,s},vv=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,bv=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Tv=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ev=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,cf={string:[[function(i){var t=yv.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?te(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?te(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=Tv.exec(i)||Ev.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:i_({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=vv.exec(i)||bv.exec(i);if(!t)return null;var e,r,s=r_({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(xv[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return o_(s)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,s=i.a,o=s===void 0?1:s;return Ir(t)&&Ir(e)&&Ir(r)?i_({r:Number(t),g:Number(e),b:Number(r),a:Number(o)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,s=i.a,o=s===void 0?1:s;if(!Ir(t)||!Ir(e)||!Ir(r))return null;var n=r_({h:Number(t),s:Number(e),l:Number(r),a:Number(o)});return o_(n)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,s=i.a,o=s===void 0?1:s;if(!Ir(t)||!Ir(e)||!Ir(r))return null;var n=function(a){return{h:l_(a.h),s:di(a.s,0,100),v:di(a.v,0,100),a:di(a.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(o)});return c_(n)},"hsv"]]},n_=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},Av=function(i){return typeof i=="string"?n_(i.trim(),cf.string):typeof i=="object"&&i!==null?n_(i,cf.object):[null,void 0]};var lf=function(i,t){var e=gh(i);return{h:e.h,s:di(e.s+100*t,0,100),l:e.l,a:e.a}},uf=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},a_=function(i,t){var e=gh(i);return{h:e.h,s:e.s,l:di(e.l+100*t,0,100),a:e.a}},df=function(){function i(t){this.parsed=Av(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return te(uf(this.rgba),2)},i.prototype.isDark=function(){return uf(this.rgba)<.5},i.prototype.isLight=function(){return uf(this.rgba)>=.5},i.prototype.toHex=function(){return t=hf(this.rgba),e=t.r,r=t.g,s=t.b,n=(o=t.a)<1?Gu(te(255*o)):"","#"+Gu(e)+Gu(r)+Gu(s)+n;var t,e,r,s,o,n},i.prototype.toRgb=function(){return hf(this.rgba)},i.prototype.toRgbString=function(){return t=hf(this.rgba),e=t.r,r=t.g,s=t.b,(o=t.a)<1?"rgba("+e+", "+r+", "+s+", "+o+")":"rgb("+e+", "+r+", "+s+")";var t,e,r,s,o},i.prototype.toHsl=function(){return s_(gh(this.rgba))},i.prototype.toHslString=function(){return t=s_(gh(this.rgba)),e=t.h,r=t.s,s=t.l,(o=t.a)<1?"hsla("+e+", "+r+"%, "+s+"%, "+o+")":"hsl("+e+", "+r+"%, "+s+"%)";var t,e,r,s,o},i.prototype.toHsv=function(){return t=u_(this.rgba),{h:te(t.h),s:te(t.s),v:te(t.v),a:te(t.a,3)};var t},i.prototype.invert=function(){return Fi({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),Fi(lf(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),Fi(lf(this.rgba,-t))},i.prototype.grayscale=function(){return Fi(lf(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),Fi(a_(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),Fi(a_(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?Fi({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):te(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=gh(this.rgba);return typeof t=="number"?Fi({h:t,s:e.s,l:e.l,a:e.a}):te(e.h)},i.prototype.isEqual=function(t){return this.toHex()===Fi(t).toHex()},i}(),Fi=function(i){return i instanceof df?i:new df(i)},h_=[],d_=function(i){i.forEach(function(t){h_.indexOf(t)<0&&(t(df,cf),h_.push(t))})};function f_(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in e)r[e[s]]=s;var o={};i.prototype.toName=function(n){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=r[this.toHex()];if(l)return l;if(n?.closest){var u=this.toRgb(),c=1/0,d="black";if(!o.length)for(var f in e)o[f]=new i(e[f]).toRgb();for(var p in e){var m=(a=u,h=o[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<c&&(c=m,d=p)}return d}},t.string.push([function(n){var a=n.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new i(h).toRgb():null},"name"])}d_([f_]);var gn=class{constructor(i=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=i}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(i){return this.value=i,this}set value(i){if(i instanceof gn)this._value=this.cloneSource(i._value),this._int=i._int,this._components.set(i._components);else{if(i===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,i))&&(this.normalize(i),this._value=this.cloneSource(i))}}get value(){return this._value}cloneSource(i){return typeof i=="string"||typeof i=="number"||i instanceof Number||i===null?i:Array.isArray(i)||ArrayBuffer.isView(i)?i.slice(0):typeof i=="object"&&i!==null?{...i}:i}isSourceEqual(i,t){let e=typeof i;if(e!==typeof t)return!1;if(e==="number"||e==="string"||i instanceof Number)return i===t;if(Array.isArray(i)&&Array.isArray(t)||ArrayBuffer.isView(i)&&ArrayBuffer.isView(t))return i.length!==t.length?!1:i.every((s,o)=>s===t[o]);if(i!==null&&t!==null){let s=Object.keys(i),o=Object.keys(t);return s.length!==o.length?!1:s.every(n=>i[n]===t[n])}return i===t}toRgba(){let[i,t,e,r]=this._components;return{r:i,g:t,b:e,a:r}}toRgb(){let[i,t,e]=this._components;return{r:i,g:t,b:e}}toRgbaString(){let[i,t,e]=this.toUint8RgbArray();return`rgba(${i},${t},${e},${this.alpha})`}toUint8RgbArray(i){let[t,e,r]=this._components;return i=i??[],i[0]=Math.round(t*255),i[1]=Math.round(e*255),i[2]=Math.round(r*255),i}toRgbArray(i){i=i??[];let[t,e,r]=this._components;return i[0]=t,i[1]=e,i[2]=r,i}toNumber(){return this._int}toLittleEndianNumber(){let i=this._int;return(i>>16)+(i&65280)+((i&255)<<16)}multiply(i){let[t,e,r,s]=gn.temp.setValue(i)._components;return this._components[0]*=t,this._components[1]*=e,this._components[2]*=r,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(i,t=!0){return t&&(this._components[0]*=i,this._components[1]*=i,this._components[2]*=i),this._components[3]=i,this.refreshInt(),this._value=null,this}toPremultiplied(i){if(i===1)return(i*255<<24)+this._int;if(i===0)return 0;let t=this._int>>16&255,e=this._int>>8&255,r=this._int&255;return t=t*i+.5|0,e=e*i+.5|0,r=r*i+.5|0,(i*255<<24)+(t<<16)+(e<<8)+r}toHex(){let i=this._int.toString(16);return`#${"000000".substring(0,6-i.length)+i}`}toHexa(){let t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(i){return this._components[3]=i,this}round(i){let[t,e,r]=this._components;return this._components.set([Math.min(255,t/i*i),Math.min(255,e/i*i),Math.min(255,r/i*i)]),this.refreshInt(),this._value=null,this}toArray(i){i=i??[];let[t,e,r,s]=this._components;return i[0]=t,i[1]=e,i[2]=r,i[3]=s,i}normalize(i){let t;if((typeof i=="number"||i instanceof Number)&&i>=0&&i<=16777215){let e=i;t=[(e>>16&255)/255,(e>>8&255)/255,(e&255)/255,1]}else if((Array.isArray(i)||i instanceof Float32Array)&&i.length>=3&&i.length<=4&&i.every(e=>e<=1&&e>=0)){let[e,r,s,o=1]=i;t=[e,r,s,o]}else if((i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&i.length>=3&&i.length<=4){let[e,r,s,o=255]=i;t=[e/255,r/255,s/255,o/255]}else if(typeof i=="string"||typeof i=="object"){if(typeof i=="string"){let r=gn.HEX_PATTERN.exec(i);r&&(i=`#${r[2]}`)}let e=Fi(i);if(e.isValid()){let{r,g:s,b:o,a:n}=e.rgba;t=[r/255,s/255,o/255,n]}}if(t)this._components.set(t),this.refreshInt();else throw new Error(`Unable to convert color ${i}`)}refreshInt(){this._components.forEach((r,s)=>this._components[s]=Math.min(Math.max(r,0),1));let[i,t,e]=this._components;this._int=(i*255<<16)+(t*255<<8)+(e*255|0)}},Nt=gn;Nt.shared=new gn;Nt.temp=new gn;Nt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function p_(i,t=[]){return et("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Nt.shared.setValue(i).toRgbArray(t)}function m_(i){return et("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Nt.shared.setValue(i).toHex()}function g_(i){return et("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),Nt.shared.setValue(i).toNumber()}function __(i){return et("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Nt.shared.setValue(i).toNumber()}function wv(){let i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[K.NORMAL_NPM]=K.NORMAL,i[K.ADD_NPM]=K.ADD,i[K.SCREEN_NPM]=K.SCREEN,t[K.NORMAL]=K.NORMAL_NPM,t[K.ADD]=K.ADD_NPM,t[K.SCREEN]=K.SCREEN_NPM;let e=[];return e.push(t),e.push(i),e}var _h=wv();function x_(i,t){return _h[t?1:0][i]}function y_(i,t,e,r=!0){return et("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),Nt.shared.setValue(i).premultiply(t,r).toArray(e??new Float32Array(4))}function v_(i,t){return et("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),Nt.shared.setValue(i).toPremultiplied(t)}function b_(i,t,e,r=!0){return et("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),Nt.shared.setValue(i).premultiply(t,r).toArray(e??new Float32Array(4))}var Hu=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function T_(i,t=null){let e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,s=0;r<e;r+=6,s+=4)t[r+0]=s+0,t[r+1]=s+1,t[r+2]=s+2,t[r+3]=s+0,t[r+4]=s+2,t[r+5]=s+3;return t}function rs(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}var Cv={Float32Array,Uint32Array,Int32Array,Uint8Array};function E_(i,t){let e=0,r=0,s={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;let o=new ArrayBuffer(e*4),n=null,a=0;for(let h=0;h<i.length;h++){let l=t[h],u=i[h],c=rs(u);s[c]||(s[c]=new Cv[c](o)),n=s[c];for(let d=0;d<u.length;d++){let f=(d/l|0)*r+a,p=d%l;n[f+p]=u[d]}a+=l}return new Float32Array(o)}function ss(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function xh(i){return!(i&i-1)&&!!i}function yh(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function Vu(i,t,e){let r=i.length,s;if(t>=r||e===0)return;e=t+e>r?r-t:e;let o=r-e;for(s=t;s<o;++s)i[s]=i[s+e];i.length=o}function A_(i){return i===0?0:i<0?-1:1}var Sv=0;function er(){return++Sv}var w_=class{constructor(i,t,e,r){this.left=i,this.top=t,this.right=e,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}},_n=w_;_n.EMPTY=new w_(0,0,0,0);var vh={},ee=Object.create(null),Se=Object.create(null);function C_(){let i;for(i in ee)ee[i].destroy();for(i in Se)Se[i].destroy()}function S_(){let i;for(i in ee)delete ee[i];for(i in Se)delete Se[i]}var Xu=class{constructor(t,e,r){this._canvas=F.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||F.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function I_(i,t,e){for(let r=0,s=4*e*t;r<t;++r,s+=4)if(i[s+3]!==0)return!1;return!0}function R_(i,t,e,r,s){let o=4*t;for(let n=r,a=r*o+4*e;n<=s;++n,a+=o)if(i[a+3]!==0)return!1;return!0}function Wu(i){let{width:t,height:e}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");let o=r.getImageData(0,0,t,e).data,n=0,a=0,h=t-1,l=e-1;for(;a<e&&I_(o,t,a);)++a;if(a===e)return _n.EMPTY;for(;I_(o,t,l);)--l;for(;R_(o,t,n,a,l);)++n;for(;R_(o,t,h,a,l);)--h;return++h,++l,new _n(n,a,h,l)}function P_(i){let t=Wu(i),{width:e,height:r}=t,s=null;if(!t.isEmpty()){let o=i.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");s=o.getImageData(t.left,t.top,e,r)}return{width:e,height:r,data:s}}function M_(i){let t=Hu.exec(i);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}var $u;function ju(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location,$u||($u=document.createElement("a")),$u.href=i;let e=Uu.parse($u.href),r=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!r||e.protocol!==t.protocol?"anonymous":""}function bh(i,t=1){let e=F.RETINA_PREFIX?.exec(i);return e?parseFloat(e[1]):t}var R=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(R||{}),ff=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},F_=(i,t)=>ff(i).priority??t,D={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(ff).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(ff).forEach(t=>{t.type.forEach(e=>{let r=this._addHandlers,s=this._queue;r[e]?r[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(i,t,e){let r=this._addHandlers,s=this._removeHandlers;if(r[i]||s[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,s[i]=e;let o=this._queue;return o[i]&&(o[i].forEach(n=>t(n)),delete o[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((s,o)=>F_(o,e)-F_(s,e)))},r=>{let s=t.indexOf(r.ref);s!==-1&&t.splice(s,1)})}};var Th=class{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}};var Iv=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Rv(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function zu(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let e=t.createShader(t.FRAGMENT_SHADER);for(;;){let r=Iv.replace(/%forloop%/gi,Rv(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}var pf=0,mf=1,gf=2,_f=3,xf=4,yf=5,Di=class{constructor(){this.data=0,this.blendMode=K.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<pf)}set blend(t){!!(this.data&1<<pf)!==t&&(this.data^=1<<pf)}get offsets(){return!!(this.data&1<<mf)}set offsets(t){!!(this.data&1<<mf)!==t&&(this.data^=1<<mf)}get culling(){return!!(this.data&1<<gf)}set culling(t){!!(this.data&1<<gf)!==t&&(this.data^=1<<gf)}get depthTest(){return!!(this.data&1<<_f)}set depthTest(t){!!(this.data&1<<_f)!==t&&(this.data^=1<<_f)}get depthMask(){return!!(this.data&1<<yf)}set depthMask(t){!!(this.data&1<<yf)!==t&&(this.data^=1<<yf)}get clockwiseFrontFace(){return!!(this.data&1<<xf)}set clockwiseFrontFace(t){!!(this.data&1<<xf)!==t&&(this.data^=1<<xf)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==K.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let t=new Di;return t.depthTest=!1,t.blend=!0,t}};var xn=[];function yn(i,t){if(!i)return null;let e="";if(typeof i=="string"){let r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=xn.length-1;r>=0;--r){let s=xn[r];if(s.test&&s.test(i,e))return new s(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}var kt=class{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,s,o,n,a,h){if(arguments.length>8)throw new Error("max arguments reached");let{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](t,e,r,s,o,n,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){let e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(kt.prototype,{dispatch:{value:kt.prototype.emit},run:{value:kt.prototype.emit}});var Qe=class{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new kt("setRealSize"),this.onUpdate=new kt("update"),this.onError=new kt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}};var ir=class extends Qe{constructor(t,e){let{width:r,height:s}=e||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=t}upload(t,e,r){let s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ue.UNPACK);let o=e.realWidth,n=e.realHeight;return r.width===o&&r.height===n?s.texSubImage2D(e.target,0,0,0,o,n,e.format,r.type,this.data):(r.width=o,r.height=n,s.texImage2D(e.target,0,r.internalFormat,o,n,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}};var Pv={scaleMode:ui.NEAREST,format:k.RGBA,alphaMode:Ue.NPM},vn=class extends os.default{constructor(i=null,t=null){super(),t=Object.assign({},vn.defaultOptions,t);let{alphaMode:e,mipmap:r,anisotropicLevel:s,scaleMode:o,width:n,height:a,wrapMode:h,format:l,type:u,target:c,resolution:d,resourceOptions:f}=t;i&&!(i instanceof Qe)&&(i=yn(i,f),i.internal=!0),this.resolution=d||F.RESOLUTION,this.width=Math.round((n||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=s,this._wrapMode=h,this._scaleMode=o,this.format=l,this.type=u,this.target=c,this.alphaMode=e,this.uid=er(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=n>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(i)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)}setStyle(i,t){let e;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,e=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(i,t,e){return e=e||this.resolution,this.setRealSize(i*e,t*e,e)}setRealSize(i,t,e){return this.resolution=e||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=xh(this.realWidth)&&xh(this.realHeight)}setResolution(i){let t=this.resolution;return t===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*t)/i,this.height=Math.round(this.height*t)/i,this.emit("update",this)),this._refreshPOT(),this)}setResource(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(i){this.emit("error",this,i)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Se[this.cacheId],delete ee[this.cacheId],this.cacheId=null),this.dispose(),vn.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(i,t,e=F.STRICT_TEXTURE_CACHE){let r=typeof i=="string",s=null;if(r)s=i;else{if(!i._pixiId){let n=t?.pixiIdPrefix||"pixiid";i._pixiId=`${n}_${er()}`}s=i._pixiId}let o=Se[s];if(r&&e&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new vn(i,t),o.cacheId=s,vn.addToCache(o,s)),o}static fromBuffer(i,t,e,r){i=i||new Float32Array(t*e*4);let s=new ir(i,{width:t,height:e}),o=i instanceof Float32Array?ht.FLOAT:ht.UNSIGNED_BYTE;return new vn(s,Object.assign({},Pv,r||{width:t,height:e,type:o}))}static addToCache(i,t){t&&(i.textureCacheIds.includes(t)||i.textureCacheIds.push(t),Se[t]&&Se[t]!==i&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Se[t]=i)}static removeFromCache(i){if(typeof i=="string"){let t=Se[i];if(t){let e=t.textureCacheIds.indexOf(i);return e>-1&&t.textureCacheIds.splice(e,1),delete Se[i],t}}else if(i?.textureCacheIds){for(let t=0;t<i.textureCacheIds.length;++t)delete Se[i.textureCacheIds[t]];return i.textureCacheIds.length=0,i}return null}},ot=vn;ot.defaultOptions={mipmap:Mi.POW2,anisotropicLevel:0,scaleMode:ui.LINEAR,wrapMode:ph.CLAMP,alphaMode:Ue.UNPACK,target:Sr.TEXTURE_2D,format:k.RGBA,type:ht.UNSIGNED_BYTE};ot._globalBatch=0;var Eh=class{constructor(){this.texArray=null,this.blend=0,this.type=pn.TRIANGLES,this.start=0,this.size=0,this.data=null}};var Mv=0,Ot=class{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Mv++,this.disposeRunner=new kt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?ke.ELEMENT_ARRAY_BUFFER:ke.ARRAY_BUFFER}get index(){return this.type===ke.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ot(t)}};var ns=class{constructor(t,e=0,r=!1,s=ht.FLOAT,o,n,a,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=s,this.stride=o,this.start=n,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,s,o){return new ns(t,e,r,s,o)}};var Bv={Float32Array,Uint32Array,Int32Array,Uint8Array};function D_(i,t){let e=0,r=0,s={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;let o=new ArrayBuffer(e*4),n=null,a=0;for(let h=0;h<i.length;h++){let l=t[h],u=i[h],c=rs(u);s[c]||(s[c]=new Bv[c](o)),n=s[c];for(let d=0;d<u.length;d++){let f=(d/l|0)*r+a,p=d%l;n[f+p]=u[d]}a+=l}return new Float32Array(o)}var N_={5126:4,5123:2,5121:1},Fv=0,Dv={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},fi=class{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Fv++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new kt("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,s=!1,o,n,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ot||(e instanceof Array&&(e=new Float32Array(e)),e=new Ot(e));let l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,r,s,o);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new ns(u,r,s,o,n,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ot||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ot(t)),t.type=ke.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let t=[],e=[],r=new Ot,s;for(s in this.attributes){let o=this.attributes[s],n=this.buffers[o.buffer];t.push(n.data),e.push(o.size*N_[o.type]/4),o.buffer=0}for(r.data=D_(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let t in this.attributes){let e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let t=new fi;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ot(this.buffers[e].data.slice(0));for(let e in this.attributes){let r=this.attributes[e];t.attributes[e]=new ns(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=ke.ELEMENT_ARRAY_BUFFER),t}static merge(t){let e=new fi,r=[],s=[],o=[],n;for(let a=0;a<t.length;a++){n=t[a];for(let h=0;h<n.buffers.length;h++)s[h]=s[h]||0,s[h]+=n.buffers[h].data.length,o[h]=0}for(let a=0;a<n.buffers.length;a++)r[a]=new Dv[rs(n.buffers[a].data)](s[a]),e.buffers[a]=new Ot(r[a]);for(let a=0;a<t.length;a++){n=t[a];for(let h=0;h<n.buffers.length;h++)r[h].set(n.buffers[h].data,o[h]),o[h]+=n.buffers[h].data.length}if(e.attributes=n.attributes,n.indexBuffer){e.indexBuffer=e.buffers[n.buffers.indexOf(n.indexBuffer)],e.indexBuffer.type=ke.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let c=0;c<n.buffers.length;c++)if(n.buffers[c]!==n.indexBuffer){u=c;break}for(let c in n.attributes){let d=n.attributes[c];(d.buffer|0)===u&&(h+=d.size*N_[d.type]/4)}for(let c=0;c<t.length;c++){let d=t[c].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[c].buffers[u].data.length/h,l+=d.length}}return e}};var Ah=class extends fi{constructor(t=!1){super(),this._buffer=new Ot(null,t,!1),this._indexBuffer=new Ot(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ht.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ht.FLOAT).addAttribute("aColor",this._buffer,4,!0,ht.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ht.FLOAT).addIndex(this._indexBuffer)}};var vf=Math.PI*2,bf=180/Math.PI,Tf=Math.PI/180,as=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(as||{});var ct=class{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ct(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}};var Yu=[new ct,new ct,new ct,new ct],nt=class{constructor(t=0,e=0,r=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(s),this.type=as.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new nt(0,0,0,0)}clone(){return new nt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){let w=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=w)return!1;let Q=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>Q}let r=this.left,s=this.right,o=this.top,n=this.bottom;if(s<=r||n<=o)return!1;let a=Yu[0].set(t.left,t.top),h=Yu[1].set(t.left,t.bottom),l=Yu[2].set(t.right,t.top),u=Yu[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;let c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=r||Math.min(a.x,h.x,l.x,u.x)>=s||Math.max(a.y,h.y,l.y,u.y)<=o||Math.min(a.y,h.y,l.y,u.y)>=n))return!1;let d=c*(h.y-a.y),f=c*(a.x-h.x),p=d*r+f*o,m=d*s+f*o,g=d*r+f*n,_=d*s+f*n;if(Math.max(p,m,g,_)<=d*a.x+f*a.y||Math.min(p,m,g,_)>=d*u.x+f*u.y)return!1;let v=c*(a.y-l.y),x=c*(l.x-a.x),y=v*r+x*o,P=v*s+x*o,H=v*r+x*n,E=v*s+x*n;return!(Math.max(y,P,H,E)<=v*a.x+x*a.y||Math.min(y,P,H,E)>=v*u.x+x*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){let e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=s,this.height=Math.max(o-s,0),this}ceil(t=1,e=.001){let r=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=s-this.y,this}enlarge(t){let e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=s,this.height=o-s,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};var dt=class{constructor(t=1,e=0,r=0,s=1,o=0,n=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=s,this.tx=o,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,s,o,n){return this.a=t,this.b=e,this.c=r,this.d=s,this.tx=o,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));let r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new ct;let r=t.x,s=t.y;return e.x=this.a*r+this.c*s+this.tx,e.y=this.b*r+this.d*s+this.ty,e}applyInverse(t,e){e=e||new ct;let r=1/(this.a*this.d+this.c*-this.b),s=t.x,o=t.y;return e.x=this.d*r*s+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*o+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){let e=Math.cos(t),r=Math.sin(t),s=this.a,o=this.c,n=this.tx;return this.a=s*e-this.b*r,this.b=s*r+this.b*e,this.c=o*e-this.d*r,this.d=o*r+this.d*e,this.tx=n*e-this.ty*r,this.ty=n*r+this.ty*e,this}append(t){let e=this.a,r=this.b,s=this.c,o=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*r+t.b*o,this.c=t.c*e+t.d*s,this.d=t.c*r+t.d*o,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*r+t.ty*o+this.ty,this}setTransform(t,e,r,s,o,n,a,h,l){return this.a=Math.cos(a+l)*o,this.b=Math.sin(a+l)*o,this.c=-Math.sin(a-h)*n,this.d=Math.cos(a-h)*n,this.tx=t-(r*this.a+s*this.c),this.ty=e-(r*this.b+s*this.d),this}prepend(t){let e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){let r=this.a,s=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){let e=this.a,r=this.b,s=this.c,o=this.d,n=t.pivot,a=-Math.atan2(-s,o),h=Math.atan2(r,e),l=Math.abs(a+h);return l<1e-5||Math.abs(vf-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(s*s+o*o),t.position.x=this.tx+(n.x*e+n.y*s),t.position.y=this.ty+(n.x*r+n.y*o),t}invert(){let t=this.a,e=this.b,r=this.c,s=this.d,o=this.tx,n=t*s-e*r;return this.a=s/n,this.b=-e/n,this.c=-r/n,this.d=t/n,this.tx=(r*this.ty-s*o)/n,this.ty=-(t*this.ty-e*o)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let t=new dt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new dt}static get TEMP_MATRIX(){return new dt}};var js=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],zs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ys=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],qs=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ef=[],L_=[],qu=Math.sign;function Nv(){for(let i=0;i<16;i++){let t=[];Ef.push(t);for(let e=0;e<16;e++){let r=qu(js[i]*js[e]+Ys[i]*zs[e]),s=qu(zs[i]*js[e]+qs[i]*zs[e]),o=qu(js[i]*Ys[e]+Ys[i]*qs[e]),n=qu(zs[i]*Ys[e]+qs[i]*qs[e]);for(let a=0;a<16;a++)if(js[a]===r&&zs[a]===s&&Ys[a]===o&&qs[a]===n){t.push(a);break}}}for(let i=0;i<16;i++){let t=new dt;t.set(js[i],zs[i],Ys[i],qs[i],0,0),L_.push(t)}}Nv();var wt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>js[i],uY:i=>zs[i],vX:i=>Ys[i],vY:i=>qs[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Ef[i][t],sub:(i,t)=>Ef[i][wt.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?wt.S:wt.N:Math.abs(t)*2<=Math.abs(i)?i>0?wt.E:wt.W:t>0?i>0?wt.SE:wt.SW:i>0?wt.NE:wt.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{let s=L_[wt.inv(t)];s.tx=e,s.ty=r,i.append(s)}};var pi=class{constructor(t,e,r=0,s=0){this._x=r,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new pi(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}};var O_=class{constructor(){this.worldTransform=new dt,this.localTransform=new dt,this.position=new pi(this.onChange,this,0,0),this.scale=new pi(this.onChange,this,1,1),this.pivot=new pi(this.onChange,this,0,0),this.skew=new pi(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){let i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){let t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){let e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}},bn=O_;bn.IDENTITY=new O_;var U_=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var k_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Ku(i,t,e){let r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function Af(i){let t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function wh(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Af(2*t);case"bvec3":return Af(3*t);case"bvec4":return Af(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var rr=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}];var Lv={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Ov={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function wf(i,t){let e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let r in i.uniforms){let s=t[r];if(!s){i.uniforms[r]?.group&&(i.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}let o=i.uniforms[r],n=!1;for(let a=0;a<rr.length;a++)if(rr[a].test(s,o)){e.push(rr[a].code(r,o)),n=!0;break}if(!n){let h=(s.size===1&&!s.isArray?Lv:Ov)[s.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}var G_={},Zu=G_;function Qu(){if(Zu===G_||Zu?.isContextLost()){let i=F.ADAPTER.createCanvas(),t;F.PREFER_ENV>=Ze.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Zu=t}return Zu}var Ju;function Cf(){if(!Ju){Ju=Ce.MEDIUM;let i=Qu();i&&i.getShaderPrecisionFormat&&(Ju=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?Ce.HIGH:Ce.MEDIUM)}return Ju}function H_(i,t){let e=i.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=i.getShaderInfoLog(t),s=r.split(`
`),o={},n=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!o[l]?(o[l]=!0,!0):!1),a=[""];n.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let h=e.join(`
`);a[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Sf(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||H_(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||H_(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}var Uv={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ch(i){return Uv[i]}var tc=null,V_={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Sh(i,t){if(!tc){let e=Object.keys(V_);tc={};for(let r=0;r<e.length;++r){let s=e[r];tc[i[s]]=V_[s]}}return tc[t]}function ec(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===Ce.HIGH&&e!==Ce.HIGH&&(r=Ce.MEDIUM),`precision ${r} float;
${i}`}else if(e!==Ce.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}var Ih;function ic(){if(typeof Ih=="boolean")return Ih;try{Ih=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ih=!1}return Ih}var kv=0,rc={},Tn=class{constructor(i,t,e="pixi-shader",r={}){this.extra={},this.id=kv++,this.vertexSrc=i||Tn.defaultVertexSrc,this.fragmentSrc=t||Tn.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(e=e.replace(/\s+/g,"-"),rc[e]?(rc[e]++,e+=`-${rc[e]}`):rc[e]=1,this.vertexSrc=`#define SHADER_NAME ${e}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${e}
${this.fragmentSrc}`,this.vertexSrc=ec(this.vertexSrc,Tn.defaultVertexPrecision,Ce.HIGH),this.fragmentSrc=ec(this.fragmentSrc,Tn.defaultFragmentPrecision,Cf())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return k_}static get defaultFragmentSrc(){return U_}static from(i,t,e){let r=i+t,s=vh[r];return s||(vh[r]=s=new Tn(i,t,e)),s}},Ge=Tn;Ge.defaultVertexPrecision=Ce.HIGH;Ge.defaultFragmentPrecision=ci.apple.device?Ce.HIGH:Ce.MEDIUM;var Gv=0,ae=class{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Gv++,this.static=!!e,this.ubo=!!r,t instanceof Ot?(this.buffer=t,this.buffer.type=ke.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ot(new Float32Array(1)),this.buffer.type=ke.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new ae(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new ae(t,e,r)}static uboFrom(t,e){return new ae(t,e??!0,!0)}};var Rr=class{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof ae?this.uniformGroup=e:this.uniformGroup=new ae(e):this.uniformGroup=new ae({}),this.disposeRunner=new kt("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(let r in e.uniforms){let s=e.uniforms[r];if(s.group&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){let s=Ge.from(t,e);return new Rr(s,r)}};var Rh=class{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){let r=new Int32Array(t);for(let o=0;o<t;o++)r[o]=o;this.defaultGroupCache[t]=ae.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ge(this.vertexSrc,s)}let e={tint:new Float32Array([1,1,1,1]),translationMatrix:new dt,default:this.defaultGroupCache[t]};return new Rr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}};var Ph=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}};function X_(){return!ci.apple.device}function W_(i){let t=!0,e=F.ADAPTER.getNavigator();if(ci.tablet||ci.phone){if(ci.apple.device){let r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(ci.android.device){let r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}var Ks=class{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}};var $_=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var j_=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var Ni=class extends Ks{constructor(i){super(i),this.setShaderGenerator(),this.geometryClass=Ah,this.vertexSize=6,this.state=Di.for2d(),this.size=Ni.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),i.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??W_(32),this._defaultMaxTextures}static set defaultMaxTextures(i){this._defaultMaxTextures=i}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??X_(),this._canUploadSameBuffer}static set canUploadSameBuffer(i){this._canUploadSameBuffer=i}get MAX_TEXTURES(){return et("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return j_}static get defaultFragmentTemplate(){return $_}setShaderGenerator({vertex:i=Ni.defaultVertexSrc,fragment:t=Ni.defaultFragmentTemplate}={}){this.shaderGenerator=new Rh(i,t)}contextChange(){let i=this.renderer.gl;F.PREFER_ENV===Ze.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),Ni.defaultMaxTextures),this.maxTextures=zu(this.maxTextures,i)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:i,_textureArrayPool:t}=Ni,e=this.size/4,r=Math.floor(e/this.maxTextures)+1;for(;i.length<e;)i.push(new Eh);for(;t.length<r;)t.push(new Ph);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(i){i._texture.valid&&(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)}buildTexturesAndDrawCalls(){let{_bufferedTextures:i,maxTextures:t}=this,e=Ni._textureArrayPool,r=this.renderer.batch,s=this._tempBoundTextures,o=this.renderer.textureGC.count,n=++ot._globalBatch,a=0,h=e[0],l=0;r.copyBoundTextures(s,t);for(let u=0;u<this._bufferSize;++u){let c=i[u];i[u]=null,c._batchEnabled!==n&&(h.count>=t&&(r.boundArray(h,s,n,t),this.buildDrawCalls(h,l,u),l=u,h=e[++a],++n),c._batchEnabled=n,c.touched=o,h.elements[h.count++]=c)}h.count>0&&(r.boundArray(h,s,n,t),this.buildDrawCalls(h,l,this._bufferSize),++a,++n);for(let u=0;u<s.length;u++)s[u]=null;ot._globalBatch=n}buildDrawCalls(i,t,e){let{_bufferedElements:r,_attributeBuffer:s,_indexBuffer:o,vertexSize:n}=this,a=Ni._drawCallPool,h=this._dcIndex,l=this._aIndex,u=this._iIndex,c=a[h];c.start=this._iIndex,c.texArray=i;for(let d=t;d<e;++d){let f=r[d],p=f._texture.baseTexture,m=_h[p.alphaMode?1:0][f.blendMode];r[d]=null,t<d&&c.blend!==m&&(c.size=u-c.start,t=d,c=a[++h],c.texArray=i,c.start=u),this.packInterleavedGeometry(f,s,o,l,u),l+=f.vertexData.length/2*n,u+=f.indices.length,c.blend=m}t<e&&(c.size=u-c.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=u}bindAndClearTexArray(i){let t=this.renderer.texture;for(let e=0;e<i.count;e++)t.bind(i.elements[e],i.ids[e]),i.elements[e]=null;i.count=0}updateGeometry(){let{_packedGeometries:i,_attributeBuffer:t,_indexBuffer:e}=this;Ni.canUploadSameBuffer?(i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let i=this._dcIndex,{gl:t,state:e}=this.renderer,r=Ni._drawCallPool,s=null;for(let o=0;o<i;o++){let{texArray:n,type:a,size:h,start:l,blend:u}=r[o];s!==n&&(s=n,this.bindAndClearTexArray(n)),this.state.blendMode=u,e.set(this.state),t.drawElements(a,h,t.UNSIGNED_SHORT,l*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Ni.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(i){let t=ss(Math.ceil(i/8)),e=yh(t),r=t*8;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new Th(r*this.vertexSize*4)),s}getIndexBuffer(i){let t=ss(Math.ceil(i/12)),e=yh(t),r=t*12;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let s=this._iBuffers[e];return s||(this._iBuffers[e]=s=new Uint16Array(r)),s}packInterleavedGeometry(i,t,e,r,s){let{uint32View:o,float32View:n}=t,a=r/this.vertexSize,h=i.uvs,l=i.indices,u=i.vertexData,c=i._texture.baseTexture._batchLocation,d=Math.min(i.worldAlpha,1),f=Nt.shared.setValue(i._tintRGB).toPremultiplied(d);for(let p=0;p<u.length;p+=2)n[r++]=u[p],n[r++]=u[p+1],n[r++]=h[p],n[r++]=h[p+1],o[r++]=f,n[r++]=c;for(let p=0;p<l.length;p++)e[s++]=a+l[p]}},Je=Ni;Je.defaultBatchSize=4096;Je.extension={name:"batch",type:R.RendererPlugin};Je._drawCallPool=[];Je._textureArrayPool=[];D.add(Je);var z_=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var Y_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var Mh=class extends Rr{constructor(i,t,e){let r=Ge.from(i||Mh.defaultVertexSrc,t||Mh.defaultFragmentSrc);super(r,e),this.padding=0,this.resolution=Mh.defaultResolution,this.multisample=Mh.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Di}apply(i,t,e,r,s){i.applyFilter(this,t,e,r)}get blendMode(){return this.state.blendMode}set blendMode(i){this.state.blendMode=i}get resolution(){return this._resolution}set resolution(i){this._resolution=i}static get defaultVertexSrc(){return Y_}static get defaultFragmentSrc(){return z_}},mi=Mh;mi.defaultResolution=1;mi.defaultMultisample=yt.NONE;var Pr=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Nt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;let{backgroundColor:e,background:r,backgroundAlpha:s}=t,o=r??e;o!==void 0&&(this.color=o),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}};Pr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};Pr.extension={type:[R.RendererSystem,R.CanvasRendererSystem],name:"background"};D.add(Pr);var En=class{constructor(t){this.renderer=t,this.emptyRenderer=new Ks(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){let{boundTextures:r}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=r[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,r,s){let{elements:o,ids:n,count:a}=t,h=0;for(let l=0;l<a;l++){let u=o[l],c=u._batchLocation;if(c>=0&&c<s&&e[c]===u){n[l]=c;continue}for(;h<s;){let d=e[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}n[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}};En.extension={type:R.RendererSystem,name:"batch"};D.add(En);var q_=0,Mr=class{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=q_++}init(t){if(t.context)this.initFromContext(t.context);else{let e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=q_++,this.renderer.runners.contextChange.emit(t);let e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){let e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(F.PREFER_ENV>=Ze.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){let{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){let e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};Mr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};Mr.extension={type:R.RendererSystem,name:"context"};D.add(Mr);var sc=class extends ir{upload(t,e,r){let s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ue.UNPACK);let o=e.realWidth,n=e.realHeight;return r.width===o&&r.height===n?s.texSubImage2D(e.target,0,0,0,o,n,e.format,r.type,this.data):(r.width=o,r.height=n,s.texImage2D(e.target,0,r.internalFormat,o,n,0,e.format,r.type,this.data)),!0}};var hs=class{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new kt("disposeFramebuffer"),this.multisample=yt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new ot(null,{scaleMode:ui.NEAREST,resolution:1,mipmap:Mi.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new ot(new sc(null,{width:this.width,height:this.height}),{scaleMode:ui.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Mi.OFF,format:k.DEPTH_COMPONENT,type:ht.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){let s=this.colorTextures[r],o=s.resolution;s.setSize(t/o,e/o)}if(this.depthTexture){let r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var Zs=class extends ot{constructor(t={}){if(typeof t=="number"){let e=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3];t={width:e,height:r,scaleMode:s,resolution:o}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=yt.NONE),super(null,t),this.mipmap=Mi.OFF,this.valid=!0,this._clear=new Nt([0,0,0,0]),this.framebuffer=new hs(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var he=class extends Qe{constructor(t){let e=t,r=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;super(r,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=ju(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,s){let o=t.gl,n=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1&&s.buffered.length===0)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ue.UNPACK),!this.noSubImage&&e.target===o.TEXTURE_2D&&r.width===n&&r.height===a?o.texSubImage2D(o.TEXTURE_2D,0,0,0,e.format,r.type,s):(r.width=n,r.height=a,o.texImage2D(e.target,0,r.internalFormat,e.format,r.type,s)),!0}update(){if(this.destroyed)return;let t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}};var ls=class extends he{constructor(t,e){if(e=e||{},typeof t=="string"){let r=new Image;he.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??F.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{let s=this.source;this.url=s.src;let o=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?o():(s.onload=o,s.onerror=n=>{r(n),this.onError.emit(n)})}),this._load)}process(){let t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ue.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let s=!0,o=e._glTextures;for(let n in o){let a=o[n];if(a!==r&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}};var An=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){let s=e.width,o=e.height;if(r){let n=t.width/2/s,a=t.height/2/o,h=t.x/s+n,l=t.y/o+a;r=wt.add(r,wt.NW),this.x0=h+n*wt.uX(r),this.y0=l+a*wt.uY(r),r=wt.add(r,2),this.x1=h+n*wt.uX(r),this.y1=l+a*wt.uY(r),r=wt.add(r,2),this.x2=h+n*wt.uX(r),this.y2=l+a*wt.uY(r),r=wt.add(r,2),this.x3=h+n*wt.uX(r),this.y3=l+a*wt.uY(r)}else this.x0=t.x/s,this.y0=t.y/o,this.x1=(t.x+t.width)/s,this.y1=t.y/o,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/o,this.x3=t.x/s,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}};var K_=new An;function oc(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}var it=class extends os.default{constructor(t,e,r,s,o,n,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new nt(0,0,1,1)),t instanceof it&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this._uvs=K_,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new ct(n.x,n.y):new ct(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){let{resource:e}=this.baseTexture;e?.url&&ee[e.url]&&it.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,it.removeFromCache(this),this.textureCacheIds=null}clone(){let t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new it(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===K_&&(this._uvs=new An),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=F.STRICT_TEXTURE_CACHE){let s=typeof t=="string",o=null;if(s)o=t;else if(t instanceof ot){if(!t.cacheId){let a=e?.pixiIdPrefix||"pixiid";t.cacheId=`${a}-${er()}`,ot.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${er()}`}o=t._pixiId}let n=ee[o];if(s&&r&&!n)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!n&&!(t instanceof ot)?(e.resolution||(e.resolution=bh(t)),n=new it(new ot(t,e)),n.baseTexture.cacheId=o,ot.addToCache(n.baseTexture,o),it.addToCache(n,o)):!n&&t instanceof ot&&(n=new it(t),it.addToCache(n,o)),n}static fromURL(t,e){let r=Object.assign({autoLoad:!1},e?.resourceOptions),s=it.from(t,Object.assign({resourceOptions:r},e),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,r,s){return new it(ot.fromBuffer(t,e,r,s))}static fromLoader(t,e,r,s){let o=new ot(t,Object.assign({scaleMode:ot.defaultOptions.scaleMode,resolution:bh(e)},s)),{resource:n}=o;n instanceof ls&&(n.url=e);let a=new it(o);return r||(r=e),ot.addToCache(a.baseTexture,r),it.addToCache(a,r),r!==e&&(ot.addToCache(a.baseTexture,e),it.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ee[e]&&ee[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),ee[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=ee[t];if(e){let r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete ee[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)ee[t.textureCacheIds[e]]===t&&delete ee[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;let{x:e,y:r,width:s,height:o}=t,n=e+s>this.baseTexture.width,a=r+o>this.baseTexture.height;if(n||a){let h=n&&a?"and":"or",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,u=`Y: ${r} + ${o} = ${r+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return it._EMPTY||(it._EMPTY=new it(new ot),oc(it._EMPTY),oc(it._EMPTY.baseTexture)),it._EMPTY}static get WHITE(){if(!it._WHITE){let t=F.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),it._WHITE=new it(ot.from(t)),oc(it._WHITE),oc(it._WHITE.baseTexture)}return it._WHITE}};var Br=class extends it{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){let s=this.baseTexture.resolution,o=Math.round(t*s)/s,n=Math.round(e*s)/s;this.valid=o>0&&n>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=n,r&&this.baseTexture.resize(o,n),this.updateUvs()}setResolution(t){let{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Br(new Zs(t))}};var wn=class{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=yt.NONE){let s=new Zs(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Br(s)}getOptimalTexture(t,e,r=1,s=yt.NONE){let o;t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=ss(t),e=ss(e),o=((t&65535)<<16|e&65535)>>>0,s>1&&(o+=s*4294967296)):o=s>1?-s:-1,this.texturePool[o]||(this.texturePool[o]=[]);let n=this.texturePool[o].pop();return n||(n=this.createTexture(t,e,s)),n.filterPoolKey=o,n.setResolution(r),n}getFilterTexture(t,e,r){let s=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||yt.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){let e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(let e in this.texturePool){let r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(let e in this.texturePool){if(!(Number(e)<0))continue;let r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}};wn.SCREEN_KEY=-1;var Bh=class extends fi{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var Fh=class extends fi{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ot(this.vertices),this.uvBuffer=new Ot(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+e.width/t.width,this.uvs[3]=s,this.uvs[4]=r+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=r,this.uvs[7]=s+e.height/t.height,r=e.x,s=e.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+e.width,this.vertices[3]=s,this.vertices[4]=r+e.width,this.vertices[5]=s+e.height,this.vertices[6]=r,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var Dh=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=yt.NONE,this.sourceFrame=new nt,this.destinationFrame=new nt,this.bindingSourceFrame=new nt,this.bindingDestinationFrame=new nt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var nc=[new ct,new ct,new ct,new ct],If=new dt,Cn=class{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new wn,this.statePool=[],this.quad=new Bh,this.quadUv=new Fh,this.tempRect=new nt,this.activeState={},this.globalUniforms=new ae({outputFrame:new nt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){let r=this.renderer,s=this.defaultFilterStack,o=this.statePool.pop()||new Dh,n=this.renderer.renderTexture,a=e[0].resolution,h=e[0].multisample,l=e[0].padding,u=e[0].autoFit,c=e[0].legacy??!0;for(let p=1;p<e.length;p++){let m=e[p];a=Math.min(a,m.resolution),h=Math.min(h,m.multisample),l=this.useMaxPadding?Math.max(l,m.padding):l+m.padding,u=u&&m.autoFit,c=c||(m.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=n.current),s.push(o),o.resolution=a,o.multisample=h,o.legacy=c,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(l);let d=this.tempRect.copyFrom(n.sourceFrame);r.projection.transform&&this.transformAABB(If.copyFrom(r.projection.transform).invert(),d),u?(o.sourceFrame.fit(d),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(d)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,n.current?n.current.resolution:r.resolution,n.sourceFrame,n.destinationFrame,r.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,a,h),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;let f=this.tempRect;f.x=0,f.y=0,f.width=o.sourceFrame.width,f.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(n.sourceFrame),o.bindingDestinationFrame.copyFrom(n.destinationFrame),o.transform=r.projection.transform,r.projection.transform=null,n.bind(o.renderTexture,o.sourceFrame,f),r.framebuffer.clear(0,0,0,0)}pop(){let t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;let s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;let o=s.inputSize,n=s.inputPixel,a=s.inputClamp;if(o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],n[0]=Math.round(o[0]*e.resolution),n[1]=Math.round(o[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],a[0]=.5*n[2],a[1]=.5*n[3],a[2]=e.sourceFrame.width*o[2]-.5*n[2],a[3]=e.sourceFrame.height*o[3]-.5*n[3],e.legacy){let l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,is.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<r.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[c].apply(this,l,u,is.CLEAR,e);let d=l;l=u,u=d}r[c].apply(this,l,h.renderTexture,is.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=is.CLEAR){let{renderTexture:r,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){let n=this.tempRect;n.x=0,n.y=0,n.width=t.filterFrame.width,n.height=t.filterFrame.height,r.bind(t,t.filterFrame,n)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let o=s.stateId&1||this.forceClear;(e===is.CLEAR||e===is.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,s){let o=this.renderer;o.state.set(t.state),this.bindAndClear(r,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(pn.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(pn.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){let{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:o}=e._texture,n=t.set(s.width,0,0,s.height,r.x,r.y),a=e.worldTransform.copyTo(dt.TEMP_MATRIX);return a.invert(),n.prepend(a),n.scale(1/o.width,1/o.height),n.translate(e.anchor.x,e.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,s=yt.NONE){return this.texturePool.getOptimalTexture(t,e,r,s)}getFilterTexture(t,e,r){if(typeof t=="number"){let o=t;t=e,e=o}t=t||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||yt.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){let r=nc[0],s=nc[1],o=nc[2],n=nc[3];r.set(e.left,e.top),s.set(e.left,e.bottom),o.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(r,r),t.apply(s,s),t.apply(o,o),t.apply(n,n);let a=Math.min(r.x,s.x,o.x,n.x),h=Math.min(r.y,s.y,o.y,n.y),l=Math.max(r.x,s.x,o.x,n.x),u=Math.max(r.y,s.y,o.y,n.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,r,s,o){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(o){let{a:n,b:a,c:h,d:l}=o;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(n)>1e-4||Math.abs(l)>1e-4))return}o=o?If.copyFrom(o):If.identity(),o.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(o,t),t.ceil(e),this.transformAABB(o.invert(),t)}}};Cn.extension={type:R.RendererSystem,name:"filter"};D.add(Cn);var Nh=class{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=yt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var Hv=new nt,Sn=class{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new hs(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new nt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;F.PREFER_ENV===Ze.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){let{gl:s}=this;if(t){let o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=r),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let n=0;n<t.colorTextures.length;n++){let a=t.colorTextures[n];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){let n=e.width>>r,a=e.height>>r,h=n/e.width;this.setViewport(e.x*h,e.y*h,n,a)}else{let n=t.width>>r,a=t.height>>r;this.setViewport(0,0,n,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,s){let o=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),s=Math.round(s),(o.width!==r||o.height!==s||o.x!==t||o.y!==e)&&(o.x=t,o.y=e,o.width=r,o.height=s,this.gl.viewport(t,e,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,s,o=Nu.COLOR|Nu.DEPTH){let{gl:n}=this;n.clearColor(t,e,r,s),n.clear(o)}initFramebuffer(t){let{gl:e}=this,r=new Nh(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){let{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));let s=t.colorTextures,o=s.length;e.drawBuffers||(o=Math.min(o,1));for(let n=0;n<o;n++){let a=s[n],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),n===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){let{gl:r}=this,s=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures,n=o.length;r.drawBuffers||(n=Math.min(n,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let h=0;h<n;h++){let l=o[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(r.COLOR_ATTACHMENT0+h))}if(a.length>1&&r.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){let l=t.depthTexture;this.renderer.texture.bind(l,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,e)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(s.stencil=s.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s.stencil)):s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){let{msaaSamples:e}=this,r=yt.NONE;if(t<=1||e===null)return r;for(let s=0;s<e.length;s++)if(e[s]<=t){r=e[s];break}return r===1&&(r=yt.NONE),r}blit(t,e,r){let{current:s,renderer:o,gl:n,CONTEXT_UID:a}=this;if(o.context.webGLVersion!==2||!s)return;let h=s.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;let u=s.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new hs(s.width,s.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=Hv,e.width=s.width,e.height=s.height),r||(r=e);let l=e.width===r.width&&e.height===r.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,h.framebuffer),n.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,n.COLOR_BUFFER_BIT,l?n.NEAREST:n.LINEAR)}disposeFramebuffer(t,e){let r=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];let o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){let e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){let t=this.current;if(!t)return;let e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;let r=t.width,s=t.height,o=this.gl,n=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,n),e.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,e.multisample,o.DEPTH24_STENCIL8,r,s):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,r,s),e.stencil=n,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new nt}destroy(){this.renderer=null}};Sn.extension={type:R.RendererSystem,name:"framebuffer"};D.add(Sn);var Rf={5126:4,5123:2,5121:1},In=class{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;F.PREFER_ENV===Ze.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=s=>r.bindVertexArrayOES(s),t.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){let r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(s,o)=>r.vertexAttribDivisorANGLE(s,o),t.drawElementsInstanced=(s,o,n,a,h)=>r.drawElementsInstancedANGLE(s,o,n,a,h),t.drawArraysInstanced=(s,o,n,a)=>r.drawArraysInstancedANGLE(s,o,n,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;let{gl:r}=this,s=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},o=!0);let n=s[e.program.id]||this.initGeometryVao(t,e,o);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?r.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){let s=t.buffers[r];e.update(s)}}checkCompatibility(t,e){let r=t.attributes,s=e.attributeData;for(let o in s)if(!r[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,e){let r=t.attributes,s=e.attributeData,o=["g",t.id];for(let n in r)s[n]&&o.push(n,s[n].location);return o.join("-")}initGeometryVao(t,e,r=!0){let s=this.gl,o=this.CONTEXT_UID,n=this.renderer.buffer,a=e.program;a.glPrograms[o]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);let h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID],u=l[h];if(u)return l[a.id]=u,u;let c=t.buffers,d=t.attributes,f={},p={};for(let m in c)f[m]=0,p[m]=0;for(let m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*Rf[d[m].type];for(let m in d){let g=d[m],_=g.size;g.stride===void 0&&(f[g.buffer]===_*Rf[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=_*Rf[g.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let m=0;m<c.length;m++){let g=c[m];n.bind(g),r&&g._glBuffers[o].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,s.bindVertexArray(null),n.unbind(ke.ARRAY_BUFFER),u}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];let r=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=t.buffers,n=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!r){if(n)for(let a=0;a<o.length;a++){let h=o[a]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(o[a],e))}if(!e){for(let a in r)if(a[0]==="g"){let h=r[a];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){let e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){let r=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,n=t.buffers,a=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let h=null;for(let l in a){let u=a[l],c=n[u.buffer],d=c._glBuffers[s];if(e.attributeData[l]){h!==d&&(o.bind(c),h=d);let f=e.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,s){let{gl:o}=this,n=this._activeGeometry;if(n.indexBuffer){let a=n.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?n.instanced?o.drawElementsInstanced(t,e||n.indexBuffer.data.length,h,(r||0)*a,s||1):o.drawElements(t,e||n.indexBuffer.data.length,h,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else n.instanced?o.drawArraysInstanced(t,r,e||n.getSize(),s||1):o.drawArrays(t,r,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};In.extension={type:R.RendererSystem,name:"geometry"};D.add(In);var Z_=new dt,Lh=class{constructor(t,e){this._texture=t,this.mapCoord=new dt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);let r=this.mapCoord;for(let s=0;s<t.length;s+=2){let o=t[s],n=t[s+1];e[s]=o*r.a+n*r.c+r.tx,e[s+1]=o*r.b+n*r.d+r.ty}return e}update(t){let e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;let r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);let s=e.orig,o=e.trim;o&&(Z_.set(s.width/o.width,0,0,s.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(Z_));let n=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/n.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/n.width,a[1]=(e._frame.y+h+l)/n.height,a[2]=(e._frame.x+e._frame.width-h+l)/n.width,a[3]=(e._frame.y+e._frame.height-h+l)/n.height,this.uClampOffset[0]=l/n.realWidth,this.uClampOffset[1]=l/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&e.rotate===0,!0}};var Q_=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var J_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var Oh=class extends mi{constructor(t,e,r){let s=null;typeof t!="string"&&e===void 0&&r===void 0&&(s=t,t=void 0,e=void 0,r=void 0),super(t||J_,e||Q_,r),this.maskSprite=s,this.maskMatrix=new dt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,s){let o=this._maskSprite,n=o._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new Lh(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,r,s))}};var Uh=class{constructor(t=null){this.type=Lt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=mi.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Lt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var Rn=class{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){let o=this.maskDataPool.pop()||new Uh;o.pooled=!0,o.maskObject=e,r=o}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==Lt.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Lt.SCISSOR:this.renderer.scissor.push(r);break;case Lt.STENCIL:this.renderer.stencil.push(r);break;case Lt.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Lt.COLOR:this.pushColorMask(r);break;default:break}r.type===Lt.SPRITE&&this.maskStack.push(r)}pop(t){let e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Lt.SCISSOR:this.renderer.scissor.pop(e);break;case Lt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Lt.SPRITE:this.popSpriteMask(e);break;case Lt.COLOR:this.popColorMask(e);break;default:break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){let r=this.maskStack[this.maskStack.length-1];r.type===Lt.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){let e=t.maskObject;e?e.isSprite?t.type=Lt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Lt.SCISSOR:t.type=Lt.STENCIL:t.type=Lt.COLOR}pushSpriteMask(t){let{maskObject:e}=t,r=t._target,s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Oh]));let o=this.renderer,n=o.renderTexture,a,h;if(n.current){let u=n.current;a=t.resolution||u.resolution,h=t.multisample??u.multisample}else a=t.resolution||o.resolution,h=t.multisample??o.multisample;s[0].resolution=a,s[0].multisample=h,s[0].maskSprite=e;let l=r.filterArea;r.filterArea=e.getBounds(!0),o.filter.push(r,s),r.filterArea=l,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){let e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){let e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}};Rn.extension={type:R.RendererSystem,name:"mask"};D.add(Rn);var Pn=class{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){let{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;let s=this.getStackLength();s!==r&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var tx=new dt,ex=[],ac=class extends Pn{constructor(i){super(i),this.glConst=F.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0}calcScissorRect(i){if(i._scissorRectLocal)return;let t=i._scissorRect,{maskObject:e}=i,{renderer:r}=this,s=r.renderTexture,o=e.getBounds(!0,ex.pop()??new nt);this.roundFrameToPixels(o,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),t&&o.fit(t),i._scissorRectLocal=o}static isMatrixRotated(i){if(!i)return!1;let{a:t,b:e,c:r,d:s}=i;return(Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(s)>1e-4)}testScissor(i){let{maskObject:t}=i;if(!t.isFastRect||!t.isFastRect()||ac.isMatrixRotated(t.worldTransform)||ac.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);let e=i._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(i,t,e,r,s){ac.isMatrixRotated(s)||(s=s?tx.copyFrom(s):tx.identity(),s.translate(-e.x,-e.y).scale(r.width/e.width,r.height/e.height).translate(r.x,r.y),this.renderer.filter.transformAABB(s,i),i.fit(r),i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),i.width=Math.round(i.width*t),i.height=Math.round(i.height*t))}push(i){i._scissorRectLocal||this.calcScissorRect(i);let{gl:t}=this.renderer;i._scissorRect||t.enable(t.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()}pop(i){let{gl:t}=this.renderer;i&&ex.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){let i=this.maskStack[this.maskStack.length-1]._scissorRect,t;this.renderer.renderTexture.current?t=i.y:t=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,t,i.width,i.height)}},hc=ac;hc.extension={type:R.RendererSystem,name:"scissor"};D.add(hc);var Mn=class extends Pn{constructor(t){super(t),this.glConst=F.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){let e=t.maskObject,{gl:r}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;let o=t._colorMask;o!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,o!==0&&(t._colorMask=o,r.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){let e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{let r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(r._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}};Mn.extension={type:R.RendererSystem,name:"stencil"};D.add(Mn);var Bn=class{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){let t=this.rendererPlugins;for(let e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(let t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}};Bn.extension={type:[R.RendererSystem,R.CanvasRendererSystem],name:"_plugin"};D.add(Bn);var Fn=class{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new dt,this.transform=null}update(t,e,r,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);let o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,e,r,s){let o=this.projectionMatrix,n=s?-1:1;o.identity(),o.a=1/e.width*2,o.d=n*(1/e.height*2),o.tx=-1-e.x*o.a,o.ty=-n-e.y*o.d}setTransform(t){}destroy(){this.renderer=null}};Fn.extension={type:R.RendererSystem,name:"projection"};D.add(Fn);var Vv=new bn,Dn=class{constructor(t){this.renderer=t,this._tempMatrix=new dt}generateTexture(t,e){let{region:r,...s}=e||{},o=r||t.getLocalBounds(null,!0);o.width===0&&(o.width=1),o.height===0&&(o.height=1);let n=Br.create({width:o.width,height:o.height,...s});this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;let a=t.transform;return t.transform=Vv,this.renderer.render(t,{renderTexture:n,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,n}destroy(){}};Dn.extension={type:[R.RendererSystem,R.CanvasRendererSystem],name:"textureGenerator"};D.add(Dn);var Qs=new nt,kh=new nt,Nn=class{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new nt,this.destinationFrame=new nt,this.viewportFrame=new nt}bind(t=null,e,r){let s=this.renderer;this.current=t;let o,n,a;t?(o=t.baseTexture,a=o.resolution,e||(Qs.width=t.frame.width,Qs.height=t.frame.height,e=Qs),r||(kh.x=t.frame.x,kh.y=t.frame.y,kh.width=e.width,kh.height=e.height,r=kh),n=o.framebuffer):(a=s.resolution,e||(Qs.width=s._view.screen.width,Qs.height=s._view.screen.height,e=Qs),r||(r=Qs,r.width=e.width,r.height=e.height));let h=this.viewportFrame;h.x=r.x*a,h.y=r.y*a,h.width=r.width*a,h.height=r.height*a,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(n,h),this.renderer.projection.update(r,e,a,!n),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){let r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=t?Nt.shared.setValue(t):r,o=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,a=o.width!==n.width||o.height!==n.height;if(a){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};Nn.extension={type:R.RendererSystem,name:"renderTexture"};D.add(Nn);var Gh=class{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function ix(i,t){let e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let o=t.getActiveAttrib(i,s);if(o.name.startsWith("gl_"))continue;let n=Sh(t,o.type),a={type:n,name:o.name,size:Ch(n),location:t.getAttribLocation(i,o.name)};e[o.name]=a}return e}function rx(i,t){let e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){let o=t.getActiveUniform(i,s),n=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),h=Sh(t,o.type);e[n]={name:n,index:s,type:h,size:o.size,isArray:a,value:wh(h,o.size)}}return e}function Pf(i,t){let e=Ku(i,i.VERTEX_SHADER,t.vertexSrc),r=Ku(i,i.FRAGMENT_SHADER,t.fragmentSrc),s=i.createProgram();i.attachShader(s,e),i.attachShader(s,r);let o=t.extra?.transformFeedbackVaryings;if(o&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(s,o.names,o.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||Sf(i,s,e,r),t.attributeData=ix(s,i),t.uniformData=rx(s,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){let h=Object.keys(t.attributeData);h.sort((l,u)=>l>u?1:-1);for(let l=0;l<h.length;l++)t.attributeData[h[l]].location=l,i.bindAttribLocation(s,l,h[l]);i.linkProgram(s)}i.deleteShader(e),i.deleteShader(r);let n={};for(let h in t.uniformData){let l=t.uniformData[h];n[h]={location:i.getUniformLocation(s,h),value:wh(l.type,l.size)}}return new Gh(s,n)}function Xv(i,t,e,r,s){e.buffer.update(s)}var Wv={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},sx={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function ox(i){let t=i.map(o=>({data:o,offset:0,dataLen:0,dirty:0})),e=0,r=0,s=0;for(let o=0;o<t.length;o++){let n=t[o];if(e=sx[n.data.type],n.data.size>1&&(e=Math.max(e,16)*n.data.size),n.dataLen=e,r%e!==0&&r<16){let a=r%e%16;r+=a,s+=a}r+e>16?(s=Math.ceil(s/16)*16,n.offset=s,s+=e,r=e):(n.offset=s,r+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function nx(i,t){let e=[];for(let r in i)t[r]&&e.push(t[r]);return e.sort((r,s)=>r.index-s.index),e}function Mf(i,t){if(!i.autoManage)return{size:0,syncFunc:Xv};let e=nx(i.uniforms,t),{uboElements:r,size:s}=ox(e),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let n=0;n<r.length;n++){let a=r[n],h=i.uniforms[a.data.name],l=a.data.name,u=!1;for(let c=0;c<rr.length;c++){let d=rr[c];if(d.codeUbo&&d.test(a.data,h)){o.push(`offset = ${a.offset/4};`,rr[c].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){let c=Ch(a.data.type),d=Math.max(sx[a.data.type]/16,1),f=c/d,p=(4-f%4)%4;o.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{let c=Wv[a.data.type];o.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${c};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}var $v=0,lc={textureCount:0,uboCount:0},Ln=class{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=$v++}systemCheck(){if(!ic())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;let r=t.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),e||(lc.textureCount=0,lc.uboCount=0,this.syncUniformGroup(t.uniformGroup,lc)),s}setUniforms(t){let e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){let r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){let e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=wf(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){let r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;let s=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),s(r.uniformData,t.uniforms,this.renderer,lc,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){let{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);let o=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;let n=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[n];if(a||(a=this._uboCache[n]=Mf(t,this.shader.program.uniformData)),t.autoManage){let h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){let s=t.uniforms,o=[`${r}-`];for(let n in s)o.push(n),e[n]&&o.push(e[n].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){let e=this.gl,r=t.program,s=Pf(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};Ln.extension={type:R.RendererSystem,name:"shader"};D.add(Ln);var Fr=class{constructor(t){this.renderer=t}run(t){let{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.2.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}};Fr.defaultOptions={hello:!1};Fr.extension={type:[R.RendererSystem,R.CanvasRendererSystem],name:"startup"};D.add(Fr);function ax(i,t=[]){return t[K.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.ADD]=[i.ONE,i.ONE],t[K.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.NONE]=[0,0],t[K.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[K.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[K.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[K.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[K.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[K.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[K.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[K.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[K.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[K.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[K.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}var jv=0,zv=1,Yv=2,qv=3,Kv=4,Zv=5,Bf=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=K.NONE,this._blendEq=!1,this.map=[],this.map[jv]=this.setBlend,this.map[zv]=this.setOffset,this.map[Yv]=this.setCullFace,this.map[qv]=this.setDepthTest,this.map[Kv]=this.setFrontFace,this.map[Zv]=this.setDepthMask,this.checks=[],this.defaultState=new Di,this.defaultState.blend=!0}contextChange(i){this.gl=i,this.blendModes=ax(i),this.set(this.defaultState),this.reset()}set(i){if(i=i||this.defaultState,this.stateId!==i.data){let t=this.stateId^i.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(i.data&1<<e)),t=t>>1,e++;this.stateId=i.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,i)}forceState(i){i=i||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(i.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,i);this.stateId=i.data}setBlend(i){this.updateCheck(Bf.checkBlendMode,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.updateCheck(Bf.checkPolygonOffset,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(i){this.gl[i?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(i){this.gl.depthMask(i)}setCullFace(i){this.gl[i?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(i){this.gl.frontFace(this.gl[i?"CW":"CCW"])}setBlendMode(i){if(i===this.blendMode)return;this.blendMode=i;let t=this.blendModes[i],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(i,t){this.gl.polygonOffset(i,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(i,t){let e=this.checks.indexOf(i);t&&e===-1?this.checks.push(i):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(i,t){i.setBlendMode(t.blendMode)}static checkPolygonOffset(i,t){i.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}},uc=Bf;uc.extension={type:R.RendererSystem,name:"state"};D.add(uc);var On=class extends os.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);let e=(t.priority??[]).filter(s=>t.systems[s]),r=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(let s of r)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new kt(e)})}addSystem(t,e){let r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(let s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(t,e){let r=Object.keys(this._systemsHash);t.items.forEach(s=>{let o=r.find(n=>this._systemsHash[n]===s);s[t.name](e[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}};var cc=class{constructor(i){this.renderer=i,this.count=0,this.checkCount=0,this.maxIdle=cc.defaultMaxIdle,this.checkCountMax=cc.defaultCheckCountMax,this.mode=cc.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Ou.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let i=this.renderer.texture,t=i.managedTextures,e=!1;for(let r=0;r<t.length;r++){let s=t[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(i.destroyTexture(s,!0),t[r]=null,e=!0)}if(e){let r=0;for(let s=0;s<t.length;s++)t[s]!==null&&(t[r++]=t[s]);t.length=r}}unload(i){let t=this.renderer.texture,e=i._texture;e&&!e.framebuffer&&t.destroyTexture(e);for(let r=i.children.length-1;r>=0;r--)this.unload(i.children[r])}destroy(){this.renderer=null}},He=cc;He.defaultMode=Ou.AUTO;He.defaultMaxIdle=60*60;He.defaultCheckCountMax=60*10;He.extension={type:R.RendererSystem,name:"textureGC"};D.add(He);var Js=class{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ht.UNSIGNED_BYTE,this.internalFormat=k.RGBA,this.samplerType=0}};function hx(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[ht.UNSIGNED_BYTE]:{[k.RGBA]:i.RGBA8,[k.RGB]:i.RGB8,[k.RG]:i.RG8,[k.RED]:i.R8,[k.RGBA_INTEGER]:i.RGBA8UI,[k.RGB_INTEGER]:i.RGB8UI,[k.RG_INTEGER]:i.RG8UI,[k.RED_INTEGER]:i.R8UI,[k.ALPHA]:i.ALPHA,[k.LUMINANCE]:i.LUMINANCE,[k.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ht.BYTE]:{[k.RGBA]:i.RGBA8_SNORM,[k.RGB]:i.RGB8_SNORM,[k.RG]:i.RG8_SNORM,[k.RED]:i.R8_SNORM,[k.RGBA_INTEGER]:i.RGBA8I,[k.RGB_INTEGER]:i.RGB8I,[k.RG_INTEGER]:i.RG8I,[k.RED_INTEGER]:i.R8I},[ht.UNSIGNED_SHORT]:{[k.RGBA_INTEGER]:i.RGBA16UI,[k.RGB_INTEGER]:i.RGB16UI,[k.RG_INTEGER]:i.RG16UI,[k.RED_INTEGER]:i.R16UI,[k.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[ht.SHORT]:{[k.RGBA_INTEGER]:i.RGBA16I,[k.RGB_INTEGER]:i.RGB16I,[k.RG_INTEGER]:i.RG16I,[k.RED_INTEGER]:i.R16I},[ht.UNSIGNED_INT]:{[k.RGBA_INTEGER]:i.RGBA32UI,[k.RGB_INTEGER]:i.RGB32UI,[k.RG_INTEGER]:i.RG32UI,[k.RED_INTEGER]:i.R32UI,[k.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[ht.INT]:{[k.RGBA_INTEGER]:i.RGBA32I,[k.RGB_INTEGER]:i.RGB32I,[k.RG_INTEGER]:i.RG32I,[k.RED_INTEGER]:i.R32I},[ht.FLOAT]:{[k.RGBA]:i.RGBA32F,[k.RGB]:i.RGB32F,[k.RG]:i.RG32F,[k.RED]:i.R32F,[k.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[ht.HALF_FLOAT]:{[k.RGBA]:i.RGBA16F,[k.RGB]:i.RGB16F,[k.RG]:i.RG16F,[k.RED]:i.R16F},[ht.UNSIGNED_SHORT_5_6_5]:{[k.RGB]:i.RGB565},[ht.UNSIGNED_SHORT_4_4_4_4]:{[k.RGBA]:i.RGBA4},[ht.UNSIGNED_SHORT_5_5_5_1]:{[k.RGBA]:i.RGB5_A1},[ht.UNSIGNED_INT_2_10_10_10_REV]:{[k.RGBA]:i.RGB10_A2,[k.RGBA_INTEGER]:i.RGB10_A2UI},[ht.UNSIGNED_INT_10F_11F_11F_REV]:{[k.RGB]:i.R11F_G11F_B10F},[ht.UNSIGNED_INT_5_9_9_9_REV]:{[k.RGB]:i.RGB9_E5},[ht.UNSIGNED_INT_24_8]:{[k.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[ht.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[k.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[ht.UNSIGNED_BYTE]:{[k.RGBA]:i.RGBA,[k.RGB]:i.RGB,[k.ALPHA]:i.ALPHA,[k.LUMINANCE]:i.LUMINANCE,[k.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ht.UNSIGNED_SHORT_5_6_5]:{[k.RGB]:i.RGB},[ht.UNSIGNED_SHORT_4_4_4_4]:{[k.RGBA]:i.RGBA},[ht.UNSIGNED_SHORT_5_5_5_1]:{[k.RGBA]:i.RGBA}},t}var Un=class{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ot,this.hasIntegerTextures=!1}contextChange(){let t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=hx(t);let e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};let r=new Js(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Js(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){let{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;let s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){let{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[s]=null)}ensureSamplerType(t){let{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let o=t-1;o>=0;--o){let n=e[o];n&&n._glTextures[s].samplerType!==Lu.FLOAT&&this.renderer.texture.unbind(n)}}initTexture(t){let e=new Js(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,this.webGLVersion===2&&t.type===ht.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){let e=t._glTextures[this.CONTEXT_UID];if(!e)return;let r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==Lu.FLOAT&&(this.hasIntegerTextures=!0);else{let s=t.realWidth,o=t.realHeight,n=r.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,n.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){let{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){let s=this.managedTextures.indexOf(t);s!==-1&&Vu(this.managedTextures,s,1)}}updateTextureStyle(t){let e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Mi.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=ph.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){let r=this.gl;if(e.mipmap&&t.mipmap!==Mi.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===ui.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===ui.LINEAR){let o=Math.min(t.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===ui.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===ui.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}};Un.extension={type:R.RendererSystem,name:"texture"};D.add(Un);var kn=class{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:r}=this,s=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){let{gl:r,renderer:s}=this;e&&s.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){let{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){let{gl:e,renderer:r,CONTEXT_UID:s}=this,o=e.createTransformFeedback();t._glTransformFeedbacks[s]=o,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,o);for(let n=0;n<t.buffers.length;n++){let a=t.buffers[n];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,n,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,e){let r=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);let o=this.renderer.buffer;if(o)for(let n=0;n<t.buffers.length;n++){let a=t.buffers[n];if(!a)continue;let h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&o.dispose(a,e))}r&&(e||s.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};kn.extension={type:R.RendererSystem,name:"transformFeedback"};D.add(kn);var Dr=class{constructor(t){this.renderer=t}init(t){this.screen=new nt(0,0,t.width,t.height),this.element=t.view||F.ADAPTER.createCanvas(),this.resolution=t.resolution||F.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);let r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}};Dr.defaultOptions={width:800,height:600,resolution:F.RESOLUTION,autoDensity:!1};Dr.extension={type:[R.RendererSystem,R.CanvasRendererSystem],name:"_view"};D.add(Dr);F.PREFER_ENV=Ze.WEBGL2;F.STRICT_TEXTURE_CACHE=!1;F.RENDER_OPTIONS={...Mr.defaultOptions,...Pr.defaultOptions,...Dr.defaultOptions,...Fr.defaultOptions};Object.defineProperties(F,{WRAP_MODE:{get(){return ot.defaultOptions.wrapMode},set(i){et("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ot.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return ot.defaultOptions.scaleMode},set(i){et("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ot.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return ot.defaultOptions.mipmap},set(i){et("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ot.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return ot.defaultOptions.anisotropicLevel},set(i){et("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ot.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return et("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),mi.defaultResolution},set(i){mi.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return et("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),mi.defaultMultisample},set(i){mi.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return Je.defaultMaxTextures},set(i){et("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Je.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return Je.defaultBatchSize},set(i){et("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Je.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return Je.canUploadSameBuffer},set(i){et("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Je.canUploadSameBuffer=i}},GC_MODE:{get(){return He.defaultMode},set(i){et("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),He.defaultMode=i}},GC_MAX_IDLE:{get(){return He.defaultMaxIdle},set(i){et("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),He.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return He.defaultCheckCountMax},set(i){et("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),He.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return Ge.defaultVertexPrecision},set(i){et("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Ge.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return Ge.defaultFragmentPrecision},set(i){et("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Ge.defaultFragmentPrecision=i}}});var to=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(to||{});var Gn=class{constructor(t,e=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));let e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let e=this.next;return this.next=t?null:e,this.previous=null,e}};var ti=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Gn(null,null,1/0),this.deltaMS=1/ti.targetFPMS,this.elapsedMS=1/ti.targetFPMS,this._tick=i=>{this._requestId=null,this.started&&(this.update(i),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(i,t,e=to.NORMAL){return this._addListener(new Gn(i,t,e))}addOnce(i,t,e=to.NORMAL){return this._addListener(new Gn(i,t,e,!0))}_addListener(i){let t=this._head.next,e=this._head;if(!t)i.connect(e);else{for(;t;){if(i.priority>t.priority){i.connect(e);break}e=t,t=t.next}i.previous||i.connect(e)}return this._startIfPossible(),this}remove(i,t){let e=this._head.next;for(;e;)e.match(i,t)?e=e.destroy():e=e.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let i=0,t=this._head;for(;t=t.next;)i++;return i}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let i=this._head.next;for(;i;)i=i.destroy(!0);this._head.destroy(),this._head=null}}update(i=performance.now()){let t;if(i>this.lastTime){if(t=this.elapsedMS=i-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){let s=i-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=i-s%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*ti.targetFPMS;let e=this._head,r=e.next;for(;r;)r=r.emit(this.deltaTime);e.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=i}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(i){let t=Math.min(this.maxFPS,i),e=Math.min(Math.max(0,t)/1e3,ti.targetFPMS);this._maxElapsedMS=1/e}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(i){if(i===0)this._minElapsedMS=0;else{let t=Math.max(this.minFPS,i);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!ti._shared){let i=ti._shared=new ti;i.autoStart=!0,i._protected=!0}return ti._shared}static get system(){if(!ti._system){let i=ti._system=new ti;i.autoStart=!0,i._protected=!0}return ti._system}},Rt=ti;Rt.targetFPMS=.06;Object.defineProperties(F,{TARGET_FPMS:{get(){return Rt.targetFPMS},set(i){et("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Rt.targetFPMS=i}}});var Hh=class{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,to.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Rt.shared:new Rt,t.autoStart&&this.start()}static destroy(){if(this._ticker){let t=this._ticker;this.ticker=null,t.destroy()}}};Hh.extension=R.Application;D.add(Hh);var Qv=[];D.handleByList(R.Renderer,Qv);var Vh=class{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){let r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{let r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=yt.HIGH?this.multisample=yt.HIGH:e>=yt.MEDIUM?this.multisample=yt.MEDIUM:e>=yt.LOW?this.multisample=yt.LOW:this.multisample=yt.NONE}destroy(){}};Vh.extension={type:R.RendererSystem,name:"_multisample"};D.add(Vh);var dc=class{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var Xh=class{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){let{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){let{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){let o=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,o.buffer)}}bindBufferRange(t,e,r){let{gl:s,CONTEXT_UID:o}=this;r=r||0;let n=t._glBuffers[o]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,n.buffer,r*256,256)}update(t){let{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{let o=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,o)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];let r=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),r&&(e||s.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){let e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){let{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new dc(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}};Xh.extension={type:R.RendererSystem,name:"buffer"};D.add(Xh);var Wh=class{constructor(t){this.renderer=t}render(t,e){let r=this.renderer,s,o,n,a;if(e&&(s=e.renderTexture,o=e.clear,n=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=n,!r.context.isLost){if(s||(this.lastObjectRendered=t),!a){let h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(o??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),s&&(e.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};Wh.extension={type:R.RendererSystem,name:"objectRenderer"};D.add(Wh);var Ff=class extends On{constructor(i){super(),this.type=sf.WEBGL,i=Object.assign({},F.RENDER_OPTIONS,i),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ae({projectionMatrix:new dt},!0);let t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ff.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in i&&(et("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),i.premultipliedAlpha=i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",i.backgroundAlpha=i.useContextAlpha===!1?1:i.backgroundAlpha),this._plugin.rendererPlugins=Ff.__plugins,this.options=i,this.startup.run(this.options)}static test(i){return i?.forceCanvas?!1:ku()}render(i,t){this.objectRenderer.render(i,t)}resize(i,t){this._view.resizeView(i,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(i=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:i}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(i){this._view.resolution=i,this.runners.resolutionChange.emit(i)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return et("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return et("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return et("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(i){et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=i}get backgroundAlpha(){return et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(i){et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=i}get powerPreference(){return et("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(i,t){return this.textureGenerator.generateTexture(i,t)}},eo=Ff;eo.extension={type:R.Renderer,priority:1};eo.__plugins={};eo.__systems={};D.handleByMap(R.RendererPlugin,eo.__plugins);D.handleByMap(R.RendererSystem,eo.__systems);D.add(eo);var us=class extends Qe{constructor(t,e){let{width:r,height:s}=e||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){let n=new ot;this.items.push(n),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Qe?this.addResourceAt(t[r],r):this.addResourceAt(yn(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;let e=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(e).then(()=>{let{realWidth:r,realHeight:s}=this.items[0];return this.resize(r,s),Promise.resolve(this)}),this._load}};var Hn=class extends us{constructor(t,e){let{width:r,height:s}=e||{},o,n;Array.isArray(t)?(o=t,n=t.length):n=t,super(n,{width:r,height:s}),o&&this.initFromArray(o,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Sr.TEXTURE_2D_ARRAY}upload(t,e,r){let{length:s,itemDirtyIds:o,items:n}=this,{gl:a}=t;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,e.format,r.type,null);for(let h=0;h<s;h++){let l=n[h];o[h]<l.dirtyId&&(o[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}};var Vn=class extends he{constructor(t){super(t)}static test(t){let{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}};var $h=class extends us{constructor(i,t){let{width:e,height:r,autoLoad:s,linkBaseTexture:o}=t||{};if(i&&i.length!==$h.SIDES)throw new Error(`Invalid length. Got ${i.length}, expected 6`);super(6,{width:e,height:r});for(let n=0;n<$h.SIDES;n++)this.items[n].target=Sr.TEXTURE_CUBE_MAP_POSITIVE_X+n;this.linkBaseTexture=o!==!1,i&&this.initFromArray(i,t),s!==!1&&this.load()}bind(i){super.bind(i),i.target=Sr.TEXTURE_CUBE_MAP}addBaseTextureAt(i,t,e){if(e===void 0&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=Sr.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.parentTextureArray=this.baseTexture,this.items[t]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[t]=i,this}upload(i,t,e){let r=this.itemDirtyIds;for(let s=0;s<$h.SIDES;s++){let o=this.items[s];(r[s]<o.dirtyId||e.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(i,o,e),r[s]=o.dirtyId):r[s]<-1&&(i.gl.texImage2D(o.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),r[s]=-1))}return!0}static test(i){return Array.isArray(i)&&i.length===$h.SIDES}},jh=$h;jh.SIDES=6;var Li=class extends he{constructor(t,e){e=e||{};let r,s;typeof t=="string"?(r=Li.EMPTY,s=t):(r=t,s=null),super(r),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{let r=await F.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=await r.blob();if(this.destroyed)return;let o=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ue.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=o,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Li._EMPTY=Li._EMPTY??F.ADAPTER.createCanvas(0,0),Li._EMPTY}};var fc=class extends he{constructor(i,t){t=t||{},super(F.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=i,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(i=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),i(this)},fc.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let i=new Image;he.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=t=>{this._resolve&&(i.onerror=null,this.onError.emit(t))},i.onload=()=>{if(!this._resolve)return;let t=i.width,e=i.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=t*this.scale,s=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/e*t,s=this._overrideHeight||this._overrideWidth/t*e),r=Math.round(r),s=Math.round(s);let o=this.source;o.width=r,o.height=s,o._pixiId=`canvas_${er()}`,o.getContext("2d").drawImage(i,0,0,t,e,0,0,r,s),this._resolve(),this._resolve=null}}static getSize(i){let t=fc.SVG_SIZE.exec(i),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(i,t){return t==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&fc.SVG_XML.test(i)}},Nr=fc;Nr.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Nr.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var Df=class extends he{constructor(i,t){if(t=t||{},!(i instanceof HTMLVideoElement)){let e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);let r=i[0].src||i[0];he.crossOrigin(e,r,t.crossorigin);for(let s=0;s<i.length;++s){let o=document.createElement("source"),{src:n,mime:a}=i[s];n=n||i[s];let h=n.split("?").shift().toLowerCase(),l=h.slice(h.lastIndexOf(".")+1);a=a||Df.MIME_TYPES[l]||`video/${l}`,o.src=n,o.type=a,e.appendChild(o)}i=e}super(i),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(i=0){if(!this.destroyed){let t=Rt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;let i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,i.load())}),this._load}_onError(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)}_isSourcePlaying(){let i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Rt.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Rt.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){let i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);let t=this.valid;this.resize(i.videoWidth,i.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()}dispose(){this._isConnectedToTicker&&(Rt.shared.remove(this.update,this),this._isConnectedToTicker=!1);let i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(Rt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Rt.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(i){i!==this._updateFPS&&(this._updateFPS=i)}static test(i,t){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||Df.TYPES.includes(t)}},Xn=Df;Xn.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];Xn.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};xn.push(Li,ls,Vn,Xn,Nr,ir,jh,Hn);var cs=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?nt.EMPTY:(t=t||new nt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){let{a:r,b:s,c:o,d:n,tx:a,ty:h}=t,l=r*e.x+o*e.y+a,u=s*e.x+n*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,s=this.maxX,o=this.maxY,n=t[0],a=t[1];e=n<e?n:e,r=a<r?a:r,s=n>s?n:s,o=a>o?a:o,n=t[2],a=t[3],e=n<e?n:e,r=a<r?a:r,s=n>s?n:s,o=a>o?a:o,n=t[4],a=t[5],e=n<e?n:e,r=a<r?a:r,s=n>s?n:s,o=a>o?a:o,n=t[6],a=t[7],e=n<e?n:e,r=a<r?a:r,s=n>s?n:s,o=a>o?a:o,this.minX=e,this.minY=r,this.maxX=s,this.maxY=o}addFrame(t,e,r,s,o){this.addFrameMatrix(t.worldTransform,e,r,s,o)}addFrameMatrix(t,e,r,s,o){let n=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty,d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=n*e+h*r+u,_=a*e+l*r+c;d=g<d?g:d,f=_<f?_:f,p=g>p?g:p,m=_>m?_:m,g=n*s+h*r+u,_=a*s+l*r+c,d=g<d?g:d,f=_<f?_:f,p=g>p?g:p,m=_>m?_:m,g=n*e+h*o+u,_=a*e+l*o+c,d=g<d?g:d,f=_<f?_:f,p=g>p?g:p,m=_>m?_:m,g=n*s+h*o+u,_=a*s+l*o+c,d=g<d?g:d,f=_<f?_:f,p=g>p?g:p,m=_>m?_:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,r){let s=this.minX,o=this.minY,n=this.maxX,a=this.maxY;for(let h=e;h<r;h+=2){let l=t[h],u=t[h+1];s=l<s?l:s,o=u<o?u:o,n=l>n?l:n,a=u>a?u:a}this.minX=s,this.minY=o,this.maxX=n,this.maxY=a}addVertices(t,e,r,s){this.addVerticesMatrix(t.worldTransform,e,r,s)}addVerticesMatrix(t,e,r,s,o=0,n=o){let a=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty,f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let _=r;_<s;_+=2){let v=e[_],x=e[_+1],y=a*v+l*x+c,P=u*x+h*v+d;f=Math.min(f,y-o),m=Math.max(m,y+o),p=Math.min(p,P-n),g=Math.max(g,P+n)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){let e=this.minX,r=this.minY,s=this.maxX,o=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,e){let r=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,o=t.maxX<e.maxX?t.maxX:e.maxX,n=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=o&&s<=n){let a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<h?s:h,this.maxX=o>l?o:l,this.maxY=n>u?n:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){let r=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,o=t.maxX<e.x+e.width?t.maxX:e.x+e.width,n=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=o&&s<=n){let a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<h?s:h,this.maxX=o>l?o:l,this.maxY=n>u?n:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,s,o,n){t-=o,e-=n,r+=o,s+=n,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}};var gi=class extends st.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new bn,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new cs,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){let e=Object.keys(t);for(let r=0;r<e.length;++r){let s=e[r];Object.defineProperty(gi.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new nt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new nt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new cs);let e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;let s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;let n=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-o,n}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,s){return e&&(t=e.toGlobal(t,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,s=1,o=0,n=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=s||1,this.rotation=o,this.skew.x=n,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new pc),this.tempDisplayObjectParent}enableTempParent(){let t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*bf}set angle(t){this.transform.rotation=t*Tf}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}},pc=class extends gi{constructor(){super(...arguments),this.sortDirty=null}};gi.prototype.displayObjectUpdateTransform=gi.prototype.updateTransform;var Jv=new dt;function tb(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}var Nf=class extends gi{constructor(){super(),this.children=[],this.sortableChildren=Nf.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(i){}addChild(...i){if(i.length>1)for(let t=0;t<i.length;t++)this.addChild(i[t]);else{let t=i[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return i[0]}addChildAt(i,t){if(t<0||t>this.children.length)throw new Error(`${i}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return i.parent&&i.parent.removeChild(i),i.parent=this,this.sortDirty=!0,i.transform._parentID=-1,this.children.splice(t,0,i),this._boundsID++,this.onChildrenChange(t),i.emit("added",this),this.emit("childAdded",i,this,t),i}swapChildren(i,t){if(i===t)return;let e=this.getChildIndex(i),r=this.getChildIndex(t);this.children[e]=t,this.children[r]=i,this.onChildrenChange(e<r?e:r)}getChildIndex(i){let t=this.children.indexOf(i);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(i,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);let e=this.getChildIndex(i);st.removeItems(this.children,e,1),this.children.splice(t,0,i),this.onChildrenChange(t)}getChildAt(i){if(i<0||i>=this.children.length)throw new Error(`getChildAt: Index (${i}) does not exist.`);return this.children[i]}removeChild(...i){if(i.length>1)for(let t=0;t<i.length;t++)this.removeChild(i[t]);else{let t=i[0],e=this.children.indexOf(t);if(e===-1)return null;t.parent=null,t.transform._parentID=-1,st.removeItems(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e)}return i[0]}removeChildAt(i){let t=this.getChildAt(i);return t.parent=null,t.transform._parentID=-1,st.removeItems(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i),t}removeChildren(i=0,t=this.children.length){let e=i,r=t,s=r-e,o;if(s>0&&s<=r){o=this.children.splice(e,s);for(let n=0;n<o.length;++n)o[n].parent=null,o[n].transform&&(o[n].transform._parentID=-1);this._boundsID++,this.onChildrenChange(i);for(let n=0;n<o.length;++n)o[n].emit("removed",this),this.emit("childRemoved",o[n],this,n);return o}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let i=!1;for(let t=0,e=this.children.length;t<e;++t){let r=this.children[t];r._lastSortedIndex=t,!i&&r.zIndex!==0&&(i=!0)}i&&this.children.length>1&&this.children.sort(tb),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let i=0,t=this.children.length;i<t;++i){let e=this.children[i];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let i=0;i<this.children.length;i++){let t=this.children[i];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){let e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(i,t=!1){let e=super.getLocalBounds(i);if(!t)for(let r=0,s=this.children.length;r<s;++r){let o=this.children[r];o.visible&&o.updateTransform()}return e}_calculateBounds(){}_renderWithCulling(i){let t=i.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let e,r;this.cullArea?(e=this.cullArea,r=this.worldTransform):this._render!==Nf.prototype._render&&(e=this.getBounds(!0));let s=i.projection.transform;if(s&&(r?(r=Jv.copyFrom(r),r.prepend(s)):r=s),e&&t.intersects(e,r))this._render(i);else if(this.cullArea)return;for(let o=0,n=this.children.length;o<n;++o){let a=this.children[o],h=a.cullable;a.cullable=h||!this.cullArea,a.render(i),a.cullable=h}}render(i){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(i);else if(this.cullable)this._renderWithCulling(i);else{this._render(i);for(let t=0,e=this.children.length;t<e;++t)this.children[t].render(i)}}renderAdvanced(i){let t=this.filters,e=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let s=0;s<t.length;s++)t[s].enabled&&this._enabledFilters.push(t[s])}let r=t&&this._enabledFilters?.length||e&&(!e.isMaskData||e.enabled&&(e.autoDetect||e.type!==Lt.NONE));if(r&&i.batch.flush(),t&&this._enabledFilters?.length&&i.filter.push(this,this._enabledFilters),e&&i.mask.push(this,this._mask),this.cullable)this._renderWithCulling(i);else{this._render(i);for(let s=0,o=this.children.length;s<o;++s)this.children[s].render(i)}r&&i.batch.flush(),e&&i.mask.pop(this),t&&this._enabledFilters?.length&&i.filter.pop()}_render(i){}destroy(i){super.destroy(),this.sortDirty=!1;let t=typeof i=="boolean"?i:i?.children,e=this.removeChildren(0,this.children.length);if(t)for(let r=0;r<e.length;++r)e[r].destroy(i)}get width(){return this.scale.x*this.getLocalBounds().width}set width(i){let t=this.getLocalBounds().width;t!==0?this.scale.x=i/t:this.scale.x=1,this._width=i}get height(){return this.scale.y*this.getLocalBounds().height}set height(i){let t=this.getLocalBounds().height;t!==0?this.scale.y=i/t:this.scale.y=1,this._height=i}},Oi=Nf;Oi.defaultSortableChildren=!1;Oi.prototype.containerUpdateTransform=Oi.prototype.updateTransform;Object.defineProperties(F,{SORTABLE_CHILDREN:{get(){return Oi.defaultSortableChildren},set(i){st.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Oi.defaultSortableChildren=i}}});var zh=new ct,eb=new Uint16Array([0,1,2,0,2,3]),io=class extends Oi{constructor(t){super(),this._anchor=new pi(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Nt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=K.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||it.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=eb,this.pluginName="batch",this.isSprite=!0,this._roundPixels=F.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=st.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=st.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;let e=this.transform.worldTransform,r=e.a,s=e.b,o=e.c,n=e.d,a=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,d=this._anchor,f=0,p=0,m=0,g=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,g=u.y-d._y*c.height,m=g+u.height):(p=-d._x*c.width,f=p+c.width,g=-d._y*c.height,m=g+c.height),l[0]=r*p+o*g+a,l[1]=n*g+s*p+h,l[2]=r*f+o*g+a,l[3]=n*g+s*f+h,l[4]=r*f+o*m+a,l[5]=n*m+s*f+h,l[6]=r*p+o*m+a,l[7]=n*m+s*p+h,this._roundPixels){let _=F.RESOLUTION;for(let v=0;v<l.length;++v)l[v]=Math.round(l[v]*_)/_}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let t=this._texture,e=this.vertexTrimmedData,r=t.orig,s=this._anchor,o=this.transform.worldTransform,n=o.a,a=o.b,h=o.c,l=o.d,u=o.tx,c=o.ty,d=-s._x*r.width,f=d+r.width,p=-s._y*r.height,m=p+r.height;e[0]=n*d+h*p+u,e[1]=l*p+a*d+c,e[2]=n*f+h*p+u,e[3]=l*p+a*f+c,e[4]=n*f+h*m+u,e[5]=l*m+a*f+c,e[6]=n*d+h*m+u,e[7]=l*m+a*d+c}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){let t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new cs),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new nt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,zh);let e=this._texture.orig.width,r=this._texture.orig.height,s=-e*this.anchor.x,o=0;return zh.x>=s&&zh.x<s+e&&(o=-r*this.anchor.y,zh.y>=o&&zh.y<o+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){let r=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(t,e){let r=t instanceof it?t:it.from(t,e);return new io(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){let e=st.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){let e=st.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||it.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}};/*!
 * @pixi/particle-emitter - v5.0.8
 * Compiled Mon, 28 Nov 2022 04:01:38 UTC
 *
 * @pixi/particle-emitter is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Ie=class{constructor(t,e,r){this.value=t,this.time=e,this.next=null,this.isStepped=!1,r?this.ease=typeof r=="function"?r:Gf(r):this.ease=null}static createList(t){if("list"in t){let r=t.list,s,{value:o,time:n}=r[0],a=s=new Ie(typeof o=="string"?ds(o):o,n,t.ease);if(r.length>2||r.length===2&&r[1].value!==o)for(let h=1;h<r.length;++h){let{value:l,time:u}=r[h];s.next=new Ie(typeof l=="string"?ds(l):l,u),s=s.next}return a.isStepped=!!t.isStepped,a}let e=new Ie(typeof t.start=="string"?ds(t.start):t.start,0);return t.end!==t.start&&(e.next=new Ie(typeof t.end=="string"?ds(t.end):t.end,1)),e}},jn=it.from,ib=!1,Ui=Math.PI/180;function sr(i,t){if(!i)return;let e=Math.sin(i),r=Math.cos(i),s=t.x*r-t.y*e,o=t.x*e+t.y*r;t.x=s,t.y=o}function Yh(i,t,e){return i<<16|t<<8|e}function Uf(i){return Math.sqrt(i.x*i.x+i.y*i.y)}function lx(i){let t=1/Uf(i);i.x*=t,i.y*=t}function kf(i,t){i.x*=t,i.y*=t}function ds(i,t){t||(t={}),i.charAt(0)==="#"?i=i.substr(1):i.indexOf("0x")===0&&(i=i.substr(2));let e;return i.length===8&&(e=i.substr(0,2),i=i.substr(2)),t.r=parseInt(i.substr(0,2),16),t.g=parseInt(i.substr(2,2),16),t.b=parseInt(i.substr(4,2),16),e&&(t.a=parseInt(e,16)),t}function Gf(i){let t=i.length,e=1/t;return function(r){let s=t*r|0,o=(r-s*e)*t,n=i[s]||i[t-1];return n.s+o*(2*(1-o)*(n.cp-n.s)+o*(n.e-n.s))}}function ux(i){return i?(i=i.toUpperCase().replace(/ /g,"_"),K[i]||K.NORMAL):K.NORMAL}function rb(i,t=10){(typeof t!="number"||t<=0)&&(t=10);let e=new Ie(ds(i[0].value),i[0].time);e.isStepped=!0;let r=e,s=i[0],o=1,n=i[o];for(let a=1;a<t;++a){let h=a/t;for(;h>n.time;)s=n,n=i[++o];h=(h-s.time)/(n.time-s.time);let l=ds(s.value),u=ds(n.value),c={r:(u.r-l.r)*h+l.r,g:(u.g-l.g)*h+l.g,b:(u.b-l.b)*h+l.b};r.next=new Ie(c,a/t),r=r.next}return e}var sb={__proto__:null,GetTextureFromString:jn,verbose:ib,DEG_TO_RADS:Ui,rotatePoint:sr,combineRGBComponents:Yh,length:Uf,normalize:lx,scaleBy:kf,hexToRGB:ds,generateEase:Gf,getBlendMode:ux,createSteppedGradient:rb},$n=class extends io{constructor(t){super(),this.prevChild=this.nextChild=null,this.emitter=t,this.config={},this.anchor.x=this.anchor.y=.5,this.maxLife=0,this.age=0,this.agePercent=0,this.oneOverLife=0,this.next=null,this.prev=null,this.init=this.init,this.kill=this.kill}init(t){this.maxLife=t,this.age=this.agePercent=0,this.rotation=0,this.position.x=this.position.y=0,this.scale.x=this.scale.y=1,this.tint=16777215,this.alpha=1,this.oneOverLife=1/this.maxLife,this.visible=!0}kill(){this.emitter.recycle(this)}destroy(){this.parent&&this.parent.removeChild(this),this.emitter=this.next=this.prev=null,super.destroy()}},Tt;(function(i){i[i.Spawn=0]="Spawn",i[i.Normal=2]="Normal",i[i.Late=5]="Late"})(Tt||(Tt={}));var Lf=Rt.shared,ro=Symbol("Position particle per emitter position"),pt=class{constructor(t,e){this.initBehaviors=[],this.updateBehaviors=[],this.recycleBehaviors=[],this.minLifetime=0,this.maxLifetime=0,this.customEase=null,this._frequency=1,this.spawnChance=1,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=new ct,this.particlesPerWave=1,this.rotation=0,this.ownerPos=new ct,this._prevEmitterPos=new ct,this._prevPosIsValid=!1,this._posChanged=!1,this._parent=null,this.addAtBack=!1,this.particleCount=0,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticlesFirst=null,this._activeParticlesLast=null,this._poolFirst=null,this._origConfig=null,this._autoUpdate=!1,this._destroyWhenComplete=!1,this._completeCallback=null,this.parent=t,e&&this.init(e),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos}static registerBehavior(t){pt.knownBehaviors[t.type]=t}get frequency(){return this._frequency}set frequency(t){typeof t=="number"&&t>0?this._frequency=t:this._frequency=1}get parent(){return this._parent}set parent(t){this.cleanup(),this._parent=t}init(t){if(!t)return;this.cleanup(),this._origConfig=t,this.minLifetime=t.lifetime.min,this.maxLifetime=t.lifetime.max,t.ease?this.customEase=typeof t.ease=="function"?t.ease:Gf(t.ease):this.customEase=null,this.particlesPerWave=1,t.particlesPerWave&&t.particlesPerWave>1&&(this.particlesPerWave=t.particlesPerWave),this.frequency=t.frequency,this.spawnChance=typeof t.spawnChance=="number"&&t.spawnChance>0?t.spawnChance:1,this.emitterLifetime=t.emitterLifetime||-1,this.maxParticles=t.maxParticles>0?t.maxParticles:1e3,this.addAtBack=!!t.addAtBack,this.rotation=0,this.ownerPos.set(0),t.pos?this.spawnPos.copyFrom(t.pos):this.spawnPos.set(0),this._prevEmitterPos.copyFrom(this.spawnPos),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=t.emit===void 0?!0:!!t.emit,this.autoUpdate=!!t.autoUpdate;let e=t.behaviors.map(r=>{let s=pt.knownBehaviors[r.type];return s?new s(r.config):(console.error(`Unknown behavior: ${r.type}`),null)}).filter(r=>!!r);e.push(ro),e.sort((r,s)=>r===ro?s.order===Tt.Spawn?1:-1:s===ro?r.order===Tt.Spawn?-1:1:r.order-s.order),this.initBehaviors=e.slice(),this.updateBehaviors=e.filter(r=>r!==ro&&r.updateParticle),this.recycleBehaviors=e.filter(r=>r!==ro&&r.recycleParticle)}getBehavior(t){return pt.knownBehaviors[t]&&this.initBehaviors.find(e=>e instanceof pt.knownBehaviors[t])||null}fillPool(t){for(;t>0;--t){let e=new $n(this);e.next=this._poolFirst,this._poolFirst=e}}recycle(t,e=!1){for(let r=0;r<this.recycleBehaviors.length;++r)this.recycleBehaviors[r].recycleParticle(t,!e);t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t===this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t===this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),t.prev=null,t.next=this._poolFirst,this._poolFirst=t,t.parent&&t.parent.removeChild(t),--this.particleCount}rotate(t){if(this.rotation===t)return;let e=t-this.rotation;this.rotation=t,sr(e,this.spawnPos),this._posChanged=!0}updateSpawnPos(t,e){this._posChanged=!0,this.spawnPos.x=t,this.spawnPos.y=e}updateOwnerPos(t,e){this._posChanged=!0,this.ownerPos.x=t,this.ownerPos.y=e}resetPositionTracking(){this._prevPosIsValid=!1}get emit(){return this._emit}set emit(t){this._emit=!!t,this._emitterLife=this.emitterLifetime}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this._autoUpdate&&!t?Lf.remove(this.update,this):!this._autoUpdate&&t&&Lf.add(this.update,this),this._autoUpdate=!!t}playOnceAndDestroy(t){this.autoUpdate=!0,this.emit=!0,this._destroyWhenComplete=!0,this._completeCallback=t}playOnce(t){this.emit=!0,this._completeCallback=t}update(t){if(this._autoUpdate&&(t=Lf.elapsedMS*.001),!this._parent)return;for(let n=this._activeParticlesFirst,a;n;n=a)if(a=n.next,n.age+=t,n.age>n.maxLife||n.age<0)this.recycle(n);else{let h=n.age*n.oneOverLife;this.customEase&&(this.customEase.length===4?h=this.customEase(h,0,1,1):h=this.customEase(h)),n.agePercent=h;for(let l=0;l<this.updateBehaviors.length;++l)if(this.updateBehaviors[l].updateParticle(n,t)){this.recycle(n);break}}let e,r;this._prevPosIsValid&&(e=this._prevEmitterPos.x,r=this._prevEmitterPos.y);let s=this.ownerPos.x+this.spawnPos.x,o=this.ownerPos.y+this.spawnPos.y;if(this._emit)for(this._spawnTimer-=t<0?0:t;this._spawnTimer<=0;){if(this._emitterLife>=0&&(this._emitterLife-=this._frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this.particleCount>=this.maxParticles){this._spawnTimer+=this._frequency;continue}let n,a;if(this._prevPosIsValid&&this._posChanged){let u=1+this._spawnTimer/t;n=(s-e)*u+e,a=(o-r)*u+r}else n=s,a=o;let h=null,l=null;for(let u=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),c=0;c<u;++c){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let d;if(this.minLifetime===this.maxLifetime?d=this.minLifetime:d=Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer>=d)continue;let f;this._poolFirst?(f=this._poolFirst,this._poolFirst=this._poolFirst.next,f.next=null):f=new $n(this),f.init(d),this.addAtBack?this._parent.addChildAt(f,0):this._parent.addChild(f),h?(l.next=f,f.prev=l,l=f):l=h=f,++this.particleCount}if(h){this._activeParticlesLast?(this._activeParticlesLast.next=h,h.prev=this._activeParticlesLast,this._activeParticlesLast=l):(this._activeParticlesFirst=h,this._activeParticlesLast=l);for(let u=0;u<this.initBehaviors.length;++u){let c=this.initBehaviors[u];if(c===ro)for(let d=h,f;d;d=f){f=d.next,this.rotation!==0&&(sr(this.rotation,d.position),d.rotation+=this.rotation),d.position.x+=n,d.position.y+=a,d.age+=-this._spawnTimer;let p=d.age*d.oneOverLife;this.customEase&&(this.customEase.length===4?p=this.customEase(p,0,1,1):p=this.customEase(p)),d.agePercent=p}else c.initParticles(h)}for(let u=h,c;u;u=c){c=u.next;for(let d=0;d<this.updateBehaviors.length;++d)if(this.updateBehaviors[d].updateParticle(u,-this._spawnTimer)){this.recycle(u);break}}}this._spawnTimer+=this._frequency}if(this._posChanged&&(this._prevEmitterPos.x=s,this._prevEmitterPos.y=o,this._prevPosIsValid=!0,this._posChanged=!1),!this._emit&&!this._activeParticlesFirst){if(this._completeCallback){let n=this._completeCallback;this._completeCallback=null,n()}this._destroyWhenComplete&&this.destroy()}}emitNow(){let t=this.ownerPos.x+this.spawnPos.x,e=this.ownerPos.y+this.spawnPos.y,r=null,s=null;for(let o=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),n=0;n<o;++n){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let a;this._poolFirst?(a=this._poolFirst,this._poolFirst=this._poolFirst.next,a.next=null):a=new $n(this);let h;this.minLifetime===this.maxLifetime?h=this.minLifetime:h=Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,a.init(h),this.addAtBack?this._parent.addChildAt(a,0):this._parent.addChild(a),r?(s.next=a,a.prev=s,s=a):s=r=a,++this.particleCount}if(r){this._activeParticlesLast?(this._activeParticlesLast.next=r,r.prev=this._activeParticlesLast,this._activeParticlesLast=s):(this._activeParticlesFirst=r,this._activeParticlesLast=s);for(let o=0;o<this.initBehaviors.length;++o){let n=this.initBehaviors[o];if(n===ro)for(let a=r,h;a;a=h)h=a.next,this.rotation!==0&&(sr(this.rotation,a.position),a.rotation+=this.rotation),a.position.x+=t,a.position.y+=e;else n.initParticles(r)}}}cleanup(){let t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t,!0);this._activeParticlesFirst=this._activeParticlesLast=null,this.particleCount=0}get destroyed(){return!(this._parent&&this.initBehaviors.length)}destroy(){this.autoUpdate=!1,this.cleanup();let t;for(let e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=this._parent=this.spawnPos=this.ownerPos=this.customEase=this._completeCallback=null,this.initBehaviors.length=this.updateBehaviors.length=this.recycleBehaviors.length=0}};pt.knownBehaviors={};var zn=class{constructor(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h}getRandPos(t){t.x=Math.random()*this.w+this.x,t.y=Math.random()*this.h+this.y}};zn.type="rect";zn.editorConfig=null;var so=class{constructor(t){this.x=t.x||0,this.y=t.y||0,this.radius=t.radius,this.innerRadius=t.innerRadius||0,this.rotation=!!t.affectRotation}getRandPos(t){this.innerRadius!==this.radius?t.x=Math.random()*(this.radius-this.innerRadius)+this.innerRadius:t.x=this.radius,t.y=0;let e=Math.random()*Math.PI*2;this.rotation&&(t.rotation+=e),sr(e,t.position),t.position.x+=this.x,t.position.y+=this.y}};so.type="torus";so.editorConfig=null;var Yn=class{constructor(t){this.segments=[],this.countingLengths=[],this.totalLength=0,this.init(t)}init(t){if(!t||!t.length)this.segments.push({p1:{x:0,y:0},p2:{x:0,y:0},l:0});else if(Array.isArray(t[0]))for(let e=0;e<t.length;++e){let r=t[e],s=r[0];for(let o=1;o<r.length;++o){let n=r[o];this.segments.push({p1:s,p2:n,l:0}),s=n}}else{let e=t[0];for(let r=1;r<t.length;++r){let s=t[r];this.segments.push({p1:e,p2:s,l:0}),e=s}}for(let e=0;e<this.segments.length;++e){let{p1:r,p2:s}=this.segments[e],o=Math.sqrt((s.x-r.x)*(s.x-r.x)+(s.y-r.y)*(s.y-r.y));this.segments[e].l=o,this.totalLength+=o,this.countingLengths.push(this.totalLength)}}getRandPos(t){let e=Math.random()*this.totalLength,r,s;if(this.segments.length===1)r=this.segments[0],s=e;else for(let a=0;a<this.countingLengths.length;++a)if(e<this.countingLengths[a]){r=this.segments[a],s=a===0?e:e-this.countingLengths[a-1];break}s/=r.l||1;let{p1:o,p2:n}=r;t.x=o.x+s*(n.x-o.x),t.y=o.y+s*(n.y-o.y)}};Yn.type="polygonalChain";Yn.editorConfig=null;var ob={__proto__:null,Rectangle:zn,Torus:so,PolygonalChain:Yn},nb={__proto__:null},qn=class{constructor(t){var e;this.order=Tt.Late,this.minStart=t.minStart,this.maxStart=t.maxStart,this.accel=t.accel,this.rotate=!!t.rotate,this.maxSpeed=(e=t.maxSpeed)!==null&&e!==void 0?e:0}initParticles(t){let e=t;for(;e;){let r=Math.random()*(this.maxStart-this.minStart)+this.minStart;e.config.velocity?e.config.velocity.set(r,0):e.config.velocity=new ct(r,0),sr(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){let r=t.config.velocity,s=r.x,o=r.y;if(r.x+=this.accel.x*e,r.y+=this.accel.y*e,this.maxSpeed){let n=Uf(r);n>this.maxSpeed&&kf(r,this.maxSpeed/n)}t.x+=(s+r.x)/2*e,t.y+=(o+r.y)/2*e,this.rotate&&(t.rotation=Math.atan2(r.y,r.x))}};qn.type="moveAcceleration";qn.editorConfig=null;function ab(i){return this.ease&&(i=this.ease(i)),(this.first.next.value-this.first.value)*i+this.first.value}function hb(i){this.ease&&(i=this.ease(i));let t=this.first.value,e=this.first.next.value,r=(e.r-t.r)*i+t.r,s=(e.g-t.g)*i+t.g,o=(e.b-t.b)*i+t.b;return Yh(r,s,o)}function lb(i){this.ease&&(i=this.ease(i));let t=this.first,e=t.next;for(;i>e.time;)t=e,e=e.next;return i=(i-t.time)/(e.time-t.time),(e.value-t.value)*i+t.value}function ub(i){this.ease&&(i=this.ease(i));let t=this.first,e=t.next;for(;i>e.time;)t=e,e=e.next;i=(i-t.time)/(e.time-t.time);let r=t.value,s=e.value,o=(s.r-r.r)*i+r.r,n=(s.g-r.g)*i+r.g,a=(s.b-r.b)*i+r.b;return Yh(o,n,a)}function cb(i){this.ease&&(i=this.ease(i));let t=this.first;for(;t.next&&i>t.next.time;)t=t.next;return t.value}function db(i){this.ease&&(i=this.ease(i));let t=this.first;for(;t.next&&i>t.next.time;)t=t.next;let e=t.value;return Yh(e.r,e.g,e.b)}var fs=class{constructor(t=!1){this.first=null,this.isColor=!!t,this.interpolate=null,this.ease=null}reset(t){this.first=t,t.next&&t.next.time>=1?this.interpolate=this.isColor?hb:ab:t.isStepped?this.interpolate=this.isColor?db:cb:this.interpolate=this.isColor?ub:lb,this.ease=this.first.ease}},Kn=class{constructor(t){this.order=Tt.Normal,this.list=new fs(!1),this.list.reset(Ie.createList(t.alpha))}initParticles(t){let e=t;for(;e;)e.alpha=this.list.first.value,e=e.next}updateParticle(t){t.alpha=this.list.interpolate(t.agePercent)}};Kn.type="alpha";Kn.editorConfig=null;var Zn=class{constructor(t){this.order=Tt.Normal,this.value=t.alpha}initParticles(t){let e=t;for(;e;)e.alpha=this.value,e=e.next}};Zn.type="alphaStatic";Zn.editorConfig=null;function cx(i){let t=[];for(let e=0;e<i.length;++e){let r=i[e];if(typeof r=="string")t.push(jn(r));else if(r instanceof it)t.push(r);else{let s=r.count||1;for(typeof r.texture=="string"?r=jn(r.texture):r=r.texture;s>0;--s)t.push(r)}}return t}var Qn=class{constructor(t){this.order=Tt.Normal,this.anims=[];for(let e=0;e<t.anims.length;++e){let r=t.anims[e],s=cx(r.textures),o=r.framerate<0?-1:r.framerate>0?r.framerate:60,n={textures:s,duration:o>0?s.length/o:0,framerate:o,loop:o>0?!!r.loop:!1};this.anims.push(n)}}initParticles(t){let e=t;for(;e;){let r=Math.floor(Math.random()*this.anims.length),s=e.config.anim=this.anims[r];e.texture=s.textures[0],e.config.animElapsed=0,s.framerate===-1?(e.config.animDuration=e.maxLife,e.config.animFramerate=s.textures.length/e.maxLife):(e.config.animDuration=s.duration,e.config.animFramerate=s.framerate),e=e.next}}updateParticle(t,e){let r=t.config,s=r.anim;r.animElapsed+=e,r.animElapsed>=r.animDuration&&(r.anim.loop?r.animElapsed=r.animElapsed%r.animDuration:r.animElapsed=r.animDuration-1e-6);let o=r.animElapsed*r.animFramerate+1e-7|0;t.texture=s.textures[o]||s.textures[s.textures.length-1]||it.EMPTY}};Qn.type="animatedRandom";Qn.editorConfig=null;var Jn=class{constructor(t){this.order=Tt.Normal;let e=t.anim,r=cx(e.textures),s=e.framerate<0?-1:e.framerate>0?e.framerate:60;this.anim={textures:r,duration:s>0?r.length/s:0,framerate:s,loop:s>0?!!e.loop:!1}}initParticles(t){let e=t,r=this.anim;for(;e;)e.texture=r.textures[0],e.config.animElapsed=0,r.framerate===-1?(e.config.animDuration=e.maxLife,e.config.animFramerate=r.textures.length/e.maxLife):(e.config.animDuration=r.duration,e.config.animFramerate=r.framerate),e=e.next}updateParticle(t,e){let r=this.anim,s=t.config;s.animElapsed+=e,s.animElapsed>=s.animDuration&&(r.loop?s.animElapsed=s.animElapsed%s.animDuration:s.animElapsed=s.animDuration-1e-6);let o=s.animElapsed*s.animFramerate+1e-7|0;t.texture=r.textures[o]||r.textures[r.textures.length-1]||it.EMPTY}};Jn.type="animatedSingle";Jn.editorConfig=null;var ta=class{constructor(t){this.order=Tt.Normal,this.value=t.blendMode}initParticles(t){let e=t;for(;e;)e.blendMode=ux(this.value),e=e.next}};ta.type="blendMode";ta.editorConfig=null;var ea=class{constructor(t){this.order=Tt.Spawn,this.spacing=t.spacing*Ui,this.start=t.start*Ui,this.distance=t.distance}initParticles(t){let e=0,r=t;for(;r;){let s;this.spacing?s=this.start+this.spacing*e:s=Math.random()*Math.PI*2,r.rotation=s,this.distance&&(r.position.x=this.distance,sr(s,r.position)),r=r.next,++e}}};ea.type="spawnBurst";ea.editorConfig=null;var ia=class{constructor(t){this.order=Tt.Normal,this.list=new fs(!0),this.list.reset(Ie.createList(t.color))}initParticles(t){let e=t,r=this.list.first.value,s=Yh(r.r,r.g,r.b);for(;e;)e.tint=s,e=e.next}updateParticle(t){t.tint=this.list.interpolate(t.agePercent)}};ia.type="color";ia.editorConfig=null;var ra=class{constructor(t){this.order=Tt.Normal;let e=t.color;e.charAt(0)==="#"?e=e.substr(1):e.indexOf("0x")===0&&(e=e.substr(2)),this.value=parseInt(e,16)}initParticles(t){let e=t;for(;e;)e.tint=this.value,e=e.next}};ra.type="colorStatic";ra.editorConfig=null;var sa=class{constructor(t){this.order=Tt.Normal,this.index=0,this.textures=t.textures.map(e=>typeof e=="string"?jn(e):e)}initParticles(t){let e=t;for(;e;)e.texture=this.textures[this.index],++this.index>=this.textures.length&&(this.index=0),e=e.next}};sa.type="textureOrdered";sa.editorConfig=null;var Wn=new ct,dx=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","abs","acos","acosh","asin","asinh","atan","atanh","atan2","cbrt","ceil","cos","cosh","exp","expm1","floor","fround","hypot","log","log1p","log10","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh"],fb=new RegExp(["[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]"].concat(dx).join("|"),"g");function pb(i){let t=i.match(fb);for(let e=t.length-1;e>=0;--e)dx.indexOf(t[e])>=0&&(t[e]=`Math.${t[e]}`);return i=t.join(""),new Function("x",`return ${i};`)}var oa=class{constructor(t){var e;if(this.order=Tt.Late,t.path)if(typeof t.path=="function")this.path=t.path;else try{this.path=pb(t.path)}catch{this.path=null}else this.path=r=>r;this.list=new fs(!1),this.list.reset(Ie.createList(t.speed)),this.minMult=(e=t.minMult)!==null&&e!==void 0?e:1}initParticles(t){let e=t;for(;e;){e.config.initRotation=e.rotation,e.config.initPosition?e.config.initPosition.copyFrom(e.position):e.config.initPosition=new ct(e.x,e.y),e.config.movement=0;let r=Math.random()*(1-this.minMult)+this.minMult;e.config.speedMult=r,e=e.next}}updateParticle(t,e){let r=this.list.interpolate(t.agePercent)*t.config.speedMult;t.config.movement+=r*e,Wn.x=t.config.movement,Wn.y=this.path(Wn.x),sr(t.config.initRotation,Wn),t.position.x=t.config.initPosition.x+Wn.x,t.position.y=t.config.initPosition.y+Wn.y}};oa.type="movePath";oa.editorConfig=null;var na=class{constructor(){this.order=Tt.Spawn}initParticles(t){}};na.type="spawnPoint";na.editorConfig=null;var aa=class{constructor(t){this.order=Tt.Normal,this.textures=t.textures.map(e=>typeof e=="string"?jn(e):e)}initParticles(t){let e=t;for(;e;){let r=Math.floor(Math.random()*this.textures.length);e.texture=this.textures[r],e=e.next}}};aa.type="textureRandom";aa.editorConfig=null;var ha=class{constructor(t){this.order=Tt.Normal,this.minStart=t.minStart*Ui,this.maxStart=t.maxStart*Ui,this.minSpeed=t.minSpeed*Ui,this.maxSpeed=t.maxSpeed*Ui,this.accel=t.accel*Ui}initParticles(t){let e=t;for(;e;)this.minStart===this.maxStart?e.rotation+=this.maxStart:e.rotation+=Math.random()*(this.maxStart-this.minStart)+this.minStart,e.config.rotSpeed=Math.random()*(this.maxSpeed-this.minSpeed)+this.minSpeed,e=e.next}updateParticle(t,e){if(this.accel){let r=t.config.rotSpeed;t.config.rotSpeed+=this.accel*e,t.rotation+=(t.config.rotSpeed+r)/2*e}else t.rotation+=t.config.rotSpeed*e}};ha.type="rotation";ha.editorConfig=null;var la=class{constructor(t){this.order=Tt.Normal,this.min=t.min*Ui,this.max=t.max*Ui}initParticles(t){let e=t;for(;e;)this.min===this.max?e.rotation+=this.max:e.rotation+=Math.random()*(this.max-this.min)+this.min,e=e.next}};la.type="rotationStatic";la.editorConfig=null;var ua=class{constructor(t){this.order=Tt.Late+1,this.rotation=(t.rotation||0)*Ui}initParticles(t){let e=t;for(;e;)e.rotation=this.rotation,e=e.next}};ua.type="noRotation";ua.editorConfig=null;var ca=class{constructor(t){var e;this.order=Tt.Normal,this.list=new fs(!1),this.list.reset(Ie.createList(t.scale)),this.minMult=(e=t.minMult)!==null&&e!==void 0?e:1}initParticles(t){let e=t;for(;e;){let r=Math.random()*(1-this.minMult)+this.minMult;e.config.scaleMult=r,e.scale.x=e.scale.y=this.list.first.value*r,e=e.next}}updateParticle(t){t.scale.x=t.scale.y=this.list.interpolate(t.agePercent)*t.config.scaleMult}};ca.type="scale";ca.editorConfig=null;var da=class{constructor(t){this.order=Tt.Normal,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){let r=Math.random()*(this.max-this.min)+this.min;e.scale.x=e.scale.y=r,e=e.next}}};da.type="scaleStatic";da.editorConfig=null;var Ve=class{constructor(t){this.order=Tt.Spawn;let e=Ve.shapes[t.type];if(!e)throw new Error(`No shape found with type '${t.type}'`);this.shape=new e(t.data)}static registerShape(t,e){Ve.shapes[e||t.type]=t}initParticles(t){let e=t;for(;e;)this.shape.getRandPos(e),e=e.next}};Ve.type="spawnShape";Ve.editorConfig=null;Ve.shapes={};Ve.registerShape(Yn);Ve.registerShape(zn);Ve.registerShape(so);Ve.registerShape(so,"circle");var fa=class{constructor(t){this.order=Tt.Normal,this.texture=typeof t.texture=="string"?jn(t.texture):t.texture}initParticles(t){let e=t;for(;e;)e.texture=this.texture,e=e.next}};fa.type="textureSingle";fa.editorConfig=null;var pa=class{constructor(t){var e;this.order=Tt.Late,this.list=new fs(!1),this.list.reset(Ie.createList(t.speed)),this.minMult=(e=t.minMult)!==null&&e!==void 0?e:1}initParticles(t){let e=t;for(;e;){let r=Math.random()*(1-this.minMult)+this.minMult;e.config.speedMult=r,e.config.velocity?e.config.velocity.set(this.list.first.value*r,0):e.config.velocity=new ct(this.list.first.value*r,0),sr(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){let r=this.list.interpolate(t.agePercent)*t.config.speedMult,s=t.config.velocity;lx(s),kf(s,r),t.x+=s.x*e,t.y+=s.y*e}};pa.type="moveSpeed";pa.editorConfig=null;var ma=class{constructor(t){this.order=Tt.Late,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){let r=Math.random()*(this.max-this.min)+this.min;e.config.velocity?e.config.velocity.set(r,0):e.config.velocity=new ct(r,0),sr(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){let r=t.config.velocity;t.x+=r.x*e,t.y+=r.y*e}};ma.type="moveSpeedStatic";ma.editorConfig=null;var mb={__proto__:null,spawnShapes:ob,editor:nb,get BehaviorOrder(){return Tt},AccelerationBehavior:qn,AlphaBehavior:Kn,StaticAlphaBehavior:Zn,RandomAnimatedTextureBehavior:Qn,SingleAnimatedTextureBehavior:Jn,BlendModeBehavior:ta,BurstSpawnBehavior:ea,ColorBehavior:ia,StaticColorBehavior:ra,OrderedTextureBehavior:sa,PathBehavior:oa,PointSpawnBehavior:na,RandomTextureBehavior:aa,RotationBehavior:ha,StaticRotationBehavior:la,NoRotationBehavior:ua,ScaleBehavior:ca,StaticScaleBehavior:da,ShapeSpawnBehavior:Ve,SingleTextureBehavior:fa,SpeedBehavior:pa,StaticSpeedBehavior:ma};function gb(i,t){var e,r,s,o,n,a,h,l,u,c,d,f,p,m,g,_,v,x,y,P,H;if("behaviors"in i)return i;let E={lifetime:i.lifetime,ease:i.ease,particlesPerWave:i.particlesPerWave,frequency:i.frequency,spawnChance:i.spawnChance,emitterLifetime:i.emitterLifetime,maxParticles:i.maxParticles,addAtBack:i.addAtBack,pos:i.pos,emit:i.emit,autoUpdate:i.autoUpdate,behaviors:[]};if(i.alpha)if("start"in i.alpha)if(i.alpha.start===i.alpha.end)i.alpha.start!==1&&E.behaviors.push({type:"alphaStatic",config:{alpha:i.alpha.start}});else{let w={list:[{time:0,value:i.alpha.start},{time:1,value:i.alpha.end}]};E.behaviors.push({type:"alpha",config:{alpha:w}})}else i.alpha.list.length===1?i.alpha.list[0].value!==1&&E.behaviors.push({type:"alphaStatic",config:{alpha:i.alpha.list[0].value}}):E.behaviors.push({type:"alpha",config:{alpha:i.alpha}});if(i.acceleration&&(i.acceleration.x||i.acceleration.y)){let w,N;"start"in i.speed?(w=i.speed.start*((e=i.speed.minimumSpeedMultiplier)!==null&&e!==void 0?e:1),N=i.speed.start):(w=i.speed.list[0].value*((r=i.minimumSpeedMultiplier)!==null&&r!==void 0?r:1),N=i.speed.list[0].value),E.behaviors.push({type:"moveAcceleration",config:{accel:i.acceleration,minStart:w,maxStart:N,rotate:!i.noRotation,maxSpeed:i.maxSpeed}})}else if(!((s=i.extraData)===null||s===void 0)&&s.path){let w,N;"start"in i.speed?(N=(o=i.speed.minimumSpeedMultiplier)!==null&&o!==void 0?o:1,i.speed.start===i.speed.end?w={list:[{time:0,value:i.speed.start}]}:w={list:[{time:0,value:i.speed.start},{time:1,value:i.speed.end}]}):(w=i.speed,N=(n=i.minimumSpeedMultiplier)!==null&&n!==void 0?n:1),E.behaviors.push({type:"movePath",config:{path:i.extraData.path,speed:w,minMult:N}})}else if(i.speed)if("start"in i.speed)if(i.speed.start===i.speed.end)E.behaviors.push({type:"moveSpeedStatic",config:{min:i.speed.start*((a=i.speed.minimumSpeedMultiplier)!==null&&a!==void 0?a:1),max:i.speed.start}});else{let w={list:[{time:0,value:i.speed.start},{time:1,value:i.speed.end}]};E.behaviors.push({type:"moveSpeed",config:{speed:w,minMult:i.speed.minimumSpeedMultiplier}})}else i.speed.list.length===1?E.behaviors.push({type:"moveSpeedStatic",config:{min:i.speed.list[0].value*((h=i.minimumSpeedMultiplier)!==null&&h!==void 0?h:1),max:i.speed.list[0].value}}):E.behaviors.push({type:"moveSpeed",config:{speed:i.speed,minMult:(l=i.minimumSpeedMultiplier)!==null&&l!==void 0?l:1}});if(i.scale)if("start"in i.scale){let w=(u=i.scale.minimumScaleMultiplier)!==null&&u!==void 0?u:1;if(i.scale.start===i.scale.end)E.behaviors.push({type:"scaleStatic",config:{min:i.scale.start*w,max:i.scale.start}});else{let N={list:[{time:0,value:i.scale.start},{time:1,value:i.scale.end}]};E.behaviors.push({type:"scale",config:{scale:N,minMult:w}})}}else if(i.scale.list.length===1){let w=(c=i.minimumScaleMultiplier)!==null&&c!==void 0?c:1,N=i.scale.list[0].value;E.behaviors.push({type:"scaleStatic",config:{min:N*w,max:N}})}else E.behaviors.push({type:"scale",config:{scale:i.scale,minMult:(d=i.minimumScaleMultiplier)!==null&&d!==void 0?d:1}});if(i.color)if("start"in i.color)if(i.color.start===i.color.end)i.color.start!=="ffffff"&&E.behaviors.push({type:"colorStatic",config:{color:i.color.start}});else{let w={list:[{time:0,value:i.color.start},{time:1,value:i.color.end}]};E.behaviors.push({type:"color",config:{color:w}})}else i.color.list.length===1?i.color.list[0].value!=="ffffff"&&E.behaviors.push({type:"colorStatic",config:{color:i.color.list[0].value}}):E.behaviors.push({type:"color",config:{color:i.color}});if(i.rotationAcceleration||!((f=i.rotationSpeed)===null||f===void 0)&&f.min||!((p=i.rotationSpeed)===null||p===void 0)&&p.max?E.behaviors.push({type:"rotation",config:{accel:i.rotationAcceleration||0,minSpeed:((m=i.rotationSpeed)===null||m===void 0?void 0:m.min)||0,maxSpeed:((g=i.rotationSpeed)===null||g===void 0?void 0:g.max)||0,minStart:((_=i.startRotation)===null||_===void 0?void 0:_.min)||0,maxStart:((v=i.startRotation)===null||v===void 0?void 0:v.max)||0}}):(!((x=i.startRotation)===null||x===void 0)&&x.min||!((y=i.startRotation)===null||y===void 0)&&y.max)&&E.behaviors.push({type:"rotationStatic",config:{min:((P=i.startRotation)===null||P===void 0?void 0:P.min)||0,max:((H=i.startRotation)===null||H===void 0?void 0:H.max)||0}}),i.noRotation&&E.behaviors.push({type:"noRotation",config:{}}),i.blendMode&&i.blendMode!=="normal"&&E.behaviors.push({type:"blendMode",config:{blendMode:i.blendMode}}),Array.isArray(t)&&typeof t[0]!="string"&&"framerate"in t[0]){for(let w=0;w<t.length;++w)t[w].framerate==="matchLife"&&(t[w].framerate=-1);E.behaviors.push({type:"animatedRandom",config:{anims:t}})}else typeof t!="string"&&"framerate"in t?(t.framerate==="matchLife"&&(t.framerate=-1),E.behaviors.push({type:"animatedSingle",config:{anim:t}})):i.orderedArt&&Array.isArray(t)?E.behaviors.push({type:"textureOrdered",config:{textures:t}}):Array.isArray(t)?E.behaviors.push({type:"textureRandom",config:{textures:t}}):E.behaviors.push({type:"textureSingle",config:{texture:t}});if(i.spawnType==="burst")E.behaviors.push({type:"spawnBurst",config:{start:i.angleStart||0,spacing:i.particleSpacing,distance:0}});else if(i.spawnType==="point")E.behaviors.push({type:"spawnPoint",config:{}});else{let w;i.spawnType==="ring"?w={type:"torus",data:{x:i.spawnCircle.x,y:i.spawnCircle.y,radius:i.spawnCircle.r,innerRadius:i.spawnCircle.minR,affectRotation:!0}}:i.spawnType==="circle"?w={type:"torus",data:{x:i.spawnCircle.x,y:i.spawnCircle.y,radius:i.spawnCircle.r,innerRadius:0,affectRotation:!1}}:i.spawnType==="rect"?w={type:"rect",data:i.spawnRect}:i.spawnType==="polygonalChain"&&(w={type:"polygonalChain",data:i.spawnPolygon}),w&&E.behaviors.push({type:"spawnShape",config:w})}return E}var Of=class extends Oi{constructor(){super(...arguments),this._firstChild=null,this._lastChild=null,this._childCount=0}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get childCount(){return this._childCount}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{let e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this._lastChild?(this._lastChild.nextChild=e,e.prevChild=this._lastChild,this._lastChild=e):this._firstChild=this._lastChild=e,++this._childCount,this._boundsID++,this.onChildrenChange(),this.emit("childAdded",e,this,this._childCount),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this._childCount)throw new Error(`addChildAt: The index ${e} supplied is out of bounds ${this._childCount}`);t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1;let r=t;if(!this._firstChild)this._firstChild=this._lastChild=r;else if(e===0)this._firstChild.prevChild=r,r.nextChild=this._firstChild,this._firstChild=r;else if(e===this._childCount)this._lastChild.nextChild=r,r.prevChild=this._lastChild,this._lastChild=r;else{let s=0,o=this._firstChild;for(;s<e;)o=o.nextChild,++s;o.prevChild.nextChild=r,r.prevChild=o.prevChild,r.nextChild=o,o.prevChild=r}return++this._childCount,this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}addChildBelow(t,e){if(e.parent!==this)throw new Error("addChildBelow: The relative target must be a child of this parent");return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,e.prevChild.nextChild=t,t.prevChild=e.prevChild,t.nextChild=e,e.prevChild=t,this._firstChild===e&&(this._firstChild=t),++this._childCount,this._boundsID++,this.onChildrenChange(),this.emit("childAdded",t,this,this._childCount),t.emit("added",this),t}addChildAbove(t,e){if(e.parent!==this)throw new Error("addChildBelow: The relative target must be a child of this parent");return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,e.nextChild.prevChild=t,t.nextChild=e.nextChild,t.prevChild=e,e.nextChild=t,this._lastChild===e&&(this._lastChild=t),++this._childCount,this._boundsID++,this.onChildrenChange(),this.emit("childAdded",t,this,this._childCount),t.emit("added",this),t}swapChildren(t,e){if(t===e||t.parent!==this||e.parent!==this)return;let{prevChild:r,nextChild:s}=t;t.prevChild=e.prevChild,t.nextChild=e.nextChild,e.prevChild=r,e.nextChild=s,this._firstChild===t?this._firstChild=e:this._firstChild===e&&(this._firstChild=t),this._lastChild===t?this._lastChild=e:this._lastChild===e&&(this._lastChild=t),this.onChildrenChange()}getChildIndex(t){let e=0,r=this._firstChild;for(;r&&r!==t;)r=r.nextChild,++e;if(!r)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this._childCount)throw new Error(`The index ${e} supplied is out of bounds ${this._childCount}`);if(t.parent!==this)throw new Error("The supplied DisplayObject must be a child of the caller");if(t.nextChild&&(t.nextChild.prevChild=t.prevChild),t.prevChild&&(t.prevChild.nextChild=t.nextChild),this._firstChild===t&&(this._firstChild=t.nextChild),this._lastChild===t&&(this._lastChild=t.prevChild),t.nextChild=null,t.prevChild=null,!this._firstChild)this._firstChild=this._lastChild=t;else if(e===0)this._firstChild.prevChild=t,t.nextChild=this._firstChild,this._firstChild=t;else if(e===this._childCount)this._lastChild.nextChild=t,t.prevChild=this._lastChild,this._lastChild=t;else{let r=0,s=this._firstChild;for(;r<e;)s=s.nextChild,++r;s.prevChild.nextChild=t,t.prevChild=s.prevChild,t.nextChild=s,s.prevChild=t}this.onChildrenChange(e)}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{let e=t[0];if(e.parent!==this)return null;e.parent=null,e.transform._parentID=-1,e.nextChild&&(e.nextChild.prevChild=e.prevChild),e.prevChild&&(e.prevChild.nextChild=e.nextChild),this._firstChild===e&&(this._firstChild=e.nextChild),this._lastChild===e&&(this._lastChild=e.prevChild),e.nextChild=null,e.prevChild=null,--this._childCount,this._boundsID++,this.onChildrenChange(),e.emit("removed",this),this.emit("childRemoved",e,this)}return t[0]}getChildAt(t){if(t<0||t>=this._childCount)throw new Error(`getChildAt: Index (${t}) does not exist.`);if(t===0)return this._firstChild;if(t===this._childCount)return this._lastChild;let e=0,r=this._firstChild;for(;e<t;)r=r.nextChild,++e;return r}removeChildAt(t){let e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,e.nextChild&&(e.nextChild.prevChild=e.prevChild),e.prevChild&&(e.prevChild.nextChild=e.nextChild),this._firstChild===e&&(this._firstChild=e.nextChild),this._lastChild===e&&(this._lastChild=e.prevChild),e.nextChild=null,e.prevChild=null,--this._childCount,this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this._childCount){let r=t;e===0&&this._childCount>0&&(e=this._childCount);let s=e,o=s-r;if(o>0&&o<=s){let n=[],a=this._firstChild;for(let u=0;u<=s&&a;++u,a=a.nextChild)u>=r&&n.push(a);let h=n[0].prevChild,l=n[n.length-1].nextChild;l?l.prevChild=h:this._lastChild=h,h?h.nextChild=l:this._firstChild=l;for(let u=0;u<n.length;++u)n[u].parent=null,n[u].transform&&(n[u].transform._parentID=-1),n[u].nextChild=null,n[u].prevChild=null;this._boundsID++,this.onChildrenChange(t);for(let u=0;u<n.length;++u)n[u].emit("removed",this),this.emit("childRemoved",n[u],this,u);return n}else if(o===0&&this._childCount===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;let t,e;for(t=this._firstChild;t;t=e)e=t.nextChild,t.visible&&t.updateTransform()}calculateBounds(){this._bounds.clear(),this._calculateBounds();let t,e;for(t=this._firstChild;t;t=e)if(e=t.nextChild,!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){let r=t._mask.maskObject||t._mask;r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds);this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){let r=gi.prototype.getLocalBounds.call(this,t);if(!e){let s,o;for(s=this._firstChild;s;s=o)o=s.nextChild,s.visible&&s.updateTransform()}return r}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);let e,r;for(e=this._firstChild;e;e=r)r=e.nextChild,e.render(t)}}renderAdvanced(t){t.batch.flush();let e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}r&&t.mask.push(this,this._mask),this._render(t);let s,o;for(s=this._firstChild;s;s=o)o=s.nextChild,s.render(t);t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()}renderCanvas(t){if(!this.visible||this.worldAlpha<=0||!this.renderable)return;this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);let e,r;for(e=this._firstChild;e;e=r)r=e.nextChild,e.renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};pt.registerBehavior(qn);pt.registerBehavior(Kn);pt.registerBehavior(Zn);pt.registerBehavior(Qn);pt.registerBehavior(Jn);pt.registerBehavior(ta);pt.registerBehavior(ea);pt.registerBehavior(ia);pt.registerBehavior(ra);pt.registerBehavior(sa);pt.registerBehavior(oa);pt.registerBehavior(na);pt.registerBehavior(aa);pt.registerBehavior(ha);pt.registerBehavior(la);pt.registerBehavior(ua);pt.registerBehavior(ca);pt.registerBehavior(da);pt.registerBehavior(Ve);pt.registerBehavior(fa);pt.registerBehavior(pa);pt.registerBehavior(ma);var fx;function px(i){return fx=i,i}function mt(){return fx}var _b=0,Vf=class extends st.EventEmitter{constructor(i){super(),this.id=_b++,this.init(i)}set(i,t){if(this[i]===void 0)throw new Error(`Property with name ${i} does not exist.`);switch(i){case"speed":this.speed=t;break;case"volume":this.volume=t;break;case"paused":this.paused=t;break;case"loop":this.loop=t;break;case"muted":this.muted=t;break}return this}get progress(){let{currentTime:i}=this._source;return i/this._duration}get paused(){return this._paused}set paused(i){this._paused=i,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(i){this._playing=!1,this._duration=i.source.duration;let t=this._source=i.source.cloneNode(!1);t.src=i.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),i.context.on("refresh",this.refresh,this),i.context.on("refreshPaused",this.refreshPaused,this),this._media=i}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(i){this._speed=i,this.refresh()}get volume(){return this._volume}set volume(i){this._volume=i,this.refresh()}get loop(){return this._loop}set loop(i){this._loop=i,this.refresh()}get muted(){return this._muted}set muted(i){this._muted=i,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(i){console.warn("HTML Audio does not support filters")}refresh(){let i=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;let e=i.volume*(i.muted?0:1),r=t.volume*(t.muted?0:1),s=this._volume*(this._muted?0:1);this._source.volume=s*e*r,this._source.playbackRate=this._speed*i.speed*t.speed}refreshPaused(){let i=this._media.context,t=this._media.parent,e=this._paused||t.paused||i.paused;e!==this._pausedReal&&(this._pausedReal=e,e?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",e))}play(i){let{start:t,end:e,speed:r,loop:s,volume:o,muted:n}=i;e&&console.assert(e>t,"End time is before start time"),this._speed=r,this._volume=o,this._loop=!!s,this._muted=n,this.refresh(),this.loop&&e!==null&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=t,this._end=e||this._duration,this._start=Math.max(0,this._start-Vf.PADDING),this._end=Math.min(this._end+Vf.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=t,this._source.onloadedmetadata=null,this.emit("progress",t,this._duration),Rt.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){Rt.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){Rt.shared.remove(this._onUpdate,this),this.removeAllListeners();let i=this._source;i&&(i.onended=null,i.onplay=null,i.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}},mc=Vf;mc.PADDING=.1;var qh=class extends st.EventEmitter{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new mc(this)}get isPlayable(){return!!this._source&&this._source.readyState===4}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){let e=this._source,r=this.parent;if(e.readyState===4){r.isLoaded=!0;let h=r.autoPlayStart();t&&setTimeout(()=>{t(null,r,h)},0);return}if(!r.url){t(new Error("sound.url or sound.source must be set"));return}e.src=r.url;let s=()=>{a(),r.isLoaded=!0;let h=r.autoPlayStart();t&&t(null,r,h)},o=()=>{a(),t&&t(new Error("Sound loading has been aborted"))},n=()=>{a();let h=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(h)):console.error(h)},a=()=>{e.removeEventListener("canplaythrough",s),e.removeEventListener("load",s),e.removeEventListener("abort",o),e.removeEventListener("error",n)};e.addEventListener("canplaythrough",s,!1),e.addEventListener("load",s,!1),e.addEventListener("abort",o,!1),e.addEventListener("error",n,!1),e.load()}};var Kh=class{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}};var oo=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],Xf=["audio/mpeg","audio/ogg"],no={};function mx(i){let t={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"',...i||{}},e=document.createElement("audio"),r={},s=/^no$/;oo.forEach(o=>{let n=e.canPlayType(`audio/${o}`).replace(s,""),a=t[o]?e.canPlayType(t[o]).replace(s,""):"";r[o]=!!n||!!a}),Object.assign(no,r)}mx();var Wt=class{static setParamValue(t,e){if(t.setValueAtTime){let r=mt().context;t.setValueAtTime(e,r.audioContext.currentTime)}else t.value=e;return e}};var xb=0,Zh=class extends st.EventEmitter{constructor(t){super(),this.id=xb++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(this[t]===void 0)throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e;break}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){this._filters&&(this._filters?.filter(e=>e).forEach(e=>e.disconnect()),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;let t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;let r=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),o=this._volume*(this._muted?0:1);Wt.setParamValue(this._gain.gain,o*s*r),Wt.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){if(this._filters?.length){this._source.disconnect();let t=this._source;this._filters.forEach(e=>{t.connect(e.destination),t=e}),t.connect(this._gain)}}refreshPaused(){let t=this._media.context,e=this._media.parent,r=this._paused||e.paused||t.paused;r!==this._pausedReal&&(this._pausedReal=r,r?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",r))}play(t){let{start:e,end:r,speed:s,loop:o,volume:n,muted:a,filters:h}=t;r&&console.assert(r>e,"End time is before start time"),this._paused=!1;let{source:l,gain:u}=this._media.nodes.cloneBufferSource();this._source=l,this._gain=u,this._speed=s,this._volume=n,this._loop=!!o,this._muted=a,this._filters=h,this.refresh();let c=this._source.buffer.duration;this._duration=c,this._end=r,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=r,this._source.loopStart=e,this._source.start(0,e)):r?this._source.start(0,e,r-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){Rt.shared.remove(this._updateListener,this),t&&Rt.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._filters?.forEach(t=>t.disconnect()),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){let e=this._now(),r=e-this._lastUpdate;if(r>0||t){let s=this._source.playbackRate.value;this._elapsed+=r*s,this._lastUpdate=e;let o=this._duration,n;if(this._source.loopStart){let a=this._source.loopEnd-this._source.loopStart;n=(this._source.loopStart+this._elapsed%a)/o}else n=this._elapsed%o/o;this._progress=n,this.emit("progress",this._progress,o)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}};var ao=class{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach(e=>{e&&e.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach(r=>{e===null?this._input.connect(r.destination):e.connect(r.destination),e=r}),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}};var gx=class extends ao{constructor(i){let t=i.audioContext,e=t.createBufferSource(),r=t.createGain(),s=t.createAnalyser();e.connect(s),s.connect(r),r.connect(i.destination),super(s,r),this.context=i,this.bufferSource=e,this.gain=r,this.analyser=s}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(gx.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){let i=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=i.buffer,Wt.setParamValue(t.playbackRate,i.playbackRate.value),t.loop=i.loop;let e=this.context.audioContext.createGain();return t.connect(e),e.connect(this.destination),{source:t,gain:e}}get bufferSize(){return this.script.bufferSize}},gc=gx;gc.BUFFER_SIZE=0;var ho=class{init(t){this.parent=t,this._nodes=new gc(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new Zh(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){let e=this.parent.url,r=await F.ADAPTER.fetch(e);this._decode(await r.arrayBuffer(),t)}_decode(t,e){let r=(s,o)=>{if(s)e&&e(s);else{this.parent.isLoaded=!0,this.buffer=o;let n=this.parent.autoPlayStart();e&&e(null,this.parent,n)}};t instanceof AudioBuffer?r(null,t):this.parent.context.decode(t,r)}};var ga=class{static from(i){let t={};typeof i=="string"?t.url=i:i instanceof ArrayBuffer||i instanceof AudioBuffer||i instanceof HTMLAudioElement?t.source=i:Array.isArray(i)?t.url=i:t=i,t={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...t},Object.freeze(t);let e=mt().useLegacy?new qh:new ho;return new ga(e,t)}constructor(i,t){this.media=i,this.options=t,this._instances=[],this._sprites={},this.media.init(this);let e=t.complete;this._autoPlayOptions=e?{complete:e}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=Array.isArray(t.url)?this.preferUrl(t.url):t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}preferUrl(i){let[t]=i.map(e=>({url:e,ext:st.path.extname(e).slice(1)})).filter(({ext:e})=>no[e]).sort((e,r)=>oo.indexOf(e.ext)-oo.indexOf(r.ext));if(!t)throw new Error("No supported file type found");return t.url}get context(){return mt().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(i){this._paused=i,this.refreshPaused()}get speed(){return this._speed}set speed(i){this._speed=i,this.refresh()}get filters(){return this.media.filters}set filters(i){this.media.filters=i}addSprites(i,t){if(typeof i=="object"){let r={};for(let s in i)r[s]=this.addSprites(s,i[s]);return r}console.assert(!this._sprites[i],`Alias ${i} is already taken`);let e=new Kh(this,t);return this._sprites[i]=e,e}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(i){if(i){let t=this._sprites[i];t!==void 0&&(t.destroy(),delete this._sprites[i])}else for(let t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let i=this._instances.length-1;i>=0;i--)this._instances[i].stop();return this}play(i,t){let e;if(typeof i=="string"?e={sprite:i,loop:this.loop,complete:t}:typeof i=="function"?(e={},e.complete=i):e=i,e={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...e||{}},e.sprite){let s=e.sprite;console.assert(!!this._sprites[s],`Alias ${s} is not available`);let o=this._sprites[s];e.start=o.start+(e.start||0),e.end=o.end,e.speed=o.speed||1,e.loop=o.loop||e.loop,delete e.sprite}if(e.offset&&(e.start=e.offset),!this.isLoaded)return this._preloadQueue?new Promise(s=>{this._preloadQueue.push(()=>{s(this.play(e))})}):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=e,new Promise((s,o)=>{this._preload((n,a,h)=>{this._preloadQueue.forEach(l=>l()),this._preloadQueue=null,n?o(n):(e.loaded&&e.loaded(n,a,h),s(h))})}));(this.singleInstance||e.singleInstance)&&this._removeInstances();let r=this._createInstance();return this._instances.push(r),this.isPlaying=!0,r.once("end",()=>{e.complete&&e.complete(this),this._onComplete(r)}),r.once("stop",()=>{this._onComplete(r)}),r.play(e),r}refresh(){let i=this._instances.length;for(let t=0;t<i;t++)this._instances[t].refresh()}refreshPaused(){let i=this._instances.length;for(let t=0;t<i;t++)this._instances[t].refreshPaused()}get volume(){return this._volume}set volume(i){this._volume=i,this.refresh()}get muted(){return this._muted}set muted(i){this._muted=i,this.refresh()}get loop(){return this._loop}set loop(i){this._loop=i,this.refresh()}_preload(i){this.media.load(i)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let i;return this.autoPlay&&(i=this.play(this._autoPlayOptions)),i}_removeInstances(){for(let i=this._instances.length-1;i>=0;i--)this._poolInstance(this._instances[i]);this._instances.length=0}_onComplete(i){if(this._instances){let t=this._instances.indexOf(i);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(i)}_createInstance(){if(ga._pool.length>0){let i=ga._pool.pop();return i.init(this.media),i}return this.media.create()}_poolInstance(i){i.destroy(),ga._pool.indexOf(i)<0&&ga._pool.push(i)}},ps=ga;ps._pool=[];var Qh=class extends st.EventEmitter{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}};var Lr=class extends ao{constructor(){let t=window,e=new Lr.AudioContext,r=e.createDynamicsCompressor(),s=e.createAnalyser();s.connect(r),r.connect(e.destination),super(s,r),this.autoPause=!0,this._ctx=e,this._offlineCtx=new Lr.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=r,this.analyser=s,this.events=new st.EventEmitter,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked=e.state==="suspended"&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){if(!this.autoPause)return;let t=this._ctx.state;(t==="suspended"||t==="interrupted"||!this._locked)&&(this.paused=this._pausedOnBlur,this.refreshPaused())}onBlur(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))}_unlock(){this._locked&&(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){let t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),t.context.state==="suspended"&&t.context.resume()}static get AudioContext(){let t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){let t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();let t=this._ctx;typeof t.close<"u"&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&this._ctx.state==="running"?this._ctx.suspend():!t&&this._ctx.state==="suspended"&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){let r=o=>{e(new Error(o?.message||"Unable to decode file"))},s=this._offlineCtx.decodeAudioData(t,o=>{e(null,o)},r);s&&s.catch(r)}};var _c=class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new Lr),this._htmlAudioContext=new Qh,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return Lr.AudioContext!==null}add(t,e){if(typeof t=="object"){let o={};for(let n in t){let a=this._getOptions(t[n],e);o[n]=this.add(n,a)}return o}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof ps)return this._sounds[t]=e,e;let r=this._getOptions(e),s=ps.from(r);return this._sounds[t]=s,s}_getOptions(t,e){let r;return typeof t=="string"?r={url:t}:Array.isArray(t)?r={url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?r={source:t}:r=t,r={...r,...e||{}},r}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}get disableAutoPause(){return!this._webAudioContext.autoPause}set disableAutoPause(t){this._webAudioContext.autoPause=!t}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(let t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(let t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){let r=!!this._sounds[t];return e&&console.assert(r,`No sound matching alias '${t}'.`),r}isPlaying(){for(let t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){let r=this.find(t);return e!==void 0&&(r.volume=e),r.volume}speed(t,e){let r=this.find(t);return e!==void 0&&(r.speed=e),r.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}};var Ac={};ya(Ac,{DistortionFilter:()=>xc,EqualizerFilter:()=>_i,Filter:()=>Yt,MonoFilter:()=>bc,ReverbFilter:()=>vc,StereoFilter:()=>yc,StreamFilter:()=>Tc,TelephoneFilter:()=>Ec});var Yt=class{constructor(t,e){this.init(t,e)}init(t,e){this.destination=t,this.source=e||t}connect(t){this.source?.connect(t)}disconnect(){this.source?.disconnect()}destroy(){this.disconnect(),this.destination=null,this.source=null}};var gt=class extends Yt{constructor(i=0,t=0,e=0,r=0,s=0,o=0,n=0,a=0,h=0,l=0){let u=[],c=[{f:gt.F32,type:"lowshelf",gain:i},{f:gt.F64,type:"peaking",gain:t},{f:gt.F125,type:"peaking",gain:e},{f:gt.F250,type:"peaking",gain:r},{f:gt.F500,type:"peaking",gain:s},{f:gt.F1K,type:"peaking",gain:o},{f:gt.F2K,type:"peaking",gain:n},{f:gt.F4K,type:"peaking",gain:a},{f:gt.F8K,type:"peaking",gain:h},{f:gt.F16K,type:"highshelf",gain:l}];mt().useLegacy||(u=c.map(d=>{let f=mt().context.audioContext.createBiquadFilter();return f.type=d.type,Wt.setParamValue(f.Q,1),f.frequency.value=d.f,Wt.setParamValue(f.gain,d.gain),f})),super(u[0],u[u.length-1]),this.bands=u,this.bandsMap={};for(let d=0;d<this.bands.length;d++){let f=this.bands[d];d>0&&this.bands[d-1].connect(f),this.bandsMap[f.frequency.value]=f}}setGain(i,t=0){if(!this.bandsMap[i])throw new Error(`No band found for frequency ${i}`);Wt.setParamValue(this.bandsMap[i].gain,t)}getGain(i){if(!this.bandsMap[i])throw new Error(`No band found for frequency ${i}`);return this.bandsMap[i].gain.value}set f32(i){this.setGain(gt.F32,i)}get f32(){return this.getGain(gt.F32)}set f64(i){this.setGain(gt.F64,i)}get f64(){return this.getGain(gt.F64)}set f125(i){this.setGain(gt.F125,i)}get f125(){return this.getGain(gt.F125)}set f250(i){this.setGain(gt.F250,i)}get f250(){return this.getGain(gt.F250)}set f500(i){this.setGain(gt.F500,i)}get f500(){return this.getGain(gt.F500)}set f1k(i){this.setGain(gt.F1K,i)}get f1k(){return this.getGain(gt.F1K)}set f2k(i){this.setGain(gt.F2K,i)}get f2k(){return this.getGain(gt.F2K)}set f4k(i){this.setGain(gt.F4K,i)}get f4k(){return this.getGain(gt.F4K)}set f8k(i){this.setGain(gt.F8K,i)}get f8k(){return this.getGain(gt.F8K)}set f16k(i){this.setGain(gt.F16K,i)}get f16k(){return this.getGain(gt.F16K)}reset(){this.bands.forEach(i=>{Wt.setParamValue(i.gain,0)})}destroy(){this.bands.forEach(i=>{i.disconnect()}),this.bands=null,this.bandsMap=null}},_i=gt;_i.F32=32;_i.F64=64;_i.F125=125;_i.F250=250;_i.F500=500;_i.F1K=1e3;_i.F2K=2e3;_i.F4K=4e3;_i.F8K=8e3;_i.F16K=16e3;var xc=class extends Yt{constructor(t=0){let e;if(!mt().useLegacy){let{audioContext:r}=mt().context;e=r.createWaveShaper()}super(e),this._distortion=e,this.amount=t}set amount(t){if(this._amount=t,mt().useLegacy)return;let e=t*1e3,r=44100,s=new Float32Array(r),o=Math.PI/180,n=0,a;for(;n<r;++n)a=n*2/r-1,s[n]=(3+e)*a*20*o/(Math.PI+e*Math.abs(a));this._distortion.curve=s,this._distortion.oversample="4x"}get amount(){return this._amount}destroy(){this._distortion=null,super.destroy()}};var yc=class extends Yt{constructor(t=0){let e,r,s;if(!mt().useLegacy){let{audioContext:o}=mt().context;o.createStereoPanner?(e=o.createStereoPanner(),s=e):(r=o.createPanner(),r.panningModel="equalpower",s=r)}super(s),this._stereo=e,this._panner=r,this.pan=t}set pan(t){this._pan=t,this._stereo?Wt.setParamValue(this._stereo.pan,t):this._panner&&this._panner.setPosition(t,0,1-Math.abs(t))}get pan(){return this._pan}destroy(){super.destroy(),this._stereo=null,this._panner=null}};var vc=class extends Yt{constructor(t=3,e=2,r=!1){super(null),this._seconds=this._clamp(t,1,50),this._decay=this._clamp(e,0,100),this._reverse=r,this._rebuild()}_clamp(t,e,r){return Math.min(r,Math.max(e,t))}get seconds(){return this._seconds}set seconds(t){this._seconds=this._clamp(t,1,50),this._rebuild()}get decay(){return this._decay}set decay(t){this._decay=this._clamp(t,0,100),this._rebuild()}get reverse(){return this._reverse}set reverse(t){this._reverse=t,this._rebuild()}_rebuild(){if(mt().useLegacy)return;let{audioContext:t}=mt().context,e=t.sampleRate,r=e*this._seconds,s=t.createBuffer(2,r,e),o=s.getChannelData(0),n=s.getChannelData(1),a;for(let l=0;l<r;l++)a=this._reverse?r-l:l,o[l]=(Math.random()*2-1)*Math.pow(1-a/r,this._decay),n[l]=(Math.random()*2-1)*Math.pow(1-a/r,this._decay);let h=t.createConvolver();h.buffer=s,this.init(h)}};var bc=class extends Yt{constructor(){let t,e;if(!mt().useLegacy){let{audioContext:r}=mt().context;e=r.createChannelSplitter(),t=r.createChannelMerger(),t.connect(e)}super(t,e),this._merger=t}destroy(){this._merger?.disconnect(),this._merger=null,super.destroy()}};var Tc=class extends Yt{constructor(){let t,e;if(!mt().useLegacy){let{audioContext:r}=mt().context;t=r.createMediaStreamDestination(),e=r.createMediaStreamSource(t.stream)}super(t,e),this._stream=t?.stream}get stream(){return this._stream}destroy(){this._stream=null,super.destroy()}};var Ec=class extends Yt{constructor(){let t,e;if(!mt().useLegacy){let{audioContext:r}=mt().context,s=r.createBiquadFilter(),o=r.createBiquadFilter(),n=r.createBiquadFilter(),a=r.createBiquadFilter();s.type="lowpass",Wt.setParamValue(s.frequency,2e3),o.type="lowpass",Wt.setParamValue(o.frequency,2e3),n.type="highpass",Wt.setParamValue(n.frequency,500),a.type="highpass",Wt.setParamValue(a.frequency,500),s.connect(o),o.connect(n),n.connect(a),t=s,e=a}super(t,e)}};var _x={loader:R.LoadParser,resolver:R.ResolveParser,cache:R.CacheParser,detection:R.DetectionParser};D.handle(R.Asset,i=>{let t=i.ref;Object.entries(_x).filter(([e])=>!!t[e]).forEach(([e,r])=>D.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{let t=i.ref;Object.keys(_x).filter(e=>!!t[e]).forEach(e=>D.remove(t[e]))});var wc=class{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}};function xi(i,t){if(Array.isArray(t)){for(let e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function yi(i,t){let e=i.split("?")[0],r=st.path.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}var Re=(i,t)=>(Array.isArray(i)||(i=[i]),t?i.map(e=>typeof e=="string"?t(e):e):i);function xx(i,t,e,r,s){let o=t[e];for(let n=0;n<o.length;n++){let a=o[n];e<t.length-1?xx(i.replace(r[e],a),t,e+1,r,s):s.push(i.replace(r[e],a))}}function Cc(i){let t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){let s=[];e.forEach(o=>{let n=o.substring(1,o.length-1).split(",");s.push(n)}),xx(i,s,0,e,r)}else r.push(i);return r}var Or=i=>!Array.isArray(i);var Wf=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){let e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){let r=Re(t),s;for(let a=0;a<this.parsers.length;a++){let h=this.parsers[a];if(h.test(e)){s=h.getCacheableAssets(r,e);break}}s||(s={},r.forEach(a=>{s[a]=e}));let o=Object.keys(s),n={cacheKeys:o,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,n)}),o.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),e instanceof it){let a=e;r.forEach(h=>{a.baseTexture!==it.EMPTY.baseTexture&&ot.addToCache(a.baseTexture,h),it.addToCache(a,h)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}let e=this._cacheMap.get(t);e.cacheKeys.forEach(s=>{this._cache.delete(s)}),e.keys.forEach(s=>{this._cacheMap.delete(s)})}get parsers(){return this._parsers}},ms=new Wf;var Sc=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){let r={promise:null,parser:null};return r.promise=(async()=>{let s=null,o=null;if(e.loadParser&&(o=this._parserHash[e.loadParser],o||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!o){for(let n=0;n<this.parsers.length;n++){let a=this.parsers[n];if(a.load&&a.test?.(t,e,this)){o=a;break}}if(!o)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await o.load(t,e,this),r.parser=o;for(let n=0;n<this.parsers.length;n++){let a=this.parsers[n];a.parse&&a.parse&&await a.testParse?.(s,e,this)&&(s=await a.parse(s,e,this)||s,r.parser=a)}return s})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0,s={},o=Or(t),n=Re(t,l=>({src:l})),a=n.length,h=n.map(async l=>{let u=st.path.toAbsolute(l.src);if(!s[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),s[l.src]=await this.promiseCache[u].promise,e&&e(++r/a)}catch(c){throw delete this.promiseCache[u],delete s[l.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(h),o?s[n[0].src]:s}async unload(t){let r=Re(t,s=>({src:s})).map(async s=>{let o=st.path.toAbsolute(s.src),n=this.promiseCache[o];if(n){let a=await n.promise;n.parser?.unload?.(a,s,this),delete this.promiseCache[o]}});await Promise.all(r)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}};var Pe=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(Pe||{});var Eb=".json",Ab="application/json",$f={extension:{type:R.LoadParser,priority:Pe.Low},name:"loadJson",test(i){return xi(i,Ab)||yi(i,Eb)},async load(i){return await(await F.ADAPTER.fetch(i)).json()}};D.add($f);var wb=".txt",Cb="text/plain",jf={name:"loadTxt",extension:{type:R.LoadParser,priority:Pe.Low},test(i){return xi(i,Cb)||yi(i,wb)},async load(i){return await(await F.ADAPTER.fetch(i)).text()}};D.add(jf);var Sb=["normal","bold","100","200","300","400","500","600","700","800","900"],Ib=[".ttf",".otf",".woff",".woff2"],Rb=["font/ttf","font/otf","font/woff","font/woff2"];function zf(i){let t=st.path.extname(i);return st.path.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}var Yf={extension:{type:R.LoadParser,priority:Pe.Low},name:"loadWebFont",test(i){return xi(i,Rb)||yi(i,Ib)},async load(i,t){let e=F.ADAPTER.getFontFaceSet();if(e){let r=[],s=t.data?.family??zf(i),o=t.data?.weights?.filter(a=>Sb.includes(a))??["normal"],n=t.data??{};for(let a=0;a<o.length;a++){let h=o[a],l=new FontFace(s,`url(${encodeURI(i)})`,{...n,weight:h});await l.load(),e.add(l),r.push(l)}return r.length===1?r[0]:r}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>F.ADAPTER.getFontFaceSet().delete(t))}};D.add(Yf);var yx=0,qf,Pb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",Mb={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Pb}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Bb={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},Kf,Zf=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{let e=URL.createObjectURL(new Blob([Mb.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",s=>{r.terminate(),URL.revokeObjectURL(e),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){qf===void 0&&(qf=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<qf&&(Kf||(Kf=URL.createObjectURL(new Blob([Bb.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Kf),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();let r=new Promise((s,o)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:o})});return this.next(),r}next(){if(!this.queue.length)return;let t=this.getWorker();if(!t)return;let e=this.queue.pop(),r=e.id;this.resolveHash[yx]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:yx++,id:r})}},Qf=new Zf;function _a(i,t,e){let r=new it(i);return r.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),r}var Fb=[".jpeg",".jpg",".png",".webp",".avif"],Db=["image/jpeg","image/png","image/webp","image/avif"];async function Jf(i){let t=await F.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);let e=await t.blob();return await createImageBitmap(e)}var Ur={name:"loadTextures",extension:{type:R.LoadParser,priority:Pe.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return xi(i,Db)||yi(i,Fb)},async load(i,t,e){let r=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Qf.isImageBitmapSupported()?r=await Qf.loadImageBitmap(i):r=await Jf(i):r=await new Promise(o=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=i,r.complete?o(r):r.onload=()=>{o(r)}});let s=new ot(r,{resolution:st.getResolutionOfUrl(i),...t.data});return s.resource.src=i,_a(s,e,i)},unload(i){i.destroy(!0)}};D.add(Ur);var Nb=".svg",Lb="image/svg+xml",tp={extension:{type:R.LoadParser,priority:Pe.High},name:"loadSVG",test(i){return xi(i,Lb)||yi(i,Nb)},async testParse(i){return Nr.test(i)},async parse(i,t,e){let r=new Nr(i,t?.data?.resourceOptions),s=new ot(r,{resolution:st.getResolutionOfUrl(i),...t?.data});s.resource.src=i;let o=_a(s,e,i);return t?.data?.resourceOptions?.autoLoad||await r.load(),o},async load(i,t){return(await F.ADAPTER.fetch(i)).text()},unload:Ur.unload};D.add(tp);var Ic=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{let e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){let r=[];Array.isArray(e)?e.forEach(s=>{if(typeof s.name=="string"){let o=this._createBundleAssetId(t,s.name);r.push(o),this.add([s.name,o],s.srcs,s.data)}else{let o=s.name.map(n=>this._createBundleAssetId(t,n));o.forEach(n=>{r.push(n)}),this.add([...s.name,...o],s.srcs)}}):Object.keys(e).forEach(s=>{r.push(this._createBundleAssetId(t,s)),this.add([s,this._createBundleAssetId(t,s)],e[s])}),this._bundles[t]=r}add(t,e,r){let s=Re(t);s.forEach(n=>{this.hasKey(n)&&console.warn(`[Resolver] already has key: ${n} overwriting`)}),Array.isArray(e)||(typeof e=="string"?e=Cc(e):e=[e]);let o=e.map(n=>{let a=n;if(typeof n=="string"){let h=!1;for(let l=0;l<this._parsers.length;l++){let u=this._parsers[l];if(u.test(n)){a=u.parse(n),h=!0;break}}h||(a={src:n})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=s),(this._basePath||this._rootPath)&&(a.src=st.path.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=a.data??r,a});s.forEach(n=>{this._assetMap[n]=o})}resolveBundle(t){let e=Or(t);t=Re(t);let r={};return t.forEach(s=>{let o=this._bundles[s];if(o){let n=this.resolve(o),a={};for(let h in n){let l=n[h];a[this._extractAssetIdFromBundle(s,h)]=l}r[s]=a}}),e?r[t[0]]:r}resolveUrl(t){let e=this.resolve(t);if(typeof t!="string"){let r={};for(let s in e)r[s]=e[s].src;return r}return e.src}resolve(t){let e=Or(t);t=Re(t);let r={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let o=this._assetMap[s],n=this._getPreferredOrder(o),a=o[0];n?.priority.forEach(h=>{n.params[h].forEach(l=>{let u=o.filter(c=>c[h]?c[h]===l:!1);u.length&&(o=u)})}),this._resolverHash[s]=o[0]??a}else{let o=s;(this._basePath||this._rootPath)&&(o=st.path.toAbsolute(o,this._basePath,this._rootPath)),o=this._appendDefaultSearchParams(o),this._resolverHash[s]={src:o}}r[s]=this._resolverHash[s]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){let r=t[0],s=this._preferredOrder.find(o=>o.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;let e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}};var Rc=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Ic,this.loader=new Sc,this.cache=ms,this._backgroundLoader=new wc(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let o=t.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}let e=t.texturePreference?.resolution??1,r=typeof e=="number"?[e]:e,s=[];if(t.texturePreference?.format){let o=t.texturePreference?.format;s=typeof o=="string"?[o]:o;for(let n of this._detections)await n.test()||(s=await n.remove(s))}else for(let o of this._detections)await o.test()&&(s=await o.add(s));this.resolver.prefer({params:{format:s,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r){this.resolver.add(t,e,r)}async load(t,e){this._initialized||await this.init();let r=Or(t),s=Re(t).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):(this.resolver.hasKey(a)||this.resolver.add(a,a),a)),o=this.resolver.resolve(s),n=await this._mapLoadToResolve(o,e);return r?n[s[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);let s=this.resolver.resolveBundle(t),o={},n=Object.keys(s),a=0,h=0,l=()=>{e?.(++a/h)},u=n.map(c=>{let d=s[c];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{o[c]=f})});return await Promise.all(u),r?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ms.get(t);let e={};for(let r=0;r<t.length;r++)e[r]=ms.get(t[r]);return e}async _mapLoadToResolve(t,e){let r=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;let o=await this.loader.load(r,e);this._backgroundLoader.active=!0;let n={};return r.forEach((a,h)=>{let l=o[a.src],u=[a.src];a.alias&&u.push(...a.alias),n[s[h]]=l,ms.set(u,l)}),n}async unload(t){this._initialized||await this.init();let e=Re(t).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Re(t);let e=this.resolver.resolveBundle(t),r=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(r)}async _unloadFromResolved(t){let e=Object.values(t);e.forEach(r=>{ms.remove(r.src)}),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return Ur.config.preferWorkers}set preferWorkers(t){et("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}},Jh=new Rc;D.handleByList(R.LoadParser,Jh.loader.parsers).handleByList(R.ResolveParser,Jh.resolver.parsers).handleByList(R.CacheParser,Jh.cache.parsers).handleByList(R.DetectionParser,Jh.detections);var ep={extension:R.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof it),getCacheableAssets:(i,t)=>{let e={};return i.forEach(r=>{t.forEach((s,o)=>{e[r+(o===0?"":o+1)]=s})}),e}};D.add(ep);var ip={extension:{type:R.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;let i="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await F.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};D.add(ip);var rp={extension:{type:R.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;let i="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await F.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};D.add(rp);var vx=["png","jpg","jpeg"],sp={extension:{type:R.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...vx],remove:async i=>i.filter(t=>!vx.includes(t))};D.add(sp);var op={extension:R.ResolveParser,test:Ur.test,parse:i=>({resolution:parseFloat(F.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i})};D.add(op);var bx=i=>{let t=i.src;return i?.alias?.[0]??st.path.basename(t,st.path.extname(t))},Tx={extension:R.Asset,detection:{test:async()=>!0,add:async i=>[...i,...oo.filter(t=>no[t])],remove:async i=>i.filter(t=>i.includes(t))},loader:{extension:{type:[R.LoadParser],priority:Pe.High},test(i){let t=st.path.extname(i).slice(1);return!!no[t]||Xf.some(e=>i.startsWith(`data:${e}`))},async load(i,t){let e=await new Promise((r,s)=>ps.from({...t.data,url:i,preload:!0,loaded(o,n){o?s(o):r(n),t.data?.loaded?.(o,n)}}));return mt().add(bx(t),e),e},async unload(i,t){mt().remove(bx(t))}}};D.add(Tx);var Ex=px(new _c);var Pc=rf;Pc.particles=Hf;Pc.sound=Ex;Pc.sound.filters=Ac;window.PIXI=Pc;})();
//# sourceMappingURL=pixi.js.map
